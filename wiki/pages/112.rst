看门狗
======

   作者：朱汪斌 楼康华 更新时间：2020年8月8日 关键字： 看门狗 dog

概述
----

Air724UG
内部已经自带了看门狗，通常情况下不需要外加硬件看门狗，如果对系统稳定性有极高的要求，可以外加硬件看门狗Luat153B

参考电路
--------

Luat153B 是上海合宙通信科技有限公司推出的一款硬件看门狗芯片，可以配合
Luat 模块一起使用。

如果超过4分钟没有给 Luat153B 喂狗，Luat153B
将会重启模块。由于模块的软件升级时间是在1分钟内，故在模块升级软件的时候不会受到
Luat153B 的干扰；

配合 Air724UG 使用时的参考电路如下：

.. image:: http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200923141137829_WatchDog.png

Luat153B 的 VDD 输入范围是2.4-5.5V , 可以由VBAT直接供电； Luat153B 的第
2 脚 WD_EN 通过100K电阻拉高，上电后自动工作； R40 和 C55
是一个上电复位电路，保障 Luat153B 的稳定工作； Luat153B 的第 6 脚 WDI
是喂狗输入管脚，WDI 管脚的电压域 VBAT,
无法和模块直接相连，故这里加了一颗 NPN 三极管 Q14
来做电平转换,模块的喂狗输出管脚默认使用 GPIO_7 ; Luat153B 的第 5 脚
RESET_OUT
用来控制给模块断电重启。如果模块的电源输入管脚加了比较大的电容，建议增加一颗
NMOS 管来给模块放电，保证模块完全掉电； Luat153B 的第 7 脚 POWER_ON_OUT
用来在模块断电重启以后拉低 PWRKEY 管脚使模块重新开机；

--------------

看门狗LUA接口
-------------

--------------

## 软看门狗
-----------

-  说明

**软件实现的看门狗,超时后会调用restart接口重启模块,软件出现
异常或者阻塞时,软看门狗不起作用**

--------------

**rtos.openSoftDog**

打开看门狗接口

-  语法

.. code:: lua

   rtos.openSoftDog(timeout)

-  参数

======= ========
参数    释义
======= ========
timeout 超时时间
======= ========

-  返回值

无

--------------

**rtos.eatSoftDog**

喂狗接口

-  语法

.. code:: lua

   rtos.eatSoftDog()

-  参数

无

-  返回值

无

--------------

**rtos.closeSoftDog**

关闭接口

-  语法

.. code:: lua

   rtos.closeSoftDog()

-  参数

无

-  返回值

无

--------------

## 硬件看门狗
-------------

-  说明

模块启动后，会配置pmu硬件看门狗, 超时时间20秒， 喂狗时间4s，
一旦系统出现异常，看门狗超时就会重启模块

--------------

相关资料以及购买链接
--------------------

相关开发板购买链接

`Air724UG开发板 <http://m.openluat.com/product/1264>`__

`Air724 开发板使用说明 <https://doc.luatos.wiki/103/>`__

常见问题
--------

https://doc.luatos.wiki/638/
