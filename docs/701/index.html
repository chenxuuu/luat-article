<!DOCTYPE html>

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>X、合宙Air模块Luat开发：全网首发，通过iic直接驱动OLED，720Sl开始有显时代 [ Luat doc 社区文章静态页面 ]</title>

    <!-- stylesheets list from config.yml -->

      <link rel="stylesheet" href="/css/iLiKE.css">




<meta name="generator" content="Hexo 5.3.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="https://iot.openluat.com/assets/img/logo.jpg"></img>
        </a>
      </div>
      <div class="menu-right">







          <a href="/">首页</a>







          <a href="/archives">归档</a>







          <a href="https://luatdoc.papapoi.com/wiki/">关于</a>

      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">X、合宙Air模块Luat开发：全网首发，通过iic直接驱动OLED，720Sl开始有显时代</h1>
<article class="post markdown-style">
  <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里查看所有博文</a></p>
<blockquote>
<p>本系列博客，理论上适用于合宙的Air202、Air268、Air720x、Air720S以及最近发布的Air720U（我还没拿到样机，应该也能支持）。</p>
</blockquote>
<blockquote>
<p>先不管支不支持，如果你用的是合宙的模块，那都不妨一试，也许会有意外收获<br>我使用的是Air720SL模块，如果在其他模块上不能用，那就是底层core固件暂时还没有支持，这里的代码是没有问题的。例程仅供参考！</p>
</blockquote>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><blockquote>
<p>这里我把博客标题设置为X，是因为本系列教程按照正常的学习顺序，不应该先发OLED驱动，还有好多基础知识都还没讲到，本系列教程截至今日，才讲到模拟量采集，所以看本篇博客大家可能会有点不知所云<br><img src="https://img-blog.csdnimg.cn/20200225142340236.png" alt="在这里插入图片描述"></p>
</blockquote>
<blockquote>
<p>用过2g模块的同志，应该知道2g模块官方支持disp驱动库，直接调用库函数就可以很简单实现oled或者lcd驱动</p>
<p>但是！！！4g模块暂时还没有disp驱动（后续应该会支持），所以现在是无法直接调用库函数驱动OLED的！！！！！<br><img src="https://img-blog.csdnimg.cn/20200225142458600.png" alt="在这里插入图片描述"></p>
</blockquote>
<blockquote>
<p>所谓没有条件那就创造条件，正好这几天闲的没事干，研究了一下通过iic直接驱动OLED，在逻辑分析仪没有带回来的情况下，运气好到爆竟然把驱动调试出来了这里要感谢社区大神<code>Miuser</code>没有他帮助调试那么今天就见不到这篇文章了，既然驱动开发出来了本着开源的思想，就把OLED驱动分享出来，独乐乐不如众乐乐<br><img src="https://img-blog.csdnimg.cn/20200225142203906.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</blockquote>
<blockquote>
<p>这里我提供<code>两种</code>驱动OLED的方式，</p>
</blockquote>
<ul>
<li>第一种驱动是实时从字库读取字模，用到谁就读谁，然后直接通过iic找到对应的地址写入，实时读写。这种驱动没有缓存，所占用的内存极小，同时刷屏速度也较低，刷屏速度取决与读取字库的速度，只要文件没有读取出来，就算iic速度再快也不行，这就是传说中的木桶短板效应<br><img src="https://img-blog.csdnimg.cn/20200225122128636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><blockquote>
<p>木桶定律是讲一只水桶能装多少水取决于它最短的那块木板 。一只木桶想盛满水，必须每块木板都一样平齐且无破损，如果这只桶的木板中有一块不齐或者某块木板下面有破洞，这只桶就无法盛满水。<br><img src="https://img-blog.csdnimg.cn/20200225142917102.png" alt="在这里插入图片描述"></p>
</blockquote>
</li>
<li>第二种驱动方式是建立一个128*64  bit的缓存区，所需要的缓存是1K字节ram，这种方法刷新速度理论上要比第一种驱动要快，虽然第二种驱动流程多了一步，但是用户只能在最后一步能感受到刷屏已经开始，所以第二种驱动方式给人的感觉刷屏是更快的<br><img src="https://img-blog.csdnimg.cn/20200225122552131.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><blockquote>
<p>但是第二种驱动方式是全屏刷新，每次刷新数据都较多，所以在低速iic上，刷新速度优势不是特别明显，高速iic刷新速度是低速iic的刷新速度的四倍<br><img src="https://img-blog.csdnimg.cn/20200225122503330.png" alt="在这里插入图片描述"><br>我现在使用的是测试版本v0009，<code>目前官方发布的版本是v0008，很不幸v0008的iic驱动时序有问题，并不能点亮oled</code>，据内部消息近期应该会更新v0009到时候小伙伴们就能愉快的玩耍了<br>我现在使用的v0009其实也有问题，高速iic并不能点亮oled，所以我这里第二种驱动方式优势并不明显，想体验丝滑般流畅，还得等等</p>
</blockquote>
</li>
</ul>
<h1 id="二、编写第1版测试程序（不带缓存）"><a href="#二、编写第1版测试程序（不带缓存）" class="headerlink" title="二、编写第1版测试程序（不带缓存）"></a>二、编写第1版测试程序（不带缓存）</h1><blockquote>
<p> 第一版测试程序实际我只做了英文字库驱动，也不支持多字库兼容，也不支持画图形。后来因为改写第二版驱动，个人时间有限，第一版驱动中文字库支持还是由社区大神<code>Miuser</code>实现的，不过目前的功能也比较简单，<code>只支持16X16的中文和16X8的ascii字库</code>，后面我也懒得改了，就暂时这样</p>
</blockquote>
<h2 id="1、目录说明"><a href="#1、目录说明" class="headerlink" title="1、目录说明"></a>1、目录说明</h2><blockquote>
<p>文章末尾我会提供库文件以及字库的下载地址</p>
</blockquote>
<blockquote>
<p>第1版测试程序目录结构如下<br><img src="https://img-blog.csdnimg.cn/20200225130206623.png" alt="在这里插入图片描述"></p>
</blockquote>
<ul>
<li><code>ASCII_lib.bin</code>：                        16*8            Ascii字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>GB2312_lib.bin</code>：                    16*16          GB2312字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>i2c_ssd1306_oled.lua</code>：        IIC   ssd1306    OLED屏驱动库</li>
<li><code>main.lua</code>：                            DEMO文件</li>
</ul>
<p>注意：文件名不建议更改，如果更改了文件名，需要把驱动库中的用户配置区也一并更改，此字库<code>不兼容第二版oled驱动程序</code>，不要随意替换，<code>不支持第三方字库</code></p>
<h2 id="2、用户配置"><a href="#2、用户配置" class="headerlink" title="2、用户配置"></a>2、用户配置</h2><p>本驱动支持2g模块和4g模块，需要用户改动的库文件如下，只要把字库文件地址改下就行了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">-------------------------------用户配置区域------------------------------------------</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">--local fontfile_ascii = <span class="string">&quot;/ldata/ASCII_lib.bin&quot;</span> --字库文件的地址，<span class="number">2</span>G模块</span><br><span class="line">--local fontfile_gb2312 = <span class="string">&quot;/ldata/GB2312_lib.bin&quot;</span> --字库文件的地址，<span class="number">2</span>G模块</span><br><span class="line"></span><br><span class="line">local fontfile_ascii = <span class="string">&quot;/lua/ASCII_lib.bin&quot;</span> --字库文件的地址，<span class="number">4</span>G模块</span><br><span class="line">local fontfile_gb2312 = <span class="string">&quot;/lua/GB2312_lib.bin&quot;</span> --字库文件的地址，<span class="number">4</span>G模块</span><br><span class="line"></span><br><span class="line">local iicspeed = i2c.SLOW --iic速度，<span class="number">100</span>K</span><br><span class="line">--local iicspeed = i2c.FAST --iic速度，<span class="number">400</span>K。在<span class="number">720</span>sl上点不亮，<span class="number">2</span>g模块可以使用高速iic</span><br><span class="line"></span><br><span class="line">local i2cid = <span class="number">0</span> --iicid，需要根据接线而定，默认iic1</span><br><span class="line">local i2cslaveaddr = <span class="number">0x3C</span> --从机地址，如果是八位地址，需要向右移动一位。我这个模块说明书给的地址是<span class="number">0x78</span>，右移动一位就是<span class="number">0x3c</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3、函数说明"><a href="#3、函数说明" class="headerlink" title="3、函数说明"></a>3、函数说明</h2><p>接下来我做一下函数说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">-------------------------------函数说明---------------------------------------------</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">--[[</span><br><span class="line">* @description: 清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!</span><br><span class="line">* @param &#123;type&#125; 无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Clear()</span><br><span class="line">]]</span><br><span class="line">--[[</span><br><span class="line">* @description: 初始化OLED，</span><br><span class="line">* @param &#123;type&#125; :无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Init()</span><br><span class="line">]]</span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定位置显示一个字符,包括部分字符</span><br><span class="line">* @param &#123;type&#125; :-----x:<span class="number">0</span>~<span class="number">127</span></span><br><span class="line">----------------------y:<span class="number">0</span>~<span class="number">6</span></span><br><span class="line">---------------------<span class="number">-0</span>第一行，<span class="number">2</span>第二行，<span class="number">4</span>第三行，<span class="number">6</span>第四行</span><br><span class="line">----------------------Show_char:要显示的字符</span><br><span class="line">----------------------isChinese:是中文就填入<span class="number">1</span>，英文就忽略</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowChar(x, y, Show_char, isChinese)</span><br><span class="line">]]</span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定坐标起始处显示字符串</span><br><span class="line">* @param &#123;type&#125; :-----x:<span class="number">0</span>~<span class="number">127</span></span><br><span class="line">----------------------y:<span class="number">0</span>~<span class="number">6</span></span><br><span class="line">---------------------<span class="number">-0</span>第一行，<span class="number">2</span>第二行，<span class="number">4</span>第三行，<span class="number">6</span>第四行</span><br><span class="line">----------------------Show_char:要显示的字符串，支持中文</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowString(x, y, ShowStr)</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<h2 id="4、编写测试程序代码"><a href="#4、编写测试程序代码" class="headerlink" title="4、编写测试程序代码"></a>4、编写测试程序代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">--必须在这个位置定义PROJECT和VERSION变量</span><br><span class="line">--PROJECT：ascii <span class="built_in">string</span>类型，可以随便定义，只要不使用,就行</span><br><span class="line">--VERSION：ascii <span class="built_in">string</span>类型，如果使用Luat物联云平台固件升级的功能，必须按照<span class="string">&quot;X.X.X&quot;</span>定义，X表示<span class="number">1</span>位数字；否则可随便定义</span><br><span class="line">PROJECT = <span class="string">&quot;LED&quot;</span></span><br><span class="line">VERSION = <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line">require <span class="string">&quot;sys&quot;</span></span><br><span class="line">require <span class="string">&quot;common&quot;</span></span><br><span class="line">--加载日志功能模块，并且设置日志输出等级</span><br><span class="line">--如果关闭调用<span class="built_in">log</span>模块接口输出的日志，等级设置为<span class="built_in">log</span>.LOG_SILENT即可</span><br><span class="line">require <span class="string">&quot;log&quot;</span></span><br><span class="line">LOG_LEVEL = <span class="built_in">log</span>.LOGLEVEL_TRACE</span><br><span class="line"></span><br><span class="line">local oled = require <span class="string">&quot;i2c_ssd1306_oled&quot;</span>--包含库文件</span><br><span class="line">local function Test_Task()</span><br><span class="line">	oled.OLED_Init()</span><br><span class="line">    oled.OLED_Clear()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">log</span>.info(<span class="string">&quot;Test_Task_run&quot;</span>)</span><br><span class="line">        oled.OLED_ShowChar(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;6&#x27;</span>,<span class="number">0</span>)--显示一个asill字符</span><br><span class="line">        oled.OLED_ShowString(<span class="number">40</span>, <span class="number">0</span>, <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>)--显示英文字符串,超出一行会自动换行</span><br><span class="line">        oled.OLED_ShowString(<span class="number">0</span>, <span class="number">4</span>, common.utf8ToGb2312(<span class="string">&quot;合宙，你好&quot;</span>) )--显示中文字符串</span><br><span class="line">        sys.wait(<span class="number">2000</span>)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">local function user_main()</span><br><span class="line">    --显示内容</span><br><span class="line">    sys.wait(<span class="number">10000</span>)</span><br><span class="line">    sys.taskInit(Test_Task)</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">--启动系统框架</span><br><span class="line">sys.taskInit(user_main)</span><br><span class="line">sys.init(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">sys.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5、下载程序到开发板"><a href="#5、下载程序到开发板" class="headerlink" title="5、下载程序到开发板"></a>5、下载程序到开发板</h2><p>实验效果如下<br><img src="https://img-blog.csdnimg.cn/20200225124705910.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="二、编写第2版测试程序（带缓存）"><a href="#二、编写第2版测试程序（带缓存）" class="headerlink" title="二、编写第2版测试程序（带缓存）"></a>二、编写第2版测试程序（带缓存）</h1><blockquote>
<p> 第2版驱动，支持在任意地方画矩形。<br> 支持显示不同大小的中文和英文字库，目前做了<code>12X6、16X8、24X12的ascii字库支持 和12X12、16X16、24X24的中文字库显示</code><br>近期不打算改了，后续可能还会增加二维码显示，有能力朋友可以先试试，搞出来跟我讲下，顺便学习学习</p>
</blockquote>
<h2 id="1、目录说明-1"><a href="#1、目录说明-1" class="headerlink" title="1、目录说明"></a>1、目录说明</h2><blockquote>
<p>文章末尾我会提供库文件以及字库的下载地址</p>
</blockquote>
<blockquote>
<p>第2版测试程序目录结构如下<br><img src="https://img-blog.csdnimg.cn/2020022513205237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</blockquote>
<ul>
<li><code>ASCII_12X6.bin</code>：         12*6                Ascii字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>ASCII_16X8.bin</code>：        16*8                Ascii字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>ASCII_24X12.bin</code>：        24*12            Ascii字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>GB2312_12X12.bin</code>：    12*12              GB2312字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>GB2312_16X16.bin</code>：    16*16              GB2312字库二进制文件，直接随同lua脚本一起下载即可</li>
<li><code>GB2312_24X24.bin</code>：    24*24              GB2312字库二进制文件，直接随同lua脚本一起下载即可，这个文件过大，全部下载就会超出了脚本区大小，单独下载应该没问题（我没有测试），也就是说只能下载这一个字库，其他的五个字库可以一同下载</li>
<li><code>i2c_ssd1306_oled.lua</code>：IIC   ssd1306    OLED屏驱动库</li>
<li><code>main.lua</code>：DEMO文件</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20200225132632653.png" alt="在这里插入图片描述"><br>注意：文件名不建议更改，如果更改了文件名，需要把驱动库中的用户配置区也一并更改，此字库<code>不兼容第一版oled驱动程序</code>，不要随意替换，<code>不支持第三方字库</code></p>
<h2 id="2、用户配置-1"><a href="#2、用户配置-1" class="headerlink" title="2、用户配置"></a>2、用户配置</h2><p>本驱动支持2g模块和4g模块，需要改动的库文件如下，只要把字库文件地址改下就行了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">-------------------------------用户配置区域------------------------------------------</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">--local Size_address = <span class="string">&quot;ldata&quot;</span> --字库文件的地址，<span class="number">2</span>G模块</span><br><span class="line">local Size_address = <span class="string">&quot;lua&quot;</span> --字库文件的地址，<span class="number">4</span>G模块</span><br><span class="line"></span><br><span class="line">local Size_12X6_name = <span class="string">&quot;ASCII_12X6.bin&quot;</span> --ascll字库名称</span><br><span class="line">local Size_16X8_name = <span class="string">&quot;ASCII_16X8.bin&quot;</span></span><br><span class="line">local Size_24X12_name = <span class="string">&quot;ASCII_24X12.bin&quot;</span></span><br><span class="line"></span><br><span class="line">--通过Luatools烧写的所有文件，都存放在此区域，目前总空间为<span class="number">524</span>KB，所以中文字库不能三个全部一起下载</span><br><span class="line">local FontSize_12X12_name = <span class="string">&quot;GB2312_12X12.bin&quot;</span> --GB2312中文字库名称</span><br><span class="line">local FontSize_16X16_name = <span class="string">&quot;GB2312_16X16.bin&quot;</span></span><br><span class="line">local FontSize_24X24_name = <span class="string">&quot;GB2312_24X24.bin&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">local iicspeed = i2c.SLOW --iic速度，<span class="number">100</span>K</span><br><span class="line">--local iicspeed = i2c.FAST --iic速度，<span class="number">400</span>K。在<span class="number">720</span>sl上点不亮，<span class="number">2</span>g模块可以使用高速iic</span><br><span class="line"></span><br><span class="line">local i2cid = <span class="number">0</span> --iicid，需要根据接线而定，默认iic1</span><br><span class="line">local i2cslaveaddr = <span class="number">0x3C</span> --从机地址，如果是八位地址，需要向右移动一位。我这个模块说明书给的地址是<span class="number">0x78</span>，右移动一位就是<span class="number">0x3c</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3、函数说明-1"><a href="#3、函数说明-1" class="headerlink" title="3、函数说明"></a>3、函数说明</h2><p>接下来我做一下函数说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">-------------------------------函数说明---------------------------------------------</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">--[[</span><br><span class="line">* @description: 更新缓存数据，到oled，操作后，必须更新，否则不会生效</span><br><span class="line">* @param &#123;type&#125; ：无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Refresh_Gram()</span><br><span class="line">*]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 开启OLED显示</span><br><span class="line">* @param &#123;type&#125; 无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Display_On()</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 关闭OLED显示</span><br><span class="line">* @param &#123;type&#125; 无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Display_Off()</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!</span><br><span class="line">* @param &#123;type&#125; 无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Clear()</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 画矩形</span><br><span class="line">* @param &#123;type&#125; :确保x1&lt;=x2 y1&lt;=y2 <span class="number">1</span>&lt;=x1&lt;=<span class="number">128</span> <span class="number">1</span>&lt;=y1&lt;=<span class="number">64</span></span><br><span class="line">dot:<span class="number">0</span>,清空 <span class="number">1</span>,填充</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Fill(x1, y1, x2, y2, dot)</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定位置显示一个字符,包括部分字符</span><br><span class="line">* @param &#123;type&#125; :-----x:<span class="number">1</span>~<span class="number">128</span></span><br><span class="line">----------------------y:<span class="number">1</span>~<span class="number">64</span></span><br><span class="line">----------------------Show_char:要显示的字符</span><br><span class="line">----------------------size:选择字体 <span class="number">12</span>/<span class="number">16</span>/<span class="number">24</span></span><br><span class="line">----------------------mode:<span class="number">0</span>,反白显示 <span class="number">1</span>,正常显示</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowChar(x, y, Show_char, size, mode)</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定坐标起始处显示字符串</span><br><span class="line">* @param &#123;type&#125; :--x:<span class="number">1</span>~<span class="number">128</span></span><br><span class="line">-------------------y:<span class="number">1</span>~<span class="number">64</span></span><br><span class="line">-------------------ShowStr:要显示的字符串</span><br><span class="line">-------------------size:选择字体 <span class="number">12</span>/<span class="number">16</span>/<span class="number">24</span></span><br><span class="line">-------------------mode:<span class="number">0</span>,反白显示 <span class="number">1</span>,正常显示</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowString(x, y, ShowString, size, mode)</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定坐标起始处显示一个汉字</span><br><span class="line">* @param &#123;type&#125; :--x:<span class="number">1</span>~<span class="number">128</span></span><br><span class="line">-------------------y:<span class="number">1</span>~<span class="number">64</span></span><br><span class="line">-------------------UTF8_ShowFont:要显示的字符串</span><br><span class="line">-------------------size:选择字体 <span class="number">12</span>/<span class="number">16</span>/<span class="number">24</span></span><br><span class="line">-------------------mode:<span class="number">0</span>,反白显示 <span class="number">1</span>,正常显示</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowFont(x, y, UTF8_ShowFont, size, mode)</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 在指定坐标起始处显示一堆汉字</span><br><span class="line">* @param &#123;type&#125; :--x:<span class="number">1</span>~<span class="number">128</span></span><br><span class="line">-------------------y:<span class="number">1</span>~<span class="number">64</span></span><br><span class="line">-------------------UTF8_ShowFonts:要显示的一堆汉字,</span><br><span class="line">-------------------size:选择字体 <span class="number">12</span>/<span class="number">16</span>/<span class="number">24</span></span><br><span class="line">-------------------mode:<span class="number">0</span>,反白显示 <span class="number">1</span>,正常显示</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_ShowFonts(x, y, UTF8_ShowFonts, size, mode)</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--[[</span><br><span class="line">* @description: 初始化OLED，</span><br><span class="line">* @param &#123;type&#125; :无</span><br><span class="line">* @<span class="keyword">return</span>: 无</span><br><span class="line">function OLED_Init()</span><br><span class="line">]]</span><br></pre></td></tr></table></figure>
<h2 id="4、编写测试程序代码-1"><a href="#4、编写测试程序代码-1" class="headerlink" title="4、编写测试程序代码"></a>4、编写测试程序代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">--必须在这个位置定义PROJECT和VERSION变量</span><br><span class="line">--PROJECT：ascii <span class="built_in">string</span>类型，可以随便定义，只要不使用,就行</span><br><span class="line">--VERSION：ascii <span class="built_in">string</span>类型，如果使用Luat物联云平台固件升级的功能，必须按照<span class="string">&quot;X.X.X&quot;</span>定义，X表示<span class="number">1</span>位数字；否则可随便定义</span><br><span class="line">PROJECT = <span class="string">&quot;LED&quot;</span></span><br><span class="line">VERSION = <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line">require <span class="string">&quot;sys&quot;</span></span><br><span class="line">--加载日志功能模块，并且设置日志输出等级</span><br><span class="line">--如果关闭调用<span class="built_in">log</span>模块接口输出的日志，等级设置为<span class="built_in">log</span>.LOG_SILENT即可</span><br><span class="line">require <span class="string">&quot;log&quot;</span></span><br><span class="line">LOG_LEVEL = <span class="built_in">log</span>.LOGLEVEL_TRACE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">local oled = require <span class="string">&quot;i2c_ssd1306_oled&quot;</span></span><br><span class="line">local function Test_Task()</span><br><span class="line">    oled.OLED_Init()--初始化</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">log</span>.info(<span class="string">&quot;Test_Task_run&quot;</span>)</span><br><span class="line">        oled.OLED_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>, <span class="number">12</span>, <span class="number">1</span>)--正常显示一堆<span class="number">12</span>*<span class="number">6</span>的ascii字符，会自动换行</span><br><span class="line">        oled.OLED_ShowChar(<span class="number">50</span>, <span class="number">20</span>, <span class="string">&#x27;6&#x27;</span>, <span class="number">16</span>, <span class="number">0</span>)--反白显示一个<span class="number">16</span>*<span class="number">8</span>的ascii字符</span><br><span class="line">        oled.OLED_ShowFont(<span class="number">90</span>, <span class="number">20</span>, <span class="string">&quot;哈&quot;</span>, <span class="number">16</span>, <span class="number">1</span>)--正常显示一个<span class="number">16</span>*<span class="number">16</span>的中文汉字</span><br><span class="line">        oled.OLED_ShowFonts(<span class="number">1</span>, <span class="number">40</span>, <span class="string">&quot;合宙，你好&quot;</span>, <span class="number">12</span>, <span class="number">0</span>)--反白显示一堆<span class="number">12</span>*<span class="number">12</span>的中文汉字，会自动换行</span><br><span class="line">        oled.OLED_Fill(<span class="number">70</span>, <span class="number">40</span>, <span class="number">90</span>, <span class="number">60</span>, <span class="number">1</span>)--画一个正方形</span><br><span class="line">        oled.OLED_Refresh_Gram()--更新显存</span><br><span class="line">        sys.wait(<span class="number">2000</span>)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">local function user_main()</span><br><span class="line">    --显示内容</span><br><span class="line">    sys.wait(<span class="number">10000</span>)</span><br><span class="line">    sys.taskInit(Test_Task)</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">--启动系统框架</span><br><span class="line">sys.taskInit(user_main)</span><br><span class="line">sys.init(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">sys.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5、下载程序到开发板-1"><a href="#5、下载程序到开发板-1" class="headerlink" title="5、下载程序到开发板"></a>5、下载程序到开发板</h2><p>实验效果如下<br><img src="https://img-blog.csdnimg.cn/2020022513513421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1><h2 id="1、本片博客涉及到的OLED驱动"><a href="#1、本片博客涉及到的OLED驱动" class="headerlink" title="1、本片博客涉及到的OLED驱动"></a>1、本片博客涉及到的OLED驱动</h2><p>下载地址：<a target="_blank" rel="noopener" href="https://download.csdn.net/download/weixin_44570083/12190546">点击这里</a><br>开发不易，收几个积分，望理解</p>
<h2 id="2、第1种驱动能用的库函数"><a href="#2、第1种驱动能用的库函数" class="headerlink" title="2、第1种驱动能用的库函数"></a>2、第1种驱动能用的库函数</h2><ul>
<li><code>OLED_Clear()</code>：清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!</li>
<li><code>OLED_Init()</code>：初始化OLED</li>
<li><code>OLED_ShowChar(x, y, Show_char, isChinese)</code>：在指定位置显示一个字符,包括部分字符</li>
<li><code>OLED_ShowString(x, y, ShowStr)</code>：在指定坐标起始处显示字符串</li>
</ul>
<p>优点：占用内存极小，没有缓存，功能简单<br>缺点：速度慢</p>
<h2 id="3、第2种驱动能用的库函数"><a href="#3、第2种驱动能用的库函数" class="headerlink" title="3、第2种驱动能用的库函数"></a>3、第2种驱动能用的库函数</h2><ul>
<li><code>OLED_Refresh_Gram()</code>：更新缓存数据，到oled，操作后，必须更新，否则不会生效</li>
<li><code>OLED_Display_On()</code>：开启OLED显示</li>
<li><code>OLED_Display_Off()</code>：关闭OLED显示</li>
<li><code>OLED_Clear()</code>：清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!</li>
<li><code>OLED_Fill(x1, y1, x2, y2, dot)</code>：画矩形</li>
<li><code>OLED_ShowChar(x, y, Show_char, size, mode)</code>：在指定位置显示一个字符,包括部分字符</li>
<li><code>OLED_ShowString(x, y, ShowString, size, mode)</code>：在指定坐标起始处显示字符串</li>
<li><code>OLED_ShowFont(x, y, UTF8_ShowFont, size, mode)</code>：在指定坐标起始处显示一个汉字</li>
<li><code>OLED_ShowFonts(x, y, UTF8_ShowFonts, size, mode)</code>：在指定坐标起始处显示一堆汉字</li>
<li><code>OLED_Init()</code>：初始化OLED</li>
</ul>
<p>优点：速度快，比第一种驱动多一个功能，后续会继续增加新的功能<br>缺点：占用1k内存，有缓存</p>
<h2 id="4、再次提醒"><a href="#4、再次提醒" class="headerlink" title="4、再次提醒"></a>4、再次提醒</h2><ul>
<li> 现在时间是2020年2月25日，到目前为止官方的720sl固件只发布到v0008版本，因为v0008版本iic时序有问题，所以并不能通过本驱动点亮OLED。</li>
<li>目前我使用的v0009内测版本，只能通过低速iic点亮oled，高速iic并不能点亮，所以速度快的优势体现不出来。我不清楚正式版本会不会修复这个问题。</li>
<li> 按照官方手册说明，高速iic比低速iic速度块4倍，修复这个问题后，oled刷新应该是丝滑般流畅</li>
</ul>
<blockquote>
<p>不会下载的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里</a>，进去查看我的第二篇博文<code>2、Air720SL模块Luat开发：第一个Luat的Hello World</code>里面讲了怎么下载<br>这里只是我的学习笔记，拿出来给大家分享，欢迎大家批评指正，本篇教程到此结束</p>
</blockquote>

</article>

    <div class="pagenator post-pagenator">


        <a class="extend prev post-prev" href="/30/">上一篇</a>



    <p>上次更新 2021-01-28</p>


        <a class="extend next post-next" href="/27/">下一篇</a>

    </div>

    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">





				<li>
					<a href="https://luatdoc.papapoi.com/wiki/" title="stack-overflow" target="_self">
					<i class="fa fa-stack-overflow"></i>
					</a>
				</li>












				<li>
					<a href="https://github.com/openluat" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
















	</ul>
</div>
    <div class="copyright">
        <span>



                © 仅供搜索引擎收录使用 2017 - 2021

        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10);
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
