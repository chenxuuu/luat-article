<!DOCTYPE html>

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>合宙Air202模块连接阿里云物联网平台收发数据 [ Luat doc 社区文章静态页面 ]</title>

    <!-- stylesheets list from config.yml -->

      <link rel="stylesheet" href="/css/iLiKE.css">




<meta name="generator" content="Hexo 5.3.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="https://iot.openluat.com/assets/img/logo.jpg"></img>
        </a>
      </div>
      <div class="menu-right">







          <a href="/">首页</a>







          <a href="/archives">归档</a>







          <a href="https://luatdoc.papapoi.com/wiki/">关于</a>

      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">合宙Air202模块连接阿里云物联网平台收发数据</h1>
<article class="post markdown-style">
  <p><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">用到的GPRS模块：合宙Air202用到的物联网平台：阿里云</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">GPRS模块对接阿里云物联网平台，对于新手来说还是很有难度的。在这里，我将使用合宙air202模块，连接阿里云物联网平台，最终使用自己的阿里云服务器来进行数据的双向通信。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="word-wrap: break-word; font-weight: 700; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#000000" style="word-wrap: break-word;"><br style="word-wrap: break-word;"></font></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="word-wrap: break-word; font-weight: 700; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#000000" style="word-wrap: break-word;">一、阿里云物联网平台创建新设备</font></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">1、登录阿里云系统，进入阿里云物联网控制台</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">2、创建产品，选择高级版，输入产品名称，节点类型选择“设备”，设备类型选择“无”，数据格式选择“</span><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">Alink JSON</font></font><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">”，是否接入网关选择“否”，确认</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">3、进入刚刚创建的产品，添加设备，输入设备名称DeviceName，建议以无线网络模块的IMEI序列号来命名设备以避免重复，保存后，物联网系统会自动生成该设备证书，包括三个数据，如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1897" aid="1897" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/190713ebrednt8n8ehxo1f.jpg" zoomfile="data/attachment/forum/201809/27/190713ebrednt8n8ehxo1f.jpg" file="data/attachment/forum/201809/27/190713ebrednt8n8ehxo1f.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="word-wrap: break-word; font-weight: 700; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#000000" style="word-wrap: break-word;">二、无线网络模块连接阿里云物联网平台</font></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">阿里云物联网平台与设备端支持MQTT通信协议，因此在这里建议无线网络模块采用MQTT协议连接阿里云物联网平台。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">MQTT通信协议的底层是TCP通信，因此只要无线模块支持TCP通信，原则上就可以TCP基础上移植MQTT，然而MQTT的协议自己移植的话过于复杂，因此各大无线模组供应商与阿里云合作，纷纷推出了内嵌了阿里云物联网通信协议的通信模组，例如这里使用的是AIR202模组。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">air202模组是2G模组，具有较高的性价比。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">1、拿到AIR202模组，先确认其固件是否是支持连接阿里云物联网平台的版本，方法是发送AT+CGRM,模块会返回当前固件版本，例如：AirM2M_V5509_AT_S_SSL。只有版本尾号为SSL的固件版本才支持接入阿里云物联网平台。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">2、接下来，使用串口助手向air202依次发送一下AT指令</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（1）AT //必须发送大写的AT,用来与模组进行波特率的同步。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（2）AT+CGMR//查看模块固件版本，检查尾号是否为SSL，若尾号不是SSL，则需要先使用合宙的LuaTool工具先更新固件，如下图所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1898" aid="1898" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/192741to0ab4grb7abbbbb.jpg" zoomfile="data/attachment/forum/201809/27/192741to0ab4grb7abbbbb.jpg" file="data/attachment/forum/201809/27/192741to0ab4grb7abbbbb.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（3）AT+CGATT?&nbsp;&nbsp;//查看GPRS业务附着情况，附着成功返回1，若返回0则肯定不能联网</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（4）AT+SAPBR=3,1,"CONTYPE","GPRS"&nbsp;&nbsp;//设置网络参数</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;AT+SAPBR=3,1,"APN","CMIOT"&nbsp;</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;AT+SAPBR=1,1</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（5）AT+CGATT? //检查网络附着情况</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（6）AT+HTTPINIT //使用http业务之前，先初始化http协议栈</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（7）AT+HTTPPARA="URL","https://iot-auth.cn-shanghai.aliyuncs.com/auth/devicename"&nbsp;&nbsp;//设置http参数</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;AT+HTTPPARA="USER_DEFINED","Content-Type: application/x-www-form-urlencoded"</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;AT+HTTPDATA=112,20000&nbsp;&nbsp;//注意这里的数字112是下面一条数据的总字节个数</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（8）productKey=a1jRE6oEtOv&amp;sign=773c0feaab4109a153cf07f3dcef3356&amp;clientId=869300031656865&amp;deviceName=869300031656865</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;productKey是阿里云物联网平台系统自动为你创建的产品产生的一个参数。如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1899" aid="1899" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/194029qqhorraqxxxqkxdx.jpg" zoomfile="data/attachment/forum/201809/27/194029qqhorraqxxxqkxdx.jpg" file="data/attachment/forum/201809/27/194029qqhorraqxxxqkxdx.jpg" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;clientId与deviceName在这里设置为相同的数据，来自物联网平台用户添加设备时输入的设备名称，例如这里都是869300031656865，如下图所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1900" aid="1900" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/194237aizuh5y566h38s8v.jpg" zoomfile="data/attachment/forum/201809/27/194237aizuh5y566h38s8v.jpg" file="data/attachment/forum/201809/27/194237aizuh5y566h38s8v.jpg" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp; sign参数的来头就稍微复杂了一点，它是使用hMacMd5算法计算出来的一个哈希值。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">前期测试，可以使用现成的工具来进行计算，例如使用一个在线计算器，链接：</span><a href="http://tool.oschina.net/encrypt?type=2" target="_blank" style="word-wrap: break-word; color: rgb(51, 102, 153); text-decoration-line: underline; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun; background-color: rgb(255, 255, 255);">http://tool.oschina.net/encrypt?type=2</a><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">界面如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1901" aid="1901" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/194914trydhcr63dl3akc3.png" zoomfile="data/attachment/forum/201809/27/194914trydhcr63dl3akc3.png" file="data/attachment/forum/201809/27/194914trydhcr63dl3akc3.png" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">在上面的小工具输入明文为：clientId862991419835241deviceName862991419835241productKeyb1KCi45LcCP</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">注意，输入的明文里的clientId与deviceName应该与被注册的设备信息保持一致，productKey应与被注册的产品信息一致。检查一下，不要有多余的空格符。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">这里要注意下，上面小工具需要输入一个密钥，该密钥为被注册的这个设备的</span><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">DeviceSecret，如下图所示：</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1902" aid="1902" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/195412tcpwckeecuqcuhdc.jpg" zoomfile="data/attachment/forum/201809/27/195412tcpwckeecuqcuhdc.jpg" file="data/attachment/forum/201809/27/195412tcpwckeecuqcuhdc.jpg" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">最终计算出一个哈希值，该值就是上面步骤（8）中的sign。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（9）AT+HTTPACTION=1 //http方式激活，该AT指令发送后稍微等几秒，模块回复+HTTPACTION: 1,200,128</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（10）AT+HTTPREAD //查询http数据响应，一切正常的话，此时模块应该返回与阿里云物联网平台进行鉴权后的数据结果，其中包括iotId、iotToken和success成功提示</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（11）AT+HTTPTERM //结束http服务</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（12）AT+MCONFIG="869300031656865","这里输入上面步骤10返回的iotId","这里输入上面步骤10返回的iotToken"&nbsp;&nbsp;//设置MQTT相关参数</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;这里注意，每次执行步骤10后获取到的iotToken值都不一样，都需要重新更新步骤12中的iotToken。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（13）AT+SSLMIPSTART="这里应该是你产品的的ProducKey.iot-as-mqtt.cn-shanghai.aliyuncs.com",1883&nbsp; &nbsp;</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp; //例如AT+SSLMIPSTART="a1jRE6oEtOv.iot-as-mqtt.cn-shanghai.aliyuncs.com",1883，这条指令发送完后要等几秒，模块回复“CONNECT OK”</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（14）AT+MCONNECT=1,300 //客户端向服务器请求会话连接，返回CONNACK OK说明连接成功</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">（15）AT+MSUB="/a1jRE6oEtOv/869300031656865/user/get",0&nbsp;&nbsp;//这条指令用于订阅一个topic，请参考自己平台下某个设备的可用topic进行修改，若&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;订阅成功系统返回“SUBACK”。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">截止到此，采用air202的设备端就已经成功与阿里云物联网平台进行了mqtt长连接。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">此时从阿里云物联网平台查看设备，会发现该设备处于“在线”状态，如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1903" aid="1903" src="http://bbs.qdclab.com/data/attachment/forum/201809/27/202115csngdtjx403t94ns.jpg" zoomfile="data/attachment/forum/201809/27/202115csngdtjx403t94ns.jpg" file="data/attachment/forum/201809/27/202115csngdtjx403t94ns.jpg" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">三、设备端发送数据至服务器设备端与阿里云物联网平台成功连接后，设备端就可以向平台的某个具备发布权限的Topic发送数据了，例如在这里，设备将向</span><font color="#383d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">/a1jRE6oEtOv/868575026616807/user/update发布数据。</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">想要发布的数据为JSON格式如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">{</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp;&nbsp;"cmd":"get one code"</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">}</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">然而，在使用AT指令将JSON格式的数据发送到模组时，需要对上面的JSON格式数据字符串进行相应的改变，方法是将双引号“修改为\22，</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">因此需要发送的AT指令为：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">AT+MPUB="/a1jRE6oEtOv/868575026616807/user/update",1,0,"{\22cmd\22:\22get one code\22}"</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">数据发送成功后，模组会返回：“PUBACK”,这说明阿里云物联网平台已经收到数据，此时我们登录阿里云物联网平台，进入该设备所对应的产品类目下，查看“日志服务”--&gt;"上行消息分析"，可以看到通信成功的界面，如下所示：</span><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1907" aid="1907" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/090724zttgn5305r22trz2.jpg" zoomfile="data/attachment/forum/201809/28/090724zttgn5305r22trz2.jpg" file="data/attachment/forum/201809/28/090724zttgn5305r22trz2.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">然而，虽然物联网平台能够接收到来自设备端上传的数据，但是我们的服务器根本是不知道设备发来的是什么数据，想要让设备端上传的数据能够发送到自己的服务器，则中间必须要用到阿里云物联网的中间件，其实就是一个阿里云的数据转发中间件，</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">该中间件可以按照用户需求对数据做过滤处理，并最终按照用户设置的参数将数据转发到目的地，这个数据转发服务阿里云是收费的。具体的流程如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">设备端发送数据----&gt;阿里云物联网平台接收到设备端数据----&gt;规则引擎对接收到的数据做过滤提取------&gt;提取出来的数据被转发到MQ消息队列----------&gt;用户服务器监听MQ消息队列中的数据---------&gt;监听到数据则执行回调函数进行业务处理</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">1、启用MQ消息队列服务，并创建一条Topic</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp;&nbsp;进入MQ消息队列控制台，点击“创建Topic”，输入Topic名称，此处的Topic需自己取名；消息类型按需选取，再此我选择普通消息。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp;&nbsp;对刚刚创建的Topic进行授权设置，设置为授予订阅权限，这样我们的服务器就可以订阅这条Topic来监听转发过来的数据。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp;&nbsp;为刚刚创建的Topic创建生产者与消费者，名称需要自己明明。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">2、创建规则引擎并编写SQL语句</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp;&nbsp;打开阿里云物联网平台控制中的规则引擎，创建规则，输入规则名称，选择JSON格式，保存。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">&nbsp; &nbsp;&nbsp;&nbsp;点击“管理”，编辑SQL语句,如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1908" aid="1908" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/092451jjcnn54glplnlp5z.jpg" zoomfile="data/attachment/forum/201809/28/092451jjcnn54glplnlp5z.jpg" file="data/attachment/forum/201809/28/092451jjcnn54glplnlp5z.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">字段输入为*,表明我将设备端上传的JSON数据为全部选择。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">Topic处为"</span><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">+/user/update</font></font><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">",表明这条规则只处理满足</span><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">+/user/update格式的数据。</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">条件处为空，表明没有条件限制。</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">保存该SQL语句.</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">3、配置规则引擎中的转发数据目的地</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, SimSun, sans-serif" style="word-wrap: break-word; color: rgb(68, 68, 68);"><font color="#373d41" style="word-wrap: break-word;">打开上面步骤中设置的那条SQL语句对应的管理界面，界面下方点击“添加操作”，</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, SimSun, sans-serif" style="word-wrap: break-word; color: rgb(68, 68, 68);"><font color="#373d41" style="word-wrap: break-word;">选择操作为“发送数据到消息队列”，其他配置如下图所示：</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1909" aid="1909" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/094147jjlba0m7wj7f00ij.jpg" zoomfile="data/attachment/forum/201809/28/094147jjlba0m7wj7f00ij.jpg" file="data/attachment/forum/201809/28/094147jjlba0m7wj7f00ij.jpg" class="zoom" width="600" inpost="1" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">保存之后，启用该条转发规则，系统提示成功。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">3、服务器端运行Demo进行数据监听测试</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">服务端采用JAVA，源码如下：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></p><div class="blockcode" style="word-wrap: break-word; overflow: hidden; margin: 10px 0px; padding: 10px 0px 5px 10px; background: url(&quot;http://bbs.qdclab.com/static/image/common/codebg.gif&quot;) 0px 0px repeat-y rgb(247, 247, 247); color: rgb(102, 102, 102); zoom: 1; border: 1px solid rgb(204, 204, 204); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><div id="code_yI7" style="word-wrap: break-word;"><ol style="word-wrap: break-word; margin-right: 0px !important; margin-bottom: 0px !important; margin-left: 10px !important; padding: 0px !important;"><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">package com.aliyun.iot.demo;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.Action;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.ConsumeContext;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.Consumer;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.Message;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.MessageListener;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.ONSFactory;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import com.aliyun.openservices.ons.api.PropertyKeyConst;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import java.io.UnsupportedEncodingException;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">import java.util.Properties;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">public class H2 {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Properties properties = new Properties();<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // 这里的ConsumerId参数是你在MQ消息队列控制台创建的Topic时，你创建的消费者名称<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; properties.put(PropertyKeyConst.ConsumerId, "CID_lockDevice");<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // AccessKey 阿里云身份验证，在阿里云服务器管理控制台创建<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; properties.put(PropertyKeyConst.AccessKey, "改成你自己的");<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // SecretKey 阿里云身份验证，在阿里云服务器管理控制台创建<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; properties.put(PropertyKeyConst.SecretKey,"改成你自己的");<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"><br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // 设置 TCP 接入域名（此处以公共云生产环境为例）<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // http://onsaddr-internet.aliyun.com/rocketmq/nsaddr4client-internet<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; properties.put(PropertyKeyConst.ONSAddr,"http://onsaddr-internet.aliyun.com/rocketmq/nsaddr4client-internet");<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // 集群订阅方式 (默认)<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // properties.put(PropertyKeyConst.MessageModel,<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // PropertyValueConst.CLUSTERING);<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // 广播订阅方式<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // properties.put(PropertyKeyConst.MessageModel,<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // PropertyValueConst.BROADCASTING);<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Consumer consumer = ONSFactory.createConsumer(properties);<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // 下面函数中的参数qmlock_meg为MQ控制台创建的Topic名称；第二个参数为星号，表明监听所有数据<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; consumer.subscribe("qmlock_meg", "*", new MessageListener() {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;@Override<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;public Action consume(Message message, ConsumeContext context) {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;System.out.println("Receive: " + message);<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;String res = null;<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;byte[] resByte = message.getBody();//获取消息体<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;try {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; res = new String(resByte, "UTF-8");//将消息体byte型数据转换成字符串<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;} catch (UnsupportedEncodingException e) {<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; // TODO Auto-generated catch block<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; e.printStackTrace();<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;System.out.println("body: " + res);//打印消息体<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return Action.CommitMessage;//返回消息消费结果<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; });<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; consumer.start();<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; System.out.println("Consumer Started");<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;">}<br style="word-wrap: break-word;"></li><li style="word-wrap: break-word; margin: 0px 0px 0px 2em; padding: 0px 0px 0px 10px; list-style-type: decimal-leading-zero; font-family: Monaco, Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, serif; font-size: 12px; line-height: 1.8em;"></li></ol></div><span style="word-wrap: break-word; margin-left: 43px; font-size: 12px; cursor: pointer; color: rgb(51, 102, 153) !important;">复制代码</span></div><p><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">服务端启动运行后，控制台显示“Consumer Started”，并处于监听状态。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">此时，登录MQ控制台，查看消费者状态，如下图所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1910" aid="1910" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/101100qp6pdht5dzs5hksp.jpg" zoomfile="data/attachment/forum/201809/28/101100qp6pdht5dzs5hksp.jpg" file="data/attachment/forum/201809/28/101100qp6pdht5dzs5hksp.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">上图中，“是否在线”、“订阅关系是否一致”都显示“是”，表明服务端成功开启监听。</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;">进入MQ消息队列控制台，打开生产者管理，发送消息里输入消息体“hello world”并发送，显示发送成功，此时查看服务端控制台，显示出已经接受到消息，如下所示：</span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1911" aid="1911" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/101505w666pu6z1ngjr664.jpg" zoomfile="data/attachment/forum/201809/28/101505w666pu6z1ngjr664.jpg" file="data/attachment/forum/201809/28/101505w666pu6z1ngjr664.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><span style="color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"></span><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">&nbsp; &nbsp;MQ控制台发送消息，服务端能够成功接收，说明服务端监听正常。</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font color="#373d41" style="word-wrap: break-word; font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, &amp;quot;" style="word-wrap: break-word;">接下来，使用air202模组，发送</font></font><font face="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, SimSun, sans-serif" style="word-wrap: break-word; color: rgb(68, 68, 68);"><font color="#373d41" style="word-wrap: break-word;">AT+MPUB="/a1b96wWfb8u/868575026616807/user/update",1,0,"{\22cmd\22:\22get one code\22}"</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><font face="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, SimSun, sans-serif" style="word-wrap: break-word; color: rgb(68, 68, 68);"><font color="#373d41" style="word-wrap: break-word;">服务端收到数据如下所示：</font></font><br style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><ignore_js_op style="word-wrap: break-word; color: rgb(68, 68, 68); font-family: Tahoma, &quot;Microsoft Yahei&quot;, Simsun;"><img id="aimg_1912" aid="1912" src="http://bbs.qdclab.com/data/attachment/forum/201809/28/101706ose9xsn63x36xe93.jpg" zoomfile="data/attachment/forum/201809/28/101706ose9xsn63x36xe93.jpg" file="data/attachment/forum/201809/28/101706ose9xsn63x36xe93.jpg" class="zoom" width="600" inpost="1" initialized="true" style="word-wrap: break-word; cursor: pointer;">&nbsp;</ignore_js_op><br></p>
</article>

    <div class="pagenator post-pagenator">


        <a class="extend prev post-prev" href="/461/">上一篇</a>



    <p>上次更新 2021-01-28</p>


        <a class="extend next post-next" href="/459/">下一篇</a>

    </div>

    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">





				<li>
					<a href="https://luatdoc.papapoi.com/wiki/" title="stack-overflow" target="_self">
					<i class="fa fa-stack-overflow"></i>
					</a>
				</li>












				<li>
					<a href="https://github.com/openluat" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
















	</ul>
</div>
    <div class="copyright">
        <span>



                © 仅供搜索引擎收录使用 2017 - 2021

        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10);
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
