<!DOCTYPE html>

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Air720系列模块空中升级完全指南 [ Luat doc 社区文章静态页面 ]</title>

    <!-- stylesheets list from config.yml -->

      <link rel="stylesheet" href="/css/iLiKE.css">




<meta name="generator" content="Hexo 5.3.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="https://iot.openluat.com/assets/img/logo.jpg"></img>
        </a>
      </div>
      <div class="menu-right">







          <a href="/">首页</a>







          <a href="/archives">归档</a>







          <a href="https://luatdoc.papapoi.com/wiki/">关于</a>

      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">Air720系列模块空中升级完全指南</h1>
<article class="post markdown-style">
  <blockquote>
<p> Air720系列空中采用全固件升级的方式，即将完整固件（.bin文件)包放到服务器中，模块通过查询方式得到空中升级的指令，然后下载整个固件包（大约5MB),下载到本地flash内部后，再重启进行更新。如果中途失败会重新进行更新动作，如果下载固件过程不完整，则不会进行更新。所以不需要担心空中升级失败导致的模块变砖问题。<br>Air720（AT固件）空中升级分为模块端AT指令触发升级和自动升级2种方式。<br>Air720（Lua固件）空中升级一般是模块开机后，自动连接服务器，请求升级。（本文以720H模块，合宙服务器为例）</p>
</blockquote>
<hr>
<h1 id="AT固件："><a href="#AT固件：" class="headerlink" title="AT固件："></a><strong>AT固件：</strong></h1><h1 id="1：模块端AT指令触发升级："><a href="#1：模块端AT指令触发升级：" class="headerlink" title="1：模块端AT指令触发升级："></a>1：模块端AT指令触发升级：</h1><h2 id="1-1-合宙IoT平台配置（点击此处进入）"><a href="#1-1-合宙IoT平台配置（点击此处进入）" class="headerlink" title="1.1 合宙IoT平台配置（点击此处进入）"></a>1.1 合宙IoT平台配置<a target="_blank" rel="noopener" href="https://iot.openluat.com/" title="点击此处进入">（点击此处进入）</a></h2><h3 id="1-1-1登录平台，查询模块是否在自己账户项目下："><a href="#1-1-1登录平台，查询模块是否在自己账户项目下：" class="headerlink" title="1.1.1登录平台，查询模块是否在自己账户项目下："></a>1.1.1登录平台，查询模块是否在自己账户项目下：</h3><p>  客户向合宙采购4G模块时，如果采购人员没有告知合宙这批模块放在iot.openluat.com上的哪个产品下，则合宙会以<strong>采购人的手机号为账号，默认密码888888</strong>，创建一个“Air720X标准模块”的产品，此次采购的所有模块都会放在这个产品下。<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_33713.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_10691.png"></p>
<h3 id="1-1-2配置流程"><a href="#1-1-2配置流程" class="headerlink" title="1.1.2配置流程"></a>1.1.2配置流程</h3><h4 id="1-1-2-1依次点击进入产品-gt-固件升级-gt-升级配置，页面如下"><a href="#1-1-2-1依次点击进入产品-gt-固件升级-gt-升级配置，页面如下" class="headerlink" title="1.1.2.1依次点击进入产品-&gt;固件升级-&gt;升级配置，页面如下"></a>1.1.2.1依次点击进入产品-&gt;固件升级-&gt;升级配置，页面如下</h4><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_80120.png"></p>
<h4 id="1-1-2-2以720H模块为例，登录官网下载最新固件"><a href="#1-1-2-2以720H模块为例，登录官网下载最新固件" class="headerlink" title="1.1.2.2以720H模块为例，登录官网下载最新固件"></a>1.1.2.2以720H模块为例，登录官网<a target="_blank" rel="noopener" href="http://www.openluat.com/Product/4g/Air720H.html" title="官网">下载最新固件</a></h4><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_30096.png"></p>
<h4 id="1-1-2-3固件解压后，将bin文件上传至IOT平台"><a href="#1-1-2-3固件解压后，将bin文件上传至IOT平台" class="headerlink" title="1.1.2.3固件解压后，将bin文件上传至IOT平台"></a>1.1.2.3固件解压后，将bin文件上传至IOT平台</h4><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_94831.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_12302.png"></p>
<h4 id="1-1-2-4当全项目升级为否时，需要添加待升级模块IMEI号，步骤如下图所示"><a href="#1-1-2-4当全项目升级为否时，需要添加待升级模块IMEI号，步骤如下图所示" class="headerlink" title="1.1.2.4当全项目升级为否时，需要添加待升级模块IMEI号，步骤如下图所示"></a>1.1.2.4当全项目升级为否时，需要添加待升级模块IMEI号，步骤如下图所示</h4><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_98349.png"><br>成功添加后：<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_67942.png"></p>
<h2 id="1-2模块端AT指令触发（若确认模块在IoT平台账号项目下，可省略AT-UPGRADE-”KEY”-”XXXX”指令）"><a href="#1-2模块端AT指令触发（若确认模块在IoT平台账号项目下，可省略AT-UPGRADE-”KEY”-”XXXX”指令）" class="headerlink" title="1.2模块端AT指令触发（若确认模块在IoT平台账号项目下，可省略AT+UPGRADE=”KEY”,”XXXX”指令）"></a>1.2模块端AT指令触发（若确认模块在IoT平台账号项目下，可省略AT+UPGRADE=”KEY”,”XXXX”指令）</h2><h3 id="1-2-1模块端通过USB端口，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下图所示"><a href="#1-2-1模块端通过USB端口，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下图所示" class="headerlink" title="1.2.1模块端通过USB端口，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下图所示"></a>1.2.1模块端通过USB端口，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下图所示</h3><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_48497.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_31314.png"></p>
<h3 id="1-2-2模块端通过串口2，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下"><a href="#1-2-2模块端通过串口2，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下" class="headerlink" title="1.2.2模块端通过串口2，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下"></a>1.2.2模块端通过串口2，依次发送以下AT指令，在前一条指令返回正常的情况下，发送下一条，完整流程如下</h3><p>指令触发-&gt;下载固件-&gt;刷机重启等全部过程如下:<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_71719.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_56564.png"></p>
<h3 id="注：1-2-1和1-2-2可根据实际情况选择合适的方式，触发指令相同，仅输出有部分区别"><a href="#注：1-2-1和1-2-2可根据实际情况选择合适的方式，触发指令相同，仅输出有部分区别" class="headerlink" title="注：1.2.1和1.2.2可根据实际情况选择合适的方式，触发指令相同，仅输出有部分区别"></a>注：1.2.1和1.2.2可根据实际情况选择合适的方式，触发指令相同，仅输出有部分区别</h3><h2 id="1-3升级常见问题和处理办法"><a href="#1-3升级常见问题和处理办法" class="headerlink" title="1.3升级常见问题和处理办法"></a>1.3升级常见问题和处理办法</h2><h3 id="1-3-1获取produckey，登录IOT平台-gt-进入项目-gt-产品信息"><a href="#1-3-1获取produckey，登录IOT平台-gt-进入项目-gt-产品信息" class="headerlink" title="1.3.1获取produckey，登录IOT平台-&gt;进入项目-&gt;产品信息"></a>1.3.1获取produckey，登录IOT平台-&gt;进入项目-&gt;产品信息</h3><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_66744.png"></p>
<h3 id="1-3-2升级异常时，可通过URC上报-UPGRADENID-ERROR-CODE，或者AT-UPGRADE-指令查询固件下载结果，进一步处理"><a href="#1-3-2升级异常时，可通过URC上报-UPGRADENID-ERROR-CODE，或者AT-UPGRADE-指令查询固件下载结果，进一步处理" class="headerlink" title="1.3.2升级异常时，可通过URC上报+UPGRADENID  ERROR CODE，或者AT+UPGRADE?指令查询固件下载结果，进一步处理"></a>1.3.2升级异常时，可通过URC上报+UPGRADENID  ERROR CODE，或者AT+UPGRADE?指令查询固件下载结果，进一步处理</h3><p> AT+UPGRADE?  返回+UPGRADE: state, [error code, http respone, fota error cause] OK<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_63430.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_14672.png"></p>
<h1 id="2：自动升级"><a href="#2：自动升级" class="headerlink" title="2：自动升级"></a>2：自动升级</h1><h2 id="2-1自动FOTA是模块定期向后台发送升级请求，来获取新固件进行更新的，大致流程如下："><a href="#2-1自动FOTA是模块定期向后台发送升级请求，来获取新固件进行更新的，大致流程如下：" class="headerlink" title="2.1自动FOTA是模块定期向后台发送升级请求，来获取新固件进行更新的，大致流程如下："></a>2.1自动FOTA是模块定期向后台发送升级请求，来获取新固件进行更新的，大致流程如下：</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_69646.png"></p>
<h1 id="3：备注"><a href="#3：备注" class="headerlink" title="3：备注"></a>3：备注</h1><ol>
<li>客户可以通过IOT平台查看升级成功数量，失败日志等信息</li>
<li>客户若是使用自己的服务器来进行空中升级，用户在自己服务器放好bin文件，模块端执行<br>AT+UPGRADE=”URL”,”<a target="_blank" rel="noopener" href="http://xxxx.bin&quot;/">http://xxxx.bin&quot;</a><br>AT+UPGRADE<br>模块只支持通过该URL执行http get获取固件bin</li>
<li>升级过程中若模块断电、重启导致升级失败，可重新升级</li>
<li>模块手动触发升级时，若频繁从同一个版本请求（目前默认一小时内6次，24小时内10次），IOT平台设备状态会自动更改为禁止升级，需要在平台设备列表手动解除</li>
</ol>
<h1 id="Lua固件：（以720H模块，合宙服务器为例）"><a href="#Lua固件：（以720H模块，合宙服务器为例）" class="headerlink" title="Lua固件：（以720H模块，合宙服务器为例）"></a><strong>Lua固件：</strong>（以720H模块，合宙服务器为例）</h1><h1 id="1-登录IOT平台点此进入，创建产品，查询模块是否在本人IOT账户下"><a href="#1-登录IOT平台点此进入，创建产品，查询模块是否在本人IOT账户下" class="headerlink" title="1.登录IOT平台点此进入，创建产品，查询模块是否在本人IOT账户下"></a>1.登录IOT平台<a target="_blank" rel="noopener" href="https://iot.openluat.com/" title="点此进入">点此进入</a>，创建产品，查询模块是否在本人IOT账户下</h1><h2 id="1-1若账户下没有产品，可新建产品，并进入产品，获取ProductKey"><a href="#1-1若账户下没有产品，可新建产品，并进入产品，获取ProductKey" class="headerlink" title="1.1若账户下没有产品，可新建产品，并进入产品，获取ProductKey"></a>1.1若账户下没有产品，可新建产品，并进入产品，获取ProductKey</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_16868.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_13096.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_87808.png"></p>
<h2 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_59602.png"></p>
<h1 id="2-设备端代码修改"><a href="#2-设备端代码修改" class="headerlink" title="2.设备端代码修改"></a>2.设备端代码修改</h1><p>例如：<br>         设备端本地烧录的旧固件版本信息为：<br>         core：Luat_V0019_ASR1802<br>         main.lua中PROJECT：LUAT_IOT_SERVER_UPDATE<br>         main.lua中VERSION：1.0.0<br>         模块型号：Air720H<br>          远程升级的新固件版本信息为：<br>         core：Luat_V0026_ASR1802<br>         main.lua中PROJECT：LUAT_IOT_SERVER_UPDATE<br>         main.lua中VERSION：2.0.0<br>         模块型号：Air720H</p>
<h2 id="2-1修改main-lua，配置新固件版本信息，支持升级功能"><a href="#2-1修改main-lua，配置新固件版本信息，支持升级功能" class="headerlink" title="2.1修改main.lua，配置新固件版本信息，支持升级功能"></a>2.1修改main.lua，配置新固件版本信息，支持升级功能</h2><p>打开脚本main.lua文件，按照注释，根据自己的需要修改PROJECT、VERSION、PRODUCT_KEY，并加载远程升级功能<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_30530.png"></p>
<p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_34234.png"></p>
<p style="font-size:25px;color:red;font-weight:bold;">注：设备每次开机，执行update.request()之后，网络准备就绪之后，模块会自动连接服务器，执行升级功能。</p>

<h1 id="3-通过Luatools生成升级包"><a href="#3-通过Luatools生成升级包" class="headerlink" title="3.通过Luatools生成升级包"></a>3.通过Luatools生成升级包</h1><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_46526.png"></p>
<p>生成的升级包文件默认存放在：Luatools工具目录下的 “量产文件生成默认文件夹\4G远程升级文件”<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_78628.png"></p>
<h1 id="4-IOT平台配置"><a href="#4-IOT平台配置" class="headerlink" title="4.IOT平台配置"></a>4.IOT平台配置</h1><h2 id="4-1"><a href="#4-1" class="headerlink" title="4.1"></a>4.1</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_63531.png"></p>
<h2 id="4-2添加IMEI-IMEI由模块包装获取，或由trace中获取-配置升级模块"><a href="#4-2添加IMEI-IMEI由模块包装获取，或由trace中获取-配置升级模块" class="headerlink" title="4.2添加IMEI(IMEI由模块包装获取，或由trace中获取),配置升级模块"></a>4.2添加IMEI(IMEI由模块包装获取，或由trace中获取),配置升级模块</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_50322.png"><br>添加成功后<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_75863.png"></p>
<h1 id="5-运行1-0-0版本软件的模块开机，会自动连接合宙服务器请求升级。"><a href="#5-运行1-0-0版本软件的模块开机，会自动连接合宙服务器请求升级。" class="headerlink" title="5.运行1.0.0版本软件的模块开机，会自动连接合宙服务器请求升级。"></a>5.运行1.0.0版本软件的模块开机，会自动连接合宙服务器请求升级。</h1><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_99175.png"></p>
<h1 id="注：升级成功后，模块会自动重启，运行新版本，可在IOT平台查询升级日志，确认模块升级成功"><a href="#注：升级成功后，模块会自动重启，运行新版本，可在IOT平台查询升级日志，确认模块升级成功" class="headerlink" title="注：升级成功后，模块会自动重启，运行新版本，可在IOT平台查询升级日志，确认模块升级成功"></a>注：升级成功后，模块会自动重启，运行新版本，可在IOT平台查询升级日志，确认模块升级成功</h1><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_67014.png"></p>
<h1 id="6-备注"><a href="#6-备注" class="headerlink" title="6.备注"></a>6.备注</h1><ol>
<li>关于空中升级原理，LUA版本空中升级（2G模块），循环升级等问题，参考<a target="_blank" rel="noopener" href="http://oldask.openluat.com/article/916">http://oldask.openluat.com/article/916</a></li>
<li>空中升级失败，错误码请参照本文AT固件升级介绍中 1.3.2部分</li>
<li>目前模块支持同一账号，不同项目间升级，不支持跨账号升级</li>
<li>如果需要定时执行升级功能等，请参考<a target="_blank" rel="noopener" href="https://wiki.openluat.com/doc/luatApi4G/#update">https://wiki.openluat.com/doc/luatApi4G/#update</a></li>
</ol>
<p>如有错误，欢迎指正！</p>

</article>

    <div class="pagenator post-pagenator">


        <a class="extend prev post-prev" href="/644/">上一篇</a>



    <p>上次更新 2021-01-28</p>


        <a class="extend next post-next" href="/642/">下一篇</a>

    </div>

    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">





				<li>
					<a href="https://luatdoc.papapoi.com/wiki/" title="stack-overflow" target="_self">
					<i class="fa fa-stack-overflow"></i>
					</a>
				</li>












				<li>
					<a href="https://github.com/openluat" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
















	</ul>
</div>
    <div class="copyright">
        <span>



                © 仅供搜索引擎收录使用 2017 - 2021

        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10);
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
