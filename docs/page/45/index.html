<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Luat doc 社区文章静态页面镜像</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:type" content="website">
<meta property="og:title" content="Luat doc 社区文章静态页面镜像">
<meta property="og:url" content="https://doc.luatos.wiki/page/45/index.html">
<meta property="og:site_name" content="Luat doc 社区文章静态页面镜像">
<meta property="og:description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chenxuuu">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Luat doc 社区文章静态页面镜像" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luat doc 社区文章静态页面镜像</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://doc.luatos.wiki"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-535" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/09/535/" class="article-date">
  <time class="dt-published" datetime="2018-12-09T10:12:57.000Z" itemprop="datePublished">2018-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/12/09/535/">Air720搭配Air530实现4G+GPS定位</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="硬件准备"><a href="#硬件准备" class="headerlink" title="硬件准备"></a>硬件准备</h2><ul>
<li>Air720H/Air720D开发板一块</li>
<li>Air530开发板一块</li>
</ul>
<h1 id="线路连接"><a href="#线路连接" class="headerlink" title="线路连接"></a>线路连接</h1><p>Air530开发板有5条线, 除PPS外均需要连接到Air720, 具体颜色可能不一样,仅供参考</p>
<table>
<thead>
<tr>
<th>Air530</th>
<th>Air720</th>
<th>颜色</th>
</tr>
</thead>
<tbody><tr>
<td>VCC</td>
<td>4V</td>
<td>黑</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
<td>蓝</td>
</tr>
<tr>
<td>TX</td>
<td>U2_RXD</td>
<td>红</td>
</tr>
<tr>
<td>RX</td>
<td>U2_TXD</td>
<td>黄</td>
</tr>
</tbody></table>
<p>实际连接图如下</p>
<p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_40296.jpg"></p>
<h2 id="Lua代码"><a href="#Lua代码" class="headerlink" title="Lua代码"></a>Lua代码</h2><p>从LuaTools的LuaTools\script\script_LuaTask\lib拷贝<code>gps.lua/agps.lua/gpsv2.lua</code></p>
<p>在调用了gps或gpsv2之前,提示两个点:</p>
<ul>
<li>如果demo代码从air202取,记得注释掉wdt</li>
<li>Air530开发板的波特率是9600, 一定要设置,否则100%报内存溢出,然后设备重启</li>
</ul>
<p>例如</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 老的gps库</span></span><br><span class="line">gps.setUart(<span class="number">2</span>, <span class="number">9600</span>,<span class="number">8</span>,uart.PAR_NONE,uart.STOP_1)</span><br><span class="line"><span class="comment">-- 新版的gps库</span></span><br><span class="line">gpsv2.<span class="built_in">open</span>(<span class="number">2</span>, <span class="number">9600</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h2 id="完整测试代码"><a href="#完整测试代码" class="headerlink" title="完整测试代码"></a>完整测试代码</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--必须在这个位置定义PROJECT和VERSION变量</span></span><br><span class="line"><span class="comment">--PROJECT：ascii string类型，可以随便定义，只要不使用,就行</span></span><br><span class="line"><span class="comment">--VERSION：ascii string类型，如果使用Luat物联云平台固件升级的功能，必须按照&quot;X.X.X&quot;定义，X表示1位数字；否则可随便定义</span></span><br><span class="line">PROJECT = <span class="string">&quot;Air720_GPS&quot;</span></span><br><span class="line">VERSION = <span class="string">&quot;2.0.0&quot;</span></span><br><span class="line">PRODUCT_KEY = <span class="string">&quot;v32xEAKsGTIEQxtqgwCldp5aPlcnPs3K&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--加载日志功能模块，并且设置日志输出等级</span></span><br><span class="line"><span class="comment">--如果关闭调用log模块接口输出的日志，等级设置为log.LOG_SILENT即可</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">LOG_LEVEL = <span class="built_in">log</span>.LOGLEVEL_TRACE</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;net&quot;</span></span><br><span class="line"><span class="comment">--每1分钟查询一次GSM信号强度</span></span><br><span class="line"><span class="comment">--每1分钟查询一次基站信息</span></span><br><span class="line">net.startQueryAll(<span class="number">60000</span>, <span class="number">60000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 两行代码二选一,测试用</span></span><br><span class="line">gps_lib = <span class="string">&quot;gps&quot;</span> <span class="comment">-- gps 经典gps库</span></span><br><span class="line"><span class="comment">--gps_lib = &quot;gpsv2&quot; --  gpsv2 新版gps库</span></span><br><span class="line"><span class="keyword">if</span> gps_lib == <span class="string">&quot;gps&quot;</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">require</span><span class="string">&quot;gps&quot;</span></span><br><span class="line">    <span class="built_in">require</span><span class="string">&quot;agps&quot;</span></span><br><span class="line">    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">printGps</span><span class="params">()</span></span></span><br><span class="line">        <span class="keyword">if</span> gps.isOpen() <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> tLocation = gps.getLocation()</span><br><span class="line">            <span class="keyword">local</span> speed = gps.getSpeed()</span><br><span class="line">            <span class="built_in">log</span>.info(<span class="string">&quot;testGps.printGps&quot;</span>,</span><br><span class="line">                gps.isOpen(),gps.isFix(),</span><br><span class="line">                tLocation.lngType,tLocation.lng,tLocation.latType,tLocation.lat,</span><br><span class="line">                gps.getAltitude(),</span><br><span class="line">                speed,</span><br><span class="line">                gps.getCourse(),</span><br><span class="line">                gps.getViewedSateCnt(),</span><br><span class="line">                gps.getUsedSateCnt())</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">--gps.setNmeaMode(2,nmeaCb)</span></span><br><span class="line">    gps.setUart(<span class="number">2</span>, <span class="number">9600</span>,<span class="number">8</span>,uart.PAR_NONE,uart.STOP_1)</span><br><span class="line">    gps.<span class="built_in">open</span>(gps.DEFAULT,&#123;tag=<span class="string">&quot;TEST1&quot;</span>&#125;)</span><br><span class="line">    sys.timerLoopStart(printGps,<span class="number">2000</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">require</span> <span class="string">&quot;gpsv2&quot;</span></span><br><span class="line">    sys.taskInit(<span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">        gpsv2.<span class="built_in">open</span>(<span class="number">2</span>, <span class="number">9600</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">log</span>.info(<span class="string">&quot;testGps isFix:&quot;</span>, gpsv2.isFix())</span><br><span class="line">            <span class="built_in">log</span>.info(<span class="string">&quot;testGps lng,lat:&quot;</span>, gpsv2.getIntLocation())</span><br><span class="line">            <span class="built_in">log</span>.info(<span class="string">&quot;testGps message:&quot;</span>, gpsv2.getAltitude(), gpsv2.getSpeed(),</span><br><span class="line">                gpsv2.getAzimuth(), gpsv2.getUsedSateCnt(), gpsv2.getViewedSateCnt())</span><br><span class="line">            sys.wait(<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--启动系统框架</span></span><br><span class="line">sys.init(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">sys.run()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/12/09/535/" data-id="ckkfmdgbx0072vkcg5csl3d60" data-title="Air720搭配Air530实现4G+GPS定位" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-534" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/08/534/" class="article-date">
  <time class="dt-published" datetime="2018-12-08T09:02:17.000Z" itemprop="datePublished">2018-12-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/12/08/534/">合宙720开发板连接阿里云MQTT</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>今天来给大家分享一下720开发板通过AT命令连接阿里云物联网平台的方法，阿里云物联网平台支持很多种连接协议，后台非常强大，可以清楚、直观的了解当前设备的连接状况。<br>本文主要介绍的是连接、发送部分，阿里云物联网平台还可以实现规则引擎、边缘计算、设备影子等非常强大的功能，感兴趣的小伙伴自行研究下。</p>
</blockquote>
<hr>
<blockquote>
<p>首先，我们先来了解一下阿里云物联网平台，这里是官方介绍链接：<br><a target="_blank" rel="noopener" href="https://www.aliyun.com/product/iot-deviceconnect">https://www.aliyun.com/product/iot-deviceconnect</a><br>这是关于设备端开发协议的官方文档：<br><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/30540.html">https://help.aliyun.com/document_detail/30540.html</a></p>
</blockquote>
<hr>
<blockquote>
<p>本教程对应阿里云中“MQTT客户端域名直连”部分，主要是讲解连接域名、设备ID、用户名、密码的计算步骤</p>
</blockquote>
<h1 id="一、阿里云平台设备创建"><a href="#一、阿里云平台设备创建" class="headerlink" title="一、阿里云平台设备创建"></a>一、阿里云平台设备创建</h1><h2 id="1、登陆阿里云-进入控制台-gt-物联网平台"><a href="#1、登陆阿里云-进入控制台-gt-物联网平台" class="headerlink" title="1、登陆阿里云,进入控制台-&gt;物联网平台"></a>1、登陆阿里云,进入控制台-&gt;物联网平台</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_38353.png"><br> 2、进入设备管理-产品<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_63872.png"></p>
<h2 id="3、创建产品"><a href="#3、创建产品" class="headerlink" title="3、创建产品"></a>3、创建产品</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_19354.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_63566.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_15335.png"></p>
<blockquote>
<p>关于基础版和高级版可以参考阿里云文档，这里以创建基础版为例</p>
</blockquote>
<h2 id="4、添加设备"><a href="#4、添加设备" class="headerlink" title="4、添加设备"></a>4、添加设备</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_73190.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_38825.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_84761.png"></p>
<blockquote>
<p>此处DeviceName建议填写IMEI号，也可填写其他可以保证唯一的号码（比如SN、MAC等）</p>
</blockquote>
<h2 id="5、得到设备证书（三元组数据）"><a href="#5、得到设备证书（三元组数据）" class="headerlink" title="5、得到设备证书（三元组数据）"></a>5、得到设备证书（三元组数据）</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_26003.png"></p>
<blockquote>
<p>这个设备证书里面有三个参数，稍后计算请求信息会用到，非常重要</p>
</blockquote>
<h2 id="6、配置Topic类"><a href="#6、配置Topic类" class="headerlink" title="6、配置Topic类"></a>6、配置Topic类</h2><p>回到刚刚创建的产品，在消息和通信选项卡下，创建Topic类<br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_26229.png"><br><img src="http://doc.openluat.com/api/static/editormd/uploads/5_61826.png"><br>Topic类分为发布、订阅、发布和订阅，发布是指可以向平台发送消息，订阅是指可以从平台接收消息，发布和订阅是指发送消息到平台并从平台接收消息（设备发布的消息平台会返回相同信息）</p>
<blockquote>
<p>阿里云Topic规则如下：<br>Topic格式必须以“/”进行分层，区分每个类目。其中前两个类目已经规定好，第一个代表产品标识productKey，第二个${deviceName}通配deviceName。简单来说，Topic类：/pk/${deviceName}/update是具体Topic： /pkTopic格式必须以“/”进行分层，区分每个类目。其中前两个类目已经规定好，第一个代表产品标识productKey，第二个${deviceName}通配deviceName。简单来说，Topic类：/pk/${deviceName}/update是具体Topic： /pk/mydevice/update 或者 /pk/yourdevice/update 的集合</p>
</blockquote>
<p>这里我们先添加一个发布和订阅的test Topic类</p>
<h1 id="二、计算请求信息"><a href="#二、计算请求信息" class="headerlink" title="二、计算请求信息"></a>二、计算请求信息</h1><blockquote>
<p>本教程示范步骤采用的是“MQTT客户端域名直连”方法，如采用“使用HTTPS认证再连接模式”需要先调用HTTP请求获取设备iotId和密钥iotToken，其余步骤基本相同<br>这里假设我的设备三元组信息如下：<br>ProductKey: a1hahpgAs3s<br>DeviceName: test<br>DeviceSecret: qIpssQEfjxuGoiDHCiQ6PZb1vUJ7SsAM</p>
</blockquote>
<h2 id="1、请求域名"><a href="#1、请求域名" class="headerlink" title="1、请求域名"></a>1、请求域名</h2><blockquote>
<p>${YourProductKey}.iot-as-mqtt.${YourRegionId}.aliyuncs.com:1883<br>${YourProductKey}请替换为您的产品key。<br>${YourRegionId}请参考地域和可用区替换为您的Region ID。</p>
</blockquote>
<p>目前阿里云物联网平台在国内只有华东2（上海）节点是开放的，对应的Region ID 为 cn-shanghai</p>
<blockquote>
<p>因此我的请求域名为：a1hahpgAs3s.iot-as-mqtt.cn-shanghai.aliyuncs.com</p>
</blockquote>
<h2 id="2、请求端口"><a href="#2、请求端口" class="headerlink" title="2、请求端口"></a>2、请求端口</h2><p>阿里云物联网平台请求端口都为1883，与地域、产品、设备无关</p>
<h2 id="3、请求ID"><a href="#3、请求ID" class="headerlink" title="3、请求ID"></a>3、请求ID</h2><blockquote>
<p>我的请求ID：test|securemode=3,signmethod=hmacsha1,timestamp=1544257319|</p>
</blockquote>
<p>其中test为DeviceName；securemode可选值有2 （TLS直连模式）和3（TCP直连模式）我们这里采用TCP直连模式因此选3；signmethod是加密方法，我们这里采用哈希SHA1加密，官方支持的还有hmacmd5、hmacsha256；timestamp是时间戳，代表当前时间</p>
<h2 id="4、请求username用户名"><a href="#4、请求username用户名" class="headerlink" title="4、请求username用户名"></a>4、请求username用户名</h2><blockquote>
<p>我的请求用户名：test&amp;a1hahpgAs3s</p>
</blockquote>
<p>其中test为DeviceName;a1hahpgAs3s为我的产品ProductKey</p>
<h2 id="5、请求password密码"><a href="#5、请求password密码" class="headerlink" title="5、请求password密码"></a>5、请求password密码</h2><blockquote>
<p>我的请求密码：c65de7069643b59fc972e8884fede9aaffeada38</p>
</blockquote>
<p>请求密码计算方法如下：</p>
<h3 id="（1）拼接签名原文"><a href="#（1）拼接签名原文" class="headerlink" title="（1）拼接签名原文"></a>（1）拼接签名原文</h3><blockquote>
<p>此处{ {} }中表示对应变量</p>
</blockquote>
<p>clientId{ {DeviceName} }deviceName{ {DeviceName} }productKey{ {ProductKey} }timestamp{ {time} }<br>例如，我的签名原文为：clientIdtestdeviceNametestproductKeya1hahpgAs3stimestamp1544257319</p>
<h3 id="（2）计算签名"><a href="#（2）计算签名" class="headerlink" title="（2）计算签名"></a>（2）计算签名</h3><p>签名密钥为DeviceSecret<br>根据哈希SHA1方法计算得出签名值为c65de7069643b59fc972e8884fede9aaffeada38</p>
<blockquote>
<p>签名计算部分比较复杂，因此我用JS开发了一个签名计算工具，地址：<br><a target="_blank" rel="noopener" href="http://lhb.ink/mqtt">http://lhb.ink/mqtt</a><br>工具采用JS计算签名值，所有信息在本地计算不会经过网络，可放心使用</p>
</blockquote>
<h1 id="三、合宙720连接MQTT"><a href="#三、合宙720连接MQTT" class="headerlink" title="三、合宙720连接MQTT"></a>三、合宙720连接MQTT</h1><blockquote>
<p>连接之前，建议将固件版本升级为最新版本</p>
</blockquote>
<h2 id="1、连接MQTT"><a href="#1、连接MQTT" class="headerlink" title="1、连接MQTT"></a>1、连接MQTT</h2><p><code>AT+CGREG?</code> 查询注册状态</p>
<p><code>AT+CGATT?</code> 查看当前GPRS附着状态</p>
<p><code>AT+CSTT=&quot;3GWAP&quot;</code> 设置APN 我这里用的是联通卡，如果是电信卡换成<code>AT+CSTT=&quot;CMNET&quot;</code></p>
<p><code>AT+CIICR</code> 激活移动场景</p>
<p><code>AT+CIFSR</code> 查询当前IP</p>
<p><code>AT+MCONFIG=&quot;test|securemode=3,signmethod=hmacsha1,timestamp=1544257319|&quot;,&quot;test&amp;a1hahpgAs3s&quot;,&quot;c65de7069643b59fc972e8884fede9aaffeada38&quot;</code> 设置当前连接参数，包括请求客户端ID、用户名、密码，<strong>此处请根据实际设备参数填写</strong></p>
<p><code>AT+MIPSTART=&quot;a1hahpgAs3s.iot-as-mqtt.cn-shanghai.aliyuncs.com&quot;,&quot;1883&quot;</code>设置当前连接参数，包括请求地址、端口，<strong>此处请根据实际设备参数填写</strong></p>
<p><code>AT+MCONNECT=1,600</code> 建立连接会话，此处600为MQTT保活时间</p>
<blockquote>
<p>设备端在保活时间间隔内，至少需要发送一次报文，包括ping请求。<br>如果服务端在保活时间内无法收到任何报文，物联网平台会断开连接，设备端需要进行重连。<br>设置保活时间的取值，取值范围为30至1200秒，建议取值300秒以上。</p>
</blockquote>
<p><code>AT+MSUB=&quot;/a1hahpgAs3s/test/test&quot;,0</code> 订阅消息，第一个test为设备DeviceName，第二个test为消息路径（在一、6中创建的，可在物联网平台配置）</p>
<p><code>AT+MPUB=&quot;/a1hahpgAs3s/test/test&quot;,0,0,&quot;helloworld&quot;</code>发布消息<code>helloworld</code>到test路径中</p>
<p><code>AT+MDISCONNECT</code> 关闭MQTT连接</p>
<p>此部分前后关联较强，附我测试的AT命令交互：</p>
<blockquote>
<p>16:39:24.390]发→◇AT+CGREG?<br>[16:39:24.391]收←◆AT+CGREG?<br>+CGREG: 2,1,”2317”,”0a541706”<br>OK<br>[16:39:25.590]发→◇AT+CGATT?<br>[16:39:25.592]收←◆AT+CGATT?<br>+CGATT: 1<br>OK<br>[16:39:27.048]发→◇AT+CSTT=”3GWAP”<br>[16:39:27.050]收←◆AT+CSTT=”3GWAP”<br>OK<br>[16:39:27.844]发→◇AT+CIICR<br>[16:39:27.847]收←◆AT+CIICR<br>[16:39:28.137]收←◆<br>+CGEV: ME PDN ACT 7<br>OK<br>[16:39:29.510]发→◇AT+CIFSR<br>[16:39:29.513]收←◆<br>AT+CIFSR<br>10.69.48.127<br>[16:39:48.025]收←◆+UPGRADEIND: 0<br>[16:39:54.611]收←◆+UPGRADEIND: -1002<br>[16:39:56.309]收←◆<br>+CGEV: NW MODIFY 5,2<br>[16:39:56.339]收←◆<br>+CGEV: NW MODIFY 7,2<br>[16:41:35.502]发→◇AT+MCONFIG=”test|securemode=3,signmethod=hmacsha1,timestamp=1544257319|”,”test&amp;a1hahpgAs3s”,”c65de7069643b59fc972e8884fede9aaffeada38”<br>[16:41:35.505]收←◆<br>AT+MCONFIG=”test|securemode=3,signmethod=hmacsha1,timestamp=1544257319|”,”test&amp;a1hahpgAs3s”,”c65de7069643b59fc972e8884fede9aaffeada38”<br>OK<br>[16:41:36.960]发→◇AT+MIPSTART=”a1hahpgAs3s.iot-as-mqtt.cn-shanghai.aliyuncs.com”,”1883”<br>[16:41:36.962]收←◆AT+MIPSTART=”a1hahpgAs3s.iot-as-mqtt.cn-shanghai.aliyuncs.com”,”1883”<br>OK<br>[16:41:37.271]收←◆<br>CONNECT OK<br>[16:41:38.519]发→◇AT+MCONNECT=1,600<br>[16:41:38.522]收←◆AT+MCONNECT=1,600<br>OK<br>[16:41:38.720]收←◆<br>CONNACK OK<br>[16:41:58.578]发→◇AT+MSUB=”/a1hahpgAs3s/test/test”,0<br>[16:41:58.582]收←◆AT+MSUB=”/a1hahpgAs3s/test/test”,0<br>OK<br>[16:41:58.791]收←◆<br>SUBACK<br>[16:42:06.912]发→◇AT+MPUB=”/a1hahpgAs3s/test/test”,0,0,”helloworld”<br>[16:42:06.915]收←◆AT+MPUB=”/a1hahpgAs3s/test/test”,0,0,”helloworld”<br>OK<br>[16:42:07.073]收←◆<br>+MSUB: “/a1hahpgAs3s/test/test”,10 byte,helloworld<br>[16:42:17.258]发→◇AT+MDISCONNECT<br>[16:42:17.261]收←◆<br>AT+MDISCONNECT<br>OK<br>[16:42:19.824]收←◆<br>CLOSED</p>
</blockquote>
<p>注：实际请求请使用根据设备计算的参数进行连接</p>
<h2 id="2、在阿里云后台查看设备连接情况"><a href="#2、在阿里云后台查看设备连接情况" class="headerlink" title="2、在阿里云后台查看设备连接情况"></a>2、在阿里云后台查看设备连接情况</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_44673.png"><br>激活设备：首次连接连接后设备由未激活变为激活状态</p>
<h2 id="3、查看设备日志"><a href="#3、查看设备日志" class="headerlink" title="3、查看设备日志"></a>3、查看设备日志</h2><p><img src="http://doc.openluat.com/api/static/editormd/uploads/5_61952.png"></p>
<p><em>内容较长难免出现纰漏，如有错误欢迎批评指正</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/12/08/534/" data-id="ckkfmdgbx0071vkcgev0l4a53" data-title="合宙720开发板连接阿里云MQTT" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-533" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/02/533/" class="article-date">
  <time class="dt-published" datetime="2018-12-02T10:36:36.000Z" itemprop="datePublished">2018-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/12/02/533/">air202luat二次开发设备接入阿里云（七）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><span style="color: rgb(51, 51, 51);">记录设备接入阿里云的过程</span></p><p><span style="color: rgb(51, 51, 51);">七，网页控制开关灯</span></p><p><span style="color: rgb(51, 51, 51);">有了前面文章积累的代码，通过网页开关灯就比较好实现了，无非是写个网页发送请求，话不多说开干。</span></p><p><span style="color: rgb(51, 51, 51);">1，前端页面</span></p><p><span style="color: rgb(51, 51, 51);">因为没怎么学过前端之前的网页都太low了</span><span style="color: rgb(51, 51, 51); font-family: arial; font-size: 13px;">-_-! 于是这次决定搞个稍微美观一点的！！！（虽然最后结果是还是很难看</span><span style="color: rgb(51, 51, 51); font-family: arial; font-size: 13px;">‘(*&gt;﹏&lt;*)′</span><span style="color: rgb(51, 51, 51); font-family: arial; font-size: 13px;">&nbsp;</span><span style="color: rgb(51, 51, 51); font-family: arial; font-size: 13px;">）</span></p><p>网上搜了个按钮的素材</p><p><img src="http://oldask.openluat.com/image/show/attachments-2018-12-U4bSMgEe5c03ac436b130.png" style="width: 271px;" class="img-responsive">有了开关下面就是点开关的时候执行的功能了，本来想着直接写个按钮点击事件直接执行后端代码，后来发现这样不可行因为页面会跳转，怎样在不刷新全部页面的情况下刷新页面部分内容呢？当然是ajax技术了，所以现在的逻辑就变成了通过ajax发送开关指令到后端页面并刷新按键状态，我对js这东西不太懂，基本都是边百度边写的，所以代码可能写的比较渣。</p><p>代码如下：</p><pre>    &lt;div class="text"&gt;
        开关灯
    &lt;/div&gt;
    &lt;!-- 按钮 --&gt;
    &lt;form class="wrap5" a="off" &gt;
        &lt;span type="submit" name="deng"  data-value="开灯指令的base64编码" id="aa"&gt;ON&lt;/span&gt;
        &lt;span type="submit" name="deng"  data-value="关灯指令的base64编码" id="bb"&gt;OFF&lt;/span&gt;
        &lt;div&gt;&lt;/div&gt;
    &lt;/form&gt;

<pre><code>&amp;lt;script src=&quot;LED/js/jquery.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;

    var df;
    var boolean = true;
    $(&quot;.wrap5&quot;).mousedown(function(event) &#123;
        if ($(&quot;.wrap5&quot;).attr(&quot;a&quot;) == &quot;off&quot;) &#123;
            $(&quot;.wrap5 div&quot;).stop().animate(&#123;
                &quot;left&quot; : &quot;98px&quot;
            &#125;,400),
            $(&quot;.wrap5&quot;).attr(&quot;a&quot;,&quot;on&quot;)
            df = $(&quot;#aa&quot;).attr(&quot;data-value&quot;);
        &#125;else &#123;
            $(&quot;.wrap5 div&quot;).stop().animate(&#123;
                &quot;left&quot; : &quot;2px&quot;
            &#125;,400),
            $(&quot;.wrap5&quot;).attr(&quot;a&quot;,&quot;off&quot;)
            df = $(&quot;#bb&quot;).attr(&quot;data-value&quot;);
        &#125;
    &#125;);
</code></pre>
<p> $(‘form’).click(function() {</p>
<p>   $.ajax(<br>     {<br>      url: ‘/aliyun/INIT.php’,//根据自己路径修改<br>      method: ‘get’,<br>      data: {‘df’:df},<br>     });<br>         });</p>
<p> &lt;/script&gt;<br></pre><p>2，后端</p><p>后端就比较好实现了，就是获取前端请求的指令把指令发送到阿里云。</p><p>前端用的get请求所以后端直接获取参数就行了，代码很少无非就是之前发送的固定的base64字符串变成get请求的变量罢了</p><p><img src="http://oldask.openluat.com/image/show/attachments-2018-12-ZF4yFC2W5c03b14b2b0d0.png" style="width: 530px;" class="img-responsive"><br></p><p>3，测试</p><p>先把我们的设备上线，然后浏览器打开刚刚写好的前端页面，成功的实现了开关灯操作</p><p>4，后记</p><ol><li>&nbsp;&nbsp;&nbsp;&nbsp;虽然能开关灯了但是一打开页面默认是开灯，要先点off才能on，比较差劲，研究了半天api也没搞明白怎么查询设备状态，还需努力。</li><li>&nbsp;&nbsp;&nbsp;&nbsp;只能控制一个设备，这个应该好解决，多传几个参数就行，但是怎么用一个页面区分不同设备没想出来Q_Q 大佬们能给个思路不&nbsp;(๑´ڡ`๑)</li><li>&nbsp;&nbsp;&nbsp;&nbsp;革命尚未成功，同志仍需努力</li></ol></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/12/02/533/" data-id="ckkfmdgbw0070vkcgg0jbd1bh" data-title="air202luat二次开发设备接入阿里云（七）" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-532" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/29/532/" class="article-date">
  <time class="dt-published" datetime="2018-11-29T13:35:21.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/29/532/">air202luat二次开发设备接入阿里云（六）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p style="color: rgb(51, 51, 51);">记录设备接入阿里云的过程</p><p style="color: rgb(51, 51, 51);">六，通过自己的服务器控制阿里云的设备</p><p style="color: rgb(51, 51, 51);">之前说过通过阿里云下发指令控制设备，可是下发命令是在控制台里模拟的，这很不方便也不符合实际使用场景，所以就考虑怎么通过别的方式下发命令。</p><p style="color: rgb(51, 51, 51);">1，流程分析，大体流程基本如下</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-ERSEgxv65bffba0e12bfa.png" style="width: 117.5px;" class="img-responsive"></p><p style="color: rgb(51, 51, 51);">2，网页发送指令传递给服务器</p><p style="color: rgb(51, 51, 51);">环境要求：一个公网ip，web开发环境（要求有后端语言的环境）</p><p style="color: rgb(51, 51, 51);">其实就是很常见的前端页面传递请求后端处理，为了简单我就直接链接跳转到后端页面。</p><pre style="">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;发送指令测试&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;a href="/send.php"&gt;
        &lt;button&gt;点我发送指令&lt;/button&gt;
    &lt;/a&gt;
&lt;/body&gt;<br></pre><p style="color: rgb(51, 51, 51);">3，服务器根据前端请求通过api向阿里云发送指令</p><p style="color: rgb(51, 51, 51);">下载sdk，因为学习过php所以我使用的是php的sdk</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-ILIJcly85bffccd5c3a7d.png" style="width: 315.5px;" class="img-responsive">参照api写代码</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-r2gxHnDy5bffcd6040ea8.png" style="width: 369.5px;" class="img-responsive">在sdk根目录新建一个client.php</p><p style="color: rgb(51, 51, 51);"><span class="keyword parmname" style="padding: 0px; margin: 0px; font-family: monospace; font-weight: 700;">accessKeyId</span><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">即您的账号的AccessKeyId，</span><span class="keyword parmname" data-spm-anchor-id="a2c4g.11186623.2.i0.30ec49403TL9My" style="padding: 0px; margin: 0px; font-family: monospace; font-weight: 700;">accessSecret</span><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">即AccessKeyId对应的AccessKeySecret&nbsp;&nbsp;</span><a href="https://ak-console.aliyun.com/?spm=a2c4g.11186623.2.12.30ec49403TL9My" target="_blank">获取</a><br></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-TEZeEnfE5bffe7c109006.png" style="width: 431px;" class="img-responsive">新建一个send.php</p><p style="color: rgb(51, 51, 51);">根据阿里云产品的信息修改，其中要发送的数据要求转换成base64，可以在<a href="http://tool.oschina.net/encrypt?type=3" target="_blank">这里</a>转换</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-h2N62ZCu5bffe89f1fadc.png" style="width: 481px;" class="img-responsive">把这几个文件放到可以被调用到的地方</p><p style="color: rgb(51, 51, 51);">4，测试</p><p style="color: rgb(51, 51, 51);">首先将设备连接上阿里云，打开luatool工具打印调试信息，打开html文件，点击发送指令，luatool工具log中出现hello world</p><p style="color: rgb(51, 51, 51);"><br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/29/532/" data-id="ckkfmdgbw006zvkcg5gsja06n" data-title="air202luat二次开发设备接入阿里云（六）" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-531" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/29/531/" class="article-date">
  <time class="dt-published" datetime="2018-11-29T03:13:42.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/29/531/">air202luat二次开发设备接入阿里云（五）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p style="color: rgb(51, 51, 51);">记录设备接入阿里云的过程</p><p style="color: rgb(51, 51, 51);">五，一型一密</p><p style="color: rgb(51, 51, 51);">前几篇文章写的都是一机一密，但是实际项目中设备往往很多，不可能一一修改代码烧录，所以阿里云提供了一型一密的解决方案</p><p style="color: rgb(51, 51, 51);"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">一型一密安全认证方式，即为同一产品下所有设备烧录相同固件（固件中写入产品证书，即ProductKey和ProductSecret）。设备发送激活请求时，物联网平台根据产品证书进行认证。认证通过，物联网平台下发该设备对应的DeviceSecret。</span></p><p style="color: rgb(51, 51, 51);"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">1，开启一型一密</span></p><p style="color: rgb(51, 51, 51);"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">我们看一下我们之前创建的产品</span></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-BRa2cIJC5bff55bf3466d.png" style="width: 644px;" class="img-responsive"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">我们只需要打开这个动态注册，我们的产品就具有了一型一密的功能</span></p><p style="color: rgb(51, 51, 51);"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">2，新增设备</span></p><p style=""><font face="PingFangSC, helvetica neue, hiragino sans gb, arial, microsoft yahei ui, microsoft yahei, simsun, sans-serif" style="color: rgb(51, 51, 51);">新增设备的方法与之前一样，但是有一点，现在的DeviceName必须是设备的imei</font></p><p style=""><font face="PingFangSC, helvetica neue, hiragino sans gb, arial, microsoft yahei ui, microsoft yahei, simsun, sans-serif" style="color: rgb(51, 51, 51);">3，修改代码</font></p><p style=""><font face="PingFangSC, helvetica neue, hiragino sans gb, arial, microsoft yahei ui, microsoft yahei, simsun, sans-serif" style="color: rgb(51, 51, 51);">去掉这里注释，修改相应参数为自己的产品的</font></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-BKJBB2195bff577f50192.png" style="width: 275px;" class="img-responsive"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;"><br></span></p><p style="color: rgb(51, 51, 51);"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">获取imei作为DeviceName</span></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-nxt2gWMt5bff585b990a4.png" style="width: 432px;" class="img-responsive"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-STB9eZDc5bff587892a25.png" style="width: 520px;" class="img-responsive"><span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;"><br></span>注释一机一密，去掉一型一密的注释</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-F3yatlAU5bff58217a5a7.png" style="width: 515px;" class="img-responsive">四，烧录</p><p style="color: rgb(51, 51, 51);">把代码下载进设备，可以看到刚才创建的设备已经激活</p><p style="color: rgb(51, 51, 51);">五，注意</p><p style="color: rgb(51, 51, 51);">必须先在阿里云根据设备imei新建设备，一型一密只是<span style="font-family: PingFangSC, &quot;helvetica neue&quot;, &quot;hiragino sans gb&quot;, arial, &quot;microsoft yahei ui&quot;, &quot;microsoft yahei&quot;, simsun, sans-serif;">安全认证方式，只用于设备认证不能自动添加设备</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/29/531/" data-id="ckkfmdgbu006yvkcgaos30gfw" data-title="air202luat二次开发设备接入阿里云（五）" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-530" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/28/530/" class="article-date">
  <time class="dt-published" datetime="2018-11-28T07:23:49.000Z" itemprop="datePublished">2018-11-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/28/530/">用于air640（esp8266）lua固件的编译</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>air640使用的是esp8266，但是现在还未像air202之类的GPRS模块一样进行lua的适配，由于nodemcu的助力，越来越多的开发者使用lua进行esp8266的开发，虽然官网可以方便的进行云端编译，但是由于开发过程中的特殊需要总是免不了自己进行固件编译，其中开发环境的搭建让很多人头痛，nodemcu提供了一套docker的编译环境，用起来还是很方便的，简单的几个命令就能实现固件编译。</p><p>一，docker的安装</p><p>我用的是win10，所以直接在官网下载安装包安装即可（<a href="https://store.docker.com/editions/community/docker-ce-desktop-windows" target="_blank">传送门</a>），其他系统的自己百度就行安装过程都是傻瓜化的，其中win10安装过程中可能出现由于没有开启hyper-v导致的错误，去控制面板/程序功能/开启就可以。遇到问题百度即可不多赘述。</p><p>二，docker镜像同步</p><p>在cmd或者powershell中执行<br></p><pre>docker pull marcelstoer/nodemcu-build</pre><p>等待同步完</p><p>三，nodemcu代码同步</p><p>如果电脑中安装了git可以直接执行</p><pre>git clone --recurse-submodules https://github.com/nodemcu/nodemcu-firmware.git</pre><p>没安装的可以去GitHub上打包下载zip解压</p><p>源码存放的位置随意</p><p>四，测试编译</p><p>找到自己下载源码的位置，在源码根目录新建一个make.vbs输入如下内容</p><pre>docker run --rm -ti -v %cd%:/opt/nodemcu-firmware marcelstoer/nodemcu-build build</pre><p>双击运行即可编译出测试固件，固件位置为源码根目录的bin文件</p><p>五，其他</p><p>这只是编译测试固件，实际使用中往往是配置特定固件，需要定制只需要按照<a href="https://nodemcu.readthedocs.io/en/latest/en/build/#build-options" target="_blank">文档</a>修改，编译过程不变</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/28/530/" data-id="ckkfmdgbu006xvkcg8a4nazvq" data-title="用于air640（esp8266）lua固件的编译" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-529" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/24/529/" class="article-date">
  <time class="dt-published" datetime="2018-11-23T20:30:29.000Z" itemprop="datePublished">2018-11-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/24/529/">《柯南》剧场版里的物联网恐怖袭击，能成真吗？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>摘自：https://www.huxiu.com/article/273115.html?f=wangzhan</p><p><img style="width: 1149px;" src="https://img.huxiucdn.com/article/cover/201811/23/104429291224.jpg"></p><p>作为一个20多年的《柯南》老粉，前两天从电影院走出来的时候，不禁热泪盈眶：想不到啊，想不到有一天又跟柯南成同行了。遥想20年前，我只是个小学生，柯南也是个小学生；而今我是个研究IoT的记者，柯南也是个研究IoT的……小学生。</p><p>命运就是一条曲折离奇的锦鲤，当年我们看着柯南里各种神乎其技的科学，感叹柯南活在另一个世界。结果今年剧场版《零的执行人》里，我们看到了无人机、智慧城市、IoT家居，这些中国科技圈成天嘟囔的东西，居然也被柯南认认真真研究了一回。不禁有种“人生终于追上进度”的异样感受。</p><p>既然追上进度了，那怎么也得多聊两句。看过电影之后大家会发现，《零的执行人》中的弱智嫌犯……只用了一种作案方式：<b>物联网攻击</b>。</p><p><img style="width: 800px;" src="https://img.huxiucdn.com/article/content/201811/22/212345419845.png"></p><p>用手机轻轻一操作，全城的家电手机噼里啪啦爆炸，汽车撞成一团，卫星都让他“召唤”来直接撞东京。这简单程度够柯南里其他一千多个犯罪份子眼红一个月的。</p><h2>物联网难道已经危险成这个样子了？</h2><p>当然了，大家都知道柯南剧场版里的气氛，不惊天动地大爆炸一番是不行的，所以肯定没那么夸张。那么真实的物联网攻击，又是什么样的呢？让我们一件件看这届《柯南》剧场版里发生的案子。</p><p label="大标题" class="text-big-title">“开快点，卫星要撞地球了”</p><p>本集柯南中最装X的一幕大概是这样的：</p><blockquote><p>柯南：“安室啊，开快点。我到前面大楼上用足球踢掉个卫星给你看看”。</p><p>安室透：“得嘞。你看迎面过来那高铁没？我从它顶上给你开过去”。</p></blockquote><p>开挂的人生就是这么生猛，然而比他们两个更开挂的，其实还是嫌犯检察官（我就随意剧透了，反正推理也不是本剧重点），动动手机就把返航的卫星探测器给召唤过来撞地球了——这大概就是传说中的“天降正义”吧？</p><p><img style="width: 800px;" src="https://img.huxiucdn.com/article/content/201811/22/212340609156.png"></p><p>这件事听起来就很不靠谱，但仔细一调查我们会发现，卫星这东西的安全问题已经很严重了。</p><p><strong>目前地球轨道上有超过1000颗卫星在服役。其中有些卫星，尤其是民用通信与广电卫星，已经是名副其实的古董，使用的加密技术和通信网络已经有暴露在黑客攻击下的可能性。</strong></p><p><img style="width: 480px;" src="https://img.huxiucdn.com/article/content/201811/22/212341401542.png"></p><p>今年4月，美国战略与国际问题研究中心（CSIS）航空安全项目组发布了一份报告，其中认为当今世界上有超过4成卫星带有不同程度的安全隐患。有多种技术可以用来影响卫星，并且大部分造价十分低廉。进而得出结论：在今天卫星通信、定位、导航等产业，都具备受到有组织攻击的可能性。</p><p>实际上，黑客攻击卫星的案例正在越来越多。就在几个月之前，有外媒报道发现了专门攻击卫星通信开发商和地理空间成像企业的黑客组织。美国和东南亚的很多企业都受到过这个号称Thrip的黑客组织攻击。</p><p>针对卫星的网络攻击，基本以窃取卫星通讯频段和盗取数据为主。但是如今也出现了利用卫星通讯网络的漏洞，对卫星实现物理攻击的消息。</p><p>今年8月，安全公司IOActive宣布找到了一些卫星、飞船、船舶上系统上的新漏洞。这项发现的特别之处在于，攻击者可以利用漏洞来提高卫星天线的功率输出来，使电线过载，达到物理层面瘫痪卫星的目标。</p><p>听起来是不是跟《零》里面的剧情已经有点神似？当然了，一般情况下卫星即使掉落，也是绝对不可能突破大气层的。所以用卫星撞地球这件事并不靠谱。更何况也没有什么技术能控制卫星掉下来。</p><p>当然，《零》中的卫星劫持剧情特意安排在了空间探测器的返回舱上。这种超小概率的事件现实中还没发生过，就暂且让柯南自己去担心好了。</p><h1 label="大标题" class="text-big-title">一言不合，电视就爆炸了？</h1><p>相比卫星掉下来这种事儿，普通人可能更关心家里的物联网安全问题。</p><p><img style="width: 799px;" src="https://img.huxiucdn.com/article/content/201811/22/212352948505.png"></p><p>于是《零》中有这样一个剧情：英妃理的律师事务所里的电视，一言不合就爆炸了。</p><p>当电视被视作一个终端，开始承载更多互联网与智能交互，这块超大屏幕背后的安全问题也随之显现了出来。</p><p>还记得去年的勒索病毒吗？跟以往的木马攻击不同，勒索病毒蔓延到了手机与电脑外的其他终端，比如各种物联网设备。很不幸的是，电视也是其中之一。在勒索病毒爆发之后，短期内就发现了大量勒索病毒的变种。而在欧洲首先发现了针对智能电视的勒索病毒，并很快在俄罗斯和东欧地区蔓延开来。</p><p>与电脑一样，针对智能电视的勒索病毒也会把电视“砖”掉，用户唯一能看到的界面写着支付500美金来拯救电视。好在事后证明，勒索病毒利用的系统漏洞属于微软系统的早期问题。只有极少数品牌的已停产智能电视才可能被电视版病毒感染，影响范围有限。</p><p><strong>但这是首次出现针对电视的勒索病毒，或许可以认为，以电视为目标的网络攻击正呈现上升趋势。</strong></p><p><img style="width: 634px;" src="https://img.huxiucdn.com/article/content/201811/22/212346055494.png"></p><p>与电脑系统不同，数字电视的一个特点是要连接固定的广播信号。而这也可能成为攻击电视的新通道。</p><p>瑞士安全专家Rafael Scheel此前发现过一种新的电视攻击方法：用专门的信号发射机，通过DVB-T数字信号向用户发送恶意视频，从而实现对目标用户电视的远程控制。这种方法甚至可以利用某些型号电视上的摄像头对用户进行监视。</p><p>DVB-T是欧洲通用的数字电视信号格式，因此这个漏洞的发现，证明了数量巨大的数字电视普遍存在安全风险——在未知的数字世界里，家里的电视可能远比我们以为的脆弱。</p><p>当然了，像《零》中那样直接让电视自爆，理论上是行不通的：肯定不会有电视被设计成可以用网络控制电源过载。</p><p>现实世界里的电视爆炸，基本上是产品质量问题。</p><h1 label="大标题" class="text-big-title">整条街的车都失控了？还好柯南有滑板</h1><p>如果现实世界中，不法分子控制了一整条街上的车，那得是多可怕的事？</p><p>《零》中的傻嫌疑人虽然没有控制汽车，但通过IoT袭击瘫痪了一条街上的所有车辆。无数汽车连环相撞，卡车飞上天空。这一幕发生在现实中肯定会载入历史，但在动画里只是为了让柯南同学秀一段滑板技术而已。</p><p><img style="width: 799px;" src="https://img.huxiucdn.com/article/content/201811/22/212351756338.png"></p><p>但在车联网和自动驾驶愈来愈火热的今天，汽车的网络安全问题确实正在得到大量关注。毕竟某个黑客可以控制的方向盘和油门，这感觉有点过分恐怖了。</p><p>与黑客遥控电视爆炸不同，通过网络直接夺取车辆的控制权并非不可能发生，或者说至少可以部分发生。</p><p><img style="width: 750px;" src="https://img.huxiucdn.com/article/content/201811/22/212354329407.png"></p><p>通过车联网漏洞，两名安全专家先是控制了汽车的通风口、收音机、雨刮等设备，接着占领了车载屏幕，最后控制网络应急机制控制汽车停车。</p><p>当然这只是个安全实验，现实生活中远程侵入汽车并没有那么容易。一方面油门、刹车、中控等核心系统都是纯机械结构的，网络再被渗透也不会导致汽车真正失灵；另一方面，车载场景的数据量和网络接触面都比较有限，黑客能使用的汽车攻击方式很少。</p><p>然而要紧的是，自动驾驶技术正在一天天发展。总有一天人类的汽车是要全部交给算法和网络去控制的。那时的汽车安全不再受人类控制？</p><p>事实上，自动驾驶系统的安全问题，确实正在凸显出来。有很多人类司机很容易应对，或者根本不存在的问题，都是自动驾驶系统难以克服的。</p><p>比如对抗攻击问题。机器视觉的理解能力与真人不同，加入在路牌上掺杂干扰信息，就很可能扰乱自动驾驶系统的命令中枢——比如把限速当成停车。</p><p>再比如今天很多专家在思考用红外线异常体，来干扰激光雷达的可能性。用一些散热异常材料或者反射异常材料，安全专家可以模拟出激光雷达看不见的“障碍物”。路上确实有个路障，但激光雷达却看不见从而直接撞上去，这显然是非常严重的安全隐患。</p><p>很难说我们今天的安全技术与产业，已经准备好迎接无人驾驶的到来。——当然，目前为止针对车联网与自动驾驶系统进行黑客攻击的真实案例并不多。但安全专家确实在这个领域发现了大量目前还没有答案的问题。</p><p>这样看来，针对车的攻击，或许是《零的执行人》里最写实的一幕。希望迎来无人驾驶的时候，我们已经确实准备好了。</p><h1 label="大标题" class="text-big-title">你的手机也“biu”一下爆开了</h1><p>《零》中还有一幕是这样的：嫌犯怨恨自己的上司，于是用IoT袭击引爆了她的手机，当场把女检察官炸伤。</p><p><img style="width: 799px;" src="https://img.huxiucdn.com/article/content/201811/22/212355602428.png"></p><p>说到这，想必各位被leader虐过千百遍的朋友，心中都产生了一个大胆的想法……但是咱先别急着高兴，就跟电视的原理一样。实在难以想象手机里原装了自爆能力，就等黑客来biu地一声引爆。当然三星Note7可能是个另类。</p><p>爆炸不可能，针对手机的网络攻击却是千奇百怪的。这里说两个跟IoT层面相关的，一个是利用为基站把用户手机拖入不安全网络，实施手机劫持和信息盗取。再就是著名的IoT僵尸网络攻击，可以通过不同IoT网络间的信号过载，导致手机瘫痪。</p><p>物联网的世界里，我们的手机将连接各种各样的设备和网络，而这也事实上增加了安全隐患。物联网攻击的问题复杂性，就在于它是巨量设备与数据的交织。</p><p>便利蕴藏于万物互联，危险当然也藏身其中。</p><p>物联网连环大爆炸了解一下？</p><p>上面说了几种比较有代表性的硬件被IoT袭击的可能。</p><p>而在《零的执行人》中，我们会发现根本没有什么设备是不会被袭击的——好像除了柯南的儿童手表是个例外。</p><p>电饭煲爆炸引发了最开始的恐慌，煤气阀门可以被远程控制打开。其他诸如喷热水的壶、喷衣服的洗衣机、起火的空调、爆炸的自动售货机，凡此种种不一而足。总之在这部剧场版中，犯人轻轻一点，整个东京能连上电的地方都在爆炸。</p><p><img style="width: 800px;" src="https://img.huxiucdn.com/article/content/201811/22/212355113109.png"></p><p>显然我们不能一个个分析这些设备被袭击的可能性以及动画中的夸张之处，但我们可以看一下真正的物联网攻击，主要是通过哪些方式实现的。</p><p>归纳一下，这些年真实的物联网攻击案例，可以说主要是通过三种方式来实现的：</p><p><strong>1. 用僵尸网络瘫痪IoT设备。</strong></p><p>2016年，大名鼎鼎的Mirai

<p>僵尸网络，号称利用IoT网络的辨识漏洞瘫痪了整个东海岸的互联网。根据一些安全公司的统计，这次事件中黑客利用DDOS攻击，使用了多达150万台被入侵设备组成了“僵尸网络”。这些网络会向其他设备发送大量请求，继而导致IoT设备陆续被入侵和瘫痪。</p><p>智能摄像头是僵尸网络攻击下最容易受到攻击的设备，而僵尸网络最可怕的地方在于：被入侵的设备会变成新的“僵尸”，继而去攻击其他设备。这导致这种IoT攻击一旦形成气候就会损失巨大。</p><p><img style="width: 653px;" src="https://img.huxiucdn.com/article/content/201811/22/212354776852.png"></p><p><strong>2. 伪装识别。</strong></p><p>由于物联网没有统一的网络标准，很多设备是建立在不安全的网络基础环境之上。因此经常有可能进行错误的网络连接与控制器错认。早先很多廉价儿童手表都有这种问题，经常可能把其他手机错认成父母手机。</p><p>在《零的执行人》的TV版联动剧集，第953话《蛋糕融化了》（硬核柯南粉鉴定完毕），就展示了这种情况：出租车电台错误接入了IoT冰箱，导致冰箱断电。这个在早先的物联网网络环境中很常见，今天基本已经解决。所以今天针对电饭煲、热水壶之类的设备进行攻击，大体已经是个费力不讨好的事。</p><p><strong>3. 通过不良Wi-Fi破解入侵IoT设备。</strong></p><p>更常见的物联网攻击，是诱导物联网设备连上不安全的Wi-Fi，然后通过传输不良信号等方式来实现入侵。这种方式最常见于智能锁的破解，据说80%的智能锁破解案件，都是利用终止原Wi-Fi信号，诱导智能锁连接黑客准备的Wi-Fi来完成的。因此有专家认为，智能锁还是要尽可能保持在离线状态。</p><p>而这种模式最令人担心的案例，是利用不良Wi-Fi来劫持体联网设备。比如不久前有安全专家成功用Wi-Fi连接的方式，入侵了体内植入式心脏起搏器。</p><p>总的来看，物联网攻击的危害在于：造成网络瘫痪、争夺控制权、窃取数据。至于《零》中的爆炸，实在是有点强IoT所难。</p><p>但问题是，现实中的IoT攻击已经够让人担心了。</p><p label="大标题" class="text-big-title">虽然不是死神少年，但我们也要面对IoT攻击</p><p><br></p><p><strong>物联网攻击之所以令人担忧，首先是因为物联网设备今天正在越来越普及。随着设备基数的不断扩大，物联网攻击的影响力显然也在增强。</strong></p><p>虽然今天还没有出现过《零》中讨论的IoT恐怖袭击，可是一旦不法分子利用上述方式，发动针对医院、能源系统、交通网络的IoT袭击，那么恶劣影响是完全可能达到恐怖袭击水准的。</p><p>另一方面，是我们对IoT的安全问题认识并不充分。</p><p>不同的IoT设备，拥有不同的网络频谱、不同的底层系统，所以攻击方式也是花样百出的。媒体和大众只能看到一个认识一个。究竟破坏力的终点在哪里，恐怕是黑帽与白帽们才能一窥究竟的。</p><p>当然，讳疾忌医绝不是对待新技术的应有态度。IoT攻击再激烈，也绝对不可能超出网络控制的范畴，绝不是存在动画中每个IoT都是一枚定时炸弹的那种情况。并且关键硬件一定是有物理防护的。再强的黑客，也不可能无缘无故让你的电视手机爆炸。</p><p>正视问题和不断解决问题，才是对待IoT安全问题的正确姿态。防患于未然，建立统一标准和跨国协作机制，让白帽用力奔跑，都是今天IoT产业的题中之意。</p><p>对于大众来说，我们要做的第一件事就是想当年全民杀毒一样，认识到IoT安全的重要性。之所以这么说，是因为看到柯南贴吧里有个哥们，发帖感叹日本的物联网都这么先进了，怎么中国什么物联网都没有？其实对比《零》中的物联网水平，中国一点也不差。</p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/24/529/" data-id="ckkfmdgei00d9vkcg81yq1pe8" data-title="《柯南》剧场版里的物联网恐怖袭击，能成真吗？" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-528" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/23/528/" class="article-date">
  <time class="dt-published" datetime="2018-11-23T11:55:39.000Z" itemprop="datePublished">2018-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/23/528/">物联网卡十年简史</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>摘自：http://www.tmtpost.com/3605949.html
 物联网卡十年简史</p><p>如果从上帝视角看，互联网是一个喧嚣的世界，数十亿的人节点，通过无数看不见的数据链，交互着自己的生活和工作，信息丰富而多彩，充满着创意和活力、欢乐和哀愁。</p><p>在这之下，还有一张庞大的暗网。</p><p>数十亿节点都是没有生命的设备，一丝不苟的传递着传感数据，冷冷的执行着各种命令，这个无声而古板的网络，不断的把物理世界的信息转成数字放进虚拟世界，把虚拟世界的指令变成物理世界真实的动作，它让共享单车、无人驾驶、扫码零售等等很酷的应用成为了可能。</p><p>它，就是物联网，可能是未来自动化世界的基石。</p><p>在越来越多的物联网节点中，出现了一张小小的SIM卡片，正是这个不起眼的卡，赋予了无数设备进入虚拟世界的能力，驱动着一个更加数字化、自动化的世界。</p><p>物联网卡以及它的CP们的成长历程，正影响着我们的现在和未来。</p><h2><strong>孕育</strong><strong>&nbsp;</strong></h2><p>2002年，刚刚经历PC互联网泡沫的腾讯、新浪、网易们还没缓过气来，而移动通信市场正在疯狂爆发，不少人刚刚拥有第一部手机，诺基亚的8310、摩托罗拉V60、索爱T68这些经典机型火爆一时。</p><p>这一年的5月17日，电信日，中国移动悄然推出了GPRS业务，由于手机应用的匮乏、网络速度的缓慢，在当时并没有对人们产生太大影响，当年最潮的群体还在比拼短信发送速度，但使用SIM卡就能连接数据网络，却开启了一个崭新的时代，万物互联变得触手可及。</p><p>最早成规模的应用是电网的远程监控。</p><p>电网当年极有前瞻性的采用移动通信的方式进行电网数据的采集和远程控制，由于项目规模庞大、要求高、方案全，电网项目无可争议的成为中国蜂窝物联网的完美摇篮，培养了早期物联网产业链的第一批人，从无线通信模组、DTU到运营商、应用平台商。</p><p>物联网卡在这个时期仓促诞生，这时候名字还很多，最常见的名字叫M2M卡，有些也叫APN卡、行业卡、机器卡。彼时M2M卡无论是外观和功能，都与个人使用的SIM卡没太大区别。</p><p>这时期还没有太多面向物联网的硬件设备，这一年，后来一度成为国内通信模组老大的芯讯通，才刚刚在上海成立，当时市场上能买到的模组，还都是国外的，wavecom和西门子等后来消失的牌子，还特别的贵。</p><p>基础设施的蛮荒之地，要孵化出应用真不容易。</p><p>所以最初几年，除了电网远程监控应用有点规模外，其他市场都还一片寂静，不过寂静中也冒出了一些闪光应用，这些应用都成为后来大发展的雏形。</p><blockquote><p>早在03、04年，银联就推出了无线POS，非常超前，可谓最早的移动支付。当年申请一台普通的POS机手续非常复杂，还要用专门的电话线拨号联网，当时能想到用无线方式来解决POS安全接入的方法，真的是一大创新。</p><p>过后十年无线POS一路蓬勃生长，衍生出各种眼花缭乱的智能支付终端，让国内成为全球规模最大的无线智能pos市场，便利程度远远超越发达国家。</p><p>顺丰也在物流很原始的时代，开始采用移动巴枪和货车监控，尤其是移动巴枪顺丰小哥人手必备，一扫快递单就签收或者进入下一个物流环节，在网购起步阶段就花大价钱配备上了智能设备，让人不得不佩服。现在，顺丰配的设备据说已经到第七、八代了，已经成为其运营的关键要素。</p><p>还有一些比较零散的车辆监控应用，比如在公交、出租车上安装可以回传数据的GPS，就可以看到车到哪里了，可以进行集中调度。</p><p>那个时候，手机都还没有GPS功能，GPS还是一些发烧友的玩具，一台GPS设备动则上千。而现在，各种专车、快递小哥的电动车乃至共享单车全都装上了定位，其实整个应用的原型和当初无异。</p></blockquote><p>蛮荒地上埋下的种子已经发芽，正在静待春天的到来。</p><h2><strong>成型</strong><strong>&nbsp;</strong></h2><p>这个不被大多数人关注的领域，就这么缓慢的发展了七年。</p><p>2009年，3G牌照发放，诞生两年的iPhone正式引入国内。中国开启了辉煌的移动互联网时代，手机上网开始了超越PC上网的征程，新的智能手机平台引爆了移动应用的发展。</p><p>同年，高层提出“感知中国”，物联网被正式列为国家五大新兴战略性产业之一，并开始在无锡建立物联网相关的产学研基地，政策上前所未有的重视。</p><p>这一年，由于三个契机，也成为了车联网发展的元年，庞大的产业链从这一年萌发，成为往后几年推动物联网卡发展的最主要动力。</p><blockquote><p>一是从iPhone3G开始，手机标配内置GPS模块（你还能想象最早智能手机没有GPS吗！？），基于位置的应用随之爆发，GPS从小众产品一跃成为各类方案板的标配，人们开始习惯用终端定位来获得服务，各种纸质地图、交通图开始淡出；</p><p>二是3G牌照发布后，外资品牌汽车开始把基于3G的车联网产品带入国内，如通用的安吉星、丰田的GBOOk等，配联网的中控大屏成为新宠，珠三角一大批原来做车辆影音娱乐的车辆后装公司纷纷转型做带联网功能的后装产品；</p><p>三是交通部这一年开始建设营运车辆联网联控系统，要求全国所有运营车辆都必须安装定位设备，定位数据分级上传，统一管理。带有无线数据通信能力的定位器因此而兴起，大量方案商开始进入原来车辆后装公司的地盘，不断创新出有意思的产品。</p></blockquote><p>车联网这一波的高速发展，和深圳紧紧相联。</p><p>深圳这时刚经历完一波山寨机的崛起和洗牌，山寨机产业留下了一个完整的生态体系，从元器件提供、方案板设计再到产品组装，每个环节都有成千上万的企业，深圳这片土壤让电子产品的创新变得容易，也为后来物联网的发展埋下了伏笔。</p><p>这个时期，通信模组产业开始了密集重组。</p><blockquote><p>08年，Sierra收购Wavecom成为业界老大，是的，Sierra是借Wavecom才上位的。</p><p>10年，Gemalto收了西门子的模组业务紧跟其后。还是，Gemalto那么知名，跟西门子老厂出品息息相关。</p><p>06年，中兴的一波人出来成立了有方，同年，龙尚科技在上海成立</p><p>09年，广和通开始进入模组产业</p><p>10年，芯姆通的一波人出来成立了移远，移字辈好几家公司，追溯上去都有点渊源，说芯姆通是模组界黄埔军校真不过分</p><p>10年，中兴开始推出模组产品，并在11年成立中兴物联</p></blockquote><p>自此，国内模组产业六大金刚芯讯通、移远、广和通、中兴物联、有方、龙尚均告成立，只是后来上市之路又各奔金主。</p><p>产业逐步热闹起来，也让物联网卡的发展开始进入正式轨道。</p><p>运营商这一时期开始成立独立机构。</p><blockquote><p>电信在09年率先在无锡成立物联网应用和推广中心，以基地形式支持全国物联网业务发展，并在14年挂牌成立中国电信物联网公司。</p><p>移动于10年在重庆成立物联网基地，并以更快的速度，于12年挂牌成立中移物联网公司。</p><p>联通的步伐相对慢，于14年底在南京成立物联网运营支撑中心，17年底挂牌成立物联网公司。</p></blockquote><p>这个时期物联网卡开始有了新的号段，号码上与我们普通熟知的13x、15x不一样，工信部专门为物联网分配了13位号段，以适应比人更多的物的需要，移动申请了10648/10647号段，联通申请了10646号段，电信申请了10649号段。</p><p>跟随着机构的成立，物联网卡才开始真正成为一个专门定制的产品。</p><p>三大运营商这时也开始投入巨资建设专用平台。移动在成立物联网基地后就开始着手建立自有的管理平台，一直做到现在改名叫OneLink；联通则于15年引入国际知名的Jasper平台，中间有多次说到期，但Jasper是头牌，始终割舍不掉；电信在经历了一段多个厂家建设的混乱期后，选择了华为的OC平台。</p><p>随着物联网卡产品的正规化，尤其是Jasper的引入带来的各种新鲜的玩法，让业内俗称卡商的群体开始兴起，更深行业的需求被逐步挖掘，更多行业的方案开始使用物联网卡，供给侧方案的日益完善，正等待着需求侧的引爆。</p><h2><strong>爆发</strong></h2><p>2012年，Pebble和谷歌眼镜两个产品横空出世，开启了智能硬件时代。</p><p>虽然两位先行者后来的发展让人唏嘘，但硬件数字化、联网化趋势一发不可收，智能穿戴、智能手表、智能家居、智能音箱、无人机、VR……让人眼花缭乱的产品不断涌现。</p><p>但智能硬件的火热，并没有让物联网卡的市场立刻就爆发，产品价格、功耗、尺寸等等一系列的影响，让大部分智能硬件方案选择了蓝牙、wifi，只有必须脱离手机、路由器使用的智能硬件，才会考虑蜂窝网络方案，所以，车联网产品成为了智能硬件时代早期物联网卡江湖的主角。</p><p>发展到这个时期，车联网产品已经和上一个时代不一样了。</p><p>最早期，车联网产品是以车机、中控屏的形态出现，是汽车原厂把控的产业链体系的一个环节，早期做的厂家往往是做汽车精品电子、汽车音响的，主要依托4S店、维修店来销售，一般都要拆装。</p><p>但智能硬件产业的兴起，让外行人有了染指汽车联网的机会。深圳强大的硬件产业链，不断创新出各种花样的硬件，绕过车厂、4S店等体系，以消费硬件的方式进入了汽车，也开启了智能硬件厂家与汽车原厂争夺汽车联网主导权的胶着之战。</p><blockquote><p>最早的所谓车联网智能硬件其实很low，大概是12年左右，一度兴起云电子狗，在电子狗基础上有了联网能力后，各种路上的信息更加及时，虽然low，但产品深受欢迎。</p><p>13年的时候，云狗还没热多久，OBD产品开始出现，OBD从最初只有4S店才能接入汽车的专用设备，一下成为消费级随时可以读取汽车数据的利器，由于OBD能获得大量汽车使用信息，而且能将数据汇聚到云端，一度让具有互联网思维的人很兴奋，OBD最期待的应用是UBI，也就是把车辆大数据与车辆保险结合在一起。</p><p>这些潜在的应用前景，让腾讯都动了心，14年腾讯推出了路宝，不过UBI应用始终没有成气候，OBD想卖行车数据的变现尝试几经曲折都不太顺利，所以14年以后OBD就开始没落。</p><p>但紧接着另一个产品——行车记录仪又开始兴起，至今仍受欢迎，行车记录仪的形态也有很多变种，其中最重要的分支就是智能后视镜，这个巧妙的设计可以套到汽车后视镜上，除了行车记录，还拥有了屏幕，有了屏幕就有了一切，安装便利度和价格秒杀改中控大屏，后视镜坐稳了车联网江湖好多年，上面叠加了越来越多功能，前后车监测、辅助驾驶、甚至司机困不困的监测。</p><p>这些外围的各种创新最终也让车辆本身发生了变化，从特斯拉到蔚来、小鹏、理想等一众造成新势力，直接动手把车本身联网了，这些创新功能直接原装于车之中，越来越多的原厂也都加入这个阵营，车内的屏幕也越做越夸张。</p><p>外围智能硬件厂商与汽车原厂之争，仍在继续。</p></blockquote><p>车联网各种硬件创新，慢慢的把国内物联网卡规模推送到了几千万的级别。</p><p>但让市场真正引爆的，是另一个疯狂的智能硬件。</p><p>2016年，第一辆带智能锁的摩拜自行车在上海街头上路，这个绝妙的创意，把蜂窝物联与产品运营结合在一起，自动开锁、关锁计费、定位、红包车……基于联网能力产生的无穷应用价值被不断挖掘。智能锁迅速成为共享单车的标配，OFO小黄车也逐步从机械锁转换成智能锁。</p><p>2017年的共享单车大战，让物联网卡市场获得了难以置信的增长。</p><p>短短一年，市场规模翻了一倍达到3亿的规模，需求量的激增竟然让SIM卡制造都供应不足，从上游芯片到下游封装各大厂商都得加班加点开足马力生产。芯讯通、移远等模组厂商也获益匪浅，拿到共享单车的订单就等于翻倍式增长。</p><p>共享单车引发的物联网卡市场爆发，彻底激活了整个产业链，没有做过蜂窝物联的方案商都不好意思开门做生意，方案商产业链的成熟，让更多智能化硬件的出现更加便利。</p><p>于是，沿用这种远程控制加硬件服务的思路，各种新的应用场景被不断挖掘，共享充电宝、共享按摩椅、共享纸巾、共享雨伞……越来越多的场景被这些有趣的硬件所占据。</p><p>运营商也被这气势如虹的增长震撼了，当人口红利已经达到极限饱和的时候，一块新的天地让人有了无限遐想，三家运营商的各种论坛上，开始频频出现“万物互联”的字眼，万物连接被寄予厚望。</p><p>不过令三家运营商始料不及的是，物联网卡市场刚刚爆发就引来了惨烈的竞争，物联网卡的供应方构成错综复杂，各地运营商、各路供卡渠道、甚至小米和阿里等互联网公司都参与其中。</p><p>但各类渠道价格、质量、能力各不相同，当年低价买卡的十有八九都遭遇过供应商跑路导致后续无法使用的问题。这个野蛮生长时埋下的雷，后来爆发出黑卡的问题。</p><h2><strong>插曲</strong><strong>&nbsp;</strong></h2><p>物联网卡的种种套路，最早源起Jasper平台提供的能力。</p><p>15年Jasper被引入国内后，极为强悍的开放能力迅速被众多第三方物联网卡供应商运用到极致，而其中最核心的能力就是组池和按实际使用量付费。</p><p>故事是这样的。</p><p>第三方供应商以比较大的规模组池，卡可以按各种套餐销售，并且可以远远低于市场价格，当规模大到一定程度，就会发现相当多的物联网卡实际是没有使用的，通过组池后，实际需要支付的流量，远远低于总套餐流量，相当于办低档套餐卖高档套餐。</p><p>但这样的方式仍然存在bug，当用户都过预期使用的时候，就会出现爆池风险，爆池后供应商不愿亏本支付，用户最终就无法使用。于是，这又导致一些更悲伤的故事，有些干脆就欺诈式销售，大规模低价销售然后跑路，用户用了两个月发现用不了了，这种案例数不胜数。</p><p>还有一个很有情怀但是结局悲伤的故事。</p><p>大约15年的时候，当时正是互联网免费思维盛行的时候，市场上出现了一种微x卡，可以免费使用500M，免费的东西谁不爱用？一时间，车联网产品商纷纷使用，但是和互联网免费边际成本趋向于0不同，实体商品的免费带来的成本巨大，又没有带来预想中的价值变现，微x据坊间传一度欠费数千万，最后免费模式无法持续，也让众多发出去使用的车联网厂商一地鸡毛。</p><p>对行业带来更大伤害的是“黑卡”。</p><p>15年以后，电话实名制力度非常大，但作为主要面向上游产业的产品，物联网卡很难做到个人实名，在供卡商层层转售之后，已经难以追溯卡的去向，变成了所谓“黑卡“，而黑卡一旦落入电信诈骗者之手后危害巨大。</p><p>16年徐玉玉案让人悲伤，这个标志性事件让业界意识到，不解决黑卡问题将让整个行业难以发展。</p><p>解决黑卡的核心是怎样分辨物联网卡是用到了该用的地方，并且让用的人实名，于是三大运营商纷纷推出机卡捆绑、定向流量、实名制加强等诸多措施，对存量卡也进行大规模清理，供卡商江湖也因此发生剧烈震荡，不少供卡商因为涉及黑卡损失惨重，不少供卡商下游客户也被殃及池鱼。</p><p>每个行业的成长历程总伴随着各种混乱，流量虚标、跑路、免费、黑卡这一段段插曲，不断的让市场开始意识到，在物联网上，安全大于一切。</p><p>随着物联网越来越介入到各行各业的关键设备、关键环节，安全必然成为越来越重要的考量因素，试想，有一天，这个不起眼的连接控制着我们的车、电、水、气、支付，如果一旦出现问题影响会有多大？好莱坞大片中那些被远程控制导致各种混乱的场景也许距离现实并不遥远。</p><h2><strong>新的开始</strong></h2><p>2016年6月，3GPP NB-IoT R13版本冻结。这是一个划时代的里程碑。</p><p>从最早普通个人卡兼职的产品，到面对产业定制的产品，再到独立网络制式的产品，这十余年的历史见证了物联网从孕育到正式出生的过程。</p><p>这一次，网络设备厂商成为了推广的急先锋，华为成了NB-IOT最积极的布道者，一时间各大展会、各大论坛、各种政策规划的探讨中，都能感受到NB的声势已经远远压过另一项技术eMTC。</p><p>eMTC也是专为物联网设计的技术，技术层面各有千秋，但在制式主导权的角力之下，NB-IOT在中国占据了明显的上风。</p><p>运营商层面的角力也颇有意思。</p><blockquote><p>在2G/3G上只有CDMA的电信，成为NB-IoT最积极、最坚定的支持者，原因很简单，在低速率物联网领域，几乎没有CDMA产业链的生存空间，电信要进入物联网市场，只能ALL in。</p><p>电信另外一个优势是拥有800MHZ低频FDD资源，完全没有政策障碍，只需要在现网4G基站上升级即可支持，因此投入也最没有顾虑。到17年5月17日，电信宣布NB网络建成，成为首个宣布商用的运营商。</p><p>对移动而言，最初NB的选择显得有些犹豫。原先庞大而完善的2G网络，成就了移动在物联网领域的霸主地位，在升级LPWA方面并没有那么迫切，最为关键的是移动4G是TD-LTE，缺少FDD牌照，始终存在政策障碍。</p><p>转机在17年6月，工信部批准在已分配的GSM或FDD方式频段上，可以部署NB-IoT。拿到政策后，移动也迅速抛出NB网络采购大单，全面建设FDD900M站点，并在11月宣布NB商用。</p><p>声音最小的是联通。在前物联网时代，因为有Jasper平台加持，加上拥有成熟的GSM和WCDMA，高端应用领域联通占据领先的份额，但在窄带网络建设上，联通更加的纠结，原因在于联通900M频段资源少，而1800M的NB-IOT并不成熟，虽然联通在17年也同样宣布试商用，但实际影响却不大。</p></blockquote><p>无论投入大小，这都是三大运营商在物联网支持上发出的最强音，与过去产业自然生长不同，NB产业在诸多超级力量的精心培育下，成长速度惊人，这其中最为大手笔的就是在终端产业的支持上。</p><p>网络可以有实力雄厚的运营商先建，但是在终端产业上，只要价格贵就很难有需求，没有需求量又很难降低终端价格，这是个鸡生蛋、蛋生鸡的问题。</p><p>在终端市场上，GSM制式的模块只需要20元，而NB模块要80，这个价格几乎没有市场，必须要有人能启动市场。</p><blockquote><p>第一个出手的是电信，17年号称NB宇宙第一标出炉，电信采购50万片模组每片补贴30元，让模组市场供货价格直接杀到36元。</p><p>随后移动抛出更大的橄榄枝，在17年11月全球合作伙伴大会上移动宣布对NB-IOT模组补贴10亿元。</p><p>到18年8月，联通也推出了采购计划，采购规模预期为300万片，限价35元/片。</p></blockquote><p>就这样，NB通信模组市场，在整个需求侧还没启动、需求量还不大时，就给硬生生的迅速催熟，价格迅速接近2G。</p><p>在这些大单背后，模组公司也在经历一场洗牌，这一轮洗牌叫上市。</p><p>市场空间的迅速扩大，原先并不起眼的上游电子器件厂商成为资本的香饽饽，格局之争也要求借助资本市场的力量。</p><p>于是，17年成为模组产业资本变局一年。</p><blockquote><p>17年4月，广和通首先上市，虽然不算业内龙头，但上市过程却最顺。</p><p>17年9月，日海通讯发布公告，以1.2亿收购龙尚科技68%股份，首度进入模组产业。</p><p>半年之后，日海通讯宣布以5.18亿元收购曾经的龙头芯讯通100%股权，日海通过资本方式成为模组的最大供应商。</p><p>17年12月，高新兴发布公告，宣布历经一年的中兴物联收购终于完成，高新兴也成为上述电信NB宇宙第一标的中标厂商。</p><p>17年6月，有方提交创业板IPO申请，不过18年3月主动撤回。</p><p>18年7月，最后一个主要玩家移远也提交上市申请，静待上会。</p></blockquote><p>风雨十余年，分的分，卖的卖，合的合，模组公司们在资本市场上算是会师了。</p><p>这一次，物联网的网络和终端产业，都完成了各自的飞跃。</p><p>物联网已经不是那个蛮荒之地，不再是为了实现需要左拼右凑起来的产品，它已经成为了一个泛在覆盖的基础设施，一切物品皆有可能低成本的接入这个庞大的网络，继而形成一个真正意义上的Internet of things，它所能驱动的未来不可限量。</p><p>而原来野蛮生长着的分散杂乱的物联网应用提供商们，也面临着一场新选手入场的变革。</p><p>这个变革的号角叫做“产业互联网”，众多移动互联网时代的巨头和独角兽们，在收割完人口红利之后，也开始进场收割产业红利，入局工业互联网、智慧城市、新零售、新制造……，这些也许将会构成一个以物、以产业为主体的新生态。</p><p>……</p><p>十年前，3G网络和智能手机终端开始成型，一众应用兴起，经过五年发展，移动互联网巨头们纷纷拿到船票登船，再过五年，格局已定，上半场结束。</p><p>当下，蹒跚十多年的物联网，也走到了新的开始，又是熟悉的配方、熟悉的味道。</p><p>看上去，更大的历史，才刚刚开始。</p><p><br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/23/528/" data-id="ckkfmdgeh00d8vkcg097272mj" data-title="物联网卡十年简史" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-527" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/20/527/" class="article-date">
  <time class="dt-published" datetime="2018-11-20T13:35:02.000Z" itemprop="datePublished">2018-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/20/527/">air202luat二次开发设备接入阿里云（四）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p style="color: rgb(51, 51, 51);">记录设备接入阿里云的过程</p><p style="color: rgb(51, 51, 51);">四，更新设备状态</p><p style="color: rgb(51, 51, 51);">上一篇文章介绍了如何控制设备，后来发现查看设备的时候开关一栏没有数据</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-QbGlZudM5bf40aea7067b.png" style="width: 474.5px;" class="img-responsive">就修改一下代码更新开关状态</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-DURqEsYu5bf40caaa364d.png" style="width: 592px;" class="img-responsive">重新烧录就可以看到我们的状态上传成功</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-tKH90HNE5bf40c6d583e2.png" style="width: 458.5px;" class="img-responsive">模拟一下</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-ADK0A4x35bf40d54af197.png" style="width: 468.5px;" class="img-responsive">状态更新成功</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/20/527/" data-id="ckkfmdgbu006wvkcg1zuockbs" data-title="air202luat二次开发设备接入阿里云（四）" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-526" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/20/526/" class="article-date">
  <time class="dt-published" datetime="2018-11-20T13:06:31.000Z" itemprop="datePublished">2018-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/20/526/">air202luat二次开发设备接入阿里云(三)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p style="color: rgb(51, 51, 51);">记录设备接入阿里云的过程</p><p style="color: rgb(51, 51, 51);">三，下发命令</p><p style="color: rgb(51, 51, 51);">上一篇写了上传数据，今天继续分享如何从云平台下发命令控制终端设备</p><p style="color: rgb(51, 51, 51);">1，添加功能，要实现新的事件第一件事还是在阿里云添加功能</p><p style="color: rgb(51, 51, 51);">还是添加一个自定义功能，就是个开关功能选布尔型就可以</p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-pItauGRo5bf3f78098db5.png" style="width: 299.5px;" class="img-responsive">2，接下来直接就是修改代码了</p><p style="color: rgb(51, 51, 51);">设备是如何获取我们下发的命令的呢?阿里云使用的是mqtt协议，所以我们就用到了mqtt协议的一个很重要的功能--主题订阅。在阿里云里就是<span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Topic订阅。</span></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-OjB9Ckwj5bf3f8982e74e.png" style="width: 797px;" class="img-responsive"><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">我们可以看到在我们的产品</span><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Topic列表里有一条是用于设备属性设置的，我们就是用这个</span><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Topic下发命令到设备，设备订阅这个</span><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Topic对消息解析即可</span></p><p style="color: rgb(51, 51, 51);"><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">代码的具体修改</span></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-XOdwOrxF5bf3f9b47fadc.png" style="width: 372px;" class="img-responsive"><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">根据api我们可以在demo里找到如下代码，结合上面说的，我们需要修改订阅topic为我们产品的</span></p><p style="color: rgb(51, 51, 51);"></p><p style="color: rgb(51, 51, 51);"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-1gPegePv5bf3fa879a89b.png" style="width: 519px;" class="img-responsive"><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">订阅了主题接下来就是对命令解析了</span></p><p style="color: rgb(51, 51, 51);"><span style="background-color: rgb(251, 251, 252); color: rgb(115, 119, 122); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">问题来了，阿里云到底给我们的设备发送了什么呢？第一种方法是去翻阿里的产品文档，另一种是更直观的方法直接在产品里选择调试功能，然后云平台模拟命令下发（也就是阿里云的属性设置）</span></p><p style=""><font color="#333333"><img src="http://oldask.openluat.com/image/show/attachments-2018-11-g0DD5GD25bf3fbba57529.png" style="width: 831px;" class="img-responsive"></font><p><span style="color: rgb(115, 119, 122); background-color: rgb(251, 251, 252); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">其中的</span><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">MessageParams的内容就是云平台下发的数据，把转义符去一下也就是这样一条json数据，很明显我们需要的就PowerSwitch的值</font></p></p><pre style=""><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">MessageParams:{
"method":"thing.service.property.set",
"id":"189921488",
"params":{"PowerSwitch":0},
"version":"1.0.0"
}"</font></pre><p style=""><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">怎么把这个值取出来呢，既然是json数据那肯定还是json数据操作</font></p><p style=""><img src="http://oldask.openluat.com/image/show/attachments-2018-11-lqfWWt1J5bf3fe1e79a07.png" style="width: 170px;" class="img-responsive"><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">根据api修改代码</font></p><p style=""><img src="http://oldask.openluat.com/image/show/attachments-2018-11-oPjomgZP5bf405e29a94d.png" style="width: 340.5px;" class="img-responsive"><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">然后烧录代码，去阿里云调试设备下发开关指令，可以看到我们成功的控制了一盏灯的开关</font></p><p style=""><img src="http://oldask.openluat.com/image/show/attachments-2018-11-OOKeJauN5bf402bbe906a.png" class="img-responsive" style="width: 363px;"></p><p style=""><font color="#73777a" face="Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif"><br></font></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2018/11/20/526/" data-id="ckkfmdgbt006vvkcgf5hfeb1f" data-title="air202luat二次开发设备接入阿里云(三)" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/44/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="page-number" href="/page/44/">44</a><span class="page-number current">45</span><a class="page-number" href="/page/46/">46</a><a class="page-number" href="/page/47/">47</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><a class="extend next" rel="next" href="/page/46/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2032/01/">一月 2032</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2032/01/01/608/">【置顶】合宙模块资料汇总</a>
          </li>
        
          <li>
            <a href="/2022/12/31/638/">Air系列模块常见问题列表</a>
          </li>
        
          <li>
            <a href="/2021/01/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/01/27/2420/">ECMAScript(ES6)基本语法介绍（一）</a>
          </li>
        
          <li>
            <a href="/2021/01/26/2417/">Air720S系列_luat二次开发固件（ 底层软件+上层脚本）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 chenxuuu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>