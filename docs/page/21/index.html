<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Luat doc 社区文章静态页面镜像</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:type" content="website">
<meta property="og:title" content="Luat doc 社区文章静态页面镜像">
<meta property="og:url" content="https://doc.luatos.wiki/page/21/index.html">
<meta property="og:site_name" content="Luat doc 社区文章静态页面镜像">
<meta property="og:description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chenxuuu">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Luat doc 社区文章静态页面镜像" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luat doc 社区文章静态页面镜像</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://doc.luatos.wiki"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-890" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/21/890/" class="article-date">
  <time class="dt-published" datetime="2020-06-21T15:07:12.000Z" itemprop="datePublished">2020-06-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/21/890/">11、RDA8910CSDK二次开发：新鲜出炉的MQTT库</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里查看所有博文</a></p>
<p>&emsp;&emsp;本系列博客所述资料<code>均来自合宙官方</code>，并不是本人原创（只有博客是自己写的），csdk只是得到了<code>口头的允许公开授权</code>。出于热心，本人将自己的所学笔记整理并推出相对应的使用教程，方面其他人学习。为国内的物联网事业发展尽自己的一份绵薄之力，<code>没有为自己谋取私利的想法</code>。若出现侵权现象，请告知本人，本人会立即停止更新，并删除相应的文章和代码。</p>
<p>&emsp;&emsp;本系列博客基于紫光展锐的<code>RDA8910  LTE Cat 1</code> bis芯片平台开发。理论上适用于合宙的Air720U、Air724U、广和通L610以及安信可的cat-01模块。</p>
<p>&emsp;&emsp;各个厂家的部分配置文件可能不一样，也许会导致设备出现奇怪的问题，其他的模块我也不确定能不能用，自行测试。但是有一点<code>编译下载和监视流程基本一样</code>，可供参考。</p>
<p>&emsp;&emsp;先不管支不支持，如果你用的模块是是紫光展锐的RDA8910，那都不妨一试，也许会有意外收获（<code>也有可能变砖，慎重！！！</code>）。</p>
<p>&emsp;&emsp;我使用的是<code>Air724UG</code>开发板，如果在其他模块上不能用，那也不要强怼，也许是开发包不兼容吧。这里的代码是没有问题的。例程仅供参考！</p>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>&emsp;&emsp;MQTT是一个基于客户端-服务器的消息发布/订阅传输协议。MQTT协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛。在很多情况下，包括受限的环境中，如：机器与机器（M2M）通信和物联网（IoT）。其在，通过卫星链路通信传感器、偶尔拨号的医疗设备、智能家居、及一些小型化设备中已广泛使用。<br><img src="https://img-blog.csdnimg.cn/20200602104417908.png" alt="在这里插入图片描述"><br>&emsp;&emsp;物联网应用中都离不开MQTT。玩物联网的人不会用MQTT那就是没有灵魂。目前官方提供的CSDK也是<code>没有</code>MQTT库的，所以为了大家，在下花了一点时间移植了一套开源的用于嵌入式领域的MQTT库。<br><img src="https://img-blog.csdnimg.cn/2020060210575885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;有人讲你那个HTTP库都自己写了，这个MQTT库怎么不自己写。这里声明一下HTTP的库不是我想自己写的，是因为我没找到合适的开源的HTTP库，移植起来很困难。被逼无奈自己写了一个简单的请求库，用在嵌入式平台正常情况下也够用了。<br><img src="https://img-blog.csdnimg.cn/20200602105436132.png" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;闲话少说，开始干正事。</p>
<h1 id="二、编写测试程序"><a href="#二、编写测试程序" class="headerlink" title="二、编写测试程序"></a>二、编写测试程序</h1><h2 id="2-1、了解本例程所用到的函数"><a href="#2-1、了解本例程所用到的函数" class="headerlink" title="2.1、了解本例程所用到的函数"></a>2.1、了解本例程所用到的函数</h2><p>&emsp;&emsp;使用MQTT服务需要包含<code>#include &quot;MQTTClient.h&quot;&quot;</code>头文件，我们这里只用到了7个函数，分别是：</p>
<blockquote>
<p>/**新的网络设置<br><em>@param n：指向网络结构的指针，包含网络的配置信息。<br>*@return    无<br>*</em>/</p>
</blockquote>
<ul>
<li>void <code>NewNetwork</code>(Network *n)</li>
</ul>
<blockquote>
<p>/***@简短连接网络功能<br> <em>@param n：指向网络结构的指针<br> *包含网络的配置信息。<br> *ip：服务器IP。<br> *port：服务器端口。<br>*</em>/</p>
</blockquote>
<ul>
<li>int <code>ConnectNetwork</code>(Network *n, char *ip, int port)</li>
</ul>
<blockquote>
<p>/*创建一个MQTT客户端对象<br> <em>@参数客户端<br> *@参数网络<br> *@param command_timeout_ms<br> *@参数<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport void <code>MQTTClientInit</code>(MQTTClient* client, Network* network, unsigned int command_timeout_ms,<pre><code>  unsigned char* sendbuf, size_t sendbuf_size, unsigned char* readbuf, size_t readbuf_size);
</code></pre>
</li>
</ul>
<blockquote>
<p>/<em>MQTT Connect-在网络上发送MQTT连接数据包并等待Connack<br> *调用此对象之前，必须将nework对象连接到网络端点<br> *@param选项-连接选项<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTConnect</code>(MQTTClient* client, MQTTPacket_connectData* options);</li>
</ul>
<blockquote>
<p>/*MQTT订阅-发送MQTT订阅数据包，并在返回之前等待suback。<br> <em>@param client-要使用的客户端对象<br> *@param topicFilter-要订阅的主题过滤器<br> *@param消息-要发送的消息<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTSubscribe</code>(MQTTClient* client, const char* topicFilter, enum QoS, messageHandler);</li>
</ul>
<blockquote>
<p>/*MQTT发布-发送MQTT发布数据包，并等待所有ack完成所有QoS<br> <em>@param client-要使用的客户端对象<br> *@param主题-要发布到的主题<br> *@param消息-要发送的消息<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTPublish</code>(MQTTClient* client, const char*, MQTTMessage*);</li>
</ul>
<blockquote>
<p>/<em>需要死循环调用，这个函数负责库内部一些事件处理。<br> *@param client-要使用的客户端对象<br> *@param time-产生的时间（以毫秒为单位）<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTYield</code>(MQTTClient* client, int time);</li>
</ul>
<h2 id="2-2、编写初始化程序"><a href="#2-2、编写初始化程序" class="headerlink" title="2.2、编写初始化程序"></a>2.2、编写初始化程序</h2><p>&emsp;&emsp;初始化程序负责建立socket套接字、连接网络、初始化MQTT对象、连接MQTT服务这几件事</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NewNetwork(&amp;myNet);</span><br><span class="line">ConnectNetwork(&amp;myNet, MQTT_IP, MQTT_PORT);</span><br><span class="line">MQTTClientInit(&amp;myclient, &amp;myNet, <span class="number">1000</span>, sendbuf, <span class="keyword">sizeof</span>(sendbuf), recvbuf, <span class="keyword">sizeof</span>(recvbuf));</span><br><span class="line">MQTTPacket_connectData data = MQTTPacket_connectData_initializer;</span><br><span class="line">data.willFlag = <span class="number">0</span>;</span><br><span class="line">data.MQTTVersion = <span class="number">3</span>;</span><br><span class="line">data.clientID.cstring = (<span class="keyword">char</span> *)<span class="string">&quot;RDA8910 MQTT Test&quot;</span>;</span><br><span class="line">data.username.cstring = <span class="string">&quot;Air724UG&quot;</span>;</span><br><span class="line">data.password.cstring = <span class="literal">NULL</span>;</span><br><span class="line">data.keepAliveInterval = <span class="number">120</span>;</span><br><span class="line">data.cleansession = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> rc = MQTTConnect(&amp;myclient, &amp;data);</span><br></pre></td></tr></table></figure>
<h2 id="2-3、编写订阅消息程序"><a href="#2-3、编写订阅消息程序" class="headerlink" title="2.3、编写订阅消息程序"></a>2.3、编写订阅消息程序</h2><p>&emsp;&emsp;订阅程序分成两块。第一块是向服务器发送订阅消息。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rc = MQTTSubscribe(&amp;myclient, <span class="string">&quot;FX&quot;</span>, QOS1, MQTT_CB);</span><br><span class="line">iot_debug_print(<span class="string">&quot;[MQTT_Test] Subscribed %d\r\n&quot;</span>, rc);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第二块是根据服务器下发的订阅消息，解析报文。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MQTT_CB</span><span class="params">(MessageData *md)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MQTTMessage *message = md-&gt;message;</span><br><span class="line">	uint32 datalen = (<span class="keyword">int</span>)message-&gt;payloadlen;</span><br><span class="line"></span><br><span class="line">	uint8 data[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">memcpy</span>(data, (<span class="keyword">char</span> *)message-&gt;payload, datalen);</span><br><span class="line"></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[MQTT_Test] topicName:%s,data:%s,datalen:%d&quot;</span>, md-&gt;topicName, data, datalen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-4、编写发布消息程序"><a href="#2-4、编写发布消息程序" class="headerlink" title="2.4、编写发布消息程序"></a>2.4、编写发布消息程序</h2><p>&emsp;&emsp;在任务内循环发布不同的消息，5s发一次。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Publish</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> PubData[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	uint8 num = <span class="number">0</span>;</span><br><span class="line">	uint8 datalen = <span class="number">0</span>;</span><br><span class="line">	MQTTMessage message = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	message.qos = QOS0;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		datalen = <span class="built_in">sprintf</span>(PubData, <span class="string">&quot;RDA8910 Sent:%d&quot;</span>, num);</span><br><span class="line">		PubData[datalen] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">		message.payload = PubData;</span><br><span class="line">		message.payloadlen = datalen;</span><br><span class="line">		MQTTPublish(&amp;myclient, <span class="string">&quot;RDA8910&quot;</span>, &amp;message);</span><br><span class="line">		num += <span class="number">1</span>;</span><br><span class="line">		iot_os_sleep(<span class="number">5000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、编译并下载程序"><a href="#三、编译并下载程序" class="headerlink" title="三、编译并下载程序"></a>三、编译并下载程序</h1><p>&emsp;&emsp;完整代码中上线会订阅<code>FX</code>这个主题，紧接着直接向<code>RDA8910</code>这个主题发送一条<code>RDA8910 Online!</code>，随后会定时发送其他的消息。<br>&emsp;&emsp;完整代码在这，自取。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: your name</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-19 14:05:32</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-06-02 11:22:21</span></span><br><span class="line"><span class="comment"> * @LastEditors: Please set LastEditors</span></span><br><span class="line"><span class="comment"> * @Description: In User Settings Edit</span></span><br><span class="line"><span class="comment"> * @FilePath: \RDA8910_CSDK\USER\user_main.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="comment">//#include &quot;cs_types.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_api.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_common.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_os.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_pmd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_adc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_network.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_socket.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#include &quot;http_client.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MQTTClient.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">HANDLE TestTask_HANDLE = <span class="literal">NULL</span>;</span><br><span class="line">uint8 NetWorkCbMessage = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MQTT_IP <span class="meta-string">&quot;换成自己的ip&quot;</span>	<span class="comment">//例如192.168.0.1</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MQTT_PORT 1883		<span class="comment">//自己改端口</span></span></span><br><span class="line"></span><br><span class="line">Network myNet;</span><br><span class="line">MQTTClient myclient;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> recvbuf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MQTT_CB</span><span class="params">(MessageData *md)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MQTTMessage *message = md-&gt;message;</span><br><span class="line">	uint32 datalen = (<span class="keyword">int</span>)message-&gt;payloadlen;</span><br><span class="line"></span><br><span class="line">	uint8 data[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">memcpy</span>(data, (<span class="keyword">char</span> *)message-&gt;payload, datalen);</span><br><span class="line"></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[MQTT_Test] topicName:%s,data:%s,datalen:%d&quot;</span>, md-&gt;topicName, data, datalen);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Publish</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> PubData[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	uint8 num = <span class="number">0</span>;</span><br><span class="line">	uint8 datalen = <span class="number">0</span>;</span><br><span class="line">	MQTTMessage message = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	message.qos = QOS0;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		datalen = <span class="built_in">sprintf</span>(PubData, <span class="string">&quot;RDA8910 Sent:%d&quot;</span>, num);</span><br><span class="line">		PubData[datalen] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">		message.payload = PubData;</span><br><span class="line">		message.payloadlen = datalen;</span><br><span class="line">		MQTTPublish(&amp;myclient, <span class="string">&quot;RDA8910&quot;</span>, &amp;message);</span><br><span class="line">		num += <span class="number">1</span>;</span><br><span class="line">		iot_os_sleep(<span class="number">5000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TestTask</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> NetLink = FALSE;</span><br><span class="line">	<span class="keyword">while</span> (NetLink == FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		T_OPENAT_NETWORK_CONNECT networkparam = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">switch</span> (NetWorkCbMessage)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_DISCONNECT: <span class="comment">//网络断开 表示GPRS网络不可用澹，无法进行数据连接，有可能可以打电话</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_DISCONNECT&quot;</span>);</span><br><span class="line">			iot_os_sleep(<span class="number">10000</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_READY: <span class="comment">//网络已连接 表示GPRS网络可用，可以进行链路激活</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_READY&quot;</span>);</span><br><span class="line">			<span class="built_in">memcpy</span>(networkparam.apn, <span class="string">&quot;CMNET&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;CMNET&quot;</span>));</span><br><span class="line">			<span class="comment">//建立网络连接，实际为pdp激活流程</span></span><br><span class="line">			iot_network_connect(&amp;networkparam);</span><br><span class="line">			iot_os_sleep(<span class="number">500</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_LINKED: <span class="comment">//链路已经激活 PDP已经激活，可以通过socket接口建立数据连接</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_LINKED&quot;</span>);</span><br><span class="line">			NetLink = TRUE;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (NetLink == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		NewNetwork(&amp;myNet);</span><br><span class="line">		ConnectNetwork(&amp;myNet, MQTT_IP, MQTT_PORT);</span><br><span class="line">		MQTTClientInit(&amp;myclient, &amp;myNet, <span class="number">1000</span>, sendbuf, <span class="keyword">sizeof</span>(sendbuf), recvbuf, <span class="keyword">sizeof</span>(recvbuf));</span><br><span class="line">		MQTTPacket_connectData data = MQTTPacket_connectData_initializer;</span><br><span class="line">		data.willFlag = <span class="number">0</span>;</span><br><span class="line">		data.MQTTVersion = <span class="number">3</span>;</span><br><span class="line">		data.clientID.cstring = (<span class="keyword">char</span> *)<span class="string">&quot;RDA8910 MQTT Test&quot;</span>;</span><br><span class="line">		data.username.cstring = <span class="string">&quot;Air724UG&quot;</span>;</span><br><span class="line">		data.password.cstring = <span class="literal">NULL</span>;</span><br><span class="line">		data.keepAliveInterval = <span class="number">120</span>;</span><br><span class="line">		data.cleansession = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> rc = MQTTConnect(&amp;myclient, &amp;data);</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[MQTT_Test] Connected %d\r\n&quot;</span>, rc);</span><br><span class="line">		rc = MQTTSubscribe(&amp;myclient, <span class="string">&quot;FX&quot;</span>, QOS1, MQTT_CB);</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[MQTT_Test] Subscribed %d\r\n&quot;</span>, rc);</span><br><span class="line"></span><br><span class="line">		MQTTMessage message = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		message.qos = QOS0;</span><br><span class="line">		message.payload = <span class="string">&quot;RDA8910 Online!&quot;</span>;</span><br><span class="line">		message.payloadlen = <span class="keyword">sizeof</span>(<span class="string">&quot;RDA8910 Online!&quot;</span>);</span><br><span class="line">		MQTTPublish(&amp;myclient, <span class="string">&quot;RDA8910&quot;</span>, &amp;message);</span><br><span class="line">		iot_os_create_task(Publish, <span class="literal">NULL</span>, <span class="number">2048</span>, <span class="number">10</span>, OPENAT_OS_CREATE_DEFAULT, <span class="string">&quot;Publish&quot;</span>);</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			MQTTYield(&amp;myclient, <span class="number">500</span>);</span><br><span class="line">			iot_os_sleep(<span class="number">500</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	iot_os_delete_task(TestTask_HANDLE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">NetWorkCb</span><span class="params">(E_OPENAT_NETWORK_STATE state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	NetWorkCbMessage = state;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">appimg_enter</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//系统休眠</span></span><br><span class="line">	iot_os_sleep(<span class="number">10000</span>);</span><br><span class="line">	<span class="comment">//注册网络状态回调函数</span></span><br><span class="line">	iot_network_set_cb(NetWorkCb);</span><br><span class="line">	<span class="comment">//创建一个任务</span></span><br><span class="line">	<span class="comment">//TestTask_HANDLE =</span></span><br><span class="line">	TestTask_HANDLE = iot_os_create_task(TestTask, <span class="literal">NULL</span>, <span class="number">2048</span>, <span class="number">10</span>, OPENAT_OS_CREATE_DEFAULT, <span class="string">&quot;TestTask&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出提示</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">appimg_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	OSI_LOGI(<span class="number">0</span>, <span class="string">&quot;application image exit&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="四、分析结果"><a href="#四、分析结果" class="headerlink" title="四、分析结果"></a>四、分析结果</h1><p>&emsp;&emsp;我这里使用<code>MQTT.fx</code>测试。使用MQTT.fx订阅<code>RDA8910</code>这个主题，并且随机向FX这个主题发布消息。<br>&emsp;&emsp;可以看到MQTT.fx收到了开发板发布的消息。<br><img src="https://img-blog.csdnimg.cn/20200602115220133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;开发板也能收到MQTT.fx发布的消息。<br><img src="https://img-blog.csdnimg.cn/20200602115324287.png" alt="在这里插入图片描述"><br>&emsp;&emsp;通过EMQ的控制台，看到开发板<code>11：01</code>开始上线。现在时间看右小角是<code>11：55</code>，运行了接近一个小时。也没出现掉线现象。稳定性也还是可以的。<br><img src="https://img-blog.csdnimg.cn/20200602115553862.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h1><p>&emsp;&emsp;除了上面我们使用的函数外。MQTT还具有以下其他的库。这里做简略介绍</p>
<blockquote>
<p>/<em>MQTT Connect-在网络上发送MQTT连接数据包并等待Connack<br> *调用此对象之前，必须将nework对象连接到网络端点<br> *@param选项-连接选项<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTConnectWithResults</code>(MQTTClient* client, MQTTPacket_connectData* options,<br>  MQTTConnackData* data);</li>
</ul>
<blockquote>
<p>/*MQTT SetMessageHandler-设置或删除每个主题的消息处理程序<br> <em>@param client-要使用的客户端对象<br> *@param topicFilter-主题过滤器为设置消息处理程序<br> *@param messageHandler-指向消息处理程序函数的指针或要删除的NULL<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTSetMessageHandler</code>(MQTTClient* c, const char* topicFilter, messageHandler messageHandler);</li>
</ul>
<blockquote>
<p>/<em>MQTT订阅-发送MQTT订阅数据包，并在返回之前等待suback。<br> *@param client-要使用的客户端对象<br> *@param topicFilter-要订阅的主题过滤器<br> *@param消息-要发送的消息<br> *@param数据-子包授予的QoS返回<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li>DLLExport int <code>MQTTSubscribeWithResults</code>(MQTTClient* client, const char* topicFilter, enum QoS, messageHandler, MQTTSubackData* data);</li>
</ul>
<blockquote>
<p>/<em>MQTT订阅-发送MQTT取消订阅数据包并等待取消回复，然后再返回。<br> *@param client-要使用的客户端对象<br> *@param topicFilter-要取消订阅的主题过滤器<br> *@返回成功代码<br>*</em>/</p>
</blockquote>
<ul>
<li><p>DLLExport int <code>MQTTUnsubscribe</code>(MQTTClient* client, const char* topicFilter);</p>
<blockquote>
<p>/*MQTT断开连接-发送MQTT断开连接数据包并关闭连接</p>
</blockquote>
</li>
<li><p>@param client-要使用的客户端对象</p>
</li>
<li><p>@返回成功代码</p>
</li>
<li><p>*/</p>
</li>
<li><p>DLLExport int <code>MQTTDisconnect</code>(MQTTClient* client);</p>
<blockquote>
<p>/*MQTT已连接</p>
</blockquote>
</li>
<li><p>@param client-要使用的客户端对象</p>
</li>
<li><p>@return真值，指示客户端是否连接到服务器</p>
</li>
<li><p>*/</p>
</li>
<li><p>DLLExport int <code>MQTTIsConnected</code>(MQTTClient* client);</p>
</li>
</ul>
<blockquote>
<p>不会下载的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里</a>，进去查看我的<code>RDA8910 CSDK二次开发入门教程</code>专题第一篇博文<code>1、RDA8910CSDK二次开发：环境搭建</code>里面讲了怎么下载<br>这里只是我的学习笔记，拿出来给大家分享，欢迎大家批评指正，本篇教程到此结束</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/21/890/" data-id="ckkfmdgdl00byvkcg0xpu3w85" data-title="11、RDA8910CSDK二次开发：新鲜出炉的MQTT库" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-889" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/21/889/" class="article-date">
  <time class="dt-published" datetime="2020-06-21T15:06:00.000Z" itemprop="datePublished">2020-06-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/21/889/">12、RDA8910CSDK二次开发：c语言中最好用的JSON解析库---cJSON</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里查看所有博文</a></p>
<p>&emsp;&emsp;本系列博客所述资料<code>均来自合宙官方</code>，并不是本人原创（只有博客是自己写的），csdk只是得到了<code>口头的允许公开授权</code>。出于热心，本人将自己的所学笔记整理并推出相对应的使用教程，方面其他人学习。为国内的物联网事业发展尽自己的一份绵薄之力，<code>没有为自己谋取私利的想法</code>。若出现侵权现象，请告知本人，本人会立即停止更新，并删除相应的文章和代码。</p>
<p>&emsp;&emsp;本系列博客基于紫光展锐的<code>RDA8910  LTE Cat 1</code> bis芯片平台开发。理论上适用于合宙的Air720U、Air724U、广和通L610以及安信可的cat-01模块。</p>
<p>&emsp;&emsp;各个厂家的部分配置文件可能不一样，也许会导致设备出现奇怪的问题，其他的模块我也不确定能不能用，自行测试。但是有一点<code>编译下载和监视流程基本一样</code>，可供参考。</p>
<p>&emsp;&emsp;先不管支不支持，如果你用的模块是是紫光展锐的RDA8910，那都不妨一试，也许会有意外收获（<code>也有可能变砖，慎重！！！</code>）。</p>
<p>&emsp;&emsp;我使用的是<code>Air724UG</code>开发板，如果在其他模块上不能用，那也不要强怼，也许是开发包不兼容吧。这里的代码是没有问题的。例程仅供参考！</p>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>&emsp;&emsp;JSON（JavaScript Object Notation，JavaScript对象表示法）是一种由道格拉斯·克罗克福特构想和设计、轻量级的数据交换语言，该语言以易于让人阅读的文字为基础，用来传输由属性值或者序列性的值组成的数据对象。尽管JSON是JavaScript的一个子集，但JSON是独立于语言的文本格式，并且采用了类似于C语言家族的一些习惯。</p>
<p>&emsp;&emsp;JSON 数据格式与语言无关，脱胎自JavaScript，但当前很多编程语言都支持 JSON 格式数据的生成和解析。JSON 的官方 MIME 类型是 application/json，文件扩展名是 .json。</p>
<p>&emsp;&emsp;JSON 解析器和 JSON 库支持许多不同的编程语言。 JSON 文本格式在语法上与创建 JavaScript 对象的代码相同。 由于这种相似性， 无需解析器， JavaScript 程序能够使用内建的 eval() 函数， 用 JSON 数据来生成原生的 JavaScript 对象。</p>
<p>&emsp;&emsp;JSON 是存储和交换文本信息的语法。 类似 XML。 JSON 比 XML 更小、 更快， 更易解析。</p>
<p>&emsp;&emsp;JSON 具有自我描述性， 语法简洁， 易于理解。</p>
<p>&emsp;&emsp;关于JSON的介绍，需要了解的兄弟们请参考我的<code>合宙Air模块Luat开发</code>专题，<code>第10篇</code>文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/105285966">JSON字符串的生成与解析</a>。</p>
<p><img src="https://img-blog.csdnimg.cn/20200615004541627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;总之就是一句话。JSON很常见，虽然与 JavaScript 紧密相连，但 JSON 与语言无关，JSON 使用与其他语言类似的约定（例如，C，C ++，Java，Perl ，Lua和 Python），使 JSON 成为理想的数据交换语言。</p>
<p>&emsp;&emsp;在c语言中同样有很多用于JSON生成和解析的库，其中免费开源好用的当属cJSON。那么今天我们就来耍一下。</p>
<p>&emsp;&emsp;cJSON库文件在demo里面的<code>cJSON</code>例程有提供，直接拷贝一份出来即可使用。不需要做其他的改动。</p>
<h1 id="二、编写测试程序"><a href="#二、编写测试程序" class="headerlink" title="二、编写测试程序"></a>二、编写测试程序</h1><h2 id="2-1、了解本例程所用到的函数"><a href="#2-1、了解本例程所用到的函数" class="headerlink" title="2.1、了解本例程所用到的函数"></a>2.1、了解本例程所用到的函数</h2><p>&emsp;&emsp;使用cJSON服务需要包含<code>#include &quot;cJSON.h&quot;&quot;</code>头文件，我们这里只用到了13个函数，分别是：</p>
<blockquote>
<p>/**JSON解析<br>提供一个JSON块，这将返回一个您可以查询的cJSON对象。<br><em>@param <code>value</code>：JSON字符串<br>*@return    cJSON对象指针<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON *) <code>cJSON_Parse</code>(const char *value)</li>
</ul>
<blockquote>
<p>/***从JSON对象中获取键值对。不区分大小写。<br> <em>@param <code>object</code>：要查询的cJSON对象<br>&emsp;&emsp;&emsp;&emsp;<code>string</code>：要查询的键值对<br>*@return    cJSON对象指针<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON *) <code>cJSON_GetObjectItem</code>(const cJSON * const object, const char * const string)</li>
</ul>
<blockquote>
<p>/*判断该对象是不是字符串类型<br> <em>@param <code>object</code>：要查询的cJSON对象<br>*@return     真值，是字符串类型<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON_bool) <code>cJSON_IsString</code>(const cJSON * const item);</li>
</ul>
<blockquote>
<p>/*判断该对象是不是数字类型<br> <em>@param <code>object</code>：要查询的cJSON对象<br>*@return     真值，是字数字类型<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON_bool) <code>cJSON_IsNumber</code>(const cJSON * const item)</li>
</ul>
<blockquote>
<p>/*获取数组（或对象）中的项目数。<br> <em>@param <code>object</code>：要查询的cJSON对象<br>*@return     项目数<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(int) <code>cJSON_GetArraySize</code>(const cJSON *array)</li>
</ul>
<blockquote>
<p>/<em>删除cJSON结构。<br> *@param <code>object</code>：要删除的cJSON对象<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(void) <code>cJSON_Delete</code>(cJSON *item)</li>
</ul>
<blockquote>
<p>/<em>创建一个cJSON对象<br>*@return     创建的对象<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON *) <code>cJSON_CreateObject</code>(void)</li>
</ul>
<blockquote>
<p>/*添加一个字符串到cJSON对象中<br> <em>@param <code>object</code>：要添加的cJSON对象<br> *@param <code>name</code>：要添加的键<br> *@param <code>string</code>：要添加的值<br>*@return    cJSON对象指针<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON*) <code>cJSON_AddStringToObject</code>(cJSON * const object, const char * const name, const char * const string);</li>
</ul>
<blockquote>
<p>/*添加一个数字到cJSON对象中<br> <em>@param <code>object</code>：要添加的cJSON对象<br> *@param <code>name</code>：要添加的键<br> *@param <code>number</code>：要添加的值<br>*@return    cJSON对象指针<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON*) <code>cJSON_AddNumberToObject</code>(cJSON * const object, const char * const name, const double number)</li>
</ul>
<blockquote>
<p>/*添加一个cJSON对象到cJSON对象中<br> <em>@param <code>object</code>：要添加的cJSON对象<br> *@param <code>name</code>：要添加的键<br> *@param <code>item</code>：要添加的值<br>*@return    cJSON对象指针<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON_bool) <code>cJSON_AddItemToObject</code>(cJSON *object, const char *string, cJSON *item);</li>
</ul>
<blockquote>
<p>/<em>创建一个数组对象<br> *@param <code>numbers</code>：要创建的数组<br> *@param <code>count</code>：数组的长度<br>*@return     创建的对象<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(cJSON *) <code>cJSON_CreateIntArray</code>(const int *numbers, int count)</li>
</ul>
<blockquote>
<p>/*将cJSON项目/实体/结构呈现为文本。<br> <em>@param <code>item</code>：cJSON对象<br>*@return     字符串<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(char *) <code>cJSON_Print</code>(const cJSON *item)</li>
</ul>
<blockquote>
<p>/<em>释放内存<br> *@param <code>object</code>：要释放的内存块<br>*</em>/</p>
</blockquote>
<ul>
<li>CJSON_PUBLIC(void) <code>cJSON_free</code>(void *object);<h2 id="2-2、编写cJSON解析程序"><a href="#2-2、编写cJSON解析程序" class="headerlink" title="2.2、编写cJSON解析程序"></a>2.2、编写cJSON解析程序</h2>&emsp;&emsp;解析程序负责将一个json格式的字符串转换成cJSON对象，并在其中查找需要的键值对。要注意的是，查找完毕后需要删除<code>cJSON_Parse</code>函数创建的父节点。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jsonRoot 是您要剖析的数据</span></span><br><span class="line"><span class="comment">//首先整体判断是否为一个json格式的数据</span></span><br><span class="line">iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Parsing Start&quot;</span>);</span><br><span class="line">cJSON *pJsonRoot = cJSON_Parse(jsonRoot);</span><br><span class="line"><span class="comment">//如果是否json格式数据</span></span><br><span class="line"><span class="keyword">if</span> (pJsonRoot != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON TRUE&quot;</span>);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON:%s&quot;</span>, jsonRoot);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON ERROR&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析imei字段字符串内容</span></span><br><span class="line">cJSON *pimeiAdress = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;imei&quot;</span>);</span><br><span class="line"><span class="comment">//判断imei字段是否json格式</span></span><br><span class="line"><span class="keyword">if</span> (pimeiAdress)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断mac字段是否string类型</span></span><br><span class="line">	<span class="keyword">if</span> (cJSON_IsString(pimeiAdress))</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get imeiAdress:%s&quot;</span>, pimeiAdress-&gt;valuestring);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] get imeiAdress failed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析Num字段int内容</span></span><br><span class="line">cJSON *pNumber = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;Num&quot;</span>);</span><br><span class="line"><span class="comment">//判断Num字段是否存在</span></span><br><span class="line"><span class="keyword">if</span> (pNumber)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断mac字段是否数字整型类型</span></span><br><span class="line">	<span class="keyword">if</span> (cJSON_IsNumber(pNumber))</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get Num:%d&quot;</span>, pNumber-&gt;valueint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] get Num failed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析value字段内容，判断是否为json</span></span><br><span class="line">cJSON *pValue = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;Value&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pValue)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//进一步剖析里面的name字段:注意这个根节点是 pValue</span></span><br><span class="line">	cJSON *pName = cJSON_GetObjectItem(pValue, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (pName)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (cJSON_IsString(pName))</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;Name:%s&quot;</span>, pName-&gt;valuestring);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pName failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//进一步剖析里面的age字段:注意这个根节点是 pValue</span></span><br><span class="line">	cJSON *pAge = cJSON_GetObjectItem(pValue, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (pAge)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (cJSON_IsNumber(pAge))</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;Age:%d&quot;</span>, pAge-&gt;valueint);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pAge failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//进一步剖析里面的blog字段:注意这个根节点是 pValue</span></span><br><span class="line">	cJSON *pBlog = cJSON_GetObjectItem(pValue, <span class="string">&quot;blog&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (pBlog)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (cJSON_IsString(pBlog))</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;pBlog:%s&quot;</span>, pBlog-&gt;valuestring);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pBlog failed&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue failed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//剖析数组</span></span><br><span class="line">cJSON *pArry = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;hexArry&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pArry)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获取数组长度</span></span><br><span class="line">	<span class="keyword">int</span> arryLength = cJSON_GetArraySize(pArry);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] get arryLength:%d&quot;</span>, arryLength);</span><br><span class="line">	<span class="comment">//逐个打印</span></span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; arryLength; i++)</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get cJSON_GetArrayItem(pArry, %d)= %d&quot;</span>, i, cJSON_GetArrayItem(pArry, i)-&gt;valueint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] get pArry failed&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//释放内存</span></span><br><span class="line">cJSON_Delete(pJsonRoot);</span><br><span class="line"></span><br><span class="line">iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Parsing Stop&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;相比Luat中的json解析，cJSON用起来真的是太复杂了。</p>
<h2 id="2-3、编写cJSON生成程序"><a href="#2-3、编写cJSON生成程序" class="headerlink" title="2.3、编写cJSON生成程序"></a>2.3、编写cJSON生成程序</h2><p>&emsp;&emsp;生成程序，首先创建一个空的对象（实际是一个链表），然后将不同的键值对依次插入。全部插入完成后，打印查看，最后删除<code>cJSON_CreateObject</code>函数创建的父对象<code>pRoot</code> 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取一下本地的station的mac地址，保存在全局变量tempMessage</span></span><br><span class="line">iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Generate Start&quot;</span>);</span><br><span class="line">cJSON *pRoot = cJSON_CreateObject();</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增一个字段imei到根点，数值是tempMessage</span></span><br><span class="line"><span class="keyword">char</span> tempMessage[] = <span class="string">&quot;8661111111111111&quot;</span>;</span><br><span class="line">cJSON_AddStringToObject(pRoot, <span class="string">&quot;imei&quot;</span>, tempMessage);</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增一个字段number到根点，数值是2</span></span><br><span class="line">cJSON_AddNumberToObject(pRoot, <span class="string">&quot;number&quot;</span>, <span class="number">2020</span>);</span><br><span class="line"></span><br><span class="line">cJSON *pValue = cJSON_CreateObject();</span><br><span class="line">cJSON_AddStringToObject(pValue, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;cx&quot;</span>);</span><br><span class="line">cJSON_AddNumberToObject(pValue, <span class="string">&quot;age&quot;</span>, <span class="number">17</span>);</span><br><span class="line">cJSON_AddItemToObject(pRoot, <span class="string">&quot;value&quot;</span>, pValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">//数组初始化</span></span><br><span class="line"><span class="keyword">int</span> hex[<span class="number">5</span>] = &#123;<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;;</span><br><span class="line">cJSON *pHex = cJSON_CreateIntArray(hex, <span class="number">5</span>); <span class="comment">//创建一个长度为5的int型的数组json元素</span></span><br><span class="line">cJSON_AddItemToObject(pRoot, <span class="string">&quot;hex&quot;</span>, pHex);	<span class="comment">//将数组元素添加进pRoot</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *s = cJSON_Print(pRoot);</span><br><span class="line">iot_debug_print(<span class="string">&quot;[cJSON_Test] creatJson:%s&quot;</span>, s);</span><br><span class="line"><span class="comment">//释放内存</span></span><br><span class="line">cJSON_free((<span class="keyword">void</span> *)s);</span><br><span class="line"></span><br><span class="line"><span class="comment">//释放内存</span></span><br><span class="line"><span class="comment">//cJSON_Delete(pHex);</span></span><br><span class="line"><span class="comment">//释放内存</span></span><br><span class="line"><span class="comment">//cJSON_Delete(pValue);</span></span><br><span class="line"><span class="comment">//释放内存</span></span><br><span class="line">cJSON_Delete(pRoot);</span><br><span class="line">iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Generate Stop&quot;</span>);</span><br></pre></td></tr></table></figure>
<h1 id="三、编译并下载程序"><a href="#三、编译并下载程序" class="headerlink" title="三、编译并下载程序"></a>三、编译并下载程序</h1><p>&emsp;&emsp;完整代码在这，自取。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: your name</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-19 14:05:32</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-06-15 00:10:00</span></span><br><span class="line"><span class="comment"> * @LastEditors: Please set LastEditors</span></span><br><span class="line"><span class="comment"> * @Description: In User Settings Edit</span></span><br><span class="line"><span class="comment"> * @FilePath: \RDA8910_CSDK\USER\user_main.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="comment">//#include &quot;cs_types.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_api.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_common.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_os.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_pmd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_adc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_network.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_socket.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cJSON.h&quot;</span></span></span><br><span class="line"><span class="comment">//#include &quot;MQTTClient.h&quot;</span></span><br><span class="line"></span><br><span class="line">HANDLE TestTask_HANDLE = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> jsonRoot <span class="meta-string">&quot;&#123;\r\n&quot;</span>                                                                             \</span></span><br><span class="line">				 <span class="string">&quot;\&quot;imei\&quot;: \&quot;8661111111111111\&quot;,\r\n&quot;</span>                                               \</span><br><span class="line">				 <span class="string">&quot;\&quot;Num\&quot;: 142,\r\n&quot;</span>                                                                 \</span><br><span class="line">				 <span class="string">&quot;\&quot;Value\&quot;: &#123;\r\n&quot;</span>                                                                  \</span><br><span class="line">				 <span class="string">&quot;\&quot;name\&quot;: \&quot;cx\&quot;,\r\n&quot;</span>                                                             \</span><br><span class="line">				 <span class="string">&quot;\&quot;age\&quot;: 18,\r\n&quot;</span>                                                                  \</span><br><span class="line">				 <span class="string">&quot;\&quot;blog\&quot;: \&quot;https://blog.csdn.net/weixin_44570083/article/details/104285283\&quot;\r\n&quot;</span> \</span><br><span class="line">				 <span class="string">&quot;&#125;,\r\n&quot;</span>                                                                            \</span><br><span class="line">				 <span class="string">&quot;\&quot;hexArry\&quot;: [31, 56, 36, 1365, 263]\r\n&quot;</span>                                          \</span><br><span class="line">				 <span class="string">&quot;&#125;\r\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//JSON解析</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cJSON_Parsing</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// jsonRoot 是您要剖析的数据</span></span><br><span class="line">	<span class="comment">//首先整体判断是否为一个json格式的数据</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Parsing Start&quot;</span>);</span><br><span class="line">	cJSON *pJsonRoot = cJSON_Parse(jsonRoot);</span><br><span class="line">	<span class="comment">//如果是否json格式数据</span></span><br><span class="line">	<span class="keyword">if</span> (pJsonRoot != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON TRUE&quot;</span>);</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON:%s&quot;</span>, jsonRoot);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON ERROR&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//解析imei字段字符串内容</span></span><br><span class="line">	cJSON *pimeiAdress = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;imei&quot;</span>);</span><br><span class="line">	<span class="comment">//判断imei字段是否json格式</span></span><br><span class="line">	<span class="keyword">if</span> (pimeiAdress)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//判断mac字段是否string类型</span></span><br><span class="line">		<span class="keyword">if</span> (cJSON_IsString(pimeiAdress))</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get imeiAdress:%s&quot;</span>, pimeiAdress-&gt;valuestring);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get imeiAdress failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//解析Num字段int内容</span></span><br><span class="line">	cJSON *pNumber = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;Num&quot;</span>);</span><br><span class="line">	<span class="comment">//判断Num字段是否存在</span></span><br><span class="line">	<span class="keyword">if</span> (pNumber)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//判断mac字段是否数字整型类型</span></span><br><span class="line">		<span class="keyword">if</span> (cJSON_IsNumber(pNumber))</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get Num:%d&quot;</span>, pNumber-&gt;valueint);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get Num failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//解析value字段内容，判断是否为json</span></span><br><span class="line">	cJSON *pValue = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;Value&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (pValue)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//进一步剖析里面的name字段:注意这个根节点是 pValue</span></span><br><span class="line">		cJSON *pName = cJSON_GetObjectItem(pValue, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (pName)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (cJSON_IsString(pName))</span><br><span class="line">				iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;Name:%s&quot;</span>, pName-&gt;valuestring);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pName failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//进一步剖析里面的age字段:注意这个根节点是 pValue</span></span><br><span class="line">		cJSON *pAge = cJSON_GetObjectItem(pValue, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (pAge)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (cJSON_IsNumber(pAge))</span><br><span class="line">				iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;Age:%d&quot;</span>, pAge-&gt;valueint);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pAge failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//进一步剖析里面的blog字段:注意这个根节点是 pValue</span></span><br><span class="line">		cJSON *pBlog = cJSON_GetObjectItem(pValue, <span class="string">&quot;blog&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (pBlog)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (cJSON_IsString(pBlog))</span><br><span class="line">				iot_debug_print(<span class="string">&quot;[cJSON_Test] get value-&gt;pBlog:%s&quot;</span>, pBlog-&gt;valuestring);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue-&gt;pBlog failed&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get pValue failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//剖析数组</span></span><br><span class="line">	cJSON *pArry = cJSON_GetObjectItem(pJsonRoot, <span class="string">&quot;hexArry&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (pArry)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//获取数组长度</span></span><br><span class="line">		<span class="keyword">int</span> arryLength = cJSON_GetArraySize(pArry);</span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get arryLength:%d&quot;</span>, arryLength);</span><br><span class="line">		<span class="comment">//逐个打印</span></span><br><span class="line">		<span class="keyword">int</span> i;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; arryLength; i++)</span><br><span class="line">			iot_debug_print(<span class="string">&quot;[cJSON_Test] get cJSON_GetArrayItem(pArry, %d)= %d&quot;</span>, i, cJSON_GetArrayItem(pArry, i)-&gt;valueint);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[cJSON_Test] get pArry failed&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">	cJSON_Delete(pJsonRoot);</span><br><span class="line"></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Parsing Stop&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//JSON生成</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cJSON_Generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//取一下本地的station的mac地址，保存在全局变量tempMessage</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Generate Start&quot;</span>);</span><br><span class="line">	cJSON *pRoot = cJSON_CreateObject();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//新增一个字段imei到根点，数值是tempMessage</span></span><br><span class="line">	<span class="keyword">char</span> tempMessage[] = <span class="string">&quot;8661111111111111&quot;</span>;</span><br><span class="line">	cJSON_AddStringToObject(pRoot, <span class="string">&quot;imei&quot;</span>, tempMessage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//新增一个字段number到根点，数值是2</span></span><br><span class="line">	cJSON_AddNumberToObject(pRoot, <span class="string">&quot;number&quot;</span>, <span class="number">2020</span>);</span><br><span class="line"></span><br><span class="line">	cJSON *pValue = cJSON_CreateObject();</span><br><span class="line">	cJSON_AddStringToObject(pValue, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;cx&quot;</span>);</span><br><span class="line">	cJSON_AddNumberToObject(pValue, <span class="string">&quot;age&quot;</span>, <span class="number">17</span>);</span><br><span class="line">	cJSON_AddItemToObject(pRoot, <span class="string">&quot;value&quot;</span>, pValue);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//数组初始化</span></span><br><span class="line">	<span class="keyword">int</span> hex[<span class="number">5</span>] = &#123;<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;;</span><br><span class="line">	cJSON *pHex = cJSON_CreateIntArray(hex, <span class="number">5</span>); <span class="comment">//创建一个长度为5的int型的数组json元素</span></span><br><span class="line">	cJSON_AddItemToObject(pRoot, <span class="string">&quot;hex&quot;</span>, pHex);	<span class="comment">//将数组元素添加进pRoot</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> *s = cJSON_Print(pRoot);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] creatJson:%s&quot;</span>, s);</span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">	cJSON_free((<span class="keyword">void</span> *)s);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">	<span class="comment">//cJSON_Delete(pHex);</span></span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">	<span class="comment">//cJSON_Delete(pValue);</span></span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">	cJSON_Delete(pRoot);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[cJSON_Test] cJSON_Generate Stop&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">appimg_enter</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//系统休眠</span></span><br><span class="line">	iot_os_sleep(<span class="number">20000</span>);</span><br><span class="line">	cJSON_Parsing();</span><br><span class="line">	cJSON_Generate();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出提示</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">appimg_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	OSI_LOGI(<span class="number">0</span>, <span class="string">&quot;application image exit&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="四、分析结果"><a href="#四、分析结果" class="headerlink" title="四、分析结果"></a>四、分析结果</h1><p>&emsp;&emsp;查看输出的日志信息，可以看到JSON的解析与生成都是正确的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59599</span>] [ <span class="number">7216</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON_Parsing Start</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59603</span>] [ <span class="number">7217</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON TRUE</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59604</span>] [ <span class="number">7218</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON:&#123;</span><br><span class="line"><span class="string">&quot;imei&quot;</span>: <span class="string">&quot;8661111111111111&quot;</span>,</span><br><span class="line"><span class="string">&quot;Num&quot;</span>: <span class="number">142</span>,</span><br><span class="line"><span class="string">&quot;Value&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;cx&quot;</span>,</span><br><span class="line"><span class="string">&quot;age&quot;</span>: <span class="number">18</span>,</span><br><span class="line"><span class="string">&quot;blog&quot;</span>: <span class="string">&quot;https://blog.csdn.net/weixin_44570083/article/details/104285283&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;hexArry&quot;</span>: [<span class="number">31</span>, <span class="number">56</span>, <span class="number">36</span>, <span class="number">1365</span>, <span class="number">263</span>]</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59605</span>] [ <span class="number">7219</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get imeiAdress:<span class="number">8661111111111111</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59606</span>] [ <span class="number">7220</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get Num:<span class="number">142</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59606</span>] [ <span class="number">7221</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get value-&gt;Name:cx</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59606</span>] [ <span class="number">7222</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get value-&gt;Age:<span class="number">18</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59607</span>] [ <span class="number">7223</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get value-&gt;pBlog:https:<span class="comment">//blog.csdn.net/weixin_44570083/article/details/104285283</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59607</span>] [ <span class="number">7224</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] get arryLength:<span class="number">5</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59608</span>] [ <span class="number">7225</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] <span class="function">get <span class="title">cJSON_GetArrayItem</span><span class="params">(pArry, <span class="number">0</span>)</span></span>= <span class="number">31</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59608</span>] [ <span class="number">7226</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] <span class="function">get <span class="title">cJSON_GetArrayItem</span><span class="params">(pArry, <span class="number">1</span>)</span></span>= <span class="number">56</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59608</span>] [ <span class="number">7227</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] <span class="function">get <span class="title">cJSON_GetArrayItem</span><span class="params">(pArry, <span class="number">2</span>)</span></span>= <span class="number">36</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59608</span>] [ <span class="number">7228</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] <span class="function">get <span class="title">cJSON_GetArrayItem</span><span class="params">(pArry, <span class="number">3</span>)</span></span>= <span class="number">1365</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59609</span>] [ <span class="number">7229</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] <span class="function">get <span class="title">cJSON_GetArrayItem</span><span class="params">(pArry, <span class="number">4</span>)</span></span>= <span class="number">263</span></span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59609</span>] [ <span class="number">7230</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON_Parsing Stop</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59610</span>] [ <span class="number">7231</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON_Generate Start</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.559</span>]  [<span class="number">59619</span>] [ <span class="number">7232</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] creatJson:&#123;</span><br><span class="line">	<span class="string">&quot;imei&quot;</span>:	<span class="string">&quot;8661111111111111&quot;</span>,</span><br><span class="line">	<span class="string">&quot;number&quot;</span>:	<span class="number">2020</span>,</span><br><span class="line">	<span class="string">&quot;value&quot;</span>:	&#123;</span><br><span class="line">		<span class="string">&quot;name&quot;</span>:	<span class="string">&quot;cx&quot;</span>,</span><br><span class="line">		<span class="string">&quot;age&quot;</span>:	<span class="number">17</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;hex&quot;</span>:	[<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">00</span>:<span class="number">11</span>:<span class="number">49.615</span>]  [<span class="number">59620</span>] [ <span class="number">7233</span>] [                ] [      ] [ ] OPEN/  : [cJSON_Test] cJSON_Generate Stop</span><br></pre></td></tr></table></figure>
<blockquote>
<p>不会下载的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里</a>，进去查看我的<code>RDA8910 CSDK二次开发入门教程</code>专题第一篇博文<code>1、RDA8910CSDK二次开发：环境搭建</code>里面讲了怎么下载<br>这里只是我的学习笔记，拿出来给大家分享，欢迎大家批评指正，本篇教程到此结束</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/21/889/" data-id="ckkfmdgel00dovkcgeusg08pn" data-title="12、RDA8910CSDK二次开发：c语言中最好用的JSON解析库---cJSON" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-888" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/21/888/" class="article-date">
  <time class="dt-published" datetime="2020-06-21T15:04:31.000Z" itemprop="datePublished">2020-06-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/21/888/">10、RDA8910CSDK二次开发：简易的http通讯库</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里查看所有博文</a></p>
<p>&emsp;&emsp;本系列博客所述资料<code>均来自合宙官方</code>，并不是本人原创（只有博客是自己写的），csdk只是得到了<code>口头的允许公开授权</code>。出于热心，本人将自己的所学笔记整理并推出相对应的使用教程，方面其他人学习。为国内的物联网事业发展尽自己的一份绵薄之力，<code>没有为自己谋取私利的想法</code>。若出现侵权现象，请告知本人，本人会立即停止更新，并删除相应的文章和代码。</p>
<p>&emsp;&emsp;本系列博客基于紫光展锐的<code>RDA8910  LTE Cat 1</code> bis芯片平台开发。理论上适用于合宙的Air720U、Air724U、广和通L610以及安信可的cat-01模块。</p>
<p>&emsp;&emsp;各个厂家的部分配置文件可能不一样，也许会导致设备出现奇怪的问题，其他的模块我也不确定能不能用，自行测试。但是有一点<code>编译下载和监视流程基本一样</code>，可供参考。</p>
<p>&emsp;&emsp;先不管支不支持，如果你用的模块是是紫光展锐的RDA8910，那都不妨一试，也许会有意外收获（<code>也有可能变砖，慎重！！！</code>）。</p>
<p>&emsp;&emsp;我使用的是<code>Air724UG</code>开发板，如果在其他模块上不能用，那也不要强怼，也许是开发包不兼容吧。这里的代码是没有问题的。例程仅供参考！</p>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>&emsp;&emsp;有好几天没写博客了，几天前刚说了tcp通讯和udp通讯。本来准备写一下http协议怎么使用，在官方开发包里找了半天没找到有关http的库函数。后来通过其他渠道确认了官方暂时还<code>没有提供有关http的相关库</code>函数。也就是说除非自己写或者自己移植，不然就没法用。<br><img src="https://img-blog.csdnimg.cn/20200531165445606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;随后想了下，干脆移植一个开源库试试吧，也许运气好移植成功了呢。花了半天时间找了几个开源的http库，打开一看实在是太复杂了，以我的能力暂时是搞不定。看的我头晕眼花，果断放弃。<br><img src="https://img-blog.csdnimg.cn/20200531170622140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;其实我对这个库的要求也不高，支持以下简单的post，get。然后能下载稍大的文件就行了。如果有https那就更好了，没有也不碍事。既然移植不成那就自己写一个简单的吧，凑合用一下。过一段时间也许官方的库就出来了。</p>
<p>&emsp;&emsp;http说到底其实也就是一个tcp连接，发送指定的报文信息而已，简单的应用并不复杂。只要在网上找一个协议报文格式，对着的信息上面直接替换即可。</p>
<p>&emsp;&emsp;下面就是一个GET请求的报文格式，用的是<code>HTTP/1.1</code>协议，注意<code>HTTP/1.1</code>支持<code>长连接</code>，但是这个长连接并不是永久的长连接。<code>在短时间内</code>，可以允许客户端向服务器连续发送多个请求，而无需重新建立连接。在空闲时（<code>一段时间没有动作</code>）服务器会主动断开与客户端的连接。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /admin_ui/rdx/core/images/close.png HTTP/<span class="number">1.1</span></span><br><span class="line">Accept-Language: en-US</span><br><span class="line">User-Agent: Mozilla/<span class="number">4.0</span> (compatible; MSIE <span class="number">7.0</span>; Windows NT <span class="number">6.1</span>; WOW64; Trident/<span class="number">7.0</span>; SLCC2; .NET CLR <span class="number">2.0</span><span class="number">.50727</span>; .NET CLR <span class="number">3.5</span><span class="number">.30729</span>; .NET CLR <span class="number">3.0</span><span class="number">.30729</span>; .NET4<span class="number">.0</span>C; .NET4<span class="number">.0</span>E)</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Host: xxx.xxx.xxx.xxx</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br></pre></td></tr></table></figure>
<h1 id="二、编写测试程序"><a href="#二、编写测试程序" class="headerlink" title="二、编写测试程序"></a>二、编写测试程序</h1><p>&emsp;&emsp;花了几天时间，根据报文的格式要求，写了一个简易的<code>http</code>函数库，目前只支持<code>GET</code>请求、<code>POST</code>请求。可以支持下载一些不是特别大的文件，昨晚测试下载800kb的文件没遇到什么问题。<code>https</code>暂时还没写，先凑合用着吧。</p>
<h2 id="2-1、了解本例程所用到的函数"><a href="#2-1、了解本例程所用到的函数" class="headerlink" title="2.1、了解本例程所用到的函数"></a>2.1、了解本例程所用到的函数</h2><p>&emsp;&emsp;至于内部怎么实现的我这里就不讲了，很简单，代码开源，有兴趣的可以自己去看。这里只介绍怎么使用库函数。<br>&emsp;&emsp;使用http服务需要包含<code>#include &quot;http_client.h&quot;&quot;</code>头文件，我们这里只用到了3个函数，分别是：</p>
<blockquote>
<p>/**新建一个http的对象，每次调用都会新建一个独立的对象，不会修改原有的对象<br>当初始化传入的参数不足时，初始化会失败，需要调用<code>http_get_init_state</code>，查询初始化状态<br><em>@param     config:   用户传入的初始化结构体<br>*@return    新建的http对象<br>*</em>/</p>
</blockquote>
<ul>
<li>http_client_handle_t <code>http_client_new</code>(http_client_config_t *config)</li>
</ul>
<blockquote>
<p>/**获取初始化的状态<br><em>@param        client：填写<code>http_client_new</code>返回的对象<br>*@return     ：   初始化的状态<br>*</em>/</p>
</blockquote>
<ul>
<li>http_client_init_state <code>http_get_init_state</code>(http_client_handle_t *client);</li>
</ul>
<blockquote>
<p>/*<em>/根据新建的对象，执行相应的操作<br>*@param        client：填写<code>http_client_new</code>返回的对象<br>*</em>/</p>
</blockquote>
<ul>
<li>void http_client_perform(http_client_handle_t *client);</li>
</ul>
<h2 id="2-2、编写get请求测试程序"><a href="#2-2、编写get请求测试程序" class="headerlink" title="2.2、编写get请求测试程序"></a>2.2、编写get请求测试程序</h2><p>&emsp;&emsp;demo中我写了两个get请求的测试，两个url只要选一个就行了，demo写的比较简单，一次只能测试一个请求。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http_client_config_t</span> config = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">//////////////GET测试1/////////////////////////</span></span><br><span class="line">config.url = <span class="string">&quot;https://bkimg.cdn.bcebos.com/pic/37d3d539b6003af356370ff93f2ac65c1138b69e?x-bce-process=image/resize,m_lfit,w_268,limit_1/format,f_jpg&quot;</span>;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////GET测试2/////////////////////////</span></span><br><span class="line"><span class="comment">//config.url = &quot;https://i0.hdslb.com/bfs/album/8ac5f3eecccb17dfe8702eff13a4fb51d59cfc4b.jpg&quot;;</span></span><br><span class="line">config.method = HTTP_METHOD_GET;</span><br><span class="line">config.event_handler = http_cb;</span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line"><span class="keyword">client_handle_t</span> = http_client_new(&amp;config);</span><br><span class="line">iot_debug_print(<span class="string">&quot;[http_client] init_state:%d&quot;</span>, http_get_init_state(&amp;<span class="keyword">client_handle_t</span>));</span><br><span class="line"><span class="keyword">if</span> (http_get_init_state(&amp;<span class="keyword">client_handle_t</span>) == HTTP_INIT_OK)</span><br><span class="line">&#123;</span><br><span class="line">	http_client_perform(&amp;<span class="keyword">client_handle_t</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-3、编写post请求测试程序"><a href="#2-3、编写post请求测试程序" class="headerlink" title="2.3、编写post请求测试程序"></a>2.3、编写post请求测试程序</h2><p>&emsp;&emsp;post请求主要是提交数据，我这里向<code>http://httpbin.org/post</code>提交字符串<code>”123456“</code>，该网站会回应相应的的报文数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///////////////////POST测试////////////////////////</span></span><br><span class="line">config.url = <span class="string">&quot;http://httpbin.org/post&quot;</span>;</span><br><span class="line">config.table_data = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">config.method = HTTP_METHOD_POST;</span><br><span class="line"><span class="comment">////////////////////////////////////</span></span><br><span class="line">config.event_handler = http_cb;</span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line"><span class="keyword">client_handle_t</span> = http_client_new(&amp;config);</span><br><span class="line">iot_debug_print(<span class="string">&quot;[http_client] init_state:%d&quot;</span>, http_get_init_state(&amp;<span class="keyword">client_handle_t</span>));</span><br><span class="line"><span class="keyword">if</span> (http_get_init_state(&amp;<span class="keyword">client_handle_t</span>) == HTTP_INIT_OK)</span><br><span class="line">&#123;</span><br><span class="line">	http_client_perform(&amp;<span class="keyword">client_handle_t</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-4、编写消息回调事件"><a href="#2-4、编写消息回调事件" class="headerlink" title="2.4、编写消息回调事件"></a>2.4、编写消息回调事件</h2><p>&emsp;&emsp;函数库中做了分包接收（一个请求分多包接收），分段接收（一个文件多次请求，不需要用户处理，库函数全部处理好了，用户只需要在回调函数中转存数据即可）。只会在一次的请求数据全部接收到后才会通知消息处理函数。拿下载文件来说，一个文件可能有好几兆，我在库里面默认设置接收缓存区为10240字节（10KB），用户可以自行更改，一次最多接收10KB的数据。由于网络问题，这10KB的数据可能需要进行分包接收，回调函数只会在10KB的数据全部接收完毕后才会通过回调函数通知用户，转存数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_cb</span><span class="params">(http_client_event *evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	iot_os_sleep(<span class="number">1000</span>);<span class="comment">//这里需要一个延时，不然下载的过程中，打印速度太快，日志会丢失，不需要查看日志的话可以忽略</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] http_client_event_state:%d&quot;</span>, evt-&gt;state);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] respons_state:%s&quot;</span>, evt-&gt;respons_state);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] data:%s&quot;</span>, evt-&gt;data);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] datalen:%d&quot;</span>, evt-&gt;datalen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="三、编译并下载程序"><a href="#三、编译并下载程序" class="headerlink" title="三、编译并下载程序"></a>三、编译并下载程序</h1><p>&emsp;&emsp;完整代码在这，自取。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: your name</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-19 14:05:32</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-05-31 17:53:31</span></span><br><span class="line"><span class="comment"> * @LastEditors: Please set LastEditors</span></span><br><span class="line"><span class="comment"> * @Description: In User Settings Edit</span></span><br><span class="line"><span class="comment"> * @FilePath: \RDA8910_CSDK\USER\user_main.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cs_types.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;osi_api.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;am_openat_common.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_os.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_gpio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_pmd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_adc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_vat.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_network.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iot_socket.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;http_client.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">HANDLE TestTask_HANDLE = <span class="literal">NULL</span>;</span><br><span class="line">uint8 NetWorkCbMessage = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> socketfd = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">http_client_handle_t</span> <span class="keyword">client_handle_t</span> = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_cb</span><span class="params">(http_client_event *evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	iot_os_sleep(<span class="number">1000</span>);<span class="comment">//这里需要一个延时，不然下载的过程中，打印速度太快，日志会丢失，不需要查看日志的话可以忽略</span></span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] http_client_event_state:%d&quot;</span>, evt-&gt;state);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] respons_state:%s&quot;</span>, evt-&gt;respons_state);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] data:%s&quot;</span>, evt-&gt;data);</span><br><span class="line">	iot_debug_print(<span class="string">&quot;[http_client] datalen:%d&quot;</span>, evt-&gt;datalen);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TestTask</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> NetLink = FALSE;</span><br><span class="line">	<span class="keyword">while</span> (NetLink == FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		T_OPENAT_NETWORK_CONNECT networkparam = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">switch</span> (NetWorkCbMessage)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_DISCONNECT: <span class="comment">//网络断开 表示GPRS网络不可用澹，无法进行数据连接，有可能可以打电话</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_DISCONNECT&quot;</span>);</span><br><span class="line">			iot_os_sleep(<span class="number">10000</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_READY: <span class="comment">//网络已连接 表示GPRS网络可用，可以进行链路激活</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_READY&quot;</span>);</span><br><span class="line">			<span class="built_in">memcpy</span>(networkparam.apn, <span class="string">&quot;CMNET&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;CMNET&quot;</span>));</span><br><span class="line">			<span class="comment">//建立网络连接，实际为pdp激活流程</span></span><br><span class="line">			iot_network_connect(&amp;networkparam);</span><br><span class="line">			iot_os_sleep(<span class="number">500</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OPENAT_NETWORK_LINKED: <span class="comment">//链路已经激活 PDP已经激活，可以通过socket接口建立数据连接</span></span><br><span class="line">			iot_debug_print(<span class="string">&quot;[socket] OPENAT_NETWORK_LINKED&quot;</span>);</span><br><span class="line">			NetLink = TRUE;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (NetLink == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">http_client_config_t</span> config = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="comment">//////////////GET测试1/////////////////////////</span></span><br><span class="line">		config.url = <span class="string">&quot;https://bkimg.cdn.bcebos.com/pic/37d3d539b6003af356370ff93f2ac65c1138b69e?x-bce-process=image/resize,m_lfit,w_268,limit_1/format,f_jpg&quot;</span>;</span><br><span class="line">		config.method = HTTP_METHOD_GET;</span><br><span class="line">		<span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//////////////GET测试2/////////////////////////</span></span><br><span class="line">		<span class="comment">//config.url = &quot;https://i0.hdslb.com/bfs/album/8ac5f3eecccb17dfe8702eff13a4fb51d59cfc4b.jpg&quot;;</span></span><br><span class="line">		<span class="comment">//config.method = HTTP_METHOD_GET;</span></span><br><span class="line">		<span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">///////////////////POST测试////////////////////////</span></span><br><span class="line">		<span class="comment">//config.url = &quot;http://httpbin.org/post&quot;;</span></span><br><span class="line">		<span class="comment">//config.table_data = &quot;123456&quot;;</span></span><br><span class="line">		<span class="comment">//config.method = HTTP_METHOD_POST;</span></span><br><span class="line">		<span class="comment">////////////////////////////////////</span></span><br><span class="line">		config.event_handler = http_cb;</span><br><span class="line">		<span class="comment">//创建对象</span></span><br><span class="line">		<span class="keyword">client_handle_t</span> = http_client_new(&amp;config);</span><br><span class="line"></span><br><span class="line">		iot_debug_print(<span class="string">&quot;[http_client] init_state:%d&quot;</span>, http_get_init_state(&amp;<span class="keyword">client_handle_t</span>));</span><br><span class="line">		<span class="keyword">if</span> (http_get_init_state(&amp;<span class="keyword">client_handle_t</span>) == HTTP_INIT_OK)</span><br><span class="line">		&#123;</span><br><span class="line">			http_client_perform(&amp;<span class="keyword">client_handle_t</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	iot_os_delete_task(TestTask_HANDLE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">NetWorkCb</span><span class="params">(E_OPENAT_NETWORK_STATE state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	NetWorkCbMessage = state;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">appimg_enter</span><span class="params">(<span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//系统休眠</span></span><br><span class="line">	iot_os_sleep(<span class="number">10000</span>);</span><br><span class="line">	<span class="comment">//注册网络状态回调函数</span></span><br><span class="line">	iot_network_set_cb(NetWorkCb);</span><br><span class="line">	<span class="comment">//创建一个任务</span></span><br><span class="line">	<span class="comment">//TestTask_HANDLE =</span></span><br><span class="line">	TestTask_HANDLE = iot_os_create_task(TestTask, <span class="literal">NULL</span>, <span class="number">2048</span>, <span class="number">10</span>, OPENAT_OS_CREATE_DEFAULT, <span class="string">&quot;TestTask&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出提示</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">appimg_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	OSI_LOGI(<span class="number">0</span>, <span class="string">&quot;application image exit&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="四、分析结果"><a href="#四、分析结果" class="headerlink" title="四、分析结果"></a>四、分析结果</h1><p>&emsp;&emsp;测试GET请求，通过打印数据，看到<code>Range_all</code>=25644字节，也就是图片的总大小25.6KB。分三段接收，第一段接收<code>10240</code>，第二段接收<code>10240</code>，第三段接收<code>5164</code>，三段加在一起正好是<code>25644</code>。<br><img src="https://img-blog.csdnimg.cn/20200531175821223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;测试POST请求，通过打印数据，http响应<code>200</code>，只能看到部分接收到的数据，还有数据大小是<code>495</code>字节。<br><img src="https://img-blog.csdnimg.cn/20200531190242442.png" alt="在这里插入图片描述"><br>&emsp;&emsp;这时候我们需要用一下网络调试助手，将下面的数据发送出去，响应头中附带的信息是响应<code>200</code>，<code>Content-Length=496</code>，以及正文数据的第一行和我们在日志中看到的是一样的。数据应该是没什么问题，我也懒得将数据一行行拆开打印了测试了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /post HTTP/<span class="number">1.1</span>\r\nHost: httpbin.org\r\nConnection: close\r\nUser-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">80.0</span><span class="number">.3987</span><span class="number">.163</span> Safari/<span class="number">537.36</span>\r\nContent-Length: <span class="number">8</span>\r\nContent-Type: application/json\r\nAccept: *<span class="comment">/*\r\n\r\n123456\r\n</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200531190505375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h1><p>&emsp;&emsp;本人提供的函数包内，有如下接口可供使用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改host数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_host</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">char</span> *host)</span></span>;</span><br><span class="line"><span class="comment">//获取host数据</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">http_get_host</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改ip数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_ip</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">char</span> *ip)</span></span>;</span><br><span class="line"><span class="comment">//获取ip数据</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">http_get_ip</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改port数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_port</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">int</span> port)</span></span>;</span><br><span class="line"><span class="comment">//获取port数据</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">http_get_port</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改path数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_path</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">char</span> *path)</span></span>;</span><br><span class="line"><span class="comment">//获取path数据</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">http_get_path</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改table_data数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_table_data</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">char</span> *table_data)</span></span>;</span><br><span class="line"><span class="comment">//获取table_data数据</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">http_get_table_data</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改method数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_method</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, <span class="keyword">http_client_method_t</span> method)</span></span>;</span><br><span class="line"><span class="comment">//获取method数据</span></span><br><span class="line"><span class="function"><span class="keyword">http_client_method_t</span> <span class="title">http_get_method</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改event_handler数据，必须先创建一个client对象才可以修改</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_set_event_handler</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client, http_event_handle_cb event_handler)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除http对象</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_delete</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"><span class="comment">//获取初始化状态</span></span><br><span class="line"><span class="function">http_client_init_state <span class="title">http_get_init_state</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"><span class="comment">//新建一个http的对象</span></span><br><span class="line"><span class="function"><span class="keyword">http_client_handle_t</span> <span class="title">http_client_new</span><span class="params">(<span class="keyword">http_client_config_t</span> *config)</span></span>;</span><br><span class="line"><span class="comment">//根据新建的对象，执行相应的操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_client_perform</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;一般情况下只需要用到如下4个函数即可满足简单的使用需求。复杂的功能我也没写，其他的接口主要是修改http对象内部变量的值，也可以直接通过指针修改（<code>不推荐</code>），容易出现问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除http对象</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_delete</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"><span class="comment">//获取初始化状态</span></span><br><span class="line"><span class="function">http_client_init_state <span class="title">http_get_init_state</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br><span class="line"><span class="comment">//新建一个http的对象</span></span><br><span class="line"><span class="function"><span class="keyword">http_client_handle_t</span> <span class="title">http_client_new</span><span class="params">(<span class="keyword">http_client_config_t</span> *config)</span></span>;</span><br><span class="line"><span class="comment">//根据新建的对象，执行相应的操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">http_client_perform</span><span class="params">(<span class="keyword">http_client_handle_t</span> *client)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不会下载的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里</a>，进去查看我的<code>RDA8910 CSDK二次开发入门教程</code>专题第一篇博文<code>1、RDA8910CSDK二次开发：环境搭建</code>里面讲了怎么下载<br>这里只是我的学习笔记，拿出来给大家分享，欢迎大家批评指正，本篇教程到此结束</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/21/888/" data-id="ckkfmdgel00dnvkcgaykhbrim" data-title="10、RDA8910CSDK二次开发：简易的http通讯库" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-887" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/21/887/" class="article-date">
  <time class="dt-published" datetime="2020-06-21T14:59:57.000Z" itemprop="datePublished">2020-06-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/21/887/">1.1、RDA8910CSDK二次开发：CSDK极致开发体验</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里查看所有博文</a></p>
<p>&emsp;&emsp;本系列博客所述资料<code>均来自合宙官方</code>，并不是本人原创（只有博客是自己写的），csdk只是得到了<code>口头的允许公开授权</code>。出于热心，本人将自己的所学笔记整理并推出相对应的使用教程，方面其他人学习。为国内的物联网事业发展尽自己的一份绵薄之力，<code>没有为自己谋取私利的想法</code>。若出现侵权现象，请告知本人，本人会立即停止更新，并删除相应的文章和代码。</p>
<p>&emsp;&emsp;本系列博客基于紫光展锐的<code>RDA8910  LTE Cat 1</code> bis芯片平台开发。理论上适用于合宙的Air720U、Air724U、广和通L610以及安信可的cat-01模块。</p>
<p>&emsp;&emsp;各个厂家的部分配置文件可能不一样，也许会导致设备出现奇怪的问题，其他的模块我也不确定能不能用，自行测试。但是有一点<code>编译下载和监视流程基本一样</code>，可供参考。</p>
<p>&emsp;&emsp;先不管支不支持，如果你用的模块是是紫光展锐的RDA8910，那都不妨一试，也许会有意外收获（<code>也有可能变砖，慎重！！！</code>）。</p>
<p>&emsp;&emsp;我使用的是<code>Air724UG</code>开发板，如果在其他模块上不能用，那也不要强怼，也许是开发包不兼容吧。这里的代码是没有问题的。例程仅供参考！</p>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>&emsp;&emsp;前几天看到<code>五行缺钱</code>这位大佬，在群里发了一个<code>flash.exe</code>的使用视频。一键开发那种体验，看的我十分眼馋。可惜的是该工具并不能完美的集成在我修改后的csdk中。于是我找到了<code>五行缺钱</code>这位大佬，一番交流下来，学到了不少东西。<br><img src="https://img-blog.csdnimg.cn/20200621223936725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;在随后的几天内，自己又写了一个工具，与csdk包高度配合，几天调教下来，使用效果也达到了我的预期。</p>
<p>&emsp;&emsp;接下来，我将会介绍一下本工具的使用方法。</p>
<h1 id="二、使用说明"><a href="#二、使用说明" class="headerlink" title="二、使用说明"></a>二、使用说明</h1><p>&emsp;&emsp;在使用工具前，需要让控制台的当前位置处于<code>CSDK\USER</code>目录下。</p>
<p><img src="https://img-blog.csdnimg.cn/2020062120444017.png" alt="在这里插入图片描述"></p>
<h2 id="2-1、帮助命令"><a href="#2-1、帮助命令" class="headerlink" title="2.1、帮助命令"></a>2.1、帮助命令</h2><p>&emsp;&emsp;在控制台中输入<code> .\Debug.bat -h</code>这条命令，控制台就会打印出详细的使用说明，如下图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621204707802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;全部的命令都在说明文档中，列了出来，并且给出了使用范例。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">==============================================================================================</span><br><span class="line">===================================Welcome to rda8910 tool====================================</span><br><span class="line">=======================================Help documents=========================================</span><br><span class="line">==============================================================================================</span><br><span class="line"></span><br><span class="line">打开帮助界面：</span><br><span class="line">        -help                           example:Debug.bat -help</span><br><span class="line">        -h                              example:Debug.bat -h</span><br><span class="line"></span><br><span class="line">开始编译：</span><br><span class="line">        -build                          example:Debug.bat -build</span><br><span class="line">        -b                              example:Debug.bat -b</span><br><span class="line"></span><br><span class="line">设置下载工具路径：</span><br><span class="line">        -tool <span class="built_in">string</span>                    example:Debug.bat -tool .\tool\</span><br><span class="line">        -t    <span class="built_in">string</span>                    example:Debug.bat -t .\tool\</span><br><span class="line"></span><br><span class="line">设置pac文件路径：</span><br><span class="line">        -pac <span class="built_in">string</span>                     example:Debug.bat -pac .\RDA8910_CSDK_USER.pac</span><br><span class="line">        -p   <span class="built_in">string</span>                     example:Debug.bat -p .\RDA8910_CSDK_USER.pac</span><br><span class="line"></span><br><span class="line">下载固件：</span><br><span class="line">        -flash                          example:Debug.bat -flash</span><br><span class="line">        -f                              example:Debug.bat -f</span><br><span class="line"></span><br><span class="line">添加Level白名单关键词：</span><br><span class="line">        白名单一次只能添加一个</span><br><span class="line">        -addlevel <span class="built_in">string</span>                example:Debug.bat -addlevel OPEN</span><br><span class="line">        -al       <span class="built_in">string</span>                example:Debug.bat -al OPEN</span><br><span class="line">        若想监视所有的Level：           example:Debug.bat -addlevel ALL</span><br><span class="line">        一旦Level白名单列表中存在ALL，其他所有的关键字都将失效</span><br><span class="line"></span><br><span class="line">移除Level白名单关键词：</span><br><span class="line">        -sublevel <span class="built_in">string</span>                example:Debug.bat -sublevel OPEN</span><br><span class="line">        -sl       <span class="built_in">string</span>                example:Debug.bat -sl OPEN</span><br><span class="line">        若想恢复Level过滤监视：         example:Debug.bat -sublevel ALL</span><br><span class="line"></span><br><span class="line">查询Level白名单关键词：</span><br><span class="line">        -getlevel                       example:Debug.bat -getlevel</span><br><span class="line">        -gl                             example:Debug.bat -gl</span><br><span class="line"></span><br><span class="line">添加Data白名单关键词：</span><br><span class="line">        白名单一次只能添加一个</span><br><span class="line">        -adddata <span class="built_in">string</span>                 example:Debug.bat -adddata [socket]</span><br><span class="line">        -ad      <span class="built_in">string</span>                 example:Debug.bat -ad [socket]</span><br><span class="line">        若想监视所有的Data：            example:Debug.bat -adddata ALL</span><br><span class="line">        一旦Data白名单列表中存在ALL，其他所有的关键字都将失效</span><br><span class="line"></span><br><span class="line">移除Data白名单关键词：</span><br><span class="line">        -subdata <span class="built_in">string</span>                 example:Debug.bat -subdata [socket]</span><br><span class="line">        -sd      <span class="built_in">string</span>                 example:Debug.bat -sd [socket]</span><br><span class="line">        若想恢复Data过滤监视：          example:Debug.bat -sublevel ALL</span><br><span class="line"></span><br><span class="line">查询Data白名单关键词：</span><br><span class="line">        -getdata                        example:Debug.bat -getdata</span><br><span class="line">        -gd                             example:Debug.bat -gd</span><br><span class="line"></span><br><span class="line">启动Monitor功能：</span><br><span class="line">        -monitor                        example:Debug.bat -monitor</span><br><span class="line">        -m                              example:Debug.bat -m</span><br></pre></td></tr></table></figure>

<h2 id="2-2、编译命令"><a href="#2-2、编译命令" class="headerlink" title="2.2、编译命令"></a>2.2、编译命令</h2><p>&emsp;&emsp;在控制台中输入<code> .\Debug.bat -b</code>这条命令，工具就会执行编译操作，如下图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621205251129.png" alt="在这里插入图片描述"></p>
<h2 id="2-3、下载相关命令"><a href="#2-3、下载相关命令" class="headerlink" title="2.3、下载相关命令"></a>2.3、下载相关命令</h2><p>&emsp;&emsp;下载pac文件前，需要指定下载工具的路径和下载文件的路径。正常情况下不需要设置，工具已经设置了默认值。</p>
<h3 id="2-3-1、下载工具路径设置"><a href="#2-3-1、下载工具路径设置" class="headerlink" title="2.3.1、下载工具路径设置"></a>2.3.1、下载工具路径设置</h3><p>&emsp;&emsp;正常情况下无需设置，除非配置文件损坏。</p>
<p>&emsp;&emsp;在控制台中输入<code>.\Debug.bat -t  ..\tools\rda8910\Download\</code>这条命令，工具就会将路径保存在本地。下次使用时自动加载。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621210039197.png" alt="在这里插入图片描述"></p>
<h3 id="2-3-2、下载文件路径设置"><a href="#2-3-2、下载文件路径设置" class="headerlink" title="2.3.2、下载文件路径设置"></a>2.3.2、下载文件路径设置</h3><p>&emsp;&emsp;正常情况下无需设置，除非配置文件损坏。</p>
<p>&emsp;&emsp;在控制台中输入<code>.\Debug.bat -p  ..\build\hex\RDA8910_CSDK_USER\RDA8910_CSDK_USER.pac</code>这条命令，工具就会将路径保存在本地。下次使用时自动加载。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621210530102.png" alt="在这里插入图片描述"></p>
<h3 id="2-3-3、下载命令"><a href="#2-3-3、下载命令" class="headerlink" title="2.3.3、下载命令"></a>2.3.3、下载命令</h3><p>&emsp;&emsp;下载命令无需任何参数，只要输入<code>.\Debug.bat -f</code>即可开始自动下载。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621210711357.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="2-4、监视相关命令"><a href="#2-4、监视相关命令" class="headerlink" title="2.4、监视相关命令"></a>2.4、监视相关命令</h2><p>&emsp;&emsp;与监视相关的命令比较多。我在工具里将监视过滤分成两级。<br>&emsp;&emsp;第一级是<code>Level</code>日志标识过滤，对应的是<code>coolwatch</code>软件中的<code>Level</code>标题，只有设置了<code>Level</code>白名单才会被放行。可以设置多个白名单。<br><img src="https://img-blog.csdnimg.cn/20200621211318335.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;第二级过滤是在第一级过滤的基础上进行的。若日志在第一级过滤中已经被干掉，那么就算再第二级过滤中放行也没有用。第二级是<code>Data</code>数据关键词过滤，对应的是<code>coolwatch</code>软件中的<code>Description</code>标题，只有设置了<code>Data</code>白名单才会被放行。可以设置多个白名单。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621211518197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-4-1、开始监视"><a href="#2-4-1、开始监视" class="headerlink" title="2.4.1、开始监视"></a>2.4.1、开始监视</h3><p>&emsp;&emsp;下载命令无需任何参数，只要输入<code>.\Debug.bat -m</code>即可开始自动监视。<br><img src="https://img-blog.csdnimg.cn/2020062121314437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-4-2、查看Level过滤白名单"><a href="#2-4-2、查看Level过滤白名单" class="headerlink" title="2.4.2、查看Level过滤白名单"></a>2.4.2、查看Level过滤白名单</h3><p>&emsp;&emsp;输入<code>.\Debug.bat -gl</code>即可查看Level白名单。在这里我设置的是<code>ALL</code>就是放行所有。只要ALL关键词存在，那么其他的关键词就全部失效。<br><img src="https://img-blog.csdnimg.cn/20200621212652343.png" alt="在这里插入图片描述"><br>&emsp;&emsp;这时候的日志就是乱七八糟什么都有。很难找到自己需要的信息。<br><img src="https://img-blog.csdnimg.cn/2020062121314437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-4-3、添加Level过滤白名单"><a href="#2-4-3、添加Level过滤白名单" class="headerlink" title="2.4.3、添加Level过滤白名单"></a>2.4.3、添加Level过滤白名单</h3><p>&emsp;&emsp;假如我需要对<code>OPEN</code>放行只需要输入<code> .\Debug.bat -al OPEN</code>。<br><img src="https://img-blog.csdnimg.cn/20200621224223946.png" alt="在这里插入图片描述"><br>&emsp;&emsp;这时候如果去运行监视，会发现监视工具还是全部放行。是因为<code>ALL</code>关键词还在，需要把它移除才行。</p>
<h3 id="2-4-4、移除Level过滤白名单"><a href="#2-4-4、移除Level过滤白名单" class="headerlink" title="2.4.4、移除Level过滤白名单"></a>2.4.4、移除Level过滤白名单</h3><p>&emsp;&emsp;输入<code> .\Debug.bat -sl ALL</code>就会移除ALL关键字。可以看到下面的<code>ALL</code>关键字已经消失了，只剩一个<code>OPEN</code>了。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621213842269.png" alt="在这里插入图片描述"><br>&emsp;&emsp;这时候我们再去运行监视。发现只有<code>OPEN</code>关键词被放行。<br><img src="https://img-blog.csdnimg.cn/2020062121402983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;重复<code>2.4.2</code>添加放行<code>GSRL</code>。<br><img src="https://img-blog.csdnimg.cn/20200621214359550.png" alt="在这里插入图片描述"><br>&emsp;&emsp;发现只有<code>OPEN</code>和<code>GSRL</code>关键词被放行。<br><img src="https://img-blog.csdnimg.cn/20200621214425769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-5-5、Data白名单"><a href="#2-5-5、Data白名单" class="headerlink" title="2.5.5、Data白名单"></a>2.5.5、Data白名单</h3><p>&emsp;&emsp;若<code>Level</code>过滤后得到的日志还是太多，那么我们需要设置<code>Data</code>过滤白名单进一步过滤。<code>Data</code>白名单匹配的是正文消息数据，正文消息中只要包含白名单列表中的一个字串，消息都会被放行。<br>&emsp;&emsp;涉及到的指令和<code>Level</code>白名单设置差不多。</p>
<ul>
<li><code>.\Debug.bat -gd</code>  查看白名单数据</li>
<li><code> .\Debug.bat -ad   hello</code>  添加白名单关键词</li>
<li><code>.\Debug.bat -sd    ALL </code>  移除白名单关键词</li>
</ul>
<h1 id="三、指令组合使用"><a href="#三、指令组合使用" class="headerlink" title="三、指令组合使用"></a>三、指令组合使用</h1><p>&emsp;&emsp;以上指令可以组合使用，我这里演示一下，一键编译下载监视的命令。</p>
<p>&emsp;&emsp;输入<code>.\Debug.bat -b -f -m</code>启动一条龙服务。效果如下图所示，按下回车后什么都不管，自动编译、下载、监视过滤。<br>。</p>
<p><img src="https://img-blog.csdnimg.cn/20200621223648293.gif" alt="在这里插入图片描述"><br>&emsp;&emsp;演示结束告辞。<br><img src="https://img-blog.csdnimg.cn/20200621224342581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3MDA4Mw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>不会下载的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44570083/article/details/104285283">点击这里</a>，进去查看我的<code>RDA8910 CSDK二次开发入门教程</code>专题第一篇博文<code>1、RDA8910CSDK二次开发：环境搭建</code>里面讲了怎么下载<br>这里只是我的学习笔记，拿出来给大家分享，欢迎大家批评指正，本篇教程到此结束</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/21/887/" data-id="ckkfmdgdk00bxvkcgg1fp1qld" data-title="1.1、RDA8910CSDK二次开发：CSDK极致开发体验" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-871" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/15/871/" class="article-date">
  <time class="dt-published" datetime="2020-06-15T11:17:31.000Z" itemprop="datePublished">2020-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/15/871/">Air530 GPS/北斗定位模块_设计指导手册_V1.9</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>欢迎加入Air530/G1模块技术交流QQ群：967368887</strong></p>
<p>@[TOC]</p>
<h1 id="1-模块整体说明"><a href="#1-模块整体说明" class="headerlink" title="1. 模块整体说明"></a>1. 模块整体说明</h1><p>   Air530模块是一款高性能、高集成度的多模卫星定位导航模块。体积小、功耗低，可用于车载导航、智能穿戴、无人机等GNSS定位的应用中。而且提供了和其他模块厂商兼容的软、硬件接口，大幅减少了用户的开发周期。</p>
<p>模块支持GPS/Beidou/GLONASS/Galileo/QZSS/SBAS。采用了射频基带一体化设计，集成了DC/DC、 LDO、 LNA、射频前端、基带处理、32位RISC CPU、RAM、FLASH存储、RTC和电源管理等功能。提供超高的性能，即使在弱信号的地方，也能快速、准确的定位。</p>
<h1 id="2-资料下载"><a href="#2-资料下载" class="headerlink" title="2. 资料下载"></a>2. 资料下载</h1><p><a target="_blank" rel="noopener" href="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/attachment/20201224173633946_Air530_%E5%8E%9F%E7%90%86%E5%9B%BEPCB%E5%B0%81%E8%A3%85.zip">Air530_原理图PCB封装.zip</a></p>
<p><a target="_blank" rel="noopener" href="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/attachment/20201024180614297_%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7_naviTrack_v1.5.2_170720.rar">调试工具_naviTrack_v1.5.2_170720.rar</a></p>
<h1 id="3-模块性能"><a href="#3-模块性能" class="headerlink" title="3. 模块性能"></a>3. 模块性能</h1><table>
<thead>
<tr>
<th>类别</th>
<th>指标项</th>
<th>典型值</th>
<th>单位</th>
</tr>
</thead>
<tbody><tr>
<td>定位时间  [测试条件1]</td>
<td>纯硬件冷启动</td>
<td>27.5</td>
<td>s</td>
</tr>
<tr>
<td>定位时间  [测试条件1]</td>
<td>纯硬件热启动</td>
<td>&lt;1</td>
<td>s</td>
</tr>
<tr>
<td>定位时间  [测试条件1]</td>
<td>纯硬件重新捕获</td>
<td>&lt;1</td>
<td>s</td>
</tr>
<tr>
<td>定位时间  [测试条件1]</td>
<td>软件辅助A-GNSS（秒定位）</td>
<td>&lt;5</td>
<td>s</td>
</tr>
<tr>
<td>灵敏度  [测试条件2]</td>
<td>冷启动</td>
<td>-148</td>
<td>dBm</td>
</tr>
<tr>
<td>灵敏度  [测试条件2]</td>
<td>热启动</td>
<td>-162</td>
<td>dBm</td>
</tr>
<tr>
<td>灵敏度  [测试条件2]</td>
<td>重新捕获</td>
<td>-164</td>
<td>dBm</td>
</tr>
<tr>
<td>灵敏度  [测试条件2]</td>
<td>跟踪</td>
<td>-166</td>
<td>dBm</td>
</tr>
<tr>
<td>精度  [测试条件3]</td>
<td>水平定位精度</td>
<td>2.5</td>
<td>m</td>
</tr>
<tr>
<td>精度  [测试条件3]</td>
<td>高度定位精度</td>
<td>3.5</td>
<td>m</td>
</tr>
<tr>
<td>精度  [测试条件3]</td>
<td>速度精度</td>
<td>0.1</td>
<td>m/s</td>
</tr>
<tr>
<td>精度  [测试条件3]</td>
<td>授时精度</td>
<td>30</td>
<td>ns</td>
</tr>
<tr>
<td>功耗  [测试条件4]</td>
<td>捕获电流值@3.3v</td>
<td>42.6</td>
<td>mA</td>
</tr>
<tr>
<td>功耗  [测试条件4]</td>
<td>跟踪电流值@3.3v</td>
<td>36.7</td>
<td>mA</td>
</tr>
<tr>
<td>工作温度</td>
<td></td>
<td>-35℃- 85℃</td>
<td></td>
</tr>
<tr>
<td>储存温度</td>
<td></td>
<td>-55℃- 100℃</td>
<td></td>
</tr>
<tr>
<td>湿度</td>
<td></td>
<td>5%  - 95%</td>
<td></td>
</tr>
</tbody></table>
<p>注：以上结果为GPS/北斗双模工作模式<br>[测试条件1]： 接收卫星个数大于6，所有卫星信号强度为-130dBm，测试10次取平均值，定位误差小于10米。<br>[测试条件2]：外接LNA噪声系数0.8，接收卫星个数大于6，五分钟之内锁定或者不失锁条件下的接收信号强度值。<br>[测试条件3]：开阔没有遮挡环境，连续24小时开机测试，50%CEP。<br>[测试条件4]：接收卫星个数大于6，所有卫星信号强度为-130dBm。</p>
<h1 id="4-模块管脚分配"><a href="#4-模块管脚分配" class="headerlink" title="4. 模块管脚分配"></a>4. 模块管脚分配</h1><p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200615154210087_22.png"></p>
<table>
<thead>
<tr>
<th><strong>Pin脚编号</strong></th>
<th><strong>Pin脚定义</strong></th>
<th><strong>Pin脚描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GPS_ANT</td>
<td>GPS天线输入</td>
</tr>
<tr>
<td>2</td>
<td>GND</td>
<td>地</td>
</tr>
<tr>
<td>3</td>
<td>WAKE</td>
<td>保留管脚，保持悬空</td>
</tr>
<tr>
<td>4</td>
<td>VCC</td>
<td>主电源，2.8V-4.2V</td>
</tr>
<tr>
<td>5</td>
<td>VBACKUP</td>
<td>如果要支持热启动，在模块关机时也必须维持VBACKUP的供电，  后备电池的电压范围是2.8V-3.3V，  VBACKUP必须要有供电，否则模块不工作；  如果不接后备电池，请把VBACKUP和VCC接在一起；</td>
</tr>
<tr>
<td>6</td>
<td>NC</td>
<td>保留管脚，保持悬空</td>
</tr>
<tr>
<td>7</td>
<td>NC</td>
<td>保留管脚，保持悬空</td>
</tr>
<tr>
<td>8</td>
<td>TXD</td>
<td>串口TX(2.8V)，输出GPS NMEA0183 数据，  默认波特率是9600bps</td>
</tr>
<tr>
<td>9</td>
<td>RXD</td>
<td>串口RX(2.8V)</td>
</tr>
<tr>
<td>10</td>
<td>GPS_TO_MCU</td>
<td>保留管脚，保持悬空</td>
</tr>
<tr>
<td>11</td>
<td>MCU_TO_GPS</td>
<td>保留管脚，保持悬空</td>
</tr>
<tr>
<td>12</td>
<td>GND</td>
<td>地</td>
</tr>
<tr>
<td>13</td>
<td>1PPS</td>
<td>授时管脚，One pulse per second(2.8V)</td>
</tr>
<tr>
<td>14</td>
<td>GND</td>
<td>地</td>
</tr>
</tbody></table>
<h1 id="5-参考设计电路"><a href="#5-参考设计电路" class="headerlink" title="5. 参考设计电路"></a>5. 参考设计电路</h1><p>参考电路：最简模式</p>
<p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20201023104518681_Air530%E5%8F%82%E8%80%83%E7%94%B5%E8%B7%AF1.png"></p>
<p>设计注意事项</p>
<ol>
<li>   VCC供电电压范围2.8-4.2V，VBACKUP供电电压范围2.8-3.3V。如果要支持GPS热启动功能，在关闭VCC供电的时候要保持给VBACKUP一直供电。</li>
<li>   模块尽量靠近GPS天线放置，天线走线保持50欧姆阻抗匹配，走线尽量短，避免锐角。</li>
<li>   GPS 天线推荐使用25X25X4mm 尺寸的陶瓷天线。</li>
<li>   串口TXD,RXD是 2.8V TTL 电平，用户可用此串口接收定位信息数据和软件升级。</li>
<li>   本模块是温度敏感设备，温度剧烈变化会导致其性能降低，使用中尽量远离高温器件与大功率发热器件。</li>
</ol>
<h1 id="6-GPS天线"><a href="#6-GPS天线" class="headerlink" title="6. GPS天线"></a>6. GPS天线</h1><p>GPS天线可根据需要选择无源天线或有源天线，有源天线相比无源天线效果好，但是成本高。</p>
<h2 id="6-1-无源天线"><a href="#6-1-无源天线" class="headerlink" title="6.1 无源天线"></a>6.1 无源天线</h2><p>如果采用无源天线，建议天线与模块之间的走线尽可能的短，最理想的情况是GPS模块直接放置在天线的背面，使模块的天线焊盘和GPS天线馈点之间零距离，如下图所示：<br><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200615154833172_44.png"></p>
<h2 id="6-2-有源天线"><a href="#6-2-有源天线" class="headerlink" title="6.2 有源天线"></a>6.2 有源天线</h2><p>采用有源天线时要注意有源天线的供电电压范围，如果有源天线的供电要和模块的供电共用一个电源的话，需要串接一颗47nH的电感，同时在靠近天线处并联一颗1000pF的电容，模块内部已经有隔直电容，外部无须再加。<br>参考电路如下：<br><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20201023104640641_Air530%E5%8F%82%E8%80%83%E7%94%B5%E8%B7%AF2.png"></p>
<h1 id="7-模块外形尺寸"><a href="#7-模块外形尺寸" class="headerlink" title="7. 模块外形尺寸"></a>7. 模块外形尺寸</h1><p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200615155043595_66.png"><br>模块尺寸为12.9mm&#42;9.9mm&#42;2.3mm；</p>
<h1 id="8-模块推荐PCB封装尺寸图"><a href="#8-模块推荐PCB封装尺寸图" class="headerlink" title="8. 模块推荐PCB封装尺寸图"></a>8. 模块推荐PCB封装尺寸图</h1><p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200615155208144_77.png"></p>
<p>说明：<br>为方便邮票孔焊接，邮票孔焊盘需外延至少0.5mm，因此模块封装尺寸建议为12.9 X 10.9 mm;<br>模块封装下载链接如下：<br><a target="_blank" rel="noopener" href="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/attachment/20201224173633946_Air530_%E5%8E%9F%E7%90%86%E5%9B%BEPCB%E5%B0%81%E8%A3%85.zip">Air530_原理图PCB封装.zip</a></p>
<h1 id="9-NMEA0183协议"><a href="#9-NMEA0183协议" class="headerlink" title="9.NMEA0183协议"></a>9.NMEA0183协议</h1><p>AIR530模块支持NMEA 0183 V4.1协议并兼容以前版本，关于NMEA 0183 V4.1的详细信息请参照NMEA 0183 V4.1官方文档。</p>
<h2 id="9-1-NMEA-0183简述"><a href="#9-1-NMEA-0183简述" class="headerlink" title="9.1 NMEA 0183简述"></a>9.1 NMEA 0183简述</h2><p>GGA：时间、位置、卫星数量<br>GLL：经度、纬度、 UTC 时间<br>GSA：GPS 接收机操作模式，定位使用的卫星，DOP 值，定位状态<br>GSV：可见 GPS 卫星信息、仰角、方位角、信噪比<br>RMC：时间、日期、位置、速度<br>VTG：地面速度信息</p>
<h2 id="9-2-Goke-NMEA命令"><a href="#9-2-Goke-NMEA命令" class="headerlink" title="9.2 Goke NMEA命令"></a>9.2 Goke NMEA命令</h2><p>Air530定制了一些命令用来控制冷、热、温启动和卫星定位模式等，可以直接通过串口直接发送命令来控制模块，命令格式如下：<br>1.<strong>启动命令</strong><br>系统热启动命令：$PGKC030,1,1&#42;2C<CR><LF><br>系统温启动命令：$PGKC030,2,1&#42;2F<CR><LF><br>系统冷启动命令：$PGKC030,3,1&#42;2E<CR><LF><br>系统重置冷启动：$PGKC030,4,1&#42;29<CR><LF><br>2.<strong>卫星定位模式设置</strong><br>单GPS:      $PGKC115,1,0,0,0&#42;2B<CR><LF><br>GPS+BEIDOU:   $PGKC115,1,0,1,0&#42;2A<CR><LF><br>GPS+GLONASS: $PGKC115,1,1,0,0&#42;2A<CR><LF></p>
<h3 id="9-2-1-GKC接口数据格式"><a href="#9-2-1-GKC接口数据格式" class="headerlink" title="9.2.1 GKC接口数据格式"></a>9.2.1 GKC接口数据格式</h3><p>GKC接口是用户和Air530之间进行交互的接口。其命令格式如下：</p>
<table>
<thead>
<tr>
<th><strong>$PGKC</strong></th>
<th><strong>Command</strong></th>
<th><strong>Arguments</strong></th>
<th>*****</th>
<th><strong>CheckSum</strong></th>
<th><strong>CR</strong></th>
<th><strong>LF</strong></th>
</tr>
</thead>
</table>
<p><strong>Command</strong>：     表示发送的命令号，具体的值参考下文。<br><strong>Arguments</strong>：     表示发送命令需要的参数，参数可以是多个，不同的命令对应不同的数据，具体值参考下文。<br>*<strong>**：                 数据结束的标志<br>**CheckSum</strong>：    整条命令的校验数据<br><strong>CR，LF</strong>：        包结束标志</p>
<p><strong>样例数据</strong>：$PGKC030,3,1*2E <CR><LF></p>
<h3 id="9-2-2-GKC命令"><a href="#9-2-2-GKC命令" class="headerlink" title="9.2.2 GKC命令"></a>9.2.2 GKC命令</h3><pre><code>1、Command: 001
                 应答消息，回应对方发送的消息处理结果
    Arguments:
       Arg1:    该消息所应答消息的command。
       Arg2:     “1”，不支持接收到的消息
                 “2”，有效消息，但执行不正确
                 “3”，有效消息，并且执行正确
Example:
             $PGKC001,101,3*2D&lt;CR&gt;&lt;LF&gt;有效消息，并且执行正确
Example:
             $PGKC001,101,3*2D&lt;CR&gt;&lt;LF&gt;

2、Command: 030
             系统重启命令
Arguments:
Arg1:  “1”，热启动
       “2”，温启动
       “3”，冷启动
Arg2:      “1”, 软件重启
        Example:
             $PGKC030,1,1*2C&lt;CR&gt;&lt;LF&gt;

3、Command: 040
擦除flash中的辅助定位数据
Arguments:
无
        Example:
            $PGKC040*2B&lt;CR&gt;&lt;LF&gt;


7、Command: 113
             开启或关闭QZSS NMEA格式输出
Arguments:
    Arg1:    “0”，关闭
            “1”，开启
Example:
    $PGKC113,1*31&lt;CR&gt;&lt;LF&gt;

8、Command: 114
             开启或关闭QZSS 功能
Arguments:
Arg1:    “0”，开启
“1”，关闭
Example:
            $PGKC114,0*37&lt;CR&gt;&lt;LF&gt;

9、Command: 115
             设置搜星模式
Arguments:
   Arg1:  “1”，GPS on
          “0”，GPS off
   Arg2:  “1”，Glonass on
          “0”，Glonass off
   Arg3:  “1”，Beidou on
          “0”，Beidou off
   Arg4:  “1”，Galieo on
          “0”，Galieo off
Example:
            $PGKC115,1,0,0,0*2B&lt;CR&gt;&lt;LF&gt;
10、Command: 147
             设置NMEA输出波特率
Arguments:
   Arg1:  9600，19200，38400，57600，115200……921600.
Example:
            $PGKC147,115200*06&lt;CR&gt;&lt;LF&gt;

11、Command: 149
       设置NMEA串口参数
Arguments:
   Arg1:     “0”，NMEA数据
             “1”，Binary数据
   Arg2:  9600，19200，38400，57600，115200……921600.
Example:
            $PGKC149,0,38400*2C&lt;CR&gt;&lt;LF&gt;

12、Command: 161
             PPS设置
Arguments:
     Arg1: “0”，关闭PPS输出
           “1”，第一次fix
           “2”，3D fix
           “3”，2D/3D fix
           “4”，始终开启
    Arg2:  PPS脉冲宽度（ms）
           要求小于999
    Arg3:  PPS周期（ms）
           要求大于PPS脉冲宽度
Example:
            $PGKC161,2,500,1000*2E&lt;CR&gt;&lt;LF&gt;

13、Command: 201
             查询NMEA消息的间隔
Arguments:
         无
Example:
            $PGKC201*2C&lt;CR&gt;&lt;LF&gt;

14、Command: 202
             返回NMEA消息的间隔（应答201命令）
Arguments:
     无
Example:
            $PGKC202,1000,0,0,0,0*02&lt;CR&gt;&lt;LF&gt;

15、Command: 239
             开启或关闭SBAS 功能
    Arguments:
       Arg1: “0”，开启
             “1”，关闭
    Example:
            $PGKC239,1*3A&lt;CR&gt;&lt;LF&gt;

16、Command: 240
             查询SBAS是否使能
   Arguments:
         无
   Example:
            $PGKC240*29&lt;CR&gt;&lt;LF&gt;

17、Command: 241
             返回SBAS是否使能（应答240命令）
Arguments:
Arg1:     “0”，关闭
         “1”，打开
Example:
            $PGKC241,1*35&lt;CR&gt;&lt;LF&gt;

18、Command: 242
             设置NMEA语句输出使能
Arguments:
   Arg1:     GLL     “0”，关闭； “1”，打开
   Arg2:     RMC     “0”，关闭； “1”，打开
   Arg3:     VTG     “0”，关闭； “1”，打开
   Arg4:     GGA     “0”，关闭； “1”，打开
   Arg5:     GSA     “0”，关闭； “1”，打开
   Arg6:     GSV     “0”，关闭； “1”，打开
   Arg7:     GRS     “0”，关闭； “1”，打开
   Arg8:     GST     “0”，关闭； “1”，打开
   Arg9~ Arg19:    保留
Example:
    $PGKC242,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0*37 &lt;CR&gt;&lt;LF&gt;

19、Command: 243
             查询NMEA语句输出频率
   Arguments:
         无
   Example:
       $PGKC243*2A&lt;CR&gt;&lt;LF&gt;

20、Command: 244
             返回NMEA语句输出频率（应答243命令）
    Arguments:
        Args:     参考242命令
    Example:
        $PGKC244,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0*31&lt;CR&gt;&lt;LF&gt;

21、Command: 278
             设置RTC时间
   Arguments:
      Arg1:     年
      Arg2:     月，1~12
      Arg3:     日，1~31
      Arg4:     时，0~23
      Arg5:     分，0~59
      Arg6:     秒，0~59
   Example:
        $PGKC278,2017,3,15,12,0,0*12&lt;CR&gt;&lt;LF&gt;

22、Command: 279
         查询RTC时间
    Arguments:
         无
    Example:
        $PGKC279*23&lt;CR&gt;&lt;LF&gt;

23、Command: 280
             返回NMEA语句输出频率（应答243命令）
    Arguments:
    Args:     参考278命令
    Example:
            $PGKC280,2017,3,15,12,0,0*15&lt;CR&gt;&lt;LF&gt;

24、Command: 284
             设置速度门限，速度低于门限值时，输出速度为0
Arguments:
Arg1:     门限值
Example:
            $PGKC284,0.5*26&lt;CR&gt;&lt;LF&gt;
25、Command: 356
      设置HDOP门限，实际HDOP大于门限值时，不定位
    Arguments:
       Arg1: 门限值
Example:
      $PGKC356,0.7*2A&lt;CR&gt;&lt;LF&gt;

26、Command: 357
       获取HDOP门限
    Arguments:
      无
    Example:
        $PGKC357*2E&lt;CR&gt;&lt;LF&gt;

27、Command: 462
             查询当前软件的版本号
    Arguments:
         无
    Example:
            $PGKC462*2F&lt;CR&gt;&lt;LF&gt;

28、Command: 463
             返回当前软件的版本号（应答462命令）
   Arguments:
         无
   Example:
            $PGKC463,GOKE9501_1.3_17101100*22&lt;CR&gt;&lt;LF&gt;

29、Command: 639
             设置大概的位置信息和时间信息，以加快定位速度
    Arguments:
       Arg1:  纬度, 例如：28.166450
       Arg2:  经度, 例如：120.389700
       Arg3:  高度, 例如：0
       Arg4:  年
       Arg5:  月
       Arg6:  日
       Arg7:  时，时间是UTC时间
       Arg8:  分
       Arg9:  秒
Example:
      $PGKC639,28.166450,120.389700,0,2017,3,15,12,0*33&lt;CR&gt;&lt;LF&gt;
</code></pre>
<h3 id="9-2-3-支持NMEA0183协议"><a href="#9-2-3-支持NMEA0183协议" class="headerlink" title="9.2.3 支持NMEA0183协议"></a>9.2.3 支持NMEA0183协议</h3><p>Air530支持NMEA0183 V4.1协议并兼容以前版本，关于NMEA0183 V4.1的详细信息可以参照NMEA 0183 V4.1官方文档。</p>
<p>常见输出格式如下：<br>GGA：时间、位置、卫星数量<br>GSA：GPS接收机操作模式，定位使用的卫星，DOP值，定位状态<br>GSV：可见GPS卫星信息、仰角、方位角、信噪比<br>RMC：时间、日期、位置、速度<br>VTG：地面速度信息</p>
<p><strong>语句标识符:</strong></p>
<table>
<thead>
<tr>
<th>标识符</th>
<th>含  义</th>
</tr>
</thead>
<tbody><tr>
<td>BD</td>
<td>BDS,北斗二代卫星系统</td>
</tr>
<tr>
<td>GP</td>
<td>GPS</td>
</tr>
<tr>
<td>GL</td>
<td>GLONASS</td>
</tr>
<tr>
<td>GA</td>
<td>Galileo</td>
</tr>
<tr>
<td>GN</td>
<td>GNSS,全球导航卫星系统</td>
</tr>
</tbody></table>
<p><strong>GGA</strong><br>$–GGA,hhmmss.ss,llll.ll,a,yyyyy.yy,a,x,xx,x.x,x.x,M,x.x,M,x.x,xxxx*hh<br>样例数据：$GPGGA,065545.789,2109.9551,N,12023.4047,E,1,9,0.85,18.1,M,8.0,M,,&#42;5E</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>样例</th>
<th>单位</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>消息ID</td>
<td>$GPGGA</td>
<td></td>
<td>GGA协议头</td>
</tr>
<tr>
<td>UTC时间</td>
<td>065545.789</td>
<td></td>
<td>hhmmss.sss</td>
</tr>
<tr>
<td>纬度</td>
<td>2109.9551</td>
<td></td>
<td>ddmm.mmmm</td>
</tr>
<tr>
<td>N/S指示</td>
<td>N</td>
<td></td>
<td>N=北，S=南</td>
</tr>
<tr>
<td>经度</td>
<td>12023.4047</td>
<td></td>
<td>dddmm.mmmm</td>
</tr>
<tr>
<td>E/W指示</td>
<td>E</td>
<td></td>
<td>W=西，E=东</td>
</tr>
<tr>
<td>定位指示</td>
<td></td>
<td></td>
<td>0:未定位  1:SPS模式，定位有效  2:差分，SPS模式，定位有效  3:PPS模式，定位有效</td>
</tr>
<tr>
<td>卫星数目</td>
<td>9</td>
<td></td>
<td>范围0到12</td>
</tr>
<tr>
<td>HDOP</td>
<td>0.85</td>
<td></td>
<td>水平精度</td>
</tr>
<tr>
<td>MSL幅度</td>
<td>18.1</td>
<td>米</td>
<td></td>
</tr>
<tr>
<td>单位</td>
<td>M</td>
<td>米</td>
<td></td>
</tr>
<tr>
<td>大地</td>
<td>-2.2</td>
<td>米</td>
<td></td>
</tr>
<tr>
<td>单位</td>
<td>M</td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>差分时间</td>
<td>8.0</td>
<td>秒</td>
<td>当没有DGPS时，无效</td>
</tr>
<tr>
<td>差分  ID</td>
<td>0000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>校验和</td>
<td>*5E</td>
<td></td>
<td></td>
</tr>
<tr>
<td><CR><LF></td>
<td></td>
<td></td>
<td>消息结束</td>
</tr>
</tbody></table>
<p><strong>GSA</strong><br>$–GSA,a,a,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x.x,x.x,x.x*hh<br>样例数据：$GPGSA,A,3,10,24,12,32,25,21,15,20,31,,,,1.25,0.85,0.91&#42;04</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>样例</th>
<th>单位</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>消息ID</td>
<td>$GPGSA</td>
<td></td>
<td>GSA协议头</td>
</tr>
<tr>
<td>模式1</td>
<td>A</td>
<td></td>
<td>M=手动，强制在2D或3D模式  A=自动</td>
</tr>
<tr>
<td>模式2</td>
<td>3</td>
<td></td>
<td>1:定位无效   2:2D定位    3:3D定位</td>
</tr>
<tr>
<td>卫星使用</td>
<td>10</td>
<td></td>
<td>通道1</td>
</tr>
<tr>
<td>卫星使用</td>
<td>24</td>
<td></td>
<td>通道2</td>
</tr>
<tr>
<td>卫星使用</td>
<td>12</td>
<td></td>
<td>通道3</td>
</tr>
<tr>
<td>卫星使用</td>
<td>32</td>
<td></td>
<td>通道4</td>
</tr>
<tr>
<td>卫星使用</td>
<td>25</td>
<td></td>
<td>通道5</td>
</tr>
<tr>
<td>卫星使用</td>
<td>21</td>
<td></td>
<td>通道6</td>
</tr>
<tr>
<td>卫星使用</td>
<td>15</td>
<td></td>
<td>通道7</td>
</tr>
<tr>
<td>卫星使用</td>
<td>20</td>
<td></td>
<td>通道8</td>
</tr>
<tr>
<td>,,,</td>
<td>,,,</td>
<td>,,,</td>
<td>,,,</td>
</tr>
<tr>
<td>卫星使用</td>
<td></td>
<td></td>
<td>通道12</td>
</tr>
<tr>
<td>PDOP</td>
<td>1.25</td>
<td></td>
<td>位置精度</td>
</tr>
<tr>
<td>HDOP</td>
<td>0.85</td>
<td></td>
<td>水平精度</td>
</tr>
<tr>
<td>VDOP</td>
<td>0.91</td>
<td></td>
<td>垂直精度</td>
</tr>
<tr>
<td>校验和</td>
<td>*04</td>
<td></td>
<td></td>
</tr>
<tr>
<td><CR><LF></td>
<td></td>
<td></td>
<td>消息结束</td>
</tr>
</tbody></table>
<p><strong>GSV</strong><br>$–GSV,x,x,x,x,x,x,x,…*hh<br>样例数据：<br>$GPGSV,3,1,12,14,75,001,31,32,67,111,38,31,57,331,33,26,47,221,20&#42;73<br>$GPGSV,3,2,12,25,38,041,29,29,30,097,32,193,26,176,35,22,23,301,30&#42;47<br>$GPGSV,3,3,12,10,20,185,28,44,20,250,,16,17,217,21,03,14,315,&#42;7D</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>样例</th>
<th>单位</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>消息ID</td>
<td>$GPGSV</td>
<td></td>
<td>GSV协议头</td>
</tr>
<tr>
<td>消息数目</td>
<td>3</td>
<td></td>
<td>范围1到4</td>
</tr>
<tr>
<td>消息编号</td>
<td>1</td>
<td></td>
<td>范围1到4</td>
</tr>
<tr>
<td>卫星数目</td>
<td>12</td>
<td></td>
<td></td>
</tr>
<tr>
<td>卫星ID</td>
<td>14</td>
<td></td>
<td>范围1到32</td>
</tr>
<tr>
<td>仰角</td>
<td>75</td>
<td>度</td>
<td>最大90°</td>
</tr>
<tr>
<td>方位角</td>
<td>001</td>
<td>度</td>
<td>范围0到359°</td>
</tr>
<tr>
<td>载噪比（C/No）</td>
<td>31</td>
<td>dBHz</td>
<td>范围0到99，没有跟踪时为空</td>
</tr>
<tr>
<td>卫星  ID</td>
<td>32</td>
<td></td>
<td>范围1到32</td>
</tr>
<tr>
<td>仰角</td>
<td>67</td>
<td>度</td>
<td>最大90°</td>
</tr>
<tr>
<td>方位角</td>
<td>111</td>
<td>度</td>
<td>范围0到359°</td>
</tr>
<tr>
<td>载噪比（C/No）</td>
<td>38</td>
<td>dBHz</td>
<td>范围0到99，没有跟踪时为空</td>
</tr>
<tr>
<td>卫星  ID</td>
<td>31</td>
<td></td>
<td>范围1到32</td>
</tr>
<tr>
<td>仰角</td>
<td>57</td>
<td>度</td>
<td>最大90°</td>
</tr>
<tr>
<td>方位角</td>
<td>331</td>
<td>度</td>
<td>范围0到359°</td>
</tr>
<tr>
<td>载噪比（C/No）</td>
<td>33</td>
<td>dBHz</td>
<td>范围0到99，没有跟踪时为空</td>
</tr>
<tr>
<td>卫星ID</td>
<td>26</td>
<td></td>
<td>范围1到32</td>
</tr>
<tr>
<td>仰角</td>
<td>47</td>
<td>度</td>
<td>最大90°</td>
</tr>
<tr>
<td>方位角</td>
<td>221</td>
<td>度</td>
<td>范围0到359°</td>
</tr>
<tr>
<td>载噪比（C/No）</td>
<td>20</td>
<td>dBHz</td>
<td>范围0到99，没有跟踪时为空</td>
</tr>
<tr>
<td>校验和</td>
<td>*73</td>
<td></td>
<td></td>
</tr>
<tr>
<td><CR><LF></td>
<td></td>
<td></td>
<td>消息结束</td>
</tr>
</tbody></table>
<p><strong>RMC</strong><br>$–RMC,hhmmss.ss,A,llll.ll,a,yyyyy.yy,a,x.x,x.x,xxxx,x.x,a&#42;hh<br>样例数据：<br>$GPRMC,100646.000,A,3109.9704,N,12123.4219,E,0.257,335.62,291216,,,A&#42;59</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>样例</th>
<th>单位</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>消息ID</td>
<td>$GPRMC</td>
<td></td>
<td>RMC协议头</td>
</tr>
<tr>
<td>UTC时间</td>
<td>100646.000</td>
<td></td>
<td>hhmmss.ss</td>
</tr>
<tr>
<td>状态</td>
<td>A</td>
<td></td>
<td>A=数据有效；V=数据无效</td>
</tr>
<tr>
<td>纬度</td>
<td>2109.9704</td>
<td></td>
<td>ddmm.mmmm</td>
</tr>
<tr>
<td>N/S指示</td>
<td>N</td>
<td></td>
<td>N=北，S=南</td>
</tr>
<tr>
<td>经度</td>
<td>11123.4219</td>
<td></td>
<td>dddmm.mmmm</td>
</tr>
<tr>
<td>E/W指示</td>
<td>E</td>
<td></td>
<td>W=西，E=东</td>
</tr>
<tr>
<td>地面速度</td>
<td>0.257</td>
<td>Knot（节）</td>
<td></td>
</tr>
<tr>
<td>方位</td>
<td>335.62</td>
<td>度</td>
<td></td>
</tr>
<tr>
<td>日期</td>
<td>291216</td>
<td></td>
<td>ddmmyy</td>
</tr>
<tr>
<td>磁变量</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>校验和</td>
<td>*59</td>
<td></td>
<td></td>
</tr>
<tr>
<td><CR><LF></td>
<td></td>
<td></td>
<td>消息结束</td>
</tr>
</tbody></table>
<p><strong>VTG</strong><br>$–VTG,x.x,T,x.x,M,x.x,N,x.x,K*hh<br>样例数据：$GPVTG,335.62,T,,M,0.257,N,0.477,K,A&#42;38</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>样例</th>
<th>单位</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>消息ID</td>
<td>$GPVTG</td>
<td></td>
<td>VTG协议头</td>
</tr>
<tr>
<td>方位</td>
<td>335.62</td>
<td>度</td>
<td></td>
</tr>
<tr>
<td>参考</td>
<td>T</td>
<td></td>
<td>True</td>
</tr>
<tr>
<td>方位</td>
<td>335.62</td>
<td>度</td>
<td></td>
</tr>
<tr>
<td>参考</td>
<td>M</td>
<td></td>
<td>Magnetic</td>
</tr>
<tr>
<td>速度</td>
<td>0.257</td>
<td>Knot（节）</td>
<td></td>
</tr>
<tr>
<td>单位</td>
<td>N</td>
<td></td>
<td>节</td>
</tr>
<tr>
<td>速度</td>
<td>0.477</td>
<td>公里/小时</td>
<td></td>
</tr>
<tr>
<td>单位</td>
<td>K</td>
<td></td>
<td>公里/小时</td>
</tr>
<tr>
<td>单位</td>
<td>A</td>
<td></td>
<td>定位系统模式指示:   A—自主模式；   D—差分模式；   E—估算（航位推算）模式；   M—手动输入模式；   S—模拟器模式；   N—数据无效。</td>
</tr>
<tr>
<td>校验和</td>
<td>*10</td>
<td></td>
<td></td>
</tr>
<tr>
<td><CR><LF></td>
<td></td>
<td></td>
<td>消息结束</td>
</tr>
</tbody></table>
<p><strong>GNSS工具naviTrack</strong><br>naviTrack是一个专为Air530开发的GNSS工具，它为用户评估、控制Air530模块提供了一个易用、强大的可视化PC端工具。当然用户也可以使用诸如u-Center、PowerGPS等工具。</p>
<p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200615175603372_88.jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/15/871/" data-id="ckkfmdgel00dmvkcg7p5n4jo5" data-title="Air530 GPS/北斗定位模块_设计指导手册_V1.9" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-846" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/12/846/" class="article-date">
  <time class="dt-published" datetime="2020-06-12T14:15:17.000Z" itemprop="datePublished">2020-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/12/846/">LuatOS 项目进度(20210124更新)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="LuatOS项目简介"><a href="#LuatOS项目简介" class="headerlink" title="LuatOS项目简介"></a>LuatOS项目简介</h1><p>gitee地址 <a target="_blank" rel="noopener" href="https://gitee.com/openLuat/LuatOS">https://gitee.com/openLuat/LuatOS</a><br>github地址 <a target="_blank" rel="noopener" href="https://github.com/openLuat/LuatOS">https://github.com/openLuat/LuatOS</a><br>QQ群: 1061642968</p>
<hr>
<h1 id="LuatOS-项目进展报告-20210124"><a href="#LuatOS-项目进展报告-20210124" class="headerlink" title="LuatOS 项目进展报告 - 20210124"></a>LuatOS 项目进展报告 - 20210124</h1><h2 id="本周进展"><a href="#本周进展" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS"><a href="#LuatOS" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: dbg库第一版,脚本调试器,命令行形式</li>
</ul>
<h3 id="LuaTools"><a href="#LuaTools" class="headerlink" title="LuaTools"></a>LuaTools</h3><ul>
<li>add: 发布2.1.1</li>
<li>add: 添加luatos dbg调试器代理</li>
<li>change: 迁移更新服务</li>
</ul>
<h3 id="Air302"><a href="#Air302" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: 并入上游v035 sdk</li>
</ul>
<h3 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: 代理luatools的更新服务</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>vscode-luatos-debug vscode插件完成度60%</li>
</ul>
<h2 id="下周计划"><a href="#下周计划" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air820ug: 继续适配sdk,也许可能有机会把lua vm跑起来</li>
<li>air302: 分发新的测试版本</li>
<li>air640w: 并入新的u8g2库(预期’消防车’会发起pr)</li>
<li>luatools: 继续完善调试器代理</li>
<li>其他: 完成vscode的luatos调试插件</li>
<li>官网: 完善博客的页面编辑器</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20210116"><a href="#LuatOS-项目进展报告-20210116" class="headerlink" title="LuatOS 项目进展报告 - 20210116"></a>LuatOS 项目进展报告 - 20210116</h1><h2 id="本周进展-1"><a href="#本周进展-1" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-1"><a href="#LuatOS-1" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 为string库添加base64方法</li>
<li>add: 为air640w的dfs_lfs2添加新的布局,通过减少文件系统大小,塞入中文字库</li>
<li>fix: socket.ntpSync没了</li>
<li>update: 默认禁用debug库,在实现lua版本的调试器之前,这个库没有意义</li>
</ul>
<h3 id="LuaTools-1"><a href="#LuaTools-1" class="headerlink" title="LuaTools"></a>LuaTools</h3><ul>
<li>add: 直接读取AP日志</li>
<li>update:适配host协议上传命令给RDA8910</li>
</ul>
<h3 id="Air302-1"><a href="#Air302-1" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: 释放uart0给用户使用</li>
</ul>
<h3 id="air820ug"><a href="#air820ug" class="headerlink" title="air820ug"></a>air820ug</h3><ul>
<li>add: 添加hello world</li>
</ul>
<h3 id="官网-1"><a href="#官网-1" class="headerlink" title="官网"></a>官网</h3><ul>
<li>update: 完成资源库设计</li>
<li>add: 为LuaTools做一个页面(未上线)</li>
</ul>
<h3 id="探索类"><a href="#探索类" class="headerlink" title="探索类"></a>探索类</h3><ul>
<li>Lua调试器探索: <a target="_blank" rel="noopener" href="https://github.com/Tencent/LuaPanda">LuaPanda</a></li>
</ul>
<h2 id="下周计划-1"><a href="#下周计划-1" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air820ug: 继续适配sdk</li>
<li>官网: 设计并实现资源库</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20210110"><a href="#LuatOS-项目进展报告-20210110" class="headerlink" title="LuatOS 项目进展报告 - 20210110"></a>LuatOS 项目进展报告 - 20210110</h1><h2 id="本周进展-2"><a href="#本周进展-2" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-2"><a href="#LuatOS-2" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>fix: msgbus和timer的freertos实现有错误,修正之</li>
</ul>
<h3 id="Air100st"><a href="#Air100st" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>update: 刷机流程完善</li>
<li>update: 文件系统验证通过,能跑脚本了</li>
</ul>
<h3 id="LuaTools-2"><a href="#LuaTools-2" class="headerlink" title="LuaTools"></a>LuaTools</h3><ul>
<li>add: luadb v2 支持校验</li>
<li>update: 已交付给测试部进行测试</li>
</ul>
<h2 id="下周计划-2"><a href="#下周计划-2" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 适配更多外设</li>
<li>luatools: 支持air640w的固件刷机和底层刷机</li>
<li>air820ug: 开始适配sdk</li>
<li>官网: 为LuaTools做一个页面</li>
<li>官网: 设计并实现资源库</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20210103"><a href="#LuatOS-项目进展报告-20210103" class="headerlink" title="LuatOS 项目进展报告 - 20210103"></a>LuatOS 项目进展报告 - 20210103</h1><h2 id="本周进展-3"><a href="#本周进展-3" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-3"><a href="#LuatOS-3" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 添加FEATURE_STATIC_LUASTATE,静态化lua_State结构体</li>
<li>fix: mqtt2的shutdown没有生效</li>
<li>fix: http库的api文档有语法错误</li>
</ul>
<h3 id="Air100st-1"><a href="#Air100st-1" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>正在完善刷机刷脚本协议</li>
</ul>
<h3 id="官网-2"><a href="#官网-2" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: 添加luatools所需的web api</li>
</ul>
<h3 id="LuaTools-3"><a href="#LuaTools-3" class="headerlink" title="LuaTools"></a>LuaTools</h3><ul>
<li>add: 定义中性版本</li>
<li>add: 日志自动清理</li>
<li>add: 按文件夹添加脚本(递归子目录)</li>
<li>change: 默认输出x86版本, 本次更新后, 将替换原有的x64版本</li>
<li>fix: 修复air302下载固件和脚本失败的bug</li>
<li>fix: 调整菜单, 修复错误的链接</li>
<li>fix: 项目列表栏的表头不应该显示</li>
<li>fix: 执行air302的语法检查会报错</li>
</ul>
<h2 id="下周计划-3"><a href="#下周计划-3" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 仍需讨论终版设计</li>
<li>air100st: 完成下载脚本的功能</li>
<li>air302: 支持ctiot升级脚本(仍无头绪)</li>
<li>air302: 用户反馈gpio在联网前持续触发到联网成功后, 有极小概率出现不再触发的问题(仍无重现)</li>
<li>air302: 用户反馈edrx参数设置无效的问题(待确认)</li>
<li>luatools: 将新版进行测试后推送,拟定新的开发计划和发布周期</li>
<li>官网: 解决设备轨迹跟踪的遗留问题</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201228"><a href="#LuatOS-项目进展报告-20201228" class="headerlink" title="LuatOS 项目进展报告 - 20201228"></a>LuatOS 项目进展报告 - 20201228</h1><h2 id="本周进展-4"><a href="#本周进展-4" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-2"><a href="#Air302-2" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 使得crypto/ctiot/http可选编译</li>
<li>update: 支持完全禁用unilog编译</li>
<li>update: 调整luat_malloc_air302,使用户可以自行调整内存大小</li>
<li>change: luaL_prepbuffsize也没有必要每次都GC</li>
<li>add: 发布V0005 beta1测试版本</li>
</ul>
<h3 id="LuatOS-4"><a href="#LuatOS-4" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>fix: luaM_realloc_无需每次都GC</li>
<li>change: luaL_prepbuffsize也没有必要每次都GC</li>
<li>update: 如果是测试固件,打印额外的提示语句</li>
</ul>
<h3 id="Air100st-2"><a href="#Air100st-2" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>完成适配spi flash,完成lfs文件系统</li>
</ul>
<h3 id="官网-3"><a href="#官网-3" class="headerlink" title="官网"></a>官网</h3><ul>
<li>update:主页手机版式</li>
<li>update:博客等页面的手机版式</li>
</ul>
<h2 id="下周计划-4"><a href="#下周计划-4" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 解决开发板的问题,确定终版设计</li>
<li>air100st: 配合luatools考虑下载脚本的流程</li>
<li>luatos: 完成rtt package所需要的元数据文件(上周未完成)</li>
<li>air302: 支持ctiot升级脚本(上周未完成)</li>
<li>luatools: 修复急需的特性,检讨代码结构</li>
<li>官网: 适配GT06协议</li>
<li>官网: 添加luatools所需的web api</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201220"><a href="#LuatOS-项目进展报告-20201220" class="headerlink" title="LuatOS 项目进展报告 - 20201220"></a>LuatOS 项目进展报告 - 20201220</h1><h2 id="本周进展-5"><a href="#本周进展-5" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-3"><a href="#Air302-3" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: 并入最新sdk后,uart2无法使用的bug</li>
</ul>
<h3 id="LuatOS-5"><a href="#LuatOS-5" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 添加墨水屏中文字库支持</li>
<li>add: 墨水屏驱动支持微雪全系列</li>
<li>update: eink的字库实现二分查找,并替换为无版权问题的谷歌字体</li>
<li>change: lua vm异常退出时,不在关闭lua state,保留现场,便于做内存分析</li>
</ul>
<h3 id="Air100st-3"><a href="#Air100st-3" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>继续适配spi flash</li>
</ul>
<h3 id="官网-4"><a href="#官网-4" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: 天气API</li>
<li>update: 优化设备管理和轨迹显示</li>
</ul>
<h2 id="下周计划-5"><a href="#下周计划-5" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 继续完成spi flash驱动,文件系统(上周未完成)</li>
<li>air302: 发布V0005测试版(上周未发布V0005,这周改成发测试版吧)</li>
<li>luatos: 完成rtt package所需要的元数据文件(上周未完成)</li>
<li>air640w: 尝试让其也支持墨水屏</li>
<li>air302: 支持ctiot升级脚本</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201213"><a href="#LuatOS-项目进展报告-20201213" class="headerlink" title="LuatOS 项目进展报告 - 20201213"></a>LuatOS 项目进展报告 - 20201213</h1><h2 id="本周进展-6"><a href="#本周进展-6" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-4"><a href="#Air302-4" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 并入sdk patch1 和 patch2</li>
<li>update: 发布V0004</li>
<li>fix: gpio16不能被控制的bug</li>
</ul>
<h3 id="LuatOS-6"><a href="#LuatOS-6" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 添加墨水屏支持, 由”好记星”贡献</li>
<li>add: 添加内置的SHT30读取支持,由”好记星”贡献</li>
<li>fix: crc.c里面的数组应该改成static的</li>
</ul>
<h3 id="Air100st-4"><a href="#Air100st-4" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>新的makefile已经完成</li>
</ul>
<h3 id="官网-5"><a href="#官网-5" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: jt808服务部署完成,基础功能可用,与设备联调ok</li>
</ul>
<h2 id="下周计划-6"><a href="#下周计划-6" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: spi和flash驱动,文件系统</li>
<li>air302: 发布V0005或者V0004.patch2</li>
<li>air302: 解决uart2无法使用的bug</li>
<li>air302: 解决http的2个bug</li>
<li>air302: 添加墨水屏的demo,基于自建的天气服务</li>
<li>官网: 优化设备管理和轨迹显示</li>
<li>官网: 添加天气API</li>
<li>air640w: 完成rtt package所需要的元数据文件</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201206"><a href="#LuatOS-项目进展报告-20201206" class="headerlink" title="LuatOS 项目进展报告 - 20201206"></a>LuatOS 项目进展报告 - 20201206</h1><h2 id="本周进展-7"><a href="#本周进展-7" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-5"><a href="#Air302-5" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 并入最新的sdk v001.034.20201120</li>
<li>add: 添加 PTW和 TimeZone 的API</li>
</ul>
<h3 id="LuatOS-7"><a href="#LuatOS-7" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>fix: air302的ds18b20的demo有错误</li>
</ul>
<h3 id="官网-6"><a href="#官网-6" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: devtrack服务的地图展示</li>
</ul>
<h2 id="下周计划-7"><a href="#下周计划-7" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 完成cmake版的Makefile,添加luatos更多代码</li>
<li>air302: 发布V0004正式版</li>
<li>官网: 测试jt808服务</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201128"><a href="#LuatOS-项目进展报告-20201128" class="headerlink" title="LuatOS 项目进展报告 - 20201128"></a>LuatOS 项目进展报告 - 20201128</h1><h2 id="本周进展-8"><a href="#本周进展-8" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-6"><a href="#Air302-6" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: 按移芯的答复,修改band获取和设置的代码, 现已支持锁频</li>
<li>update: 开始合并sdk v001.034.20201120</li>
<li>add: air302添加个上报到luatos设备跟踪服务的demo</li>
</ul>
<h3 id="Air100st-5"><a href="#Air100st-5" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: uart实现</li>
</ul>
<h3 id="LuatOS-8"><a href="#LuatOS-8" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: luat_shell支持at+ecrst,改善air302的刷机体验</li>
<li>update: air640w.py适配星盟TW-1菊花板的下载逻辑</li>
</ul>
<h2 id="Air640w"><a href="#Air640w" class="headerlink" title="Air640w"></a>Air640w</h2><ul>
<li>add : air640w支持pwm</li>
<li>update: 为air640w的demo添加标准注释头</li>
</ul>
<h3 id="官网-7"><a href="#官网-7" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: netlab支持加密连接</li>
<li>add: netlab支持更多界面动画</li>
<li>update: devlog服务小规模测试完成</li>
</ul>
<h2 id="下周计划-8"><a href="#下周计划-8" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 实现更多外设的移植,并入lua/luatos代码</li>
<li>air302: 发布V0004正式版或测试版</li>
<li>air302: 合并sdk</li>
<li>air640w: 发布V0004正式版</li>
<li>官网: 部署和测试devtrack服务</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201122"><a href="#LuatOS-项目进展报告-20201122" class="headerlink" title="LuatOS 项目进展报告 - 20201122"></a>LuatOS 项目进展报告 - 20201122</h1><h2 id="本周进展-9"><a href="#本周进展-9" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-7"><a href="#Air302-7" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: 添加nbiot.setTZ方法, 方便设置时区</li>
<li>update:加入官方给的GPIO中断解决方法</li>
<li>update:ctiot默认启用UQ MODE缓存数据</li>
<li>fix: netclient有几个日志不够清晰</li>
<li>remove: 移除已经没用的luat_lib_package_air302.c,因为默认的实现已经ok</li>
<li>remove: luat_disp_air302.c是空的,删掉吧</li>
<li>change: luat_fs_air302.c 减少一个日志吧</li>
</ul>
<h3 id="Air100st-6"><a href="#Air100st-6" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: 新的os API和dev API</li>
</ul>
<h3 id="LuatOS-9"><a href="#LuatOS-9" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>update: fpconv_g_fmt,去掉浮点数json化后,后面多余的’0’</li>
<li>update: json_encode,添加浮点数转换精度和模式的设置,原来的接口调用方式,默认为”%.7g”,和lua的tostring保持一致</li>
<li>update: 为air640w引入rtt库已经合并的rt_hw_us_delay方法</li>
<li>update: 为air302的mqtt2的demo添加少许注释</li>
<li>fix: air640w因初始化顺序问题,自动重连没有生效的bug. 原因是文件系统的初始化比rt_wlan_cfg_cache_refresh晚<br>fix: 更正mqtt 2的demo发不出消息的bug</li>
<li>add: mqtt2的demo</li>
<li>add:ctwing平台增加update API，用于和平台保活 update:ctiot demo 增加update保持连接，增加tx fail后重连平台的操作</li>
<li>add: 为air302添加sht20的demo</li>
<li>add: 为air302添加sht30的demo,顺便加上接线说明</li>
<li>remove: 移除ltests.c,反正也没用的</li>
<li>change: luat_malloc_weak.c添加一段内存调试用代码,默认关闭</li>
<li>change: luaL_prepbuffsize已经有强制gc, 无需在新建字符串时gc了</li>
</ul>
<h3 id="官网-8"><a href="#官网-8" class="headerlink" title="官网"></a>官网</h3><ul>
<li>官网: 部署多租户后台</li>
<li>官网: 部署devlog日志跟踪服务</li>
<li>官网: 部署lbsloc测试服务</li>
</ul>
<h2 id="下周计划-9"><a href="#下周计划-9" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 实现更多外设的移植</li>
<li>luatos: 协助团队外的开发者集成墨水屏</li>
<li>w800: 继续协助飞思创完成后续适配</li>
<li>官网: 完成并部署设备日志的查看界面</li>
<li>官网: 部署或小范围测试devlog/lbsloc/devtrace</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201115"><a href="#LuatOS-项目进展报告-20201115" class="headerlink" title="LuatOS 项目进展报告 - 20201115"></a>LuatOS 项目进展报告 - 20201115</h1><h2 id="本周进展-10"><a href="#本周进展-10" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-8"><a href="#Air302-8" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: gpio中断有问题,属于sdk的问题</li>
<li>fix: 获取基站数据有概率导致重启</li>
<li>fix: l_nbiot_set_edrx有日志语句错误</li>
<li>fix: air302的demo里有错误的aon_gpio和adc描述,修正一下</li>
<li>update: 新sdk的合并延后到v001.035</li>
</ul>
<h3 id="Air100st-7"><a href="#Air100st-7" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: 自定义的bootloader</li>
<li>add: 集成cm_trackback 异常堆栈跟踪</li>
</ul>
<h3 id="LuatOS-10"><a href="#LuatOS-10" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 新的mqtt2.lua,异步mqtt库, 低内存消耗,异步api</li>
<li>add: mqttcore.unpack方法,至此,全部mqtt解码均使用C实现</li>
<li>add: uart库的校验位识别符,支持全大写</li>
<li>add: urlEncode,在原来接口不变的前提下,添加了php标准,RFC3986标准和自定义标准的选择</li>
<li>fix: 使用内存在溢出的边缘时,有概率导致死机,修正luat_heap_alloc的逻辑</li>
<li>fix: mqtt2.lua在处理不完整的数据包时会报错</li>
<li>fix: 在air640w上的socket使用,如果lua端提前close,而后台线程之后才关闭, 有概率报错</li>
<li>fix: 让l_mqttcore_packSUBSCRIBE更健壮一些</li>
<li>fix: i2c带上返回值 #I24COF</li>
<li>update: cjson的fpconv的代码有点多余,清理一下</li>
</ul>
<h3 id="air640w及w800"><a href="#air640w及w800" class="headerlink" title="air640w及w800"></a>air640w及w800</h3><ol>
<li>支持wifi信息保存到文件系统</li>
<li>协助飞思创完成w800的基础移植(uart/gpio/文件系统/浮点数打印,均已可用)</li>
</ol>
<h3 id="官网-9"><a href="#官网-9" class="headerlink" title="官网"></a>官网</h3><ul>
<li>官网: iot平台后端界面初始化,基础数据结构完成</li>
<li>官网: 虚拟设备的基础部分改为Qt实现</li>
</ul>
<h2 id="下周计划-10"><a href="#下周计划-10" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 实现更多外设的移植</li>
<li>luatos: 协助团队外的开发者集成墨水屏</li>
<li>air302: 继续测试mqtt2的表现</li>
<li>w800: 继续协助飞思创完成后续适配</li>
<li>官网: 完成并部署设备日志的查看界面</li>
<li>官网: 部署iot后台</li>
<li>官网: 部署lbsloc测试服务</li>
<li>官网: 虚拟设备与luatos联合编译</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201108"><a href="#LuatOS-项目进展报告-20201108" class="headerlink" title="LuatOS 项目进展报告 - 20201108"></a>LuatOS 项目进展报告 - 20201108</h1><h2 id="本周进展-11"><a href="#本周进展-11" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-9"><a href="#Air302-9" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 合并sdk v001.033(仍未完成)</li>
</ul>
<h3 id="Air100st-8"><a href="#Air100st-8" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: 测试开发板已收到,基本测试中</li>
<li>add: 切换freertos底层,基础工作已经完成</li>
</ul>
<h3 id="LuatOS-11"><a href="#LuatOS-11" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>update: 与团队外的开发者调试Air302的内存问题</li>
</ul>
<h3 id="官网-10"><a href="#官网-10" class="headerlink" title="官网"></a>官网</h3><ul>
<li>官网: netlab英文版(海外版上线)</li>
<li>官网: luatos英文版官网开发中</li>
<li>官网: 设备日志服务,后端完成,等待前端</li>
<li>官网: 虚拟设备前端页面部分完成</li>
</ul>
<h2 id="下周计划-11"><a href="#下周计划-11" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 重新适配uart和gpio, 迁移luatos的上层代码</li>
<li>luatos: 调研lua 5.4</li>
<li>luatos: 设计主动式内存回收机制</li>
<li>官网: 设计并完成iot后台数据结构</li>
<li>官网: 完成设计日志的查看界面,需配合iot后台</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201101"><a href="#LuatOS-项目进展报告-20201101" class="headerlink" title="LuatOS 项目进展报告 - 20201101"></a>LuatOS 项目进展报告 - 20201101</h1><h2 id="本周进展-12"><a href="#本周进展-12" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-10"><a href="#Air302-10" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 合并sdk v001.033(未并入主线,问题有点多)</li>
</ul>
<h3 id="Air640w-1"><a href="#Air640w-1" class="headerlink" title="Air640w"></a>Air640w</h3><ul>
<li>fix: 修正几个编译问题</li>
<li>change: mcu固件的lua vm内存扩展到170kb</li>
<li>release: 发布V0003,并发布信息</li>
</ul>
<h2 id="下周计划-12"><a href="#下周计划-12" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air100st: 重新评估转用freertos底层</li>
<li>官网: 继续关注备案,设计其他模块</li>
<li>air302: 解决客户反馈的bug, 有客户反馈死机的问题(内存相关?)</li>
<li>luatos: 编写mqtt异步版本(本周未完成)</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201025"><a href="#LuatOS-项目进展报告-20201025" class="headerlink" title="LuatOS 项目进展报告 - 20201025"></a>LuatOS 项目进展报告 - 20201025</h1><h2 id="本周进展-13"><a href="#本周进展-13" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-11"><a href="#Air302-11" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: 创建timer失败的时候, 删除timer会段错误</li>
<li>fix: 修正ds18b20概率性修正失败的bug</li>
<li>add: 适配pm库的两个新方法,并简化日志</li>
</ul>
<h3 id="LuatOS本身"><a href="#LuatOS本身" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>fix: l_pm_last_reson改对(2个返回值)之后,行为反而跟原本不符</li>
<li>fix: 修改air302生成量产文件的目录, 适配骑士智能的批量下载工具的布局</li>
<li>update: air302.py生成便于使用的量产文件</li>
<li>add: pm添加2个新方法, 一个读取唤醒的deepTimer的id, 一个读取deepTimer唤醒时间</li>
</ul>
<h3 id="官网-11"><a href="#官网-11" class="headerlink" title="官网"></a>官网</h3><ul>
<li>update: netlab调优完成,与串口工具llcom的集成完成</li>
</ul>
<h3 id="硬件方面"><a href="#硬件方面" class="headerlink" title="硬件方面"></a>硬件方面</h3><ul>
<li>继续等待LuatOS开发板(缺flash,重新做pcb中)</li>
</ul>
<h2 id="下周计划-13"><a href="#下周计划-13" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>官网: 继续关注备案,设计其他模块</li>
<li>air302: 解决客户反馈的bug</li>
<li>luatos: 编写mqtt异步版本</li>
<li>luatos:  测试AT适配(Air724UG)</li>
<li>luatos: 考虑改写socket实现</li>
<li>虚拟设备: 继续推进编写</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201018"><a href="#LuatOS-项目进展报告-20201018" class="headerlink" title="LuatOS 项目进展报告 - 20201018"></a>LuatOS 项目进展报告 - 20201018</h1><h2 id="本周进展-14"><a href="#本周进展-14" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-12"><a href="#Air302-12" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: gpio上拉下拉的bug</li>
<li>fix: gpio切换模式是不应该打印日志,会导致ds18b20无法读取</li>
<li>fix: 修正延时函数的bug 从而修正ds18b20读取失败的bug</li>
<li>update: 更新air302的adc用法,推荐用户用完adc就关闭,这样更省电</li>
<li>update: 更新air302的ds18b20示例,加上了网络灯</li>
<li>add: 演示上传温度数据到tlink平台,默认间隔2分钟,使用ds18b20</li>
<li>add: 发布V0003正式版, 并在开源中国发新闻</li>
</ul>
<h3 id="LuatOS本身-1"><a href="#LuatOS本身-1" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>update: 新风格的README</li>
<li>update: 减少luat_main的日志. remove: 移除多余的l_sprintf方法</li>
<li>add: sensor库读取ds18b20时,默认校验crc值,以提供更可靠的输出</li>
</ul>
<h3 id="官网-12"><a href="#官网-12" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: netlab的服务器端已经就绪(tcplab的替代方案)</li>
</ul>
<h3 id="相关硬件方面"><a href="#相关硬件方面" class="headerlink" title="相关硬件方面"></a>相关硬件方面</h3><ul>
<li>update: 由于Flash缺失, LuatOS开发板继续延误中</li>
<li>update: 基于w600(即Air640w的芯片)的串口记录器, 已打样, 电路ok, 读写TF卡正常</li>
</ul>
<h2 id="下周计划-14"><a href="#下周计划-14" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>为Air302的V0004/V0005进行规划,主要是合并新的SDK及补充非核心库.</li>
<li>继续推进官网备案,使用临时域名部署各模块.</li>
<li>完成netlab网页端,推动llcom集成,争取开始公测</li>
<li>推进LuatOS开发板的片上设备的适配</li>
<li>测试AT适配(Air724系列)</li>
<li>为Air640w发布两个版本的V0003, wifi版和mcu版</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20201011"><a href="#LuatOS-项目进展报告-20201011" class="headerlink" title="LuatOS 项目进展报告 - 20201011"></a>LuatOS 项目进展报告 - 20201011</h1><h2 id="本周进展-15"><a href="#本周进展-15" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-13"><a href="#Air302-13" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: 添加udp与uart集成的demo</li>
<li>add: 支持读取DHT12温湿度传感器,并添加demo</li>
<li>add: 支持读写EEPROM,并添加demo</li>
<li>fix: i2c实现的bug</li>
</ul>
<h3 id="LuatOS本身-2"><a href="#LuatOS本身-2" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>add: sensor库暴露w1单总线协议的Lua API</li>
</ul>
<h3 id="官网-13"><a href="#官网-13" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: 基础后台已上线</li>
</ul>
<h2 id="下周计划-15"><a href="#下周计划-15" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air302仍需解决读取ds18b20的bug,最迟10月12号发布V0003,不再等了.</li>
<li>继续推进官网备案,开始使用临时域名作为替代</li>
<li>依然需要等待LuatOS开发板就位</li>
<li>开始推进官网子模块的实现,如udplab</li>
<li>推进air724的基本集成</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20200927"><a href="#LuatOS-项目进展报告-20200927" class="headerlink" title="LuatOS 项目进展报告 - 20200927"></a>LuatOS 项目进展报告 - 20200927</h1><h2 id="本周进展-16"><a href="#本周进展-16" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-14"><a href="#Air302-14" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: SSL功能经讨论,新的mbedtls配置也是不可行的.至此,彻底放弃SSL功能</li>
<li>fix: nbiot.setEDRX方法是最后一个参数应支持字符串形式</li>
</ul>
<h3 id="LuatOS本身-3"><a href="#LuatOS本身-3" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>fix: lauxlib读取文件时使用的getc没有映射到luat_fs_getc. 其中air302受影响.</li>
<li>fix: 修正几个keil下才报的编译错误</li>
<li>fix: luat_i2c_rtt有个编译警告,修正一下吧</li>
</ul>
<h3 id="Air100st-9"><a href="#Air100st-9" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>update: i2s 预研</li>
</ul>
<h3 id="Air724"><a href="#Air724" class="headerlink" title="Air724"></a>Air724</h3><ul>
<li>update: 预研csdk发现几个严重的bug,等待解决</li>
</ul>
<h2 id="下周计划-16"><a href="#下周计划-16" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>待air302的i2c问题得到确认或解决后,发布V0003,时间定在国庆前.</li>
<li>继续推进官网备案</li>
<li>继续推进虚拟设备的编写</li>
<li>国庆后主推air100st的相关开发任务</li>
<li>协助飞思创开发w800的集成</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20200920"><a href="#LuatOS-项目进展报告-20200920" class="headerlink" title="LuatOS 项目进展报告 - 20200920"></a>LuatOS 项目进展报告 - 20200920</h1><h2 id="本周进展-17"><a href="#本周进展-17" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-15"><a href="#Air302-15" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 更新SDK v001.031的patch 1</li>
<li>update: 测试新的休眠唤醒判断代码(lua的)</li>
<li>change: 更新sdk后, 强制休眠将不能使用RTC唤醒</li>
</ul>
<h3 id="LuatOS本身-4"><a href="#LuatOS本身-4" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>update: 修正pwm相关逻辑</li>
<li>add: fs添加mount/umount/mkdir方法</li>
</ul>
<h3 id="Air100st-10"><a href="#Air100st-10" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: pwm可用</li>
<li>add: 支持挂载tf卡</li>
</ul>
<h3 id="Air640w-2"><a href="#Air640w-2" class="headerlink" title="Air640w"></a>Air640w</h3><ul>
<li>add: 支持纯mcu编译模式,禁用所有网络相关的代码,总可用内存达220kb</li>
<li>add: 支持挂载tf卡</li>
<li>update: 支持pwm设置</li>
</ul>
<h3 id="Air724-1"><a href="#Air724-1" class="headerlink" title="Air724"></a>Air724</h3><ul>
<li>update: 预研csdk发现几个严重的bug,等待解决</li>
</ul>
<h2 id="下周计划-17"><a href="#下周计划-17" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>周三发布V0003正式版,并到osc发新闻(又推迟到下周)</li>
<li>继续推进AT适配的相关设计工作</li>
<li>推进Air100st片上usb设备的适配</li>
<li>继续推进官网备案(又被打回重审了,心累)</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20200913"><a href="#LuatOS-项目进展报告-20200913" class="headerlink" title="LuatOS 项目进展报告 - 20200913"></a>LuatOS 项目进展报告 - 20200913</h1><h2 id="本周进展-18"><a href="#本周进展-18" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-16"><a href="#Air302-16" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: 格式化浮点数的bug</li>
<li>fix: nbiot.getEdrx的实现写成了set方法了</li>
<li>update: 放开uart1的rx功能</li>
<li>update: 仅主动开启AON后,才在休眠时启动AON配置.<a target="_blank" rel="noopener" href="https://gitee.com/openLuat/LuatOS/issues/I1U917">https://gitee.com/openLuat/LuatOS/issues/I1U917</a></li>
<li>update: luat_main无需参数了</li>
</ul>
<h3 id="Air100st-11"><a href="#Air100st-11" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>add: spi flash可用</li>
<li>add: usb slave模式(模拟成U盘),部分完成</li>
</ul>
<h3 id="LuatOS本身-5"><a href="#LuatOS本身-5" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>fix: mqtt.lua的pub_msg没反应 <a target="_blank" rel="noopener" href="https://gitee.com/openLuat/LuatOS/issues/I1TRE7">https://gitee.com/openLuat/LuatOS/issues/I1TRE7</a></li>
<li>fix: rtt环境下读取lua vm内存大小失败.原因是老的luat_meminfo_luavm没删掉</li>
<li>change: luat_main不再传参数了</li>
<li>add: sys的订阅功能支持多topic</li>
<li>add: 添加几个设计文档</li>
<li>add: 增加低功耗定时器运行监测，如果不是自己的定时器唤醒，则继续睡</li>
<li>add: 添加gpio.setDefaultPull方法</li>
</ul>
<h3 id="Air724-2"><a href="#Air724-2" class="headerlink" title="Air724"></a>Air724</h3><ul>
<li>add: 编译环境搭建完成,添加对应的bsp目录</li>
</ul>
<h2 id="下周计划-18"><a href="#下周计划-18" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>周一/周二发布V0003正式版,并到osc发新闻</li>
<li>继续推进AT适配的相关设计工作</li>
<li>推进Air100st片上设备的适配(i2c/spi/usb)</li>
<li>完成air724的核心适配(timer/msgbus/uart)</li>
<li>继续推进Air001虚拟设备的实现</li>
<li>继续推进官网备案</li>
</ul>
<hr>
<h1 id="LuatOS-项目进展报告-20200905"><a href="#LuatOS-项目进展报告-20200905" class="headerlink" title="LuatOS 项目进展报告 - 20200905"></a>LuatOS 项目进展报告 - 20200905</h1><h2 id="本周进展-19"><a href="#本周进展-19" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="Air302-17"><a href="#Air302-17" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: ctiot库, 支持中国电信的ctwing平台</li>
<li>add: 合并上游sdk v001.031.20200829</li>
<li>update: 返回更详细的开机原因</li>
</ul>
<h3 id="Air100st-12"><a href="#Air100st-12" class="headerlink" title="Air100st"></a>Air100st</h3><ul>
<li>update: 片上文件系统可用</li>
</ul>
<h3 id="LuatOS本身-6"><a href="#LuatOS本身-6" class="headerlink" title="LuatOS本身"></a>LuatOS本身</h3><ul>
<li>add: 通用的lua vm heap实现,平台无关</li>
<li>add: ctiot库的抽象实现</li>
</ul>
<h3 id="Air001-虚拟设备"><a href="#Air001-虚拟设备" class="headerlink" title="Air001(虚拟设备)"></a>Air001(虚拟设备)</h3><ul>
<li>add: 添加一个概念实现</li>
</ul>
<h3 id="官网-14"><a href="#官网-14" class="headerlink" title="官网"></a>官网</h3><ul>
<li>备案仍未完成</li>
<li>logo重新设计中</li>
</ul>
<h2 id="下周计划-19"><a href="#下周计划-19" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>继续与厂商调试air302的浮点数编译问题,完成后发布V0003正式版</li>
<li>启动AT适配的相关设计工作</li>
<li>推进Air100st片上设备的适配</li>
<li>推进Air001与mqtt的通信实现</li>
</ul>
<hr>
<h1 id="季度进度汇总及后续开发计划-2020-09-03"><a href="#季度进度汇总及后续开发计划-2020-09-03" class="headerlink" title="季度进度汇总及后续开发计划 2020-09-03"></a>季度进度汇总及后续开发计划 2020-09-03</h1><p>以下描述的模块适配和大功能的开发, 未包含LuatOS本身及社区的开发.</p>
<h2 id="Air302-18"><a href="#Air302-18" class="headerlink" title="Air302"></a>Air302</h2><ul>
<li>8月中,对外发布V0003 –&gt; 实际推迟到现在(9月初), 剩余1个关键的bug未解决</li>
<li>8月底,转入维护期 –&gt; 等待V0003的发布</li>
</ul>
<h2 id="Air640w-3"><a href="#Air640w-3" class="headerlink" title="Air640w"></a>Air640w</h2><ul>
<li>7月底,已转入维护期</li>
</ul>
<h2 id="Air100"><a href="#Air100" class="headerlink" title="Air100"></a>Air100</h2><ul>
<li>9月底,发布初始化版本 –&gt; 实际暂停中,未执行开发任务</li>
</ul>
<h2 id="Air100st-stm32f407"><a href="#Air100st-stm32f407" class="headerlink" title="Air100st(stm32f407)"></a>Air100st(stm32f407)</h2><ul>
<li>8月底,完成基本适配 –&gt; 延期到9月初,等待片上文件系统适配</li>
<li>9月底,完成开发板的适配,内部测试版 –&gt; 依然定于9月底, 需要完成USB/I2S的适配(视情况完成屏幕和摄像头的适配)</li>
<li>10月中, 对外发布初始版本</li>
<li>10月底, 完成一款应用, 功能经过测试的版本</li>
<li>11月中, 与AT适配进行结合,发布一个功能完善的版本</li>
</ul>
<h2 id="AT适配"><a href="#AT适配" class="headerlink" title="AT适配"></a>AT适配</h2><ul>
<li>9月中, 完成设计</li>
<li>9月底, 通用AT框架</li>
<li>10月中, 适配Air724UG系列</li>
<li>10月底, 适配Air720S系列,发布初始版本 – 取决于Air724UG适配的顺利程度</li>
<li>11月中, 适配EC20/EC200系列</li>
</ul>
<h2 id="Air001-虚拟设备-1"><a href="#Air001-虚拟设备-1" class="headerlink" title="Air001(虚拟设备)"></a>Air001(虚拟设备)</h2><ul>
<li>9月初, 完成设计</li>
<li>9月底, 完成原型</li>
<li>10月中, 设备端–&gt;mqtt–&gt;界面,跑通</li>
<li>11月中, 发布初始版本</li>
</ul>
<p>维护期 : 已实现主要开发任务,完成固件的对外发布, 往后以修正bug为主.</p>
<hr>
<h1 id="LuatOS-项目进展报告-20200830"><a href="#LuatOS-项目进展报告-20200830" class="headerlink" title="LuatOS 项目进展报告 - 20200830"></a>LuatOS 项目进展报告 - 20200830</h1><h2 id="本周进度"><a href="#本周进度" class="headerlink" title="本周进度"></a>本周进度</h2><h3 id="LuatOS-12"><a href="#LuatOS-12" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: ctiot的Lua API和平台抽象层API</li>
<li>add: 虚拟设备的部分设计文档</li>
<li>move: 整理代码,把luat/w60x的全部源码搬到bsp/air640w/rtt/applications</li>
</ul>
<h3 id="Air302-19"><a href="#Air302-19" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: ctiot的平台层实现</li>
<li>change: 调整几个AON GPIO相关的调用</li>
<li>update: 浮点数格式化的问题有解决的希望了</li>
</ul>
<h3 id="Air100-amp-Air100st"><a href="#Air100-amp-Air100st" class="headerlink" title="Air100 &amp; Air100st"></a>Air100 &amp; Air100st</h3><ul>
<li>update: 片上文件系统未完成</li>
</ul>
<h2 id="下周计划-20"><a href="#下周计划-20" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>air302合并新版sdk v001.031.20200829</li>
<li>air302解决浮点数格式化的问题</li>
<li>测试ctiot的实现</li>
<li>完成虚拟设备的原型设计并尝试实现</li>
<li>完成air100st的片上文件系统</li>
<li>设计lua vm的debug机制</li>
</ul>
<h1 id="LuatOS-项目进展报告-20200823"><a href="#LuatOS-项目进展报告-20200823" class="headerlink" title="LuatOS 项目进展报告 - 20200823"></a>LuatOS 项目进展报告 - 20200823</h1><h2 id="本周进展-20"><a href="#本周进展-20" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-13"><a href="#LuatOS-13" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 为air640w添加个how_to_build.md的文档</li>
<li>add: 添加对虚拟设备的一些想法及概念验证</li>
<li>fix: lua-cjson里面有编译错误</li>
<li>fix: luat_shell执行loadstr出错时,应该打印出出错原因</li>
<li>fix: 修正几个编译警告</li>
<li>fix: 修正l_crypto_crc16的一个小的编译警告</li>
<li>update: 整理rtt的SConscript文件</li>
<li>update: 解包mqtt数据时使用移位运算符更好一些</li>
<li>change: pack.unpack解出整数时,应该返回整数,而非浮点数</li>
<li>change: 改变w60x/air640w的编译方式,移除子模块</li>
</ul>
<h3 id="Air302-20"><a href="#Air302-20" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: Air302的spi功能和demo</li>
<li>add: Air302的远程升级demo</li>
<li>fix: os.remove不能删除文件</li>
</ul>
<h3 id="Air100-amp-Air100st-1"><a href="#Air100-amp-Air100st-1" class="headerlink" title="Air100 &amp; Air100st"></a>Air100 &amp; Air100st</h3><ul>
<li>update: Air100的移植先暂缓</li>
<li>update: Air100st uart/外挂spi flash可用</li>
</ul>
<h2 id="下周计划-21"><a href="#下周计划-21" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>争取发布Air302的V0003,并在OSC发新闻稿</li>
<li>继续完成Air100st的集成</li>
<li>修正Air302浮点数格式化的bug</li>
<li>完善虚拟模块Air001的设计</li>
<li>继续推进lwm2m库的完成</li>
<li>周例会定于每周一下午2点,时长约30分钟</li>
<li>推进air724UG</li>
</ul>
<h1 id="LuatOS-项目进度报告-20200816"><a href="#LuatOS-项目进度报告-20200816" class="headerlink" title="LuatOS 项目进度报告 - 20200816"></a>LuatOS 项目进度报告 - 20200816</h1><h2 id="本周进度-1"><a href="#本周进度-1" class="headerlink" title="本周进度"></a>本周进度</h2><h3 id="LuatOS-14"><a href="#LuatOS-14" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>fix: mklfs生成文件系统的bug</li>
<li>fix: 日志应该以\r\n结尾 <a target="_blank" rel="noopener" href="https://gitee.com/openLuat/LuatOS/issues/I1QYUH">https://gitee.com/openLuat/LuatOS/issues/I1QYUH</a></li>
<li>fix: 加上spi接口的返回值</li>
<li>add: 为netclient_send添加额外的flags参数</li>
<li>add: bsp/air100st</li>
<li>add: crypto库支持aes的解密, 并添加demo</li>
<li>add: 添加fs库,用于执行文件系统相关的操作,当前仅支持查询磁盘空间大小</li>
<li>add: 使得rtt下也支持fs模块</li>
</ul>
<h3 id="Air302-21"><a href="#Air302-21" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>fix: 修改netclient,真正支持PSM模式, 并添加PSM模式下TCP长连接的demo</li>
<li>fix: aes加密/解密会内存泄漏</li>
<li>fix: 底层sdk返回的block_used按字节计算,明显是bug呀</li>
<li>add: 添加luat_fs_info方法,用于获取文件系统的使用情况</li>
<li>update: 唤醒时不要调用appGetECBCInfoSync,起码减少2秒启动时间</li>
<li>update: 按移芯的建议,修改tcpipConnectionSend的raininfo参数, 进入休眠的时长减少到2秒</li>
<li>update: spi库调试中,未成功</li>
<li>update: lwm2m库仍在开发中</li>
</ul>
<h3 id="air100"><a href="#air100" class="headerlink" title="air100"></a>air100</h3><ul>
<li>update: sdk就绪, 移植工作未完成</li>
</ul>
<h3 id="air100st"><a href="#air100st" class="headerlink" title="air100st"></a>air100st</h3><ul>
<li>update: 添加bsp并编译ok,为下一步集成做准备</li>
</ul>
<h3 id="官网-15"><a href="#官网-15" class="headerlink" title="官网"></a>官网</h3><ul>
<li>add: 临时官网地址 <a target="_blank" rel="noopener" href="https://luatos.vue2.cn/">https://luatos.vue2.cn/</a></li>
</ul>
<h2 id="下周计划-22"><a href="#下周计划-22" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>继续推进官网的备案</li>
<li>继续推进air302剩余的工作(spi和lwm2m库)</li>
<li>集成并测试air100st临时开发板的板载资源</li>
<li>推进air100的sdk移植</li>
</ul>
<p>#LuatOS 项目进度报告 - 20200807</p>
<p>本周重点: 发布air302的V0003预览测试版及SDK</p>
<h2 id="本周进度-2"><a href="#本周进度-2" class="headerlink" title="本周进度"></a>本周进度</h2><h3 id="LuatOS-15"><a href="#LuatOS-15" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 测试完成OTA机制,发布公测版</li>
<li>change: http非200响应也读取body</li>
</ul>
<h3 id="Air302-22"><a href="#Air302-22" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: OTA机制,可使用iot.openluat.com进行升级</li>
<li>add: http文件下载</li>
<li>add: sdk,供用户自行编译LuatOS@Air302固件</li>
<li>add: V0003测试预览版</li>
</ul>
<h3 id="Air640"><a href="#Air640" class="headerlink" title="Air640"></a>Air640</h3><ul>
<li>add: OTA机制,暂时只能使用第三方升级服务</li>
</ul>
<h3 id="官网-16"><a href="#官网-16" class="headerlink" title="官网"></a>官网</h3><ul>
<li>首页UI设计完成</li>
</ul>
<h2 id="下周计划-23"><a href="#下周计划-23" class="headerlink" title="下周计划"></a>下周计划</h2><ul>
<li>推进air302的lwm2m库的开发和测试</li>
<li>推进air302的spi库的测试</li>
<li>推进官网备案</li>
<li>推进官网服务器的准备</li>
<li>推进LuatOS开发板的设计工作</li>
<li>预研Air100适配v2版API</li>
<li>预研Lua静态字符串池</li>
</ul>
<p>#LuatOS 项目进度报告 - 20200802</p>
<h2 id="本周进度-3"><a href="#本周进度-3" class="headerlink" title="本周进度"></a>本周进度</h2><h3 id="LuatOS-16"><a href="#LuatOS-16" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 脚本的OTA机制(测试中)</li>
<li>add: libgnss 测试通过,合并到主干</li>
<li>add: 添加wlan的api文档</li>
<li>add: 添加类似于一型一密的阿里云物联网平台的demo,使用regproxy实现</li>
<li>add: http库的rtt实现</li>
<li>fix: rtt版netclient的CONNECT标识有错误</li>
<li>fix: hmac_sha1/hmac_md5的rtt+硬件加速版本有bug,修正一下</li>
<li>change: 改luaconf.h,统一用32bits!!</li>
<li>add: api v2版(讨论中)</li>
</ul>
<h3 id="Air302-23"><a href="#Air302-23" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>release: 发布V0002版</li>
<li>add: http的下载功能</li>
<li>add: 适配脚本的OTA功能</li>
<li>change: 开放uart0给用户使用</li>
<li>fix: 修正几个客户反馈的小bug</li>
<li>update: lwm2m库的重新设计</li>
</ul>
<h3 id="Air640w-4"><a href="#Air640w-4" class="headerlink" title="Air640w"></a>Air640w</h3><ul>
<li>release: 发布V0002版</li>
<li>add: 网页配网/oneshot配网</li>
<li>change: 脚本区扩展到256kb</li>
<li>change: 适配脚本OTA机制</li>
</ul>
<h3 id="STM32F407"><a href="#STM32F407" class="headerlink" title="STM32F407"></a>STM32F407</h3><ul>
<li>梳理开发板需求</li>
</ul>
<h3 id="下周计划-24"><a href="#下周计划-24" class="headerlink" title="下周计划"></a>下周计划</h3><ul>
<li>详细测试脚本OTA机制</li>
<li>推进官网设计和开发,还有就是备案</li>
<li>推进lwm2m的实现和测试</li>
<li>推进stm32f407开发板</li>
<li>推进api v2版的讨论</li>
<li>为月中的V0003做准备</li>
</ul>
<h1 id="LuatOS-项目进展报告-20200726"><a href="#LuatOS-项目进展报告-20200726" class="headerlink" title="LuatOS 项目进展报告 - 20200726"></a>LuatOS 项目进展报告 - 20200726</h1><h2 id="本周进展-21"><a href="#本周进展-21" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-17"><a href="#LuatOS-17" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: crypto支持crc系列校验值/aes系列加密算法</li>
<li>add: 抽取luat_shell到LuatOS</li>
<li>change: 使用Paland.printf替换原有的custom_vsprintf,解决一系列格式化的bug</li>
<li>add: 添加32bits的luac.exe并修改air302.py</li>
<li>update: lwm2m的lua api设计(未完成)</li>
<li>update: libgnss的重新实现(测试未通过,不合并)</li>
</ul>
<h3 id="Air302-24"><a href="#Air302-24" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>change: 改为使用32bits的整型和浮点数</li>
<li>add: 适配抽象后的luat_shell</li>
</ul>
<h2 id="STM32"><a href="#STM32" class="headerlink" title="STM32"></a>STM32</h2><ul>
<li>开发板设计中</li>
</ul>
<h2 id="官网-17"><a href="#官网-17" class="headerlink" title="官网"></a>官网</h2><ul>
<li>UI设计中</li>
</ul>
<h2 id="下周计划-25"><a href="#下周计划-25" class="headerlink" title="下周计划"></a>下周计划</h2><h3 id="LuatOS-18"><a href="#LuatOS-18" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>设计: 官网UI设计</li>
<li>开发: lwm2m的实现</li>
<li>开发: ota机制的实现</li>
</ul>
<h1 id="LuatOS-项目进展报告-20200719"><a href="#LuatOS-项目进展报告-20200719" class="headerlink" title="LuatOS 项目进展报告 - 20200719"></a>LuatOS 项目进展报告 - 20200719</h1><h2 id="本周进展-22"><a href="#本周进展-22" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-19"><a href="#LuatOS-19" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: 新的api文档 <a target="_blank" rel="noopener" href="https://gitee.com/openLuat/LuatOS/blob/master/docs/api/lua/README.md">https://gitee.com/openLuat/LuatOS/blob/master/docs/api/lua/README.md</a></li>
<li>add: lpmem库的lua api层, 此为模块用于操作低功耗模式下的不掉电内存块</li>
<li>add: 改善air302的demo</li>
<li>add: mqtt的协议编解码使用C实现</li>
</ul>
<h3 id="Air302-25"><a href="#Air302-25" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>update: 底层SDK更新到v001.029.20190709</li>
<li>add: lpmem的air302实现</li>
<li>change: 调整内存布局为方案1: sys 30k, luavm 78kb</li>
</ul>
<h2 id="下周计划-26"><a href="#下周计划-26" class="headerlink" title="下周计划"></a>下周计划</h2><h3 id="LuatOS-20"><a href="#LuatOS-20" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>设计: stm32开发板需求</li>
<li>设计: lwm2m的lua api设计</li>
<li>设计: 官网UI设计</li>
<li>测试: mqtt协议深入</li>
<li>开发: crc/aes支持</li>
<li>修复: string.format和require的bug</li>
</ul>
<h3 id="Air302-26"><a href="#Air302-26" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>设计: update机制及部分实现</li>
<li>开发: http库,下载文件到文件系统</li>
<li>开发: cwting平台的lwm2m或通用lwm2m,待讨论</li>
<li>测试: spi接口api</li>
</ul>
<h1 id="LuatOS-项目进展报告-20200710"><a href="#LuatOS-项目进展报告-20200710" class="headerlink" title="LuatOS 项目进展报告 - 20200710"></a>LuatOS 项目进展报告 - 20200710</h1><p>尴尬的一周,LuatOS团队为支持阿里云的一型一密, 花费大量时间实现https,结果只能禁用之.<br>情况是这样:<br>要支持阿里云一型一密–&gt;需要支持https请求(因为动态注册的url只支持https)–&gt;需要http库及mbedtls支持(https需要加密库)–&gt;需要更多系统内存(mbedtls内存需求大)–&gt;压缩luavm的内存–&gt;luavm低于所需的最低限度,无法跑mqtt.lua</p>
<p>后续解决方向: 纯C的mqtt库</p>
<h2 id="本周进展-23"><a href="#本周进展-23" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-21"><a href="#LuatOS-21" class="headerlink" title="LuatOS"></a>LuatOS</h3><ul>
<li>add: disp支持中文字库</li>
<li>add: http库</li>
<li>add: API文档解析器基本完成</li>
<li>fix: air302.py的一些错误</li>
<li>fix: tostring在air302下返回错误的字符串</li>
</ul>
<h3 id="Air302-27"><a href="#Air302-27" class="headerlink" title="Air302"></a>Air302</h3><ul>
<li>add: 适配http库,支持https但内存尴尬,当前禁用https</li>
<li>add: pm低功耗模块支持force和check方法</li>
<li>add: 支持飞行模式</li>
<li>add: nbiot库添加更多网络信息</li>
<li>fix: gpio.get返回错误的值</li>
</ul>
<h1 id="LuatOS-项目进展报告-20200703"><a href="#LuatOS-项目进展报告-20200703" class="headerlink" title="LuatOS 项目进展报告 - 20200703"></a>LuatOS 项目进展报告 - 20200703</h1><h2 id="本周进展-24"><a href="#本周进展-24" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-22"><a href="#LuatOS-22" class="headerlink" title="LuatOS"></a>LuatOS</h3><p>add: 添加libgnss库,处理nmea数据,对接GPS模块(例如Air530),但不含agps和星历<br>update: sensor库抽象为底层无关的库<br>fix: 修正air302.py的几个错误</p>
<h3 id="Air302-28"><a href="#Air302-28" class="headerlink" title="Air302"></a>Air302</h3><p>fix: 休眠唤醒后需要主动获取联网数据<br>fix: uart2使用非115200时乱码<br>fix: netclient在域名解析成功但连接失败时未清理干净<br>fix: gpio设置上拉没有起作用<br>add: 引用libgnss库,处理nmea数据<br>add: 引用sensor库</p>
<h3 id="新的Wifi-BLE模块"><a href="#新的Wifi-BLE模块" class="headerlink" title="新的Wifi/BLE模块"></a>新的Wifi/BLE模块</h3><p>add: 基础项目结构完成</p>
<h1 id="LuatOS-项目进展报告-20200628"><a href="#LuatOS-项目进展报告-20200628" class="headerlink" title="LuatOS 项目进展报告 - 20200628"></a>LuatOS 项目进展报告 - 20200628</h1><h2 id="本周进展-25"><a href="#本周进展-25" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-23"><a href="#LuatOS-23" class="headerlink" title="LuatOS"></a>LuatOS</h3><ol>
<li>i2c添加readReg方法</li>
<li>添加pm模块的lua库代码</li>
<li>rtt版的socket实现,支持UDP通信</li>
<li>重构C LOG API</li>
<li>添加libcoap库</li>
</ol>
<h3 id="Air302-29"><a href="#Air302-29" class="headerlink" title="Air302"></a>Air302</h3><ol>
<li>禁用信号强度更新的日志,使模块能进入低功耗模式</li>
<li>添加低功耗模式的实现代码</li>
<li>添加UDP通信的代码</li>
<li>修正dns解析失败后netclient有错误的bug</li>
<li>调整lpmem库的首地址和长度</li>
<li>扩展uart1的shell功能,支持更多命令</li>
<li>验证i2c库读取光强度传感器opt3001</li>
<li>引用并验证libcoap库的使用</li>
<li>添加全新的air302.py脚本,实现在命令行下的编译/刷机/打包</li>
</ol>
<h1 id="LuatOS-项目进度报告-20200619"><a href="#LuatOS-项目进度报告-20200619" class="headerlink" title="LuatOS 项目进度报告 - 20200619"></a>LuatOS 项目进度报告 - 20200619</h1><h2 id="本周进展-26"><a href="#本周进展-26" class="headerlink" title="本周进展"></a>本周进展</h2><h3 id="LuatOS-24"><a href="#LuatOS-24" class="headerlink" title="LuatOS"></a>LuatOS</h3><ol>
<li>抽象disp库,添加对SSD1306的软件I2C支持. 换句话说,只要支持了GPIO,就起码能驱动SSD1306</li>
<li>解决一个内存异常的老bug,涉及lauxlib的resizebox方法</li>
<li>gpio.setup返回闭包,并修正OUTPUT模式下的初始值错误</li>
<li>添加rtos.meminfo(),返回luavm和系统的内存使用情况</li>
</ol>
<h3 id="Air302-30"><a href="#Air302-30" class="headerlink" title="Air302"></a>Air302</h3><ol>
<li>添加i2c实现</li>
<li>添加spi实现</li>
<li>修正vbat电压值错误</li>
<li>修改GPIO17的PWM错误</li>
<li>适配LuatOS对disp库的修正</li>
<li>适配LuaTools的信号值获取</li>
<li>适配LuaTools的rtos.meminfo()</li>
</ol>
<h3 id="新的Wifi-BLE模块-1"><a href="#新的Wifi-BLE模块-1" class="headerlink" title="新的Wifi/BLE模块"></a>新的Wifi/BLE模块</h3><ol>
<li>未完成heap和文件系统的适配</li>
</ol>
<h3 id="Air640W"><a href="#Air640W" class="headerlink" title="Air640W"></a>Air640W</h3><ol>
<li>支持disp库的软件i2c模式</li>
</ol>
<h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><ol>
<li>在码云建立openLuat组织,将相关项目迁入</li>
<li>为LuatOS申请GVP,并成功获得认证</li>
</ol>
<h2 id="下周计划-27"><a href="#下周计划-27" class="headerlink" title="下周计划"></a>下周计划</h2><ol>
<li>Air302的pm低功耗模块, coap或lwm2m模块, aliyun sdk模块</li>
<li>解决Air302的i2c/spi/io模块存在的bug</li>
<li>推进LuaTools对Air302的适配</li>
<li>测试Air302的lpmem模块的可靠性</li>
</ol>
<hr>
<hr>
<h1 id="LuatOS-项目进度报告-20200612"><a href="#LuatOS-项目进度报告-20200612" class="headerlink" title="LuatOS 项目进度报告 - 20200612"></a>LuatOS 项目进度报告 - 20200612</h1><h2 id="LuatOS整体"><a href="#LuatOS整体" class="headerlink" title="LuatOS整体"></a>LuatOS整体</h2><h3 id="本周已完成"><a href="#本周已完成" class="headerlink" title="本周已完成"></a>本周已完成</h3><ol>
<li><code>adc</code>/<code>pwm</code>/<code>crypto</code>库的抽象设计和实现</li>
</ol>
<h3 id="下周计划完成"><a href="#下周计划完成" class="headerlink" title="下周计划完成"></a>下周计划完成</h3><ol>
<li><code>m2m</code>库的抽象设计</li>
<li>继续推进<code>luatos.com</code>备案</li>
</ol>
<h2 id="Air302-NBIOT芯片"><a href="#Air302-NBIOT芯片" class="headerlink" title="Air302 NBIOT芯片"></a>Air302 NBIOT芯片</h2><p>该模块为当前的重点开发任务</p>
<h3 id="固件版本V0001-20200612"><a href="#固件版本V0001-20200612" class="headerlink" title="固件版本V0001_20200612"></a>固件版本V0001_20200612</h3><p>模块尚未正式发售,固件只推送给种子用户</p>
<ol>
<li>总体进度估算, 已完成50%</li>
<li>硬件层, 70%可用</li>
<li>应用层, 20%可用</li>
</ol>
<h3 id="本周已完成-1"><a href="#本周已完成-1" class="headerlink" title="本周已完成"></a>本周已完成</h3><ol>
<li>硬件层已完成 <code>uart</code>/<code>gpio</code>/<code>pwm</code>/<code>adc</code>/<code>crypto</code> 的适配</li>
<li>应用层已完成 <code>socket</code>/<code>mqtt</code> 的适配, 已可以连接阿里云物联网</li>
</ol>
<h3 id="下周计划完成-1"><a href="#下周计划完成-1" class="headerlink" title="下周计划完成"></a>下周计划完成</h3><ol>
<li>硬件层,适配<code>spi</code>/<code>i2c</code></li>
<li>应用层,适配<code>aliyun物联网sdk</code></li>
<li>解决客户反馈的bug</li>
</ol>
<h2 id="Air640W-wifi芯片"><a href="#Air640W-wifi芯片" class="headerlink" title="Air640W wifi芯片"></a>Air640W wifi芯片</h2><h3 id="本周无固件版本发布"><a href="#本周无固件版本发布" class="headerlink" title="本周无固件版本发布"></a>本周无固件版本发布</h3><ol>
<li>从功能上说, 已完成90%的适配任务</li>
</ol>
<h3 id="本周已完成-2"><a href="#本周已完成-2" class="headerlink" title="本周已完成"></a>本周已完成</h3><ol>
<li><code>crypto</code>库的md5/sha1的硬件加速, 支持无加密的阿里云mqtt连接</li>
</ol>
<h3 id="下周计划完成-2"><a href="#下周计划完成-2" class="headerlink" title="下周计划完成"></a>下周计划完成</h3><ol>
<li><code>crypto</code>库支持sha256/sha512/aes/3des, 由社区推动.</li>
<li><code>pwm</code> 适配, 由社区推动.</li>
</ol>
<h2 id="新的Wifi-BLE芯片"><a href="#新的Wifi-BLE芯片" class="headerlink" title="新的Wifi/BLE芯片"></a>新的Wifi/BLE芯片</h2><p>该厂商的信息暂时保密^_^</p>
<h3 id="本周已完成-3"><a href="#本周已完成-3" class="headerlink" title="本周已完成"></a>本周已完成</h3><ol>
<li>环境搭建,编译/下载ok</li>
<li>调研移植的难点和工作量</li>
</ol>
<h3 id="下周计划完成-3"><a href="#下周计划完成-3" class="headerlink" title="下周计划完成"></a>下周计划完成</h3><ol>
<li>移植文件系统littlefs,或者先用ROMFS,待定</li>
<li>移植一款heap实现,使用heap_4或者rtt版本修改而成</li>
<li>把LuatOS核心跑起来</li>
</ol>
<h1 id="全景图"><a href="#全景图" class="headerlink" title="全景图"></a>全景图</h1><p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200612221205656_LuatOS_weekly_20200612.png"></p>
<p>较之前的版本又长出了几个分支^_^</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/12/846/" data-id="ckkfmdgf200eavkcg858w2nuj" data-title="LuatOS 项目进度(20210124更新)" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-835" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/09/835/" class="article-date">
  <time class="dt-published" datetime="2020-06-09T02:17:43.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/09/835/">合宙Air720U和724U系列模块实网功耗数据</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <table style="display: block; width: 910.014px; overflow: auto; word-break: keep-all; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, Helvetica, &quot;Meiryo UI&quot;, &quot;Malgun Gothic&quot;, &quot;Segoe UI&quot;, &quot;Trebuchet MS&quot;, Monaco, monospace, Tahoma, STXihei, 华文细黑, STHeiti, &quot;Helvetica Neue&quot;, &quot;Droid Sans&quot;, &quot;wenquanyi micro hei&quot;, FreeSans, Arimo, Arial, SimSun, 宋体, Heiti, 黑体, sans-serif; margin-top: 0px !important; margin-bottom: 0px !important;"><thead><tr style="background-color: rgb(248, 248, 248); border-top: 1px solid rgb(204, 204, 204);"><th style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">型号</th><th style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">8910系列模块</th></tr></thead><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">测试项</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">数值</td></tr><tr style="background-color: rgb(248, 248, 248); border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">静态电流</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">30 uA</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">飞行模式</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">1.25 mA</td></tr><tr style="background-color: rgb(248, 248, 248); border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">休眠电流</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">1.65 mA</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">工作电流</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">12.86 mA</td></tr><tr style="background-color: rgb(248, 248, 248); border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">模拟应用场景(TCP连接频率：1分钟一次)</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">9.7 mA</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">模拟应用场景(TCP连接频率：5分钟一次)</td><td style="padding: 6px 13px; border: 1px solid rgb(221, 221, 221);">3.58 mA</td></tr></tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/09/835/" data-id="ckkfmdgdk00bvvkcghp9mfevx" data-title="合宙Air720U和724U系列模块实网功耗数据" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-792" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/04/792/" class="article-date">
  <time class="dt-published" datetime="2020-06-04T08:20:24.000Z" itemprop="datePublished">2020-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/04/792/">Cron定时执行库</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>直接上代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--新建cron对象</span></span><br><span class="line"><span class="keyword">local</span> c = cron.Cron()</span><br><span class="line"><span class="comment">--设置回调，不要让这个函数被阻塞</span></span><br><span class="line">c:SetCallBack(<span class="function"><span class="keyword">function</span> <span class="params">(_,name)</span></span></span><br><span class="line">    <span class="comment">--回调函数返回的是这个cron的唯一名称</span></span><br><span class="line">    <span class="built_in">log</span>.info(<span class="string">&quot;cron trigger&quot;</span>, name)</span><br><span class="line">    <span class="comment">--打印这个cron的配置</span></span><br><span class="line">    <span class="built_in">log</span>.info(<span class="string">&quot;cron info&quot;</span>, name, c:Get(name))</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">sys.taskInit(<span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    <span class="comment">--检查是否已经初始化（时间已同步）</span></span><br><span class="line">    <span class="comment">--如果是2g模块，记得同步时间</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> c:Initial() <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">log</span>.info(<span class="string">&quot;initial&quot;</span>,<span class="string">&quot;waiting&quot;</span>)</span><br><span class="line">        sys.wait(<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">log</span>.info(<span class="string">&quot;cron initial&quot;</span>, <span class="string">&quot;done&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">--每分钟执行一次</span></span><br><span class="line">    <span class="comment">--负号代表*/</span></span><br><span class="line">    <span class="comment">--Add: (name,min,day,mon,year,week)</span></span><br><span class="line">    <span class="comment">--名称必须为唯一值</span></span><br><span class="line">    <span class="comment">--时间参数均可为空，默认为-1</span></span><br><span class="line">    c:Add(<span class="string">&quot;test every 1 minute&quot;</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">--每两分钟执行一次</span></span><br><span class="line">    c:Add(<span class="string">&quot;test every 2 minutes&quot;</span>,<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">--每小时45分种时执行一次</span></span><br><span class="line">    c:Add(<span class="string">&quot;test at 45 minute&quot;</span>,<span class="number">45</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">--打印所有cron的配置</span></span><br><span class="line">    <span class="keyword">local</span> list = c:List()</span><br><span class="line">    <span class="keyword">for</span> i=<span class="number">1</span>,#list <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">log</span>.info(<span class="string">&quot;cron info&quot;</span>, list[i], c:Get(list[i]))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<h1 id="库"><a href="#库" class="headerlink" title="库"></a>库</h1><p>点我下载<a target="_blank" rel="noopener" href="https://1dv.papapoi.com/luat/lua%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81/moonscript/cron.lua">cron.lua</a></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><p>本库使用moonscript编写，点我下载<a target="_blank" rel="noopener" href="https://1dv.papapoi.com/luat/lua%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81/moonscript/cron.moon">cron.moon</a>：</p>
<figure class="highlight moon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--定时器组件</span></span><br><span class="line"><span class="built_in">module</span> ..., <span class="built_in">package</span>.seeall</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Cron</span></span></span><br><span class="line">    <span class="comment">--是否初始化完成</span></span><br><span class="line">    <span class="name">initial</span>: <span class="literal">false</span></span><br><span class="line">    <span class="comment">--待处理的事件篮子</span></span><br><span class="line">    <span class="name">basket</span>: &#123;&#125;</span><br><span class="line">    <span class="comment">--回调函数</span></span><br><span class="line">    <span class="name">cbFunc</span>: <span class="literal">nil</span></span><br><span class="line">    <span class="comment">--是否开启</span></span><br><span class="line">    <span class="name">enable</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">--检查时间是否匹配</span></span><br><span class="line"><span class="function">    <span class="title">check</span> = <span class="params">(set,time)</span>-&gt;</span></span><br><span class="line">        <span class="keyword">if</span> set &lt; <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> time%(-set) == <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> set == time</span><br><span class="line"></span><br><span class="line">    <span class="comment">--循环执行检查，一分钟一次</span></span><br><span class="line">    <span class="name">run</span>: <span class="function">=&gt;</span></span><br><span class="line">        sys.taskInit -&gt;</span><br><span class="line">            <span class="built_in">next</span> = (<span class="built_in">os</span>.date <span class="string">&quot;*t&quot;</span>).sec</span><br><span class="line">            sys.wait (<span class="number">60</span>-<span class="built_in">next</span>)*<span class="number">1000</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">unless</span> @enable<span class="comment">--对象停止后结束任务</span></span><br><span class="line">                t = <span class="built_in">os</span>.date <span class="string">&quot;*t&quot;</span></span><br><span class="line">                <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span> @basket</span><br><span class="line">                    <span class="keyword">if</span> (check v.min,t.min) <span class="keyword">and</span></span><br><span class="line">                        (check v.day,t.day) <span class="keyword">and</span></span><br><span class="line">                        (check v.mon,t.month) <span class="keyword">and</span></span><br><span class="line">                        (check v.year,t.year) <span class="keyword">and</span></span><br><span class="line">                        (check v.week,t.wday)</span><br><span class="line">                        @cbFunc i <span class="keyword">if</span> @cbFunc</span><br><span class="line">                <span class="built_in">next</span> = (<span class="built_in">os</span>.date <span class="string">&quot;*t&quot;</span>).sec</span><br><span class="line">                sys.wait (<span class="number">61</span>-<span class="built_in">next</span>)*<span class="number">1000</span><span class="comment">--+1s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">--定时器初始化</span></span><br><span class="line">    <span class="name">Initial</span>: <span class="function">=&gt;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span> <span class="keyword">if</span> @initial</span><br><span class="line">        <span class="comment">--开机后默认时间肯定是2020年之前</span></span><br><span class="line">        @initial = (<span class="built_in">os</span>.date <span class="string">&quot;*t&quot;</span>).year &gt;= <span class="number">2020</span></span><br><span class="line">        @run! <span class="keyword">if</span> @initial</span><br><span class="line">        @initial</span><br><span class="line"></span><br><span class="line">    <span class="comment">--新建对象后的事件</span></span><br><span class="line">    <span class="comment">--新建的时候顺带检查一下初始化状态</span></span><br><span class="line">    <span class="name">new</span>: <span class="function">=&gt;</span></span><br><span class="line">        @Initial!</span><br><span class="line"></span><br><span class="line">    <span class="comment">--设置回调函数</span></span><br><span class="line">    <span class="comment">--定时器触发后，会调用该函数</span></span><br><span class="line">    <span class="name">SetCallBack</span>: <span class="function"><span class="params">(func)</span> =&gt;</span></span><br><span class="line">        @cbFunc = func</span><br><span class="line"></span><br><span class="line">    <span class="comment">--添加要执行的cron事件</span></span><br><span class="line">    <span class="comment">--name为定时器名称，唯一值，不可重复</span></span><br><span class="line">    <span class="name">Add</span>: <span class="function"><span class="params">(name,min=<span class="number">-1</span>,hour=<span class="number">-1</span>,day=<span class="number">-1</span>,mon=<span class="number">-1</span>,year=<span class="number">-1</span>,week=<span class="number">-1</span>)</span> =&gt;</span></span><br><span class="line">        @basket[name] = &#123;:min,:hour,:day,:mon,:year,:week&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">--去掉cron事件</span></span><br><span class="line">    <span class="comment">--name为定时器名称，唯一值，不可重复</span></span><br><span class="line">    <span class="name">Del</span>: <span class="function"><span class="params">(name)</span> =&gt;</span></span><br><span class="line">        @basket[name] = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">--查看cron事件配置</span></span><br><span class="line">    <span class="comment">--name为定时器名称，唯一值，不可重复</span></span><br><span class="line">    <span class="name">Get</span>: <span class="function"><span class="params">(name)</span> =&gt;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">unless</span> @basket[name]</span><br><span class="line">        @basket[name].min,@basket[name].day,@basket[name].mon,@basket[name].year,@basket[name].week</span><br><span class="line"></span><br><span class="line">    <span class="comment">--获取cron名称列表</span></span><br><span class="line">    <span class="name">List</span>: <span class="function">=&gt;</span></span><br><span class="line">        k = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">pairs</span> @basket</span><br><span class="line">            <span class="built_in">table</span>.insert k,i</span><br><span class="line">        k</span><br><span class="line"></span><br><span class="line">    <span class="comment">--销毁对象，停止所有定时器任务</span></span><br><span class="line">    <span class="name">Distory</span>: <span class="function">=&gt;</span></span><br><span class="line">        @enable = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/04/792/" data-id="ckkfmdgdk00bwvkcgdeqd7mu8" data-title="Cron定时执行库" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-791" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/04/791/" class="article-date">
  <time class="dt-published" datetime="2020-06-04T07:22:51.000Z" itemprop="datePublished">2020-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/04/791/">手把手教你用Air724UG做一个Weather APP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="首先来看一下效果展示"><a href="#首先来看一下效果展示" class="headerlink" title="首先来看一下效果展示"></a>首先来看一下效果展示</h2><p><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200609173824830_view.JPG" alt="view" title="view"><br><strong>相关的代码可在文后找到</strong></p>
<h2 id="0-准备工作"><a href="#0-准备工作" class="headerlink" title="0.准备工作"></a>0.准备工作</h2><ul>
<li>相关硬件：</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200609174211994_%E5%87%86%E5%A4%87%E7%A1%AC%E4%BB%B6.JPG"></li>
<li>一块合宙商城购买的Air724UG开发板</li>
<li>一块LCD屏幕，驱动为gc9106l或st7735或其他</li>
<li>一个speaker（扬声器）</li>
<li>软件环境：</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200609174346817_software.png"></li>
<li>Core版本：Luat_V0014_RDA8910_TTS</li>
<li>Lib版本：script_LuaTask_V2.3.2</li>
<li>功能设计：</li>
<li>从墨迹天气API获取实况天气</li>
<li>将实况天气通过屏幕显示</li>
<li>将实况天气通过语音的方式进行播报</li>
<li>分析可知应该分别使用http，disp，audio这三个模块来实现这三个功能</li>
<li>首先创建一个空文件夹作为工程目录，放入屏幕驱动文件（color_lcd_spi_gc9106l.lua/color_lcd_spi_st7735.lua）</li>
<li>创建两个文件，一个名字为main.lua用来放置一些基本代码，内容如下</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607180912988_code.png" alt="main.lua" title="main.lua"></li>
<li>还有一个文件名字可以自定义，我这里叫getWeatherAndDisplay.lua，在这个文件的开头写下面这一行代码，用来使得文件中的函数在何处都可调用。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607180958561_code.png" alt="seeanywhere" title="seeanywhere"></li>
</ul>
<h2 id="1-获取天气信息"><a href="#1-获取天气信息" class="headerlink" title="1.获取天气信息"></a>1.获取天气信息</h2><ul>
<li>天气信息的获取这里我使用阿里云市场中免费的墨迹天气API。</li>
<li>获取天气可以通过lbs基站定位得到经纬度再使用墨迹天气经纬度版本进行天气查询。</li>
<li>但是为了简单，这里我使用对应cityID（城市ID)的方式来获取天气情况。:point_right:<a target="_blank" rel="noopener" href="https://market.aliyun.com/products/57096001/cmapi023656.html?spm=5176.2020520132.101.7.43247218rReOAl#sku=yuncode1765600000" title="购买地址戳我">获取地址戳我</a>，购买之后在阿里云的控制台中的云市场中就可以找到我们购买的天气API</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200604141807422_moji.png"></li>
<li>由于我做的是实况天气的获取，所以通过阅读API的使用说明，可以得知以下API信息：</li>
<li>请求方式：Post</li>
<li>请求地址：<a target="_blank" rel="noopener" href="http://freecityid.market.alicloudapi.com/whapi/json/alicityweather/briefcondition">http://freecityid.market.alicloudapi.com/whapi/json/alicityweather/briefcondition</a></li>
<li>返回类型：JSON</li>
<li>请求参数：<img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200604142447075_param.png"></li>
<li>返回示例：</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200612115105117_code.png" alt="返回示例" title="返回示例"></li>
<li>掌握了这些信息之后开始写Lua代码中的http部分，通过模块查询天气状况。</li>
<li>根据公众号文章学习http.request接口的使用方法:point_right:<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIwNjgzNDQ5NA==&mid=2247486377&idx=1&sn=6242c7e155cd6ce0208704e416ecd3a7&chksm=971ad5f8a06d5cee2057674d80f6c3d08c0341e460c19f9993133bb0e79dddbb659050c6a4b3&mpshare=1&scene=23&srcid=&sharer_sharetime=1590995320443&sharer_shareid=ba901ed241b377ec02413986add87bda#rd" title="必看｜如何正确使用http.request接口？">必看｜如何正确使用http.request接口？</a></li>
<li>现在，通过上面了解到的内容来拼接http请求。</li>
<li>由于我们提交参数的方式为表单提交（x-www-form-urlencoded），此种格式的body参数，需要对http.request的head和body参数进行填充，head参数需要添加[“Content-Type”]=”application/x-www-form-urlencoded”，body参数可使用如下接口httpRequestFormData接口来生成：</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607182934138_code.png"></li>
<li>通过上面的接口对请求body的封装，拼接出的http请求代码为：<br><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607183354691_code.png"></li>
<li>设计http回调函数来处理http请求返回的结果。这里需要用json模块来将json字符串解析为lua中的table数据结构。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607184140342_code.png"></li>
<li>因为天气信息是实时变化的，所以我们将http请求天气的函数放入循环计时器，每五分钟执行一次。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607184411723_code.png"></li>
</ul>
<h2 id="2-在屏幕上显示天气信息"><a href="#2-在屏幕上显示天气信息" class="headerlink" title="2.在屏幕上显示天气信息"></a>2.在屏幕上显示天气信息</h2><ul>
<li>我这里使用的是驱动为gc9106l的屏幕，所以在main.lua中require了相关的屏幕驱动代码，如果使用其他屏幕可以require相应的驱动文件，文后的代码中提供了相应的下载。</li>
<li>查阅wiki.openluat.com得知需要使用disp相关的API来进行屏幕内容的显示。</li>
<li>相关API为disp.puttext(str,x,y)</li>
<li>创建一个任务用来每分钟更新屏幕显示内容，屏幕显示的天气状况为全局变量WeatherInfo中储存的天气信息。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200609175905017_code.png"></li>
</ul>
<h2 id="3-通过TTS播放天气信息"><a href="#3-通过TTS播放天气信息" class="headerlink" title="3.通过TTS播放天气信息"></a>3.通过TTS播放天气信息</h2><ul>
<li>首先要连接一个扬声器到相关引脚上，在开发板上speaker的两个引脚名字为PAOUTP和PAOUTN。</li>
<li>播放TTS需要使用audio模块，查询wiki得知API相关的用法为：</li>
<li>audio.play(priority, type, path, vol, cbFnc, dup, dupInterval)</li>
<li>根据我们的需求编写TTS代码，播放内容传入到函数中，音量为最大7，不需要回调函数。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200607190155018_code.png"></li>
<li>由于我们需要需要在每五分钟http获取到天气信息的时候通过tts播放获取到的天气信息，所以在http回调函数中添加播放内容的代码，正好可以调用上面写好的playTts函数。</li>
<li><img src="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/images/20200609180144995_code.png"></li>
</ul>
<h2 id="4-经验总结，参考资料以及代码下载"><a href="#4-经验总结，参考资料以及代码下载" class="headerlink" title="4.经验总结，参考资料以及代码下载"></a>4.经验总结，参考资料以及代码下载</h2><ul>
<li>经验总结</li>
<li>通过对公众号历史优质文章的学习，轻松的实现各种http的请求方式，接口设计简单，功能强大。</li>
<li>这里只是最基本的disp的使用方法，通过一些界面设计可以实现更加美观的界面。</li>
<li>由于这个weather APP功能还算简单，只用到了LuaTask众多模块中的几个模块，但是LuaTask还有非常丰富的模块功能以及众多的玩法有待大家研究。</li>
<li>依靠合宙较为丰富的资料文档可以顺利的找到相关需求的实现方法。</li>
<li>参考资料</li>
<li><a href="wiki.openluat.com">合宙Wiki教程</a></li>
<li>Luat公众号文章<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIwNjgzNDQ5NA==&mid=2247486377&idx=1&sn=6242c7e155cd6ce0208704e416ecd3a7&chksm=971ad5f8a06d5cee2057674d80f6c3d08c0341e460c19f9993133bb0e79dddbb659050c6a4b3&mpshare=1&scene=23&srcid=&sharer_sharetime=1590995320443&sharer_shareid=ba901ed241b377ec02413986add87bda#rd">《必看｜如何正确使用http.request接口？》</a></li>
<li>代码下载</li>
<li><a target="_blank" rel="noopener" href="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/attachment/20200612144159052_LuatWeatherApp.7z">LuatWeatherApp.7z</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/04/791/" data-id="ckkfmdgdj00buvkcg8fb239fd" data-title="手把手教你用Air724UG做一个Weather APP" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-789" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/04/789/" class="article-date">
  <time class="dt-published" datetime="2020-06-04T04:06:35.000Z" itemprop="datePublished">2020-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/04/789/">8910 如何制作差分包</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>#实际需求</p>
<p>8910 支持差分升级，有的客户需要本地升级或者自己搭建服务器升级，需要差分升级方法，我们提供的差分升级方法一般是这么个流程   客户在windows 下生成差分包（需要原始版本和需要升级的版本），生成的差分包，可以通过本地升级或者使用服务器通过url 升级</p>
<p>#差分包生成</p>
<p>##命令的格式如下</p>
<p>dtools.exe fotacreate2 –pac old,new,xml  output.pack</p>
<p>其中命令涵义</p>
<p>old:老固件</p>
<p>new:新固件</p>
<p>xml:xml的路径（fota-win.rar 目录下的setting文件夹fota8910.xml）</p>
<p>output.pack:生成的差分文件</p>
<p>##测试例子 固件289和固件290生成差分包289-290.pack</p>
<p>dtools.exe  fotacreate2 –pac c-289.pac,c-290.pac,”E:\fota-win\setting\fota8910.xml” 289-290.pack</p>
<h1 id="差分包使用"><a href="#差分包使用" class="headerlink" title="差分包使用"></a>差分包使用</h1><h2 id="本地升级"><a href="#本地升级" class="headerlink" title="本地升级"></a>本地升级</h2><p>AT+UPDATE=<size></p>
<p>其中是size 是生成的差分包大小</p>
<p>模块收到命令会发出 &gt; 字符 <em>注意此时才可将数据发送给模块</em></p>
<p>可以sscom 中发送文件的方式</p>
<h2 id="url-升级"><a href="#url-升级" class="headerlink" title="url 升级"></a>url 升级</h2><p>可以根据  AT命令手册中的 AT+UPGRADE=“URL” 命令进行升级，具体请参照AT手册</p>
<p> #升级工具如下<br><a target="_blank" rel="noopener" href="http://openluat-luatcommunity.oss-cn-hangzhou.aliyuncs.com/attachment/20200604120630554_fota-win.rar">fota-win.rar</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/06/04/789/" data-id="ckkfmdgdj00btvkcge5vlbgrl" data-title="8910 如何制作差分包" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/20/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><a class="extend next" rel="next" href="/page/22/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2032/01/">一月 2032</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2032/01/01/608/">【置顶】合宙模块资料汇总</a>
          </li>
        
          <li>
            <a href="/2022/12/31/638/">Air系列模块常见问题列表</a>
          </li>
        
          <li>
            <a href="/2021/01/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/01/27/2420/">ECMAScript(ES6)基本语法介绍（一）</a>
          </li>
        
          <li>
            <a href="/2021/01/26/2417/">Air720S系列_luat二次开发固件（ 底层软件+上层脚本）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 chenxuuu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>