<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Luat doc 社区文章静态页面镜像</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:type" content="website">
<meta property="og:title" content="Luat doc 社区文章静态页面镜像">
<meta property="og:url" content="https://doc.luatos.wiki/page/40/index.html">
<meta property="og:site_name" content="Luat doc 社区文章静态页面镜像">
<meta property="og:description" content="Luat doc 社区文章静态页面镜像">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chenxuuu">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Luat doc 社区文章静态页面镜像" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luat doc 社区文章静态页面镜像</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://doc.luatos.wiki"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-586" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/30/586/" class="article-date">
  <time class="dt-published" datetime="2019-05-30T07:23:35.000Z" itemprop="datePublished">2019-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/30/586/">滴云快快快速云产品开发体验</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <pre><code>                        &lt;p class=&quot;MsoNormal&quot; style=&quot;text-indent:21.0pt;mso-char-indent-count:2.0&quot;&gt;&lt;span style=&quot;text-indent: 21pt;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;MsoNormal&quot; style=&quot;text-indent:21.0pt;mso-char-indent-count:2.0&quot;&gt;&lt;span style=&quot;text-indent: 21pt;&quot;&gt;你能想象简单四步完成云产品开发吗？你能想象&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 21pt;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;text-indent: 21pt;&quot;&gt;分钟就能实现一个应用吗？“滴云”可以实现这个想象。&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left; margin-left: 25px;&quot;&gt;
</code></pre>
<p><span style="font-size: 10.5pt; font-family: 等线;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p><p style="margin-left: 25px;">简单介绍下滴云是什么？滴云<span lang="EN-US" style="">(DiverseCloud)</span>是雅鲁科技整合了多年在水务、能源、医疗、工业、建筑、通信等众多行业的成功案例，推出的面向多行业、多领域的“物联网专用云平台”。滴云致力于驱动用户物联网智能化、信息化升级，构建用户自身生态链。</p><p style="text-align: left; margin-left: 25px;"><img class="img-responsive" style="width: 50%;" src="http://oldask.openluat.com/image/show/attachments-2019-05-8DAmHwuk5cef83c171aa7.png"><span style="font-size: 10.5pt; font-family: 等线;"><br></span></p><p style="text-align: left; margin-left: 25px;"><span style="font-size: 10.5pt; font-family: 等线;"><br></span></p><p class="MsoNormal" style="margin-left: 25px;">话不多说，今天我们就来体验下滴云平台的一个产品开发到底有多快捷？</p><p class="MsoNormal" style="margin-left: 25px;"><span lang="EN-US">&lt;o:p&gt;<br></o:p></span></p><p class="MsoNormal" style="margin-left: 25px;"><img class="img-responsive" style="width: 100%;" src="http://oldask.openluat.com/image/show/attachments-2019-05-Pirdu9IG5cef83fb64eec.png"><span lang="EN-US">&lt;o:p&gt;<br></o:p></span></p><p class="MsoNormal" style="margin-left: 25px;"><b>仅仅四步：</b><span lang="EN-US" style="">&lt;o:p&gt;</o:p></span></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: -21pt;"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;&#10;mso-bidi-font-family:Wingdings">l&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp; </span></span><!--[endif]-->成为开发者。即在平台填写注册信息并注册<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: -21pt;"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;&#10;mso-bidi-font-family:Wingdings">l&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp; </span></span><!--[endif]-->创建产品。就是新增自己产品和设备，并根据滴云丰富的行业应用经验提供的产品设备属性来定义我们自己的产品。<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoListParagraph" style="margin-left: 53px;">以电表类产品为例，平台已经开放给免费用户的就有各相电压、电流、<span lang="EN-US">CT</span>、<span lang="EN-US">PT</span>、频率、总有功功率、总无功功率、功率因素总和等等众多行业属性。<br></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: -21pt;"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;&#10;mso-bidi-font-family:Wingdings">l&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp; </span></span><!--[endif]-->设备接入。滴云提供了设备接入开发的快速<span lang="EN-US">SDK</span>，<span lang="EN-US">SDK</span>的接口使用也很便捷，只需要三步就可以实现，小编从<span lang="EN-US">github</span>上<span lang="EN-US">clone</span>了滴云的接入<span lang="EN-US">SDK</span>。</p><p class="MsoListParagraph" style="text-indent: -21pt; margin-left: 78px;"><span style='box-sizing: border-box; color: rgb(0, 0, 0); font-family: "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft Yahei", sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: -21pt; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;'>github 仓库：</span><a style='box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 122, 183); text-decoration: none; font-family: "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft Yahei", sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: -28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;' href="https://github.com/DthinGroup/DiverseCloud.git" target="_blank">https://github.com/DthinGroup/DiverseCloud.git</a><b></b><i></i><u></u><sub></sub><sup></sup><strike></strike><br></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: -21pt;"><img class="img-responsive" style="width: 50%;" src="http://oldask.openluat.com/image/show/attachments-2019-05-u7KiqeAp5cef86aada8fb.png"></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: 0cm;"><span lang="EN-US">&lt;v:shapetype id=”_x0000_t75” stroked=”f” filled=”f” path=”m@4@5l@4@11@9@11@9@5xe” o:preferrelative=”t” o:spt=”75” coordsize=”21600,21600”&gt;<br> &lt;v:stroke joinstyle=”miter”&gt;<br> &lt;v:formulas&gt;<br>  &lt;v:f eqn=”if lineDrawn pixelLineWidth 0”&gt;<br>  &lt;v:f eqn=”sum @0 1 0”&gt;<br>  &lt;v:f eqn=”sum 0 0 @1”&gt;<br>  &lt;v:f eqn=”prod @2 1 2”&gt;<br>  &lt;v:f eqn=”prod @3 21600 pixelWidth”&gt;<br>  &lt;v:f eqn=”prod @3 21600 pixelHeight”&gt;<br>  &lt;v:f eqn=”sum @0 0 1”&gt;<br>  &lt;v:f eqn=”prod @6 1 2”&gt;<br>  &lt;v:f eqn=”prod @7 21600 pixelWidth”&gt;<br>  &lt;v:f eqn=”sum @8 21600 0”&gt;<br>  &lt;v:f eqn=”prod @7 21600 pixelHeight”&gt;<br>  &lt;v:f eqn=”sum @10 21600 0”&gt;<br> </v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:formulas><br> &lt;v:path o:connecttype=”rect” gradientshapeok=”t” o:extrusionok=”f”&gt;<br> &lt;o:lock aspectratio=”t” v:ext=”edit”&gt;<br></o:lock></v:path></v:stroke></v:shapetype>&lt;v:shape id=”图片_x0020_4” style=”width:415.5pt;height:50.25pt;visibility:visible;mso-wrap-style:square” type=”#_x0000_t75” o:spid=”_x0000_i1025”&gt;<br> &lt;v:imagedata o:title=”” src=”file:///C:/Users/LENOVO/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png”&gt;<br></v:imagedata></v:shape></span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: 0cm;">其中提供了一个示例文件，实际只要开发者根据平台或者<span lang="EN-US">SDK</span>的<span lang="EN-US">TAG</span>信息填入就可以自动封装数据协议，再根据用户自身的通信条件，不管是有线以太网、<span lang="EN-US">WIFI</span>、<span lang="EN-US">GPRS</span>、<span lang="EN-US">NBIOT</span>等等都可以在平台得到很好的支持。<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoListParagraph" style="margin-left: 53px; text-indent: -21pt;"><!--[if !supportLists]--><span lang="EN-US" style="font-family: Wingdings;">l&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp; </span></span><!--[endif]-->产品发布。滴云提供了模板化的行业应用，用户只需要在平台上简单的鼠标点击配置就可以直接使用滴云多年沉淀的行业应用。<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p style="margin-left: 50px;"></p>
<p>小编花了两分钟配置了一个应用截图如下：</p><p style="margin-left: 50px;"><img class="img-responsive" style="width: 100%;" src="http://oldask.openluat.com/image/show/attachments-2019-05-4mKdGD0M5cef846f304e5.png"></p><p class="MsoNormal"><br></p><p class="MsoNormal" style="margin-left: 25px;">是不是十分方便快捷呢，小伙伴们快来试用吧！<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal" style="margin-left: 25px;">这里提供一个演示账号<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal" style="margin-left: 25px;"><a target="_blank" rel="noopener" href="https://dthing.net/developer/index.jsp">https://dthing.net/developer/index.jsp</a><span lang="EN-US"><a target="_blank" rel="noopener" href="https://dthing.net/developer/index.jsp"></a>&nbsp; &nbsp;&nbsp;&lt;o:p&gt;</o:p></span>账号：diversecloud&nbsp; &nbsp; &nbsp; 密码：123456</p><p class="MsoNormal" style="margin-left: 25px;"><img class="img-responsive" style="width: 959px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-agBbonzk5cf087b0a6e53.png"></p><p class="MsoNormal" style="margin-left: 25px;">后台查看数据：</p><p class="MsoNormal" style="margin-left: 25px;"><img class="img-responsive" style="width: 949px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-GHyzVdHU5cf087b6d28ec.png"></p><p class="MsoNormal" style="margin-left: 25px;"><img class="img-responsive" style="width: 943.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-cya0GDjk5cf0898fd2377.png"><br></p><p class="MsoNormal" style="margin-left: 25px;">应用入口：<img class="img-responsive" style="width: 960px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-RUlUGh265cf087bb96403.png"><br></p><p class="MsoNormal" style="margin-left: 25px;"><span lang="EN-US">&nbsp;</span></p><p class="MsoNormal" style="margin-left: 25px;">顺便<span lang="EN-US">link</span>一个文章提供了合宙<span lang="EN-US">Air202<br>S5</span>开发板接入非常非常详细的步骤<span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal" style="margin-left: 25px;"><span lang="EN-US"><a target="_blank" rel="noopener" href="http://oldask.openluat.com/article/895">http://oldask.openluat.com/article/895</a>&lt;o:p&gt;</o:p></span></p><p class="MsoNormal" style="margin-left: 25px;"><span lang="EN-US">&nbsp;</span></p><p style="margin-left: 75px;"></p>
</p><p class="MsoNormal" style="margin-left: 25px;">有兴趣的同学还可以登录<span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.dthing.net/">http://www.dthing.net</a></span>获取更多资料。<span lang="EN-US"><o:p></o:p></span></p><p style="margin-left: 75px;"><br></p>






      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/05/30/586/" data-id="ckkfmdgce008avkcgcjuf4rbr" data-title="滴云快快快速云产品开发体验" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-585" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/30/585/" class="article-date">
  <time class="dt-published" datetime="2019-05-30T06:59:35.000Z" itemprop="datePublished">2019-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/30/585/">简单优化后的ST7789配置文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><br></p><div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px; white-space: pre;"><div><span style="color: #6a9955;">--- 模块功能：ST 7789驱动芯片LCD命令配置</span></div><div><span style="color: #6a9955;">-- @author openLuat</span></div><div><span style="color: #6a9955;">-- @module ui.color_std_spi_st7789</span></div><div><span style="color: #6a9955;">-- @license MIT</span></div><div><span style="color: #6a9955;">-- @copyright openLuat</span></div><div><span style="color: #6a9955;">-- @release 2018.08.14</span></div><br><div><span style="color: #6a9955;">--[[</span></div><div><span style="color: #6a9955;">注意：disp库目前支持I2C接口和SPI接口的屏，此文件的配置，硬件上使用的是标准的SPI引脚，不是LCD专用的SPI引脚</span></div><div><span style="color: #6a9955;">硬件连线图如下：</span></div><div><span style="color: #6a9955;">Air模块 LCD</span></div><div><span style="color: #6a9955;">GND--地</span></div><div><span style="color: #6a9955;">SPI_CS--片选</span></div><div><span style="color: #6a9955;">SPI_CLK--时钟</span></div><div><span style="color: #6a9955;">SPI_DO--数据</span></div><div><span style="color: #6a9955;">SPI_DI--数据/命令选择</span></div><div><span style="color: #6a9955;">VDDIO--电源</span></div><div><span style="color: #6a9955;">UART1_CTS--复位</span></div><div><span style="color: #6a9955;">注意：Air202早期的开发板，UART1的CTS和RTS的丝印反了</span></div><div><span style="color: #6a9955;">]]</span></div><br><div><span style="color: #dcdcaa;">module</span>(<span style="color: #569cd6;">...</span>,package.<span style="color: #9cdcfe;">seeall</span>)</div><br><div><span style="color: #6a9955;">--[[</span></div><div><span style="color: #6a9955;">函数名：init</span></div><div><span style="color: #6a9955;">功能  ：初始化LCD参数</span></div><div><span style="color: #6a9955;">参数  ：无</span></div><div><span style="color: #6a9955;">返回值：无</span></div><div><span style="color: #6a9955;">]]</span></div><div><span style="color: #569cd6;">local</span> <span style="color: #c586c0;">function</span> <span style="color: #dcdcaa;">init</span>()</div><div>    <span style="color: #c586c0;">local</span> para =</div><div>    {</div><div>        width = <span style="color: #b5cea8;">320</span>, <span style="color: #6a9955;">--分辨率宽度，128像素；用户根据屏的参数自行修改</span></div><div>        height = <span style="color: #b5cea8;">240</span>, <span style="color: #6a9955;">--分辨率高度，160像素；用户根据屏的参数自行修改</span></div><div>        bpp = <span style="color: #b5cea8;">16</span>, <span style="color: #6a9955;">--位深度，彩屏仅支持16位</span></div><div>        bus = disp.<span style="color: #9cdcfe;">BUS_SPI4LINE</span>, <span style="color: #6a9955;">--LCD专用SPI引脚接口，不可修改</span></div><div>        pinrst = pio.<span style="color: #9cdcfe;">P0_14</span>, <span style="color: #6a9955;">--reset，复位引脚</span></div><div>        pinrs = pio.<span style="color: #9cdcfe;">P0_18</span>, <span style="color: #6a9955;">--rs，命令/数据选择引脚</span></div><div>        </div><div>        <span style="color: #6a9955;">--bus = disp.BUS_SPI, --标准SPI接口</span></div><div>        <span style="color: #6a9955;">--pinrst = pio.P0_3, --reset，复位引脚</span></div><div>        <span style="color: #6a9955;">--pinrs = pio.P0_12, --rs，命令/数据选择引脚</span></div><br><div>        xoffset = <span style="color: #b5cea8;">0</span>, <span style="color: #6a9955;">--X轴偏移</span></div><div>        yoffset = <span style="color: #b5cea8;">0</span>, <span style="color: #6a9955;">--Y轴偏移</span></div><div>        freq = <span style="color: #b5cea8;">13000000</span>, <span style="color: #6a9955;">--spi时钟频率，支持110K到13M（即110000到13000000）之间的整数（包含110000和13000000）</span></div><div>        <span style="color: #6a9955;">--hwfillcolor = 0xFFFFFF, --填充色，黑色</span></div><br><div>        <span style="color: #6a9955;">--初始化命令</span></div><div>        <span style="color: #6a9955;">--前两个字节表示类型：0001表示延时，0000或者0002表示命令，0003表示数据</span></div><div>        <span style="color: #6a9955;">--延时类型：后两个字节表示延时时间（单位毫秒）</span></div><div>        <span style="color: #6a9955;">--命令类型：后两个字节命令的值</span></div><div>        <span style="color: #6a9955;">--数据类型：后两个字节数据的值</span></div><div>        initcmd =</div><div>        {</div><div>    </div><br><div>            <span style="color: #b5cea8;">0x00020036</span>,     <span style="color: #6a9955;">--//控制</span></div><div>            <span style="color: #b5cea8;">0x00030060</span>,     <span style="color: #6a9955;">--横竖屏C0/A0/00/60</span></div><br><div>            <span style="color: #6a9955;">--0x00020021,--//0x13显示不反转 ,21h 反显</span></div><br><div>            <span style="color: #b5cea8;">0x0002003A</span>,</div><div>            <span style="color: #b5cea8;">0x00030005</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200B2</span>,     <span style="color: #6a9955;">--//前后肩</span></div><div>            <span style="color: #b5cea8;">0x0003000C</span>,</div><div>            <span style="color: #b5cea8;">0x0003000C</span>,</div><div>            <span style="color: #b5cea8;">0x00030000</span>,</div><div>            <span style="color: #b5cea8;">0x00030033</span>,</div><div>            <span style="color: #b5cea8;">0x00030033</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200B7</span>,     <span style="color: #6a9955;">--//VGH VGL</span></div><div>            <span style="color: #b5cea8;">0x00030035</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200BB</span>,     <span style="color: #6a9955;">--//VCOM </span></div><div>            <span style="color: #b5cea8;">0x00030019</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200C0</span>,     <span style="color: #6a9955;">--//LCM</span></div><div>            <span style="color: #b5cea8;">0x0003002C</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200C2</span>,</div><div>            <span style="color: #b5cea8;">0x00030001</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200C3</span>,     <span style="color: #6a9955;">--//VRH( vcom+vcom offset+vdv) </span></div><div>            <span style="color: #b5cea8;">0x00030012</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200C4</span>,     <span style="color: #6a9955;">--//vdv</span></div><div>            <span style="color: #b5cea8;">0x00030020</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200C6</span>,     <span style="color: #6a9955;">--//帧率</span></div><div>            <span style="color: #b5cea8;">0x0003000F</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200D0</span>,     <span style="color: #6a9955;">--//功率控制模式</span></div><div>            <span style="color: #b5cea8;">0x000300A4</span>,</div><div>            <span style="color: #b5cea8;">0x000300A1</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200E0</span>,     <span style="color: #6a9955;">--//正GAMMA</span></div><div>            <span style="color: #b5cea8;">0x000300D0</span>,</div><div>            <span style="color: #b5cea8;">0x00030004</span>,</div><div>            <span style="color: #b5cea8;">0x0003000D</span>,</div><div>            <span style="color: #b5cea8;">0x00030011</span>,</div><div>            <span style="color: #b5cea8;">0x00030013</span>,</div><div>            <span style="color: #b5cea8;">0x0003002B</span>,</div><div>            <span style="color: #b5cea8;">0x0003003F</span>,</div><div>            <span style="color: #b5cea8;">0x00030054</span>,</div><div>            <span style="color: #b5cea8;">0x0003004C</span>,</div><div>            <span style="color: #b5cea8;">0x00030018</span>,</div><div>            <span style="color: #b5cea8;">0x0003000D</span>,</div><div>            <span style="color: #b5cea8;">0x0003000B</span>,</div><div>            <span style="color: #b5cea8;">0x0003001F</span>,</div><div>            <span style="color: #b5cea8;">0x00030023</span>,</div><br><div>            <span style="color: #b5cea8;">0x000200E1</span>,     <span style="color: #6a9955;">--//负GAMMA</span></div><div>            <span style="color: #b5cea8;">0x000300D0</span>,</div><div>            <span style="color: #b5cea8;">0x00030004</span>,</div><div>            <span style="color: #b5cea8;">0x0003000C</span>,</div><div>            <span style="color: #b5cea8;">0x00030011</span>,</div><div>            <span style="color: #b5cea8;">0x00030013</span>,</div><div>            <span style="color: #b5cea8;">0x0003002C</span>,</div><div>            <span style="color: #b5cea8;">0x0003003F</span>,</div><div>            <span style="color: #b5cea8;">0x00030044</span>,</div><div>            <span style="color: #b5cea8;">0x00030051</span>,</div><div>            <span style="color: #b5cea8;">0x0003002F</span>,</div><div>            <span style="color: #b5cea8;">0x0003001F</span>,</div><div>            <span style="color: #b5cea8;">0x0003001F</span>,</div><div>            <span style="color: #b5cea8;">0x00030020</span>,</div><div>            <span style="color: #b5cea8;">0x00030023</span>,</div><br><div>            <span style="color: #b5cea8;">0x00020011</span>,     <span style="color: #6a9955;">--// sleep out</span></div><div>            <span style="color: #b5cea8;">0x00010078</span>,</div><br><div>            <span style="color: #b5cea8;">0x00020029</span>      <span style="color: #6a9955;">--//Display On</span></div><div>        },</div><div>        <span style="color: #6a9955;">--休眠命令</span></div><div>        sleepcmd = {</div><div>            <span style="color: #b5cea8;">0x00020010</span>,</div><div>        },</div><div>        <span style="color: #6a9955;">--唤醒命令</span></div><div>        wakecmd = {</div><div>            <span style="color: #b5cea8;">0x00020011</span>,</div><div>        }</div><div>    }</div><div>    disp.<span style="color: #dcdcaa;">init</span>(para)</div><div>    disp.<span style="color: #dcdcaa;">clear</span>()</div><div>    disp.<span style="color: #dcdcaa;">update</span>()</div><div><span style="color: #c586c0;">end</span></div><br><div><span style="color: #6a9955;">--控制SPI引脚的电压域</span></div><div>pmd.<span style="color: #dcdcaa;">ldoset</span>(<span style="color: #b5cea8;">6</span>,pmd.<span style="color: #9cdcfe;">LDO_VMMC</span>)</div><div><span style="color: #dcdcaa;">init</span>()</div><br><div><span style="color: #6a9955;">--打开背光</span></div><div><span style="color: #6a9955;">--实际使用时，用户根据自己的lcd背光控制方式，添加背光控制代码</span></div></div>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/05/30/585/" data-id="ckkfmdgcd0089vkcgfxa881h9" data-title="简单优化后的ST7789配置文件" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-584" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/27/584/" class="article-date">
  <time class="dt-published" datetime="2019-05-27T04:47:12.000Z" itemprop="datePublished">2019-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/27/584/">合宙开发板使用JSON、TLV格式接入滴云DiverseCloud的示例-Air202 S5开发板</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <pre><code>                        &lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;本例程使用&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;Air202 S5&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;开发板实现雅鲁科技滴云&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;DiverseCloud&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;数据接入，使用&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;AT&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;指令进行&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;TLV&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;与&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;JSON&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;两种数据帧格式的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot; style=&quot;text-indent: 24pt;&quot;&gt;MQTT&lt;/span&gt;&lt;span style=&quot;text-indent: 24pt; font-family: 宋体;&quot;&gt;发布。目标是可在平台查看到发布的数据内容。从而实现设备到云端的整个数据流程。&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span lang=&quot;EN-US&quot;&gt;Tip&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;：合宙&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;AT&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;指令也可实现&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;TLV&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;格式的数据解析，可通过&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;AT+MQTTMODE&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:&amp;#10;Calibri;mso-hansi-font-family:Calibri&quot;&gt;进行&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;ASCII&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;到&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;HEX&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;的切换，并使用滴云提供的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;Tlv SDK&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;包进行数据包封装即可实现数据自动解析。&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:&amp;#10;Calibri;mso-hansi-font-family:Calibri&quot;&gt;流程为：登录&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;注册滴云平台&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;新建产品&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;新建设备&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;准备好开发板&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;配置开发板为&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;AT&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;指令模式&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;根据滴云平台提供参数与所需发布的数据进行开发板的&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;AT&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;&amp;#10;mso-hansi-font-family:Calibri&quot;&gt;指令控制&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;在平台查看发布的数据。&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri&quot;&gt;SDK&amp;nbsp;&lt;span style=&#39;box-sizing: border-box; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: -21pt; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;&#39;&gt;github 仓库：&lt;/span&gt;&lt;a style=&#39;box-sizing: border-box; background-color: rgb(255, 255, 255); color: rgb(51, 122, 183); text-decoration: none; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: -28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;&#39; href=&quot;https://github.com/DthinGroup/DiverseCloud.git&quot; target=&quot;_blank&quot;&gt;https://github.com/DthinGroup/DiverseCloud.git&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:&amp;#10;Calibri;mso-hansi-font-family:Calibri&quot;&gt;滴云物联网平台地址：&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;&lt;a href=&quot;https://www.dthing.net/developer/index.jsp&quot;&gt;https://www.dthing.net/developer/index.jsp&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:&amp;#10;Calibri;mso-hansi-font-family:Calibri&quot;&gt;没有账户的可自行注册一个账户。注册完成后登陆滴云平台。&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;h1 style=&quot;margin-left:0cm;text-indent:9.0pt;mso-list:l0 level2 lfo1&quot;&gt;&lt;a name=&quot;_Toc8146622&quot;&gt;&lt;span lang=&quot;EN-US&quot;&gt;1&lt;/span&gt;准备工作&lt;/a&gt;&lt;/h1&gt;&lt;h3 style=&quot;margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1&quot;&gt;&lt;a name=&quot;_Toc8146623&quot;&gt;&lt;!--[if !supportLists]--&gt;&lt;span lang=&quot;EN-US&quot;&gt;1.1&lt;span style=&quot;font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: &quot; roman&quot;;&quot;=&quot;&quot; new=&quot;&quot; times=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;!--[endif]--&gt;硬件&lt;/a&gt;&lt;span lang=&quot;EN-US&quot;&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/h3&gt;&lt;p class=&quot;a&quot; style=&quot;text-indent:24.0pt&quot;&gt;&lt;span style=&quot;font-family:宋体;mso-ascii-font-family:&amp;#10;Calibri;mso-hansi-font-family:Calibri&quot;&gt;使用的开发板为合宙&lt;/span&gt;&lt;span lang=&quot;EN-US&quot;&gt;Air202
</code></pre>
<p>S5</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;Calibri">开发板，相关说明文档地址如下</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">链接地址：</span><span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.openluat.com/Product/gprs/Air202S5.html">http://www.openluat.com/Product/gprs/Air202S5.html</a>&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 91.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-caROsK6e5ceb6964a59b3.png"><br></p><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146624"><span lang="EN-US">1.2&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp; &nbsp; &nbsp; &nbsp;</span></span><!--[endif]-->下载、调试工具</a><span lang="EN-US">&lt;o:p&gt;</o:p></span></h3><p class="a" style="text-indent:24.0pt"><span lang="EN-US"><a href="http://www.openluat.com/Product/file/rda8955/luatools-redirect.html" target="_blank"><span lang="EN-US" style="font-size:11.5pt;line-height:150%;&#10;font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;&#10;color:#333333"><span lang="EN-US">下载</span></span><span lang="EN-US" style="font-size:11.5pt;line-height:150%;font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri;color:#333333"><span lang="EN-US">及</span></span><span lang="EN-US" style="font-size:11.5pt;line-height:150%;font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri;color:#333333"><span lang="EN-US">调试工具</span></span><span style="font-size:11.5pt;line-height:150%;color:#333333">1.6.4</span></a>&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">链接地址：</span><span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.openluat.com/Product/gprs/Air202S5.html">http://www.openluat.com/Product/gprs/Air202S5.html</a>&lt;o:p&gt;</o:p></span></p><h2 style="margin-left:0cm;text-indent:9.0pt;mso-list:l0 level2 lfo1"><a name="_Toc8146625"><span lang="EN-US">2&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;<br></span></span><!--[endif]--><span lang="EN-US">AT</span>指令实现<span lang="EN-US">MQTT<br>JSON</span>格式发布</a><span lang="EN-US">&lt;o:p&gt;</o:p></span></h2><h2 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146626"><span lang="EN-US">2.1&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span><!--[endif]-->平台端</a><span style="color: rgb(57, 132, 198);">配置</span></h2><h4 style="margin-left:0cm;text-indent:18.0pt;mso-list:l0 level4 lfo1"><span lang="EN-US">2.1.1&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;&nbsp;<br></span></span><!--[endif]-->添加产品<span lang="EN-US">&lt;o:p&gt;</o:p></span></h4><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">登录滴云开发者控制台</span><span lang="EN-US"><a target="_blank" rel="noopener" href="https://www.dthing.net/developer/index.jsp">https://www.dthing.net/developer/index.jsp</a>&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 250px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-R4wDd9dP5ceb6972e520a.png"><br></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 249.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-DVKBJ4sY5ceb697cbd0d4.png"><br></p><h4 style="margin-left:43.2pt;text-indent:-43.2pt;mso-char-indent-count:0;&#10;mso-list:l0 level4 lfo5"><span lang="EN-US">2.1.2&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;<br></span></span><!--[endif]-->获取<span lang="EN-US">MQTT</span>配置参数<span lang="EN-US">&lt;o:p&gt;</o:p></span></h4><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">这是刚创建好的产品，点击</span><span lang="EN-US">DTU</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">配置来获取相应的</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">配置参数</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 915px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-Cqb92E4b5ceb69847e079.png"><br></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 335px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-lTvQvjQ75ceb698ac736c.png"><br></p><h4 style="margin-left:0cm;text-indent:18.0pt;mso-list:l0 level4 lfo1"><span lang="EN-US">2.1.3&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;&nbsp;<br></span></span><!--[endif]-->添加设备<span lang="EN-US">&lt;o:p&gt;</o:p></span></h4><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">进入设备管理界面</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 887.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-AdfopjtI5ceb6994066b1.png"><br></p><p class="MsoNormal"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">进入设备列表</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 949px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-sP5ZYlfx5ceb699a10b9d.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">添加设备</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 958px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-IPiZoi1M5ceb69a05fdd0.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">添加一个设备标识为</span><span lang="EN-US">1.2.3.4</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">的设备，发布的</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">消息体内</span><span lang="EN-US">JSON</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">数据“</span><span lang="EN-US">deviceTag</span><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">”的值需要与此处设置的设备标识对应</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 292.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-PqWS2G4l5ceb69a781522.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">设备地址是用于使用应用模板的情况下在</span><span lang="EN-US">GIS</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">图层上定位设备使用</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 232px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-asxfHhMr5ceb69b119839.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">到此平台端的基础配置就已经完成。接下来进行开发板的相关操作。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146627"><span lang="EN-US">2.2&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span><!--[endif]-->开发板切换<span lang="EN-US">AT</span>版本</a><span lang="EN-US">&lt;o:p&gt;</o:p></span></h3><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">已切换成</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">版本的请忽略此步骤。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">将开发板的跳帽跳至</span><span lang="EN-US">HOST</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">模式，使用</span><span lang="EN-US">usb</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">线连接电脑，并安装驱动。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">开发板按下开机键开机后，根据软件的提示完成版本下载切换操作。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 221px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-iYsTjy7c5ceb69b5d5231.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">等待下载完成</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 537px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-J0xkATFr5ceb69bbe91ec.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">完成</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">版本切换后就可以使用</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">指令进行开发板的控制了。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146628"><span lang="EN-US">2.3&lt;span style=”font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: “ roman”;”=”” new=”” times=””&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span><!--[endif]--><span lang="EN-US">AT</span>指令实现<span lang="EN-US">ASCII</span>的数据发布</a><span lang="EN-US">&lt;o:p&gt;</o:p></span></h3><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">将开发板的跳帽跳至</span><span lang="EN-US">UART1</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">模式，使用</span><span lang="EN-US">usb</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">线连接电脑，并安装驱动。</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">开机后，可使用串口助手进行测试，测试时使用的波特率是</span><span lang="EN-US">9600bps 8 N 1&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">如下为实现</span><span lang="EN-US">ASCII</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">数据</span><span lang="EN-US">JSON</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">格式操作的指令，可参考</span><span lang="EN-US">Luat AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">指令手册</span><span lang="EN-US">&lt;o:p&gt;</o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">手册地址：</span><span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.openluat.com/Product/file/rda8955/AirM2M%20%E6%97%A0%E7%BA%BF%E6%A8%A1%E5%9D%97AT%E5%91%BD%E4%BB%A4%E6%89%8B%E5%86%8CV3.90.pdf">http://www.openluat.com/Product/file/rda8955/AirM2M%20<span lang="EN-US" style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;Calibri"><span lang="EN-US">无线模块</span></span>AT<span lang="EN-US" style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri"><span lang="EN-US">命令手册</span></span>V3.90.pdf</a>&lt;o:p&gt;</o:p></span></p><div align="center"></p>
<table class="MsoNormalTable" style="border: none;" border="1" cellspacing="0" cellpadding="0">
 <tbody><tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border:solid windowtext 1.0pt;&#10;  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:&#10;  solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">测试</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CGREG?<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查询当前</span><span lang="EN-US" style="color:windowtext">GPRS</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">注册状态</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">+CGREG: 0,1<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CGATT?<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查看当前</span><span lang="EN-US" style="color:windowtext">GPRS</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">附着状态</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">+CGATT: 1<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CSTT="CMNET"<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">启动任务，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">设置</span><span lang="EN-US" style="color:windowtext">APN</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">为</span><span lang="EN-US" style="color:windowtext">"CMNET"</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">（移动卡）</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+CSTT="CMNET"<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+CIICR<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">激活移动场景，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">获取</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+CIICR<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CIFSR</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  " new="" times="" roman",serif;mso-fareast-font-family:"times="" mso-font-kerning:0pt;mso-no-proof:no"="" roman";color:windowtext;=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查询分配的</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+CIFSR<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">10.28.166.25<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+MCONFIG="cellid","AAAA","</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  宋体;mso-bidi-font-family:" new="" times="" 0pt;mso-no-proof:no"="" roman";color:windowtext;mso-font-kerning:="">BBBB</span><span lang="EN-US" style="mso-bidi-font-size:&#10;  12.0pt;line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">"<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">设置</span><span lang="EN-US" style="color:windowtext">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">参数，</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  " new="" times="" roman",serif;mso-fareast-font-family:"times="" mso-font-kerning:0pt;mso-no-proof:no"="" roman";color:windowtext;="">AAAA</span><span lang="EN-US" style="color:windowtext">\BBBB</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">分别为滴云平台提供的账号、密码</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">内嵌的双引号用</span><span lang="EN-US" style="color:windowtext">\22 </span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">表达</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MIPSTART="
  47.111.26.51 ",1883<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">这里，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">请填上用户自己的</span><span lang="EN-US" style="color:windowtext">mqtt</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">服务器的</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址或域名地址，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">以及端口号注：</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">当使用</span><span lang="EN-US" style="color:windowtext">SSL</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接进行数据传输时，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接命令格式为</span><span lang="EN-US" style="color:windowtext">:<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+SSLMIPSTART=<svraddr>,<port></port></svraddr></span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">其余跟普通链接一样。</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">这点请知悉！</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+MIPSTART="</span><span lang="EN-US" style="color:windowtext">47.111.26.51 </span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:" new="" times="" mso-fareast-font-family:"times="" 0pt;mso-no-proof:no"="" roman";color:windowtext;mso-font-kerning:="" roman",serif;="">",1883<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times=""><o:p>&nbsp;</o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MCONNECT=1,60</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  " new="" times="" roman",serif;mso-fareast-font-family:"times="" mso-font-kerning:0pt;mso-no-proof:no"="" roman";color:windowtext;=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">建立</span><span lang="EN-US" style="color:windowtext">mqtt</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">会话</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">CONNACK OK</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  " new="" times="" roman",serif;mso-fareast-font-family:"times="" mso-font-kerning:0pt;mso-no-proof:no"="" roman";color:windowtext;=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">注：在</span><span lang="EN-US" style="color:windowtext">MIPSTART</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">返回</span><span lang="EN-US" style="color:windowtext">CONNECT OK</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">后才能发</span><span lang="EN-US" style="color:windowtext">MCONNECT</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">命令，而且要立即发，否则会被服务器踢掉。</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MPUB="dev001/v3/000/air202",2,0,"[{\22updatedTime\22:\222019-5-27
  12:00:15:253\22,\22deviceTag\22:\221.2.3.4\22,\22dataTag\22:\2210\22,\22value\22:234.6,\22timestamp\22:\222019-5-27
  12:00:15:253\22}]"</span><span lang="EN-US" style="mso-bidi-font-size:&#10;  12.0pt;line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">发布，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">消息格式缺省为</span><span lang="EN-US" style="color:windowtext">ASCII</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">格式</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">内嵌的双引号用</span><span lang="EN-US" style="color:windowtext">\22 </span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">表达</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times=""><o:p>&nbsp;</o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">PUBACK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+MDISCONNECT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">模块主动发起关闭</span><span lang="EN-US" style="color:windowtext">MQTT</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">连接</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+MIPCLOSE<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">关闭</span><span lang="EN-US" style="color:windowtext">TCP</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">AT+CIPSHUT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">关闭移动场景</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-size:12.0pt;&#10;  line-height:150%;font-family:" new="" times="" roman";color:windowtext;mso-font-kerning:0pt;mso-no-proof:no"="" "times="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
</tbody></table>

</div><p class="MsoNormal"><span lang="EN-US">&nbsp;</span></p><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146630"><span lang="EN-US">2.4<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US">DiverseCloud</span>查看数据</a><span lang="EN-US"><o:p></o:p></span></h3><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">在平台平台端若需要查看到数据，需要进行数据字典配置，以对应数据帧内的</span><span lang="EN-US">dataTag</span><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">和平台</span><span lang="EN-US">UI</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">显示的数据属性。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 948px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-6HimJoIr5ceb69c7a66a7.png"><br></p><h2 style="margin-left:28.8pt;text-indent:-28.8pt;mso-char-indent-count:0;&#10;mso-list:l0 level2 lfo6"><a name="_Toc8146631"><!--[if !supportLists]--><span lang="EN-US">3<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">
</span></span><!--[endif]--><span lang="EN-US">AT</span>指令实现<span lang="EN-US">MQTT
TLV</span>格式发布</a><span lang="EN-US"><o:p></o:p></span></h2><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146632"><!--[if !supportLists]--><span lang="EN-US">3.1<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->平台</a>端配置<span lang="EN-US"><o:p></o:p></span></h3><h4 style="margin-left:0cm;text-indent:18.0pt;mso-list:l0 level4 lfo1"><!--[if !supportLists]--><span lang="EN-US">3.1.1<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->新建产品<span lang="EN-US"><o:p></o:p></span></h4><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l1 level1 lfo2"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">由于使用的标识码识别机制为雅鲁机制因此勾选“兼容”</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l1 level1 lfo2"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">数据解析为</span><span lang="EN-US">HEX</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">的</span><span lang="EN-US">TLV</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">格式解析</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l1 level1 lfo2"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">产品类别根据实际情况设置，本章发布的数据为电表数据因此选择电表</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l1 level1 lfo2"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">设备接入协议为</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l1 level1 lfo2"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">技术参数部分用于用户对产品信息的查看不影响平台对数据的解析</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 199px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-37MIQoGN5ceb69cf43986.png"><br></p><h4 style="margin-left:0cm;text-indent:18.0pt;mso-list:l0 level4 lfo1"><!--[if !supportLists]--><span lang="EN-US">3.1.2<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->获取<span lang="EN-US">MQTT</span>配置参数<span lang="EN-US"><o:p></o:p></span></h4><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">这是刚创建好的产品，点击</span><span lang="EN-US">DTU</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">配置来获取相应的</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">配置参数</span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 950.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-wA0OI29g5ceb69d5dd62c.png"><br></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 266px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-aS9el76N5ceb69dabff91.png"><br></p><h4 style="margin-left:0cm;text-indent:18.0pt;mso-list:l0 level4 lfo1"><!--[if !supportLists]--><span lang="EN-US">3.1.3<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]-->创建设备<span lang="EN-US"><o:p></o:p></span></h4><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 241.5px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-S5QwzTnm5ceb69dfc5052.png"><br></p><h3 style="margin-left:36.0pt;text-indent:-36.0pt;mso-char-indent-count:0;&#10;mso-list:l0 level3 lfo4"><a name="_Toc8146633"><!--[if !supportLists]--><span lang="EN-US">3.2&nbsp;<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;</span></span><!--[endif]-->开发板切换<span lang="EN-US">AT</span>版本</a><span lang="EN-US"><o:p></o:p></span></h3><p class="a" style="text-indent:24.0pt"><a name="_Toc8146634"><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">已切换成</span><span lang="EN-US">AT</span></a><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">版本的请忽略此步骤。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">将开发板的跳帽跳至</span><span lang="EN-US">HOST</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">模式，使用</span><span lang="EN-US">usb</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">线连接电脑，并安装驱动。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">开发板按下开机键开机后，根据软件的提示完成版本下载切换操作。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 221px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-jc2wMERh5ceb69e56e8f7.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">等待下载完成</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 537px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-bb3QbZVP5ceb69e9a007e.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">完成</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">版本切换后就可以使用</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">指令进行开发板的控制了。</span><span lang="EN-US"><o:p></o:p></span></p><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><!--[if !supportLists]--><span lang="EN-US">3.3<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US">AT</span>指令实现<span lang="EN-US">HEX</span>的数据发布<span lang="EN-US"><o:p></o:p></span></h3><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">将开发板的跳帽跳至</span><span lang="EN-US">UART1</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">模式，使用</span><span lang="EN-US">usb</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">线连接电脑，并安装驱动。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">开机后，可使用串口助手进行测试，测试时使用的波特率是</span><span lang="EN-US">9600bps 8 N 1<o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">如下为实现</span><span lang="EN-US">ASCII</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">数据</span><span lang="EN-US">JSON</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">格式操作的指令，可参考</span><span lang="EN-US">Luat AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">指令手册</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">手册地址：</span><span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.openluat.com/Product/file/rda8955/AirM2M%20%E6%97%A0%E7%BA%BF%E6%A8%A1%E5%9D%97AT%E5%91%BD%E4%BB%A4%E6%89%8B%E5%86%8CV3.90.pdf">http://www.openluat.com/Product/file/rda8955/AirM2M%20<span lang="EN-US" style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;Calibri"><span lang="EN-US">无线模块</span></span>AT<span lang="EN-US" style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri"><span lang="EN-US">命令手册</span></span>V3.90.pdf</a><o:p></o:p></span></p><div align="center">

<table class="MsoNormalTable" style="border: none;" border="1" cellspacing="0" cellpadding="0">
 <tbody><tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border:solid windowtext 1.0pt;&#10;  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:&#10;  solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">测试</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CGREG?<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查询当前</span><span lang="EN-US" style="color:windowtext">GPRS</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">注册状态</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">+CGREG: 0,1<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CGATT?<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查看当前</span><span lang="EN-US" style="color:windowtext">GPRS</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">附着状态</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">+CGATT: 1<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CSTT="CMNET"<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">启动任务，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">设置</span><span lang="EN-US" style="color:windowtext">APN</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">为</span><span lang="EN-US" style="color:windowtext">"CMNET"</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">（移动卡）</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+CSTT="CMNET"<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK</span><span lang="EN-US" style="color:&#10;  windowtext"><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+CIICR<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">激活移动场景，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">获取</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+CIICR<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+CIFSR</span><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" roman";color:windowtext;="" mso-no-proof:no"=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">查询分配的</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+CIFSR<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">10.28.166.25<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+MCONFIG="cellid","AAAA","BBBB"<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">设置</span><span lang="EN-US" style="color:windowtext">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">参数，</span><span lang="EN-US" style="mso-bidi-font-size:12.0pt;line-height:150%;font-family:&#10;  " new="" times="" roman",serif;mso-fareast-font-family:"times="" mso-font-kerning:0pt;mso-no-proof:no"="" roman";color:windowtext;="">AAAA</span><span lang="EN-US" style="color:windowtext">\BBBB</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">分别为滴云平台提供的账号、密码</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">内嵌的双引号用</span><span lang="EN-US" style="color:windowtext">\22 </span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">表达</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MIPSTART="
  47.111.26.51 ",1883</span><span lang="EN-US" style="mso-bidi-font-family:&#10;  " new="" times="" roman";color:windowtext;mso-no-proof:no"=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">这里，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">请填上用户自己的</span><span lang="EN-US" style="color:windowtext">mqtt</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">服务器的</span><span lang="EN-US" style="color:windowtext">IP</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">地址或域名地址，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">以及端口号注：</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">当使用</span><span lang="EN-US" style="color:windowtext">SSL</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接进行数据传输时，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接命令格式为</span><span lang="EN-US" style="color:windowtext">:<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+SSLMIPSTART=<svraddr>,<port></port></svraddr></span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">其余跟普通链接一样。</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">这点请知悉！</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+MIPSTART="</span><span lang="EN-US" style="color:windowtext">47.111.26.51 </span><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" no"="" roman";color:windowtext;mso-no-proof:="">",1883<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">&nbsp;</span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MCONNECT=1,60</span><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" roman";color:windowtext;="" mso-no-proof:no"=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">建立</span><span lang="EN-US" style="color:windowtext">mqtt</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">会话</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">CONNACK OK</span><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" roman";color:windowtext;="" mso-no-proof:no"=""><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">注：在</span><span lang="EN-US" style="color:windowtext">MIPSTART</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">返回</span><span lang="EN-US" style="color:windowtext">CONNECT OK</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">后才能发</span><span lang="EN-US" style="color:windowtext">MCONNECT</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">命令，而且要立即发，否则会被服务器踢掉。</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">AT+MQTTMODE=1<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">切换消息格式为</span><span lang="EN-US" style="color:windowtext">HEX</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">格式，模块默认为</span><span lang="EN-US" style="color:windowtext">ASCII</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">模式</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK</span><span lang="EN-US" style="color:&#10;  windowtext"><o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+MPUB="dev001/v3/000/air202",2,1,"AAFE02001B0202040302000100000000000001052742824BEEDDEE"<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">发布</span><span lang="EN-US" style="color:windowtext">HEX</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">格式数据，</span><span style="color:windowtext"> </span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">消息格式缺省为</span><span lang="EN-US" style="color:windowtext">ASCII</span><span style="font-family:&#10;  宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">格式前面需要</span><span lang="EN-US" style="color:windowtext">AT+MQTTMODE=1</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:&#10;  Calibri;color:windowtext">来进行模式转换</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">&nbsp;</span></p>
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">PUBACK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+MDISCONNECT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">模块主动发起关闭</span><span lang="EN-US" style="color:windowtext">MQTT</span><span style="font-family:宋体;&#10;  mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri;color:windowtext">连接</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+MIPCLOSE<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">关闭</span><span lang="EN-US" style="color:windowtext">TCP</span><span style="font-family:宋体;mso-ascii-font-family:&#10;  Calibri;mso-hansi-font-family:Calibri;color:windowtext">链接</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">AT+CIPSHUT<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;  mso-hansi-font-family:Calibri;color:windowtext">关闭移动场景</span><span lang="EN-US" style="color:windowtext"><o:p></o:p></span></p>
  </td>
 </tr>
 <tr>
  <td width="354" valign="top" style="width:265.15pt;border:solid windowtext 1.0pt;&#10;  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;&#10;  padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="mso-bidi-font-family:" new="" times="" color:windowtext;mso-no-proof:no"="" roman";="">OK<o:p></o:p></span></p>
  </td>
  <td width="324" valign="top" style="width:243.35pt;border-top:none;border-left:&#10;  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;&#10;  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;&#10;  mso-border-alt:solid windowtext .5pt;padding:0cm 5.75pt 0cm 5.75pt">
  <p class="MsoNormal"><span lang="EN-US" style="color:windowtext">&nbsp;</span></p>
  </td>
 </tr>
</tbody></table>

</div><h3 style="margin-left:0cm;text-indent:14.0pt;mso-list:l0 level3 lfo1"><a name="_Toc8146636"><!--[if !supportLists]--><span lang="EN-US">3.4<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US">DiverseCloud</span>查看数据</a><span lang="EN-US"><o:p></o:p></span></h3><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">在滴云平台查看数据</span> <span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 953px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-cUFGgcNi5ceb69f22acc6.png"><br></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">使用测试软件测试：用测试软件发送</span><span lang="EN-US">TAG:39</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">（电表</span><span lang="EN-US">C</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">相电压），小数位数为</span><span lang="EN-US">2</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">，数值</span><span lang="EN-US">23456</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">（实际值为使用</span><span lang="EN-US">2</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">个小数位即</span><span lang="EN-US">234.56</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">）</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt"><img class="img-responsive" style="width: 374px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-eV5kky9c5ceb69f803e32.png"><br></p><p class="a1" style="margin-bottom:15.6pt;text-align:justify;text-justify:inter-ideograph"><span style="font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial">在平台查看到</span><span lang="EN-US">C</span><span style="font-family:黑体;mso-ascii-font-family:Arial;&#10;mso-hansi-font-family:Arial">相电压数据为</span><span lang="EN-US">234.56</span><span style="font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial">。</span><span lang="EN-US"><o:p></o:p></span></p><p class="a1" style="margin-bottom:15.6pt;text-align:justify;text-justify:inter-ideograph"><img class="img-responsive" style="width: 953px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-QrgGigA25ceb69fd26229.png"><br></p><h2 style="margin-left:0cm;text-indent:9.0pt;mso-list:l0 level2 lfo1"><a name="_Toc8146629"><span lang="EN-US"><span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; line-height: normal;">4</span><span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;&nbsp;</span></span><!--[endif]--><span lang="EN-US">AT</span>指令控制软件</a><span lang="EN-US"><o:p></o:p></span></h2><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">这个小软件在是本人编写的一个简易测试软件用来使用</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">指令控制</span><span lang="EN-US">air202</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">，懒得自己输指令的同学可以用这个软件测试。需要</span><span lang="EN-US">.NET framework 4.0</span><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">以上环境支持，没有安装的同学可在微软官方下载。</span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">下载链接</span><span lang="EN-US">: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1ie4GCl9w82yn_f0C-e7o5Q#list/path=%2F">https://pan.baidu.com/s/1ie4GCl9w82yn_f0C-e7o5Q#list/path=%2F</a><o:p></o:p></span></p><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">提取码</span><span lang="EN-US">: 5m93<o:p></o:p></span></p><p class="MsoNormal"><img class="img-responsive" style="width: 491px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-QBSZ8Mec5ceb6a0236270.png"><br></p><p class="MsoNormal"><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">刚上电的模块测试流程为：</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">发送</span><span lang="EN-US">AT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">测试指令</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">查询注册状态图</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">查询附着状态</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">根据运营商设置</span><span lang="EN-US">APN<o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">激活移动场景</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">查询</span><span lang="EN-US">IP<o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">根据平台提供的</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">参数设置</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">参数</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">设置</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">服务器地址及端口</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">建立</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">连接</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">根据</span><span lang="EN-US">JSON</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">格式及主题信息设置发布内容并发布</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">完成测试后关闭</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">连接</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">关闭</span><span lang="EN-US">TCP</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">连接</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="margin-left:45.0pt;text-indent:-21.0pt;mso-char-indent-count:&#10;0;mso-list:l2 level1 lfo3"><!--[if !supportLists]--><span lang="EN-US" style="font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:&#10;Wingdings">l<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: " roman";"="" new="" times="">&nbsp;
</span></span><!--[endif]--><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">关闭移动场景</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">在</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">发生断链时请查询</span><span lang="EN-US">MQTT</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;&#10;mso-hansi-font-family:Calibri">连接状态再由设置</span><span lang="EN-US">APN</span><span style="font-family:宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri">重新开始</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><span style="font-family:宋体;mso-ascii-font-family:&#10;Calibri;mso-hansi-font-family:Calibri">发布成功的截图</span><span lang="EN-US"><o:p></o:p></span></p><p class="a" style="text-indent:24.0pt"><img class="img-responsive" style="width: 491px;" src="http://oldask.openluat.com/image/show/attachments-2019-05-PUnHsXv35ceb6a083e8d7.png"><br></p><p>































































































































































































































</p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span><span style="font-family: 宋体;">了解更多内容可以登录</span><span lang="EN-US"><a target="_blank" rel="noopener" href="http://www.dthing.net/">www.dthing.net</a></span><span style="font-family: 宋体;">查看</span><br></p><p class="MsoNormal"><span lang="EN-US"><o:p></o:p></span></p>






      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/05/27/584/" data-id="ckkfmdgfy00f1vkcgeq6a9k5h" data-title="合宙开发板使用JSON、TLV格式接入滴云DiverseCloud的示例-Air202 S5开发板" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-583" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/15/583/" class="article-date">
  <time class="dt-published" datetime="2019-05-15T03:34:44.000Z" itemprop="datePublished">2019-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/15/583/">详解lua的string与hex数据(十六进制)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="本文希望阐述的问题"><a href="#本文希望阐述的问题" class="headerlink" title="本文希望阐述的问题"></a>本文希望阐述的问题</h1><p>在lua中处理 string 与 hex(十六进制数) 的思维转换</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>luat在处理通信的时候,总会设计到数据处理,例如:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">socket:send</span><br><span class="line">socket:recv</span><br><span class="line">spi.send</span><br><span class="line">spi.recv</span><br><span class="line">uart.<span class="built_in">write</span></span><br></pre></td></tr></table></figure>
<p>这些方法要么发送的string,要么返回string, 而不是使用其他编程语言的byte[]/char[], 因为lua没有byte和char</p>
<h2 id="什么是hex"><a href="#什么是hex" class="headerlink" title="什么是hex"></a>什么是hex</h2><p>先看hex的表现形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">字符串&quot;1&quot; 的 ASCII码是 0x31</span><br><span class="line">字符串&quot;2&quot; 的 ASCII码是 0x32</span><br><span class="line"></span><br><span class="line">0x3132         -- 数值标识</span><br><span class="line">&quot;3132&quot;         -- hex字符串,这个给人看的HEX字符串</span><br><span class="line">&quot;12&quot;           -- 与0x3132等价一个lua string</span><br><span class="line">&#123;0x31, 0x32&#125;   -- lua数组(table)</span><br><span class="line">[0x31, 0x32]   -- java&#x2F;c&#x2F;c++的byte[]&#x2F;char[]</span><br></pre></td></tr></table></figure>
<h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><p>把0x3132写入uart, socket/spi都是同理</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 方法<span class="number">1</span>, 使用<span class="built_in">string</span>.<span class="built_in">char</span>, 逐个字节描述</span><br><span class="line"><span class="keyword">local</span> data = <span class="built_in">string</span>.<span class="built_in">char</span>(<span class="number">0x31</span>, <span class="number">0x32</span>)</span><br><span class="line">uart.<span class="built_in">write</span>(id, data)</span><br><span class="line"></span><br><span class="line">// 方法<span class="number">2</span>, 使用 <span class="built_in">string</span>.fromHex, 传入<span class="number">2</span>的倍数长度的hex字符串</span><br><span class="line"><span class="keyword">local</span> data = <span class="built_in">string</span>.fromHex(<span class="string">&quot;3132&quot;</span>)</span><br><span class="line">uart.<span class="built_in">write</span>(id, data)</span><br><span class="line"></span><br><span class="line">// 方法<span class="number">3</span>, 使用pack库, H代表<span class="number">2</span>字节符号数, I代表<span class="number">4</span>字节无符号数, wiki可查</span><br><span class="line"><span class="keyword">local</span> data = pack.pack(<span class="string">&quot;H&quot;</span>, <span class="number">0x3132</span>)</span><br><span class="line">uart.<span class="built_in">write</span>(id, data)</span><br></pre></td></tr></table></figure>
<p>将socket读取的数据转换为数值, uart/spi均同理</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> re, data = socket:recv(<span class="number">1000</span>) <span class="comment">-- 等待1秒</span></span><br><span class="line"><span class="comment">-- 注意, data是lua string, 内容是 &quot;12&quot;, 对应hex值 [0x31,0x32]</span></span><br><span class="line"><span class="comment">-- lua string不是数组不是table,不能直接下标读取</span></span><br><span class="line">打印其hex字符串形式</span><br><span class="line"><span class="keyword">local</span> hexStr, <span class="built_in">len</span> = <span class="built_in">string</span>.toHex(data) <span class="comment">-- 返回值&quot;3132&quot;,2,后面的2是长度</span></span><br><span class="line"><span class="built_in">print</span>(hexStr) <span class="comment">-- 将输出 3132</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- 方式1,使用pack.unpack</span></span><br><span class="line"><span class="comment">-- 分解为2个数, b是无符号单字节数,2代表数量</span></span><br><span class="line"><span class="keyword">local</span> nexti, numa, numb = pack.<span class="built_in">unpack</span>(data, <span class="string">&quot;b2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(numa) <span class="comment">-- 数字 31</span></span><br><span class="line"><span class="built_in">print</span>(numb) <span class="comment">-- 数字 32</span></span><br><span class="line">直接取第二个数, 位置写<span class="number">2</span></span><br><span class="line"><span class="keyword">local</span> nexti, numb = pack.<span class="built_in">unpack</span>(data,<span class="string">&quot;b&quot;</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(numb) <span class="comment">-- 数字 32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2,使用string.byte</span></span><br><span class="line"><span class="keyword">local</span> numa = <span class="built_in">string</span>.<span class="built_in">byte</span>(data, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">local</span> numb = <span class="built_in">string</span>.<span class="built_in">byte</span>(data, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(numa) <span class="comment">-- 数字 31</span></span><br><span class="line"><span class="built_in">print</span>(numb) <span class="comment">-- 数字 32</span></span><br></pre></td></tr></table></figure>
<h2 id="扩展链接"><a href="#扩展链接" class="headerlink" title="扩展链接"></a>扩展链接</h2><p>string.byte用法<br><a target="_blank" rel="noopener" href="http://wiki.openluat.com/doc/luatApi/#stringbyte">http://wiki.openluat.com/doc/luatApi/#stringbyte</a></p>
<p>string.fromHex用法<br><a target="_blank" rel="noopener" href="http://wiki.openluat.com/doc/luatApi/#stringfromhex">http://wiki.openluat.com/doc/luatApi/#stringfromhex</a></p>
<p>string.toHex用法<br><a target="_blank" rel="noopener" href="http://wiki.openluat.com/doc/luatApi/#stringtohex">http://wiki.openluat.com/doc/luatApi/#stringtohex</a></p>
<p>pack库<br><a target="_blank" rel="noopener" href="http://wiki.openluat.com/doc/luatApi/#packpack">http://wiki.openluat.com/doc/luatApi/#packpack</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/05/15/583/" data-id="ckkfmdgcd0088vkcgem5e3l92" data-title="详解lua的string与hex数据(十六进制)" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-582" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/14/582/" class="article-date">
  <time class="dt-published" datetime="2019-05-14T03:47:13.000Z" itemprop="datePublished">2019-05-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/14/582/">合宙air202连接使用MQTT连接移动OneNet教程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <pre><code>                        &lt;p&gt;本文介绍合宙模块如何使用MQTT的方式连接中国移动的OneNet平台&lt;/p&gt;&lt;p&gt;测试工程:&amp;lt;Air800_202 连接OneNet 测试.bsp&amp;gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2270 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/合宙主图.png&quot; alt=&quot;&quot; width=&quot;602&quot; height=&quot;470&quot;&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;创建产品&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;连接:https://open.iot.10086.cn&lt;/p&gt;&lt;p&gt;创建产品的时候，选择MQTT协议接入&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2255 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/创建产品.png&quot; alt=&quot;&quot; width=&quot;1393&quot; height=&quot;521&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;创建数据模板&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;数据模板就是这个设备具有属性。比如温室度或者湿度；比如开关等。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2266 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/为产品添加数据模板模板.png&quot; alt=&quot;&quot; width=&quot;1190&quot; height=&quot;413&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;3、添加设备&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2260 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/添加设备1.png&quot; alt=&quot;&quot; width=&quot;552&quot; height=&quot;527&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2261 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/添加设备2.png&quot; alt=&quot;&quot; width=&quot;1185&quot; height=&quot;365&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;4、激活网络&lt;/p&gt;&lt;p&gt;任何操作都需要激活网络&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2256 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/获取IP.png&quot; alt=&quot;&quot; width=&quot;904&quot; height=&quot;270&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;5、MQTT连接&lt;/p&gt;&lt;p&gt;注意固件版本升级最新的:写文档使用的固件版本为:AirM2M_V5669_AT_S_SSL&lt;/p&gt;&lt;p&gt;连接的重点是3个参数要对应。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2263 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/填写连接参数.png&quot; alt=&quot;&quot; width=&quot;1595&quot; height=&quot;597&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2262 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/填写产品参数.png&quot; alt=&quot;&quot; width=&quot;1409&quot; height=&quot;434&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2258 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/设备上线.png&quot; alt=&quot;&quot; width=&quot;1397&quot; height=&quot;418&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;推送数据&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;推送数据是理解难点。必须根据有效负载组装数据。要不然云端是不识别的，如果使用MQTT.fx发送，表现的形式就是MQTT会断开。&lt;/p&gt;&lt;p&gt;oneNet平台要求真实的有效数据前需要加数据类型和长度，平台才能识别。&lt;/p&gt;&lt;p&gt;合宙的模块，可以传送hex的方式来完成这个功能。&lt;/p&gt;&lt;p&gt;在数据处理的时候，先把json压缩后，然后在转换成hex。长度是json压缩后的。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2268 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/在有效数据前添加数据类型和长度.png&quot; alt=&quot;&quot; width=&quot;1398&quot; height=&quot;523&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2269 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/转换字符串为hex.png&quot; alt=&quot;&quot; width=&quot;1879&quot; height=&quot;406&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2264 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/推送数据.png&quot; alt=&quot;&quot; width=&quot;1400&quot; height=&quot;687&quot;&gt;&lt;/p&gt;&lt;p&gt;下面是我测试的数据模板的完整数据格式。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2265 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/完整的数据.png&quot; alt=&quot;&quot; width=&quot;939&quot; height=&quot;814&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;下发数据&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;平台下发数据,默认是下发$creq&amp;nbsp;topic ，这个topic 不用显示定义也能收到数据。之前把数据格式设置成了hex ，所以收到的数据也是hex 字符串。自己在解析一下即可。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;alignnone wp-image-2267 size-full&quot; src=&quot;http://www.yinerda.com/wp-content/uploads/2019/05/下发数据.png&quot; alt=&quot;&quot; width=&quot;1519&quot; height=&quot;746&quot;&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/05/14/582/" data-id="ckkfmdgcd0087vkcg2p9bbj72" data-title="合宙air202连接使用MQTT连接移动OneNet教程" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-581" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/27/581/" class="article-date">
  <time class="dt-published" datetime="2019-04-27T05:17:23.000Z" itemprop="datePublished">2019-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/27/581/">均衡擦写spiflash,数据掉电后不丢失.</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4>线性均衡擦写spiflash，掉电后，能够找到上次的地址，接着读写。<br></h4><p><br></p><div style='color: rgb(51, 51, 51); line-height: 19px; font-family: Consolas, "Courier New", monospace; font-size: 14px; font-weight: normal; white-space: pre; background-color: rgb(253, 246, 227);'><br><div><span style="color: rgb(147, 161, 161); font-style: italic;">--- 验证spi flash驱动接口 目前该驱动兼容w25q32 bh25q32</span></div><div><span style="color: rgb(38, 139, 210);">require</span><span style="color: rgb(42, 161, 152);">"spiFlash"</span></div><div><span style="color: rgb(38, 139, 210);">require</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(42, 161, 152);">"pm"</span></div><div><span style="color: rgb(38, 139, 210);">require</span><span style="color: rgb(42, 161, 152);">"utils"</span><span style="color: rgb(51, 51, 51);"> </span></div><br><div><span style="color: rgb(51, 51, 51);">pm.</span><span style="color: rgb(38, 139, 210);">wake</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"testSpiFlash"</span><span style="color: rgb(51, 51, 51);">)</span></div><br><div><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> flashlist </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> {</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; [</span><span style="color: rgb(211, 54, 130);">0xEF15</span><span style="color: rgb(51, 51, 51);">] </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(42, 161, 152);">'w25q32'</span><span style="color: rgb(51, 51, 51);">,</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; [</span><span style="color: rgb(211, 54, 130);">0xEF16</span><span style="color: rgb(51, 51, 51);">] </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(42, 161, 152);">'w25q64'</span><span style="color: rgb(51, 51, 51);">,</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; [</span><span style="color: rgb(211, 54, 130);">0xEF17</span><span style="color: rgb(51, 51, 51);">] </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(42, 161, 152);">'w25q128'</span><span style="color: rgb(51, 51, 51);">,</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; [</span><span style="color: rgb(211, 54, 130);">0x6815</span><span style="color: rgb(51, 51, 51);">] </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(42, 161, 152);">'bh25q32'</span><span style="color: rgb(51, 51, 51);">,</span></div><div><span style="color: rgb(51, 51, 51);">}</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> HexToChar</span><span style="color: rgb(51, 51, 51);">(bChar) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((bChar</span><span style="color: rgb(133, 153, 0);">&gt;=</span><span style="color: rgb(211, 54, 130);">0x30</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);">(bChar</span><span style="color: rgb(133, 153, 0);">&lt;=</span><span style="color: rgb(211, 54, 130);">0x39</span><span style="color: rgb(51, 51, 51);">)) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bChar</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">bChar</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(211, 54, 130);">0x30</span><span style="color: rgb(51, 51, 51);">;</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((bChar</span><span style="color: rgb(133, 153, 0);">&gt;=</span><span style="color: rgb(211, 54, 130);">0x41</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);">(bChar</span><span style="color: rgb(133, 153, 0);">&lt;=</span><span style="color: rgb(211, 54, 130);">0x46</span><span style="color: rgb(51, 51, 51);">)) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(147, 161, 161); font-style: italic;">--// Capital&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bChar</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">bChar</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(211, 54, 130);">0x37</span><span style="color: rgb(51, 51, 51);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((bChar</span><span style="color: rgb(133, 153, 0);">&gt;=</span><span style="color: rgb(211, 54, 130);">0x61</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);">(bChar</span><span style="color: rgb(133, 153, 0);">&lt;=</span><span style="color: rgb(211, 54, 130);">0x66</span><span style="color: rgb(51, 51, 51);">)) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--//littlecase&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bChar</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">bChar</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(211, 54, 130);">0x57</span><span style="color: rgb(51, 51, 51);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bChar </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(211, 54, 130);">0xff</span><span style="color: rgb(51, 51, 51);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(133, 153, 0);">return</span><span style="color: rgb(51, 51, 51);"> bChar;</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(147, 161, 161); font-style: italic;">-- spiflash 大小 256*16*4*1024 字节</span></div><div><span style="color: rgb(51, 51, 51);">FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">10</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--数量*4K</span></div><div><span style="color: rgb(51, 51, 51);">SPI_MAXSIZE</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">16</span></div><div><span style="color: rgb(51, 51, 51);">SPI_COUNT</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">ReadIndex_S</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">WriteIndex_S</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">spi_flash </span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spiFlash.</span><span style="color: rgb(38, 139, 210);">setup</span><span style="color: rgb(51, 51, 51);">(spi.</span><span style="color: rgb(38, 139, 210);">SPI_1</span><span style="color: rgb(51, 51, 51);">, pio.</span><span style="color: rgb(38, 139, 210);">P0_10</span><span style="color: rgb(51, 51, 51);">)</span></div><br><div><span style="color: rgb(147, 161, 161); font-style: italic;">--把数据格式化为16进制 高位补0 ，2字节&nbsp;&nbsp;&nbsp; 写入spiflash指定地址</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> write_Index</span><span style="color: rgb(51, 51, 51);">(addr,data)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> strhex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">string.format</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"%04X"</span><span style="color: rgb(51, 51, 51);">,data)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">write</span><span style="color: rgb(51, 51, 51);">(addr,string.</span><span style="color: rgb(38, 139, 210);">fromHex</span><span style="color: rgb(51, 51, 51);">(strhex)) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readindexdata</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(addr, </span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readdatahex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readindexdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(readdatahex</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">strhex) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">write</span><span style="color: rgb(51, 51, 51);">(addr,string.</span><span style="color: rgb(38, 139, 210);">fromHex</span><span style="color: rgb(51, 51, 51);">(strhex)) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readindexdata</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(addr, </span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readdatahex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readindexdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"index err"</span><span style="color: rgb(51, 51, 51);">,readdatahex,addr,data)</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> SPI_READ</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> indexaddr</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);"> (ReadIndex</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">WriteIndex) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--&nbsp; //空队列，直接返回</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">info</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"empty"</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- local readSPIdata_pre= spi_flash:read(ReadIndex*256, 10)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- local readSPIdata_pre_hex=string.toHex(readSPIdata_pre)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--if( (readSPIdata_pre_hex~='30303030303030303030') and (readSPIdata_pre_hex~='FFFFFFFFFFFFFFFFFFFF') ) then&nbsp;&nbsp; --预读 不等于空 或者 0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readSPIdata</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">, </span><span style="color: rgb(211, 54, 130);">60</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- STRLENGTH=string.len(readSPIdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- log.info("leng:",STRLENGTH) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">write</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(42, 161, 152);">"000000000000"</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--读取完毕后清零</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- log.debug("W",WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- else&nbsp; --队列非空&nbsp; 但是预读不准确，强制清零</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- log.error("RF:",ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- log.info("W",WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--log.error("RFF:",readSPIdata_pre_hex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- spi_flash:write(ReadIndex*256,"000000000000")</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> (ReadIndex</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(51, 51, 51);">SPI_MAXSIZE;</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--第一次读地址 </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--&nbsp;&nbsp; &gt;=16</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((ReadIndex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"erase4K"</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(211, 54, 130);">2048</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">6</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--索引写完了一遍</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; indexaddr</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">ReadIndex</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(211, 54, 130);">2048</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">6</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--strhex_index=string.format("%04X",ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- spi_flash:write(ReadIndex*2+(FLASH_COUNT+4)*4096,string.fromHex(strhex_index)) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">debug</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"+"</span><span style="color: rgb(51, 51, 51);">,readSPIdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">debug</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"R"</span><span style="color: rgb(51, 51, 51);">,ReadIndex) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- return readSPIdata</span></div><br><div><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(147, 161, 161); font-style: italic;">--判断spiflash 是否有剩余空间&nbsp;&nbsp; 返回 0-没有空间&nbsp;&nbsp;&nbsp; 1-有空间</span></div><div><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> SPI_Free</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--注意： WriteIndex+16不可以大于65535&nbsp; 否则为nil 报错！！！！！！</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((WriteIndex</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(51, 51, 51);"> SPI_MAXSIZE</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">ReadIndex)&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- //队列已满时，不执行入队操作</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--队列空</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">return</span><span style="color: rgb(51, 51, 51);"> result</span></div><div><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> SPI_WRITE</span><span style="color: rgb(51, 51, 51);">(SPI_user_data)</span></div><div><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writeDataLength</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">string.len</span><span style="color: rgb(51, 51, 51);">(SPI_user_data)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readSPIdata_pre</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">((WriteIndex)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">, </span><span style="color: rgb(211, 54, 130);">10</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readSPIdata_pre_hex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readSPIdata_pre)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> indexaddr</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(readSPIdata_pre_hex</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(42, 161, 152);">'FFFFFFFFFFFFFFFFFFFF'</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- 预写地址数据正确</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">write</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">,SPI_user_data)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATA01</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">256</span><span style="color: rgb(51, 51, 51);">, writeDataLength) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">( DATA01</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">SPI_user_data) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写入正确</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写入错误</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> (WriteIndex</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(51, 51, 51);"> SPI_MAXSIZE; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--//尾部元素指向下一个空间位置,取模运算保证了索引不越界（余数一定小于除数）</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(211, 54, 130);">2048</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">3</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--索引写完了一遍</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; indexaddr</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">WriteIndex</span><span style="color: rgb(133, 153, 0);">%</span><span style="color: rgb(211, 54, 130);">2048</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">3</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(indexaddr</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--local strhex=string.format("%04X",WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--spi_flash:write(WriteIndex*2+(FLASH_COUNT+3)*4096,string.fromHex(strhex))&nbsp;&nbsp; --记录下一个地址索引</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">debug</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"W"</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">return</span><span style="color: rgb(51, 51, 51);"> result</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(147, 161, 161); font-style: italic;">--带比较写入spiflash&nbsp;&nbsp; 返回 0-满了&nbsp;&nbsp;&nbsp; 1-写入成功</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> spiWriteDataCheck</span><span style="color: rgb(51, 51, 51);">(userdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(38, 139, 210);">SPI_Free</span><span style="color: rgb(51, 51, 51);">()</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--有空间</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">SPI_WRITE</span><span style="color: rgb(51, 51, 51);">(userdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(result</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写入错误 再写一遍</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(38, 139, 210);">SPI_Free</span><span style="color: rgb(51, 51, 51);">()</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">SPI_WRITE</span><span style="color: rgb(51, 51, 51);">(teststr) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">return</span><span style="color: rgb(51, 51, 51);"> result</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(147, 161, 161); font-style: italic;">-- 从spiflash读qu size个字节数据 转为16进制</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> spiHexToDec</span><span style="color: rgb(51, 51, 51);">(address,size)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> hexdata</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(address,size)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readdatahex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(hexdata)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">return</span><span style="color: rgb(51, 51, 51);"> readdatahex</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(147, 161, 161); font-style: italic;">--二分查找索引</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> findIndex</span><span style="color: rgb(51, 51, 51);">(MAXINDEX,baseAddress1,baseAddress2,baseAddress3,W_R_index)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> miniindex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> maxindex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">MAXINDEX</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> read_flags1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(42, 161, 152);">'0000'</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> read_flags2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(42, 161, 152);">'0000'</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> read_flags3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(42, 161, 152);">'0000'</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> offsetAddress</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> erFenCount</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">11</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--分11段查找</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">while</span><span style="color: rgb(51, 51, 51);">(erFenCount</span><span style="color: rgb(133, 153, 0);">&gt;</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">do</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offsetAddress</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">(maxindex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(51, 51, 51);">miniindex)</span><span style="color: rgb(133, 153, 0);">/</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- 重新确定偏移量 对于基地址的绝对位置</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_flags1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">spiHexToDec</span><span style="color: rgb(51, 51, 51);">(baseAddress1</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">offsetAddress,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_flags2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">spiHexToDec</span><span style="color: rgb(51, 51, 51);">(baseAddress2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">offsetAddress,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read_flags3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">spiHexToDec</span><span style="color: rgb(51, 51, 51);">(baseAddress3</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">offsetAddress,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((read_flags1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">read_flags2) </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (read_flags2</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">read_flags3) </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (read_flags1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(42, 161, 152);">'FFFF'</span><span style="color: rgb(51, 51, 51);">)) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--全部相等</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maxindex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">offsetAddress</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--取后半部分</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; miniindex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">offsetAddress</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; erFenCount</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">erFenCount</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sys.</span><span style="color: rgb(38, 139, 210);">wait</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((maxindex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(51, 51, 51);">miniindex)</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; log.</span><span style="color: rgb(38, 139, 210);">info</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">'%%%%%'</span><span style="color: rgb(51, 51, 51);">,miniindex,maxindex) </span><span style="color: rgb(133, 153, 0);">end</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress1</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress3</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">tonumber</span><span style="color: rgb(51, 51, 51);">(readIndex_fromhex1,</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">tonumber</span><span style="color: rgb(51, 51, 51);">(readIndex_fromhex2,</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">tonumber</span><span style="color: rgb(51, 51, 51);">(readIndex_fromhex3,</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">readIndex_fromhex2)&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">~=</span><span style="color: rgb(42, 161, 152);">'FFFF'</span><span style="color: rgb(51, 51, 51);">) ) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- readIndex1=tonumber(readIndex_fromhex1,16)&nbsp; --十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(W_R_index</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写索引&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"W index1"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeIndex1"</span><span style="color: rgb(51, 51, 51);">,readIndex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--读索引</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"R index1"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"readIndex1"</span><span style="color: rgb(51, 51, 51);">,readIndex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((readIndex_fromhex2</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">readIndex_fromhex3)&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (readIndex_fromhex2</span><span style="color: rgb(133, 153, 0);">~=</span><span style="color: rgb(42, 161, 152);">'FFFF'</span><span style="color: rgb(51, 51, 51);">) ) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- readIndex2=tonumber(readIndex_fromhex2,16)&nbsp; --十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(W_R_index</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写索引&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex2</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"W index2"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeIndex2"</span><span style="color: rgb(51, 51, 51);">,readIndex2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--读索引</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex2</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"R index2"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"readIndex2"</span><span style="color: rgb(51, 51, 51);">,readIndex2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">readIndex_fromhex3)&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">~=</span><span style="color: rgb(42, 161, 152);">'FFFF'</span><span style="color: rgb(51, 51, 51);">) ) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- readIndex3=tonumber(readIndex_fromhex3,16)&nbsp; --十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(W_R_index</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写索引&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex3</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"W index3"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeIndex3"</span><span style="color: rgb(51, 51, 51);">,readIndex3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--读索引</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex3</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"R index3"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"readIndex3"</span><span style="color: rgb(51, 51, 51);">,readIndex3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(miniindex</span><span style="color: rgb(133, 153, 0);">&gt;=</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress1</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readflags3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">(baseAddress3</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">miniindex</span><span style="color: rgb(133, 153, 0);">-</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex2</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags2)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_fromhex3</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">string.</span><span style="color: rgb(38, 139, 210);">toHex</span><span style="color: rgb(51, 51, 51);">(readflags3)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">readIndex_fromhex2) </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (readIndex_fromhex2</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">readIndex_fromhex3) </span><span style="color: rgb(133, 153, 0);">and</span><span style="color: rgb(51, 51, 51);"> (readIndex_fromhex1</span><span style="color: rgb(133, 153, 0);">~=</span><span style="color: rgb(42, 161, 152);">'FFFF'</span><span style="color: rgb(51, 51, 51);">) ) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--这是最后的救命稻草了</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex1</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">tonumber</span><span style="color: rgb(51, 51, 51);">(readIndex_fromhex1,</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--十进制数</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(W_R_index</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写索引&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"W index_pre"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeIndex_pre"</span><span style="color: rgb(51, 51, 51);">,readIndex1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--读索引</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">readIndex1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"R index_pre"</span><span style="color: rgb(51, 51, 51);">,readIndex_fromhex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"readIndex_pre"</span><span style="color: rgb(51, 51, 51);">,readIndex1)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">&nbsp; </span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">-- 前一个也不对&nbsp; 死定了</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--接收死刑吧，确实找不到索引了&nbsp; 重新初始化。</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--出现异常情况，理论上不可能为nil&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">((readIndex1</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(181, 137, 0);">nil</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">or</span><span style="color: rgb(51, 51, 51);"> (readIndex2</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(181, 137, 0);">nil</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">or</span><span style="color: rgb(51, 51, 51);"> (readIndex3</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(181, 137, 0);">nil</span><span style="color: rgb(51, 51, 51);">) ) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"nil&nbsp; err&nbsp; err"</span><span style="color: rgb(51, 51, 51);">)&nbsp; findresult</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(147, 161, 161); font-style: italic;">--；预读初始化</span></div><div><span style="color: rgb(51, 51, 51);">flash_Inint_Flags</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(42, 161, 152);">"17513167902"</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> SPI_ININT_PRE</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--清除必须操作&nbsp; 必须清楚后才能写数据</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> writeOK_flag</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);"> spi_flash:</span><span style="color: rgb(38, 139, 210);">read</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">11</span><span style="color: rgb(51, 51, 51);">)&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--是否第一次写入数据</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> next_step</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeOK_flag"</span><span style="color: rgb(51, 51, 51);">,writeOK_flag)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(writeOK_flag</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(51, 51, 51);">flash_Inint_Flags) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next_step</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"writeOK_flag14"</span><span style="color: rgb(51, 51, 51);">, spi_flash:</span><span style="color: rgb(38, 139, 210);">write</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">,flash_Inint_Flags))</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next_step</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">2</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"next_step="</span><span style="color: rgb(51, 51, 51);">,next_step)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> count</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readindex_start</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> writeindex_start</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">local</span><span style="color: rgb(51, 51, 51);"> readIndex_flag</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(next_step</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><br><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(38, 139, 210);">findIndex</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">3</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--没有找到上次的 写索引 全部清除</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next_step</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"========================"</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(38, 139, 210);">findIndex</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">6</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">0</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--没有找到上次的 读索引 全部清除</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next_step</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(next_step</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"indexR_W1"</span><span style="color: rgb(51, 51, 51);">,ReadIndex,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readIndex_flag</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp; count</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(next_step</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.</span><span style="color: rgb(38, 139, 210);">error</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"indexR_W2"</span><span style="color: rgb(51, 51, 51);">,ReadIndex,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">'spi flash erase..........'</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">while</span><span style="color: rgb(51, 51, 51);">(count</span><span style="color: rgb(133, 153, 0);">&lt;</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">/</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">)) </span><span style="color: rgb(133, 153, 0);">do</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase64K</span><span style="color: rgb(51, 51, 51);">(count</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">16</span><span style="color: rgb(51, 51, 51);">) count</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">count</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">&nbsp; sys.</span><span style="color: rgb(38, 139, 210);">wait</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">)&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--清除数据区</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--清除读写索引区</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">3</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">6</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spi_flash:</span><span style="color: rgb(38, 139, 210);">erase4K</span><span style="color: rgb(51, 51, 51);">((FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">1024</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--第一次读写flash 索引置零</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteIndex</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--把下一次预读写的索引写入spiflash</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">3</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">4</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(WriteIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><br><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">6</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">7</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">write_Index</span><span style="color: rgb(51, 51, 51);">(ReadIndex</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(51, 51, 51);">(FLASH_COUNT</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">8</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(133, 153, 0);">*</span><span style="color: rgb(211, 54, 130);">4096</span><span style="color: rgb(51, 51, 51);">,ReadIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">'spi flash eraseinit OK'</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sys.</span><span style="color: rgb(38, 139, 210);">wait</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">1000</span><span style="color: rgb(51, 51, 51);">) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><br><br><div><span style="color: rgb(51, 51, 51);">SPI_ININT_OK</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(38, 139, 210);">SPI_ININT_PRE</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">SPI_ININT_OK</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">2</span></div><br><div><span style="color: rgb(51, 51, 51);">yesycount</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">1</span></div><div><span style="color: rgb(51, 51, 51);">xinhaoliang</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(133, 153, 0);">function</span><span style="color: rgb(38, 139, 210);"> writespiflashtest</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; syserrrcode</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(211, 54, 130);">0</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">while</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(181, 137, 0);">true</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">do</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--- if(xinhaoliang==0) then </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(SPI_ININT_OK</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; teststr</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(38, 139, 210);">string.format</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"test adcde:ftydtyfdfdfgurgjfdhguirhgujgh#&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; %d"</span><span style="color: rgb(51, 51, 51);">, yesycount)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(38, 139, 210);">spiWriteDataCheck</span><span style="color: rgb(51, 51, 51);">(teststr)</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp; </span><span style="color: rgb(147, 161, 161); font-style: italic;">--写入正确</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yesycount</span><span style="color: rgb(133, 153, 0);">=</span><span style="color: rgb(51, 51, 51);">yesycount</span><span style="color: rgb(133, 153, 0);">+</span><span style="color: rgb(211, 54, 130);">1</span><span style="color: rgb(51, 51, 51);"> </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">else</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(147, 161, 161); font-style: italic;">--满了</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">print</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(42, 161, 152);">"full"</span><span style="color: rgb(51, 51, 51);">,WriteIndex)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sys.</span><span style="color: rgb(38, 139, 210);">wait</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">5</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">sys.</span><span style="color: rgb(38, 139, 210);">taskInit</span><span style="color: rgb(51, 51, 51);">(writespiflashtest) </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">while</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(181, 137, 0);">true</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(133, 153, 0);">do</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">if</span><span style="color: rgb(51, 51, 51);">(SPI_ININT_OK</span><span style="color: rgb(133, 153, 0);">==</span><span style="color: rgb(211, 54, 130);">2</span><span style="color: rgb(51, 51, 51);">) </span><span style="color: rgb(133, 153, 0);">then</span><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(38, 139, 210);">SPI_READ</span><span style="color: rgb(51, 51, 51);">()</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sys.</span><span style="color: rgb(38, 139, 210);">wait</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(211, 54, 130);">15</span><span style="color: rgb(51, 51, 51);">)</span></div><div><span style="color: rgb(51, 51, 51);">&nbsp;&nbsp;&nbsp; </span><span style="color: rgb(133, 153, 0);">end</span></div><div><span style="color: rgb(133, 153, 0);">end</span><span style="color: rgb(51, 51, 51);">)</span></div><br></div><p><br></p><p><br></p><p><br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/04/27/581/" data-id="ckkfmdgg400f7vkcgeize1nmp" data-title="均衡擦写spiflash,数据掉电后不丢失." class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-580" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/25/580/" class="article-date">
  <time class="dt-published" datetime="2019-04-25T13:08:46.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/25/580/">aliyun的topic说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p class="MsoNormal">说在前面，所有的<span lang="EN-US">topic</span>都是需要配合物模型使用<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span class="MsoHyperlink"><span lang="EN-US"><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/73727.html?spm=a2c4g.11186623.6.566.727b77a1urids6">https://help.aliyun.com/document_detail/73727.html?spm=a2c4g.11186623.6.566.727b77a1urids6</a></span></span><span lang="EN-US"><o:p></o:p></span></p><h2>属性<span lang="EN-US"><o:p></o:p></span></h2><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="图片_x0020_1" o:spid="_x0000_i1032" type="#_x0000_t75"
 style='width:242.25pt;height:185.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--></span><img src="http://oldask.openluat.com/image/show/attachments-2019-04-QwwHRIfP5cc1b0968da4b.png" style="width: 161.5px;" class="img-responsive">所有<span lang="EN-US">properties</span>下面的都是属性，对应使用</p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/event/property/post<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/service/property/set</span></p><p class="MsoNormal"><img src="http://oldask.openluat.com/image/show/attachments-2019-04-tJ57sDSe5cc1b0ad0d396.png" style="width: 50%;" class="img-responsive"></p><p class="MsoNormal"><span lang="EN-US"><o:p><br></o:p></span></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_2" o:spid="_x0000_i1031" type="#_x0000_t75" style='width:404.25pt;
 height:42pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image003.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><h2>事件<span lang="EN-US"><o:p></o:p></span></h2><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_3" o:spid="_x0000_i1030" type="#_x0000_t75" style='width:219.75pt;
 height:201.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image005.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">Events</span>下面是事件，对应<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1HnMJCnqYK/${deviceName}/thing/event/${tsl.event.identifer}/post<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span><img src="http://oldask.openluat.com/image/show/attachments-2019-04-zXNDWxYC5cc1b0be69393.png" style="width: 146.5px;" class="img-responsive"><span lang="EN-US">${tsl.event.identifer}</span>字段说明</p><p class="MsoNormal">事件都是上报，默认会添加属性上报的<span lang="EN-US">topic<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">thing.event.property.post<o:p></o:p></span></p><p class="MsoNormal">对应<span lang="EN-US">topic</span>就是<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1HnMJCnqYK/${deviceName}/thing/event/property/post<o:p></o:p></span></p><p class="MsoNormal">其实也就是我们第一部分属性上报的<span lang="EN-US">topic</span></p><p class="MsoNormal"><img src="http://oldask.openluat.com/image/show/attachments-2019-04-olJWuspe5cc1b0dfe35cc.png" style="width: 164px;" class="img-responsive"><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span><img src="http://oldask.openluat.com/image/show/attachments-2019-04-bBrvkvhx5cc1b0ee7a586.png" style="width: 183.5px;" class="img-responsive"></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_4" o:spid="_x0000_i1029" type="#_x0000_t75" style='width:246pt;
 height:191.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image007.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_5" o:spid="_x0000_i1028" type="#_x0000_t75" style='width:275.25pt;
 height:201pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image009.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal">自己添加的事件说明<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal">事件标识对应<span lang="EN-US">identifier</span>，我这里是<span lang="EN-US">shijian</span>，上报的<span lang="EN-US">topic</span>就是<span lang="EN-US">thing.event.shijian.post<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1HnMJCnqYK/${deviceName}/thing/event/shijian/post<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span></p><h2>服务<span lang="EN-US"><o:p></o:p></span></h2><p class="MsoNormal"><span lang="EN-US">&nbsp;</span><img src="http://oldask.openluat.com/image/show/attachments-2019-04-Bow4HW865cc1b0f98e5d5.png" style="width: 215.5px;" class="img-responsive"></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_6" o:spid="_x0000_i1027" type="#_x0000_t75" style='width:323.25pt;
 height:258.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image011.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">Services</span>下面是服务对应<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/service/${tsl.event.identifer}<o:p></o:p></span></p><p class="MsoNormal">和事件相反，服务只能订阅<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal">默认添加<span lang="EN-US">thing.service.property.set</span>，和<span lang="EN-US">thing.service.property.get<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/service/property/set<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/service/property/get<o:p></o:p></span></p><p class="MsoNormal">可以看到其实还是第一部分的属性获取<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal">第二个<span lang="EN-US">topic</span>我没用过不知道干啥的，估计可以通过这个下发属性。<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span><img src="http://oldask.openluat.com/image/show/attachments-2019-04-dzDHLB2M5cc1b11728fae.png" style="width: 132.5px;" class="img-responsive"></p><p class="MsoNormal"><img src="http://oldask.openluat.com/image/show/attachments-2019-04-eET8P1Si5cc1b12c78266.png" style="width: 163.5px;" class="img-responsive"><br></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_7" o:spid="_x0000_i1026" type="#_x0000_t75" style='width:198.75pt;
 height:195.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image013.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US"><!--[if gte vml 1]><v:shape
 id="图片_x0020_8" o:spid="_x0000_i1025" type="#_x0000_t75" style='width:245.25pt;
 height:207pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="file:///C:/Users/wusuo/AppData/Local/Temp/msohtmlclip1/01/clip_image015.png"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal">自己添加服务说明，这里选用异步，同步需要<span lang="EN-US">rrpc<o:p></o:p></span></p><p class="MsoNormal">其实有了上面例子很好理解<span lang="EN-US">thing.service.fuwu</span>，也就是<span lang="EN-US"><o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">/sys/a1PODPi5ohj/${deviceName}/thing/service/fuwu<o:p></o:p></span></p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span></p><h3>关于同步<span lang="EN-US">rrpc<o:p></o:p></span></h3><p class="MsoNormal"><span class="MsoHyperlink"><span lang="EN-US"><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/90567.html?spm=a2c4g.11186623.6.624.217bf9bc6sgX4I">https://help.aliyun.com/document_detail/90567.html?spm=a2c4g.11186623.6.624.217bf9bc6sgX4I</a></span></span><span lang="EN-US"><o:p></o:p></span></p><p class="li" style="margin: 4.5pt 0cm; text-indent: -18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><!--[if !supportLists]--><span lang="EN-US" style="font-size:10.0pt;
mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#333333">·<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US" style="font-size:10.5pt;
font-family:&quot;Arial&quot;,sans-serif;color:#333333">RRPC</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">请求消息</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">Topic</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">：</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">/sys/${YourProductKey}/${YourDeviceName}/rrpc/request/${messageId}<o:p></o:p></span></p><p class="li" style="margin: 4.5pt 0cm; text-indent: -18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><!--[if !supportLists]--><span lang="EN-US" style="font-size:10.0pt;
mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#333333">·<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US" style="font-size:10.5pt;
font-family:&quot;Arial&quot;,sans-serif;color:#333333">RRPC</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">响应消息</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">Topic</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">：</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">/sys/${YourProductKey}/${YourDeviceName}/rrpc/response/${messageId}<o:p></o:p></span></p><p class="li" style="margin: 4.5pt 0cm; text-indent: -18pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><!--[if !supportLists]--><span lang="EN-US" style="font-size:10.0pt;
mso-bidi-font-size:10.5pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#333333">·<span style="font-variant-numeric: normal; font-variant-east-asian: normal; font-stretch: normal; font-size: 7pt; line-height: normal; font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><!--[endif]--><span lang="EN-US" style="font-size:10.5pt;
font-family:&quot;Arial&quot;,sans-serif;color:#333333">RRPC</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">订阅</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">Topic</span><span style="font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial;color:#333333">：</span><span lang="EN-US" style="font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">/sys/${YourProductKey}/${YourDeviceName}/rrpc/request/+<o:p></o:p></span></p><p class="MsoNormal">关键点就是订阅那个通配符<span lang="EN-US">topic</span>，因为每次<span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;
color:#333333">messageId</span><span style="mso-bidi-font-size:10.5pt;
mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;mso-bidi-font-family:
Arial;color:#333333">是不同的，也就是说每次都需要按照发过来的</span><span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">messageId</span><span style="mso-bidi-font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:
Arial;mso-bidi-font-family:Arial;color:#333333">重新组合</span><span lang="EN-US" style="mso-bidi-font-size:10.5pt;font-family:&quot;Arial&quot;,sans-serif;color:#333333">topic</span><span style="mso-bidi-font-size:10.5pt;mso-ascii-font-family:Arial;mso-hansi-font-family:
Arial;mso-bidi-font-family:Arial;color:#333333">。</span><span lang="EN-US"><o:p></o:p></span></p><p>



































































































</p><p class="MsoNormal"><span lang="EN-US">&nbsp;</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/04/25/580/" data-id="ckkfmdgcc0086vkcg8h6b4apu" data-title="aliyun的topic说明" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-579" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/12/579/" class="article-date">
  <time class="dt-published" datetime="2019-04-12T04:51:33.000Z" itemprop="datePublished">2019-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/12/579/">sim.openluat.com 其他接口</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>接上篇文章,里面是其他接口,注意在请求的时候要带上从登录接口中取到的cookie session.</p>
<p>月每日流量<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/data_in_month&quot;">http://sim.openluat.com/api/customer/data_in_month&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/&quot;">http://sim.openluat.com/&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3cxxe6e8db9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>月每日流量_c语言</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CURL *hnd = curl_easy_init();</span><br><span class="line"></span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_CUSTOMREQUEST, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_URL, <span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">curl_slist</span> *<span class="title">headers</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;cache-control: no-cache&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Connection: keep-alive&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Referer: http://sim.openluat.com/&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Accept: */*&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Content-Type: application/json;charset=utf-8&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Accept-Language: zh-CN,zh;q=0.9&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Accept-Encoding: gzip, deflate&quot;</span>);</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_HTTPHEADER, headers);</span><br><span class="line"></span><br><span class="line">CURLcode ret = curl_easy_perform(hnd);</span><br></pre></td></tr></table></figure>
<p>月每日流量_go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	url := <span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span></span><br><span class="line">	req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">nil</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Accept-Encoding&quot;</span>, <span class="string">&quot;gzip, deflate&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Accept-Language&quot;</span>, <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://sim.openluat.com/&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;keep-alive&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;cache-control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>)</span><br><span class="line">	res, _ := http.DefaultClient.Do(req)</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">	body, _ := ioutil.ReadAll(res.Body)</span><br><span class="line">	fmt.Println(res)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>月每日流量_java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span>)</span><br><span class="line">  .get()</span><br><span class="line">  .addHeader(<span class="string">&quot;Accept-Encoding&quot;</span>, <span class="string">&quot;gzip, deflate&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;Accept-Language&quot;</span>, <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://sim.openluat.com/&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;keep-alive&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;cache-control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>)</span><br><span class="line">  .build();</span><br><span class="line"></span><br><span class="line">Response response = client.newCall(request).execute();</span><br></pre></td></tr></table></figure>
<p>月每日流量_nodejs</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unirest = <span class="built_in">require</span>(<span class="string">&quot;unirest&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = unirest(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span>);</span><br><span class="line"></span><br><span class="line">req.headers(&#123;</span><br><span class="line">  <span class="string">&quot;Postman-Token&quot;</span>: <span class="string">&quot;b69a92ba-86f4-4c09-8605-124b7924b5e7&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://sim.openluat.com/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">req.end(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (res.error) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(res.error);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(res.body);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>月每日流量_objective-c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NSDictionary *headers &#x3D; @&#123; @&quot;Accept-Encoding&quot;: @&quot;gzip, deflate&quot;,</span><br><span class="line">                           @&quot;Accept-Language&quot;: @&quot;zh-CN,zh;q&#x3D;0.9&quot;,</span><br><span class="line">                           @&quot;User-Agent&quot;: @&quot;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;74.0.3724.8 Safari&#x2F;537.36&quot;,</span><br><span class="line">                           @&quot;Content-Type&quot;: @&quot;application&#x2F;json;charset&#x3D;utf-8&quot;,</span><br><span class="line">                           @&quot;Accept&quot;: @&quot;*&#x2F;*&quot;,</span><br><span class="line">                           @&quot;Referer&quot;: @&quot;http:&#x2F;&#x2F;sim.openluat.com&#x2F;&quot;,</span><br><span class="line">                           @&quot;Connection&quot;: @&quot;keep-alive&quot;,</span><br><span class="line">                           @&quot;cache-control&quot;: @&quot;no-cache&quot;;</span><br><span class="line"></span><br><span class="line">NSMutableURLRequest *request &#x3D; [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http:&#x2F;&#x2F;sim.openluat.com&#x2F;api&#x2F;customer&#x2F;data_in_month&quot;]</span><br><span class="line">                                                       cachePolicy:NSURLRequestUseProtocolCachePolicy</span><br><span class="line">                                                   timeoutInterval:10.0];</span><br><span class="line">[request setHTTPMethod:@&quot;GET&quot;];</span><br><span class="line">[request setAllHTTPHeaderFields:headers];</span><br><span class="line"></span><br><span class="line">NSURLSession *session &#x3D; [NSURLSession sharedSession];</span><br><span class="line">NSURLSessionDataTask *dataTask &#x3D; [session dataTaskWithRequest:request</span><br><span class="line">                                            completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;</span><br><span class="line">                                                if (error) &#123;</span><br><span class="line">                                                    NSLog(@&quot;%@&quot;, error);</span><br><span class="line">                                                &#125; else &#123;</span><br><span class="line">                                                    NSHTTPURLResponse *httpResponse &#x3D; (NSHTTPURLResponse *) response;</span><br><span class="line">                                                    NSLog(@&quot;%@&quot;, httpResponse);</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;];</span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure>
<p>月每日流量_ocaml</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">open Cohttp_lwt_unix</span><br><span class="line">open Cohttp</span><br><span class="line">open Lwt</span><br><span class="line"></span><br><span class="line">let uri = Uri.of_string <span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span> in</span><br><span class="line">let headers = Header.init ()</span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Accept-Encoding&quot;</span> <span class="string">&quot;gzip, deflate&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;User-Agent&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/json;charset=utf-8&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Referer&quot;</span> <span class="string">&quot;http://sim.openluat.com/&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;keep-alive&quot;</span></span><br><span class="line">  |&gt; fun h -&gt; Header.add h <span class="string">&quot;cache-control&quot;</span> <span class="string">&quot;no-cache&quot;</span></span><br><span class="line">in</span><br><span class="line"></span><br><span class="line">Client.call ~headers `GET uri</span><br><span class="line">&gt;&gt;= fun (res, body_stream) -&gt;</span><br><span class="line">  (* Do stuff with the result *)</span><br></pre></td></tr></table></figure>
<p>月每日流量_php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span> = <span class="keyword">new</span> HttpRequest();</span><br><span class="line"><span class="variable">$request</span>-&gt;setUrl(<span class="string">&#x27;http://sim.openluat.com/api/customer/data_in_month&#x27;</span>);</span><br><span class="line"><span class="variable">$request</span>-&gt;setMethod(HTTP_METH_GET);</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span>-&gt;setHeaders(<span class="keyword">array</span>(</span><br><span class="line">  <span class="string">&#x27;cache-control&#x27;</span> =&gt; <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Connection&#x27;</span> =&gt; <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Referer&#x27;</span> =&gt; <span class="string">&#x27;http://sim.openluat.com/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Accept&#x27;</span> =&gt; <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;User-Agent&#x27;</span> =&gt; <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Accept-Language&#x27;</span> =&gt; <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Accept-Encoding&#x27;</span> =&gt; <span class="string">&#x27;gzip, deflate&#x27;</span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$response</span> = <span class="variable">$request</span>-&gt;send();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$response</span>-&gt;getBody();</span><br><span class="line">&#125; <span class="keyword">catch</span> (HttpException <span class="variable">$ex</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$ex</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>月每日流量_ruby</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;uri&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;net/http&#x27;</span></span><br><span class="line"></span><br><span class="line">url = URI(<span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span>)</span><br><span class="line"></span><br><span class="line">http = Net::HTTP.new(url.host, url.port)</span><br><span class="line"></span><br><span class="line">request = Net::HTTP::Get.new(url)</span><br><span class="line">request[<span class="string">&quot;Accept-Encoding&quot;</span>] = <span class="string">&#x27;gzip, deflate&#x27;</span></span><br><span class="line">request[<span class="string">&quot;Accept-Language&quot;</span>] = <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span></span><br><span class="line">request[<span class="string">&quot;User-Agent&quot;</span>] = <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&#x27;</span></span><br><span class="line">request[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class="line">request[<span class="string">&quot;Accept&quot;</span>] = <span class="string">&#x27;*/*&#x27;</span></span><br><span class="line">request[<span class="string">&quot;Referer&quot;</span>] = <span class="string">&#x27;http://sim.openluat.com/&#x27;</span></span><br><span class="line">request[<span class="string">&quot;Connection&quot;</span>] = <span class="string">&#x27;keep-alive&#x27;</span></span><br><span class="line">request[<span class="string">&quot;cache-control&quot;</span>] = <span class="string">&#x27;no-cache&#x27;</span></span><br><span class="line"></span><br><span class="line">response = http.request(request)</span><br><span class="line">puts response.read_body</span><br></pre></td></tr></table></figure>
<p>月每日流量_swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> headers <span class="operator">=</span> [</span><br><span class="line">  <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://sim.openluat.com/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">NSMutableURLRequest</span>(url: <span class="type">NSURL</span>(string: <span class="string">&quot;http://sim.openluat.com/api/customer/data_in_month&quot;</span>)<span class="operator">!</span> <span class="keyword">as</span> <span class="type">URL</span>,</span><br><span class="line">                                        cachePolicy: .useProtocolCachePolicy,</span><br><span class="line">                                    timeoutInterval: <span class="number">10.0</span>)</span><br><span class="line">request.httpMethod <span class="operator">=</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">request.allHTTPHeaderFields <span class="operator">=</span> headers</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> session <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line"><span class="keyword">let</span> dataTask <span class="operator">=</span> session.dataTask(with: request <span class="keyword">as</span> <span class="type">URLRequest</span>, completionHandler: &#123; (data, response, error) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">if</span> (error <span class="operator">!=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span></span><br><span class="line">    <span class="built_in">print</span>(httpResponse)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">dataTask.resume()</span><br></pre></td></tr></table></figure>
<p>返回数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;data_in_month&quot;</span>: [</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0.46484375</span>,</span><br><span class="line">            <span class="number">0.189453125</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>本月流量消耗TOP5<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/data_top5_in_month&quot;">http://sim.openluat.com/api/customer/data_top5_in_month&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/&quot;">http://sim.openluat.com/&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3c3xxxdb9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>顶部数据<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/header_data&quot;">http://sim.openluat.com/api/customer/header_data&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/&quot;">http://sim.openluat.com/&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3c3xxxxxdb9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>卡信息<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/datapools/fetch?page=1%5E&amp;psize=9999&quot;">http://sim.openluat.com/api/customer/datapools/fetch?page=1^&amp;psize=9999&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/cardinformation&quot;">http://sim.openluat.com/cardinformation&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3xxxxxdb9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>预警管理<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/datapool_warning/fetch?datapool_id=7345&quot;">http://sim.openluat.com/api/customer/datapool_warning/fetch?datapool_id=7345&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/billinggroup&quot;">http://sim.openluat.com/billinggroup&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3c39e6exxxx2=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>年报表<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/data_in_year?year=2019&quot;">http://sim.openluat.com/api/customer/data_in_year?year=2019&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/reportdata&quot;">http://sim.openluat.com/reportdata&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3c39e6e8db9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>短信记录<br>curl “<a target="_blank" rel="noopener" href="http://sim.openluat.com/api/customer/sms/fetch?page=1%5E&amp;psize=10&quot;">http://sim.openluat.com/api/customer/sms/fetch?page=1^&amp;psize=10&quot;</a> -H “Accept-Encoding: gzip, deflate” -H “Accept-Language: zh-CN,zh;q=0.9” -H “User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3724.8 Safari/537.36” -H “Content-Type: application/json;charset=utf-8” -H “Accept: <em>/</em>“ -H “Referer: <a target="_blank" rel="noopener" href="http://sim.openluat.com/shortmessage&quot;">http://sim.openluat.com/shortmessage&quot;</a> -H “Cookie: UM_distinctid=169edacd4c563-0b551a9004e2b5-75442645-15f900-169edacd4c649; Hm_lvt_b73e49f8578cedfcb3c39e6e8db9d782=1554470721,1554627976; session=265c02fa-982d-4a02-949b-3189abefee42.Z420iEAp0CWipATs5949w2Dl9ig” -H “Connection: keep-alive” –compressed</p>
<p>待续….</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/04/12/579/" data-id="ckkfmdgcc0085vkcg1mvhfd0b" data-title="sim.openluat.com 其他接口" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-578" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/12/578/" class="article-date">
  <time class="dt-published" datetime="2019-04-12T04:17:00.000Z" itemprop="datePublished">2019-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/12/578/">物联网卡平台各种语言api</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近在对接合宙物联网卡系统和我自建的系统<br>网上的例子只有python的不太方便<br>提供别的例子方便下大家</p>
<p>c语言_登录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CURL *hnd = curl_easy_init();</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_CUSTOMREQUEST, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_URL, <span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">curl_slist</span> *<span class="title">headers</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;cache-control: no-cache&quot;</span>);</span><br><span class="line">headers = curl_slist_append(headers, <span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_HTTPHEADER, headers);</span><br><span class="line">curl_easy_setopt(hnd, CURLOPT_POSTFIELDS, <span class="string">&quot;&#123;\&quot;phone\&quot;:\&quot;用户名\&quot;,\&quot;password\&quot;:\&quot;密码\&quot;&#125;&quot;</span>);</span><br><span class="line">CURLcode ret = curl_easy_perform(hnd);</span><br></pre></td></tr></table></figure>
<p>go_登录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	url := <span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span></span><br><span class="line">	payload := strings.NewReader(<span class="string">&quot;&#123;\&quot;phone\&quot;:\&quot;用户名\&quot;,\&quot;password\&quot;:\&quot;密码\&quot;&#125;&quot;</span>)</span><br><span class="line">	req, _ := http.NewRequest(<span class="string">&quot;POST&quot;</span>, url, payload)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">	req.Header.Add(<span class="string">&quot;cache-control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>)</span><br><span class="line">	res, _ := http.DefaultClient.Do(req)</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">	body, _ := ioutil.ReadAll(res.Body)</span><br><span class="line">	fmt.Println(res)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java OK HTTP_登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">MediaType mediaType = MediaType.parse(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">RequestBody body = RequestBody.create(mediaType, <span class="string">&quot;&#123;\&quot;phone\&quot;:\&quot;用户名\&quot;,\&quot;password\&quot;:\&quot;密码\&quot;&#125;&quot;</span>);</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span>)</span><br><span class="line">  .post(body)</span><br><span class="line">  .addHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">  .addHeader(<span class="string">&quot;cache-control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>)</span><br><span class="line">  .build();</span><br><span class="line"></span><br><span class="line">Response response = client.newCall(request).execute();</span><br></pre></td></tr></table></figure>
<p>nodejs_登录</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> unirest = <span class="built_in">require</span>(<span class="string">&quot;unirest&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = unirest(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">req.headers(&#123;</span><br><span class="line">  <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.type(<span class="string">&quot;json&quot;</span>);</span><br><span class="line">req.send(&#123;</span><br><span class="line">  <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;密码&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (res.error) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(res.error);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(res.body);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>objective-c_登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NSDictionary *headers &#x3D; @&#123; @&quot;Content-Type&quot;: @&quot;application&#x2F;json&quot;,</span><br><span class="line">                           @&quot;cache-control&quot;: @&quot;no-cache&quot; &#125;;</span><br><span class="line">NSDictionary *parameters &#x3D; @&#123; @&quot;phone&quot;: @&quot;用户名&quot;,</span><br><span class="line">                              @&quot;password&quot;: @&quot;密码&quot; &#125;;</span><br><span class="line"></span><br><span class="line">NSData *postData &#x3D; [NSJSONSerialization dataWithJSONObject:parameters options:0 error:nil];</span><br><span class="line"></span><br><span class="line">NSMutableURLRequest *request &#x3D; [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http:&#x2F;&#x2F;sim.openluat.com&#x2F;api&#x2F;auth&#x2F;customer&#x2F;login&quot;]</span><br><span class="line">                                                       cachePolicy:NSURLRequestUseProtocolCachePolicy</span><br><span class="line">                                                   timeoutInterval:10.0];</span><br><span class="line">[request setHTTPMethod:@&quot;POST&quot;];</span><br><span class="line">[request setAllHTTPHeaderFields:headers];</span><br><span class="line">[request setHTTPBody:postData];</span><br><span class="line"></span><br><span class="line">NSURLSession *session &#x3D; [NSURLSession sharedSession];</span><br><span class="line">NSURLSessionDataTask *dataTask &#x3D; [session dataTaskWithRequest:request</span><br><span class="line">                                            completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;</span><br><span class="line">                                                if (error) &#123;</span><br><span class="line">                                                    NSLog(@&quot;%@&quot;, error);</span><br><span class="line">                                                &#125; else &#123;</span><br><span class="line">                                                    NSHTTPURLResponse *httpResponse &#x3D; (NSHTTPURLResponse *) response;</span><br><span class="line">                                                    NSLog(@&quot;%@&quot;, httpResponse);</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;];</span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure>
<p>Ocaml_登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">open Cohttp_lwt_unix</span><br><span class="line">open Cohttp</span><br><span class="line">open Lwt</span><br><span class="line"></span><br><span class="line">let uri &#x3D; Uri.of_string &quot;http:&#x2F;&#x2F;sim.openluat.com&#x2F;api&#x2F;auth&#x2F;customer&#x2F;login&quot; in</span><br><span class="line">let headers &#x3D; Header.init ()</span><br><span class="line">  |&gt; fun h -&gt; Header.add h &quot;Content-Type&quot; &quot;application&#x2F;json&quot;</span><br><span class="line">  |&gt; fun h -&gt; Header.add h &quot;cache-control&quot; &quot;no-cache&quot;</span><br><span class="line">in</span><br><span class="line">let body &#x3D; Cohttp_lwt_body.of_string &quot;&#123;\&quot;phone\&quot;:\&quot;用户名\&quot;,\&quot;password\&quot;:\&quot;密码\&quot;&#125;&quot; in</span><br><span class="line"></span><br><span class="line">Client.call ~headers ~body &#96;POST uri</span><br><span class="line">&gt;&gt;&#x3D; fun (res, body_stream) -&gt;</span><br><span class="line">  (* Do stuff with the result *)</span><br></pre></td></tr></table></figure>
<p>php_登录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span> = <span class="keyword">new</span> HttpRequest();</span><br><span class="line"><span class="variable">$request</span>-&gt;setUrl(<span class="string">&#x27;http://sim.openluat.com/api/auth/customer/login&#x27;</span>);</span><br><span class="line"><span class="variable">$request</span>-&gt;setMethod(HTTP_METH_POST);</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span>-&gt;setHeaders(<span class="keyword">array</span>(</span><br><span class="line">  <span class="string">&#x27;cache-control&#x27;</span> =&gt; <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span>-&gt;setBody(<span class="string">&#x27;&#123;&quot;phone&quot;:&quot;用户名&quot;,&quot;password&quot;:&quot;密码&quot;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$response</span> = <span class="variable">$request</span>-&gt;send();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$response</span>-&gt;getBody();</span><br><span class="line">&#125; <span class="keyword">catch</span> (HttpException <span class="variable">$ex</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$ex</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ruby_登录</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;uri&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;net/http&#x27;</span></span><br><span class="line"></span><br><span class="line">url = URI(<span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span>)</span><br><span class="line"></span><br><span class="line">http = Net::HTTP.new(url.host, url.port)</span><br><span class="line"></span><br><span class="line">request = Net::HTTP::Post.new(url)</span><br><span class="line">request[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">request[<span class="string">&quot;cache-control&quot;</span>] = <span class="string">&#x27;no-cache&#x27;</span></span><br><span class="line">request.body = <span class="string">&quot;&#123;\&quot;phone\&quot;:\&quot;用户名\&quot;,\&quot;password\&quot;:\&quot;密码\&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">response = http.request(request)</span><br><span class="line">puts response.read_body</span><br></pre></td></tr></table></figure>
<p>swift_登录</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> headers <span class="operator">=</span> [</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> parameters <span class="operator">=</span> [</span><br><span class="line">  <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;密码&quot;</span></span><br><span class="line">] <span class="keyword">as</span> [<span class="type">String</span> : <span class="keyword">Any</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> postData <span class="operator">=</span> <span class="type">JSONSerialization</span>.data(withJSONObject: parameters, options: [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">NSMutableURLRequest</span>(url: <span class="type">NSURL</span>(string: <span class="string">&quot;http://sim.openluat.com/api/auth/customer/login&quot;</span>)<span class="operator">!</span> <span class="keyword">as</span> <span class="type">URL</span>,</span><br><span class="line">                                        cachePolicy: .useProtocolCachePolicy,</span><br><span class="line">                                    timeoutInterval: <span class="number">10.0</span>)</span><br><span class="line">request.httpMethod <span class="operator">=</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">request.allHTTPHeaderFields <span class="operator">=</span> headers</span><br><span class="line">request.httpBody <span class="operator">=</span> postData <span class="keyword">as</span> <span class="type">Data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> session <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line"><span class="keyword">let</span> dataTask <span class="operator">=</span> session.dataTask(with: request <span class="keyword">as</span> <span class="type">URLRequest</span>, completionHandler: &#123; (data, response, error) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">if</span> (error <span class="operator">!=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span></span><br><span class="line">    <span class="built_in">print</span>(httpResponse)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">dataTask.resume()</span><br></pre></td></tr></table></figure>
<p>返回数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;api_url&quot;</span>: <span class="string">&quot;/api/wechat/openapidoc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;xxxxx@airm2m.com&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;enable_recharge&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;公司&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;130xxxxxx&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;role&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/04/12/578/" data-id="ckkfmdgcc0084vkcgdmvi0dsu" data-title="物联网卡平台各种语言api" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-577" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/07/577/" class="article-date">
  <time class="dt-published" datetime="2019-04-07T15:29:29.000Z" itemprop="datePublished">2019-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/07/577/">基站定位数据下载</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <pre><code>                        &lt;p&gt;去年研究基站定位的时候发现的&lt;br&gt;&lt;/p&gt;&lt;p&gt;可以用这个自己写查询接口或者查询软件了&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;http://oldask.openluat.com/image/show/attachments-2019-04-k8TcCNLS5caa174cd9351.jpg&quot; class=&quot;img-responsive&quot; style=&quot;width: 800px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://opencellid.org/downloads.php?token=5ac8658ed9385c&quot;&gt;https://opencellid.org/downloads.php?token=5ac8658ed9385c&lt;/a&gt;&lt;a href=&quot;https://opencellid.org/downloads.php?token=5ac8658ed9385c&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;如果上面的token不好用,可以自己重新注册,下载都是免费的&lt;br&gt;&lt;br&gt;&lt;/p&gt;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2019/04/07/577/" data-id="ckkfmdgcb0083vkcg9epq3w8a" data-title="基站定位数据下载" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/39/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="page-number current">40</span><a class="page-number" href="/page/41/">41</a><a class="page-number" href="/page/42/">42</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><a class="extend next" rel="next" href="/page/41/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2032/01/">一月 2032</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2032/01/01/608/">【置顶】合宙模块资料汇总</a>
          </li>
        
          <li>
            <a href="/2022/12/31/638/">Air系列模块常见问题列表</a>
          </li>
        
          <li>
            <a href="/2021/01/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/01/27/2420/">ECMAScript(ES6)基本语法介绍（一）</a>
          </li>
        
          <li>
            <a href="/2021/01/26/2417/">Air720S系列_luat二次开发固件（ 底层软件+上层脚本）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 chenxuuu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>