<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title> 如何发布一个npm包 | Luat doc 社区文章静态页面镜像</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="如何发布一个npm包背景应公司发展需要，需要把目前我们所用的编辑器，进行封装开源。如我们所知进行开源的项目封装和我们平时所写的项目和业务还是有所区别的，所以花了一点时间去了解相关写法。 目录结构123456789101112131415161718│  .babelrc│  .gitignore│  .npmignore│  package-lock.json│  package.json│  R">
<meta property="og:type" content="article">
<meta property="og:title" content=" 如何发布一个npm包">
<meta property="og:url" content="https://doc.luatos.wiki/2020/12/29/2142/index.html">
<meta property="og:site_name" content="Luat doc 社区文章静态页面镜像">
<meta property="og:description" content="如何发布一个npm包背景应公司发展需要，需要把目前我们所用的编辑器，进行封装开源。如我们所知进行开源的项目封装和我们平时所写的项目和业务还是有所区别的，所以花了一点时间去了解相关写法。 目录结构123456789101112131415161718│  .babelrc│  .gitignore│  .npmignore│  package-lock.json│  package.json│  R">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-12-29T07:31:44.000Z">
<meta property="article:modified_time" content="2021-01-27T16:09:27.337Z">
<meta property="article:author" content="chenxuuu">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Luat doc 社区文章静态页面镜像" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luat doc 社区文章静态页面镜像</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://doc.luatos.wiki"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2142" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/29/2142/" class="article-date">
  <time class="dt-published" datetime="2020-12-29T07:31:44.000Z" itemprop="datePublished">2020-12-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
       如何发布一个npm包
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="如何发布一个npm包"><a href="#如何发布一个npm包" class="headerlink" title="如何发布一个npm包"></a>如何发布一个npm包</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>应公司发展需要，需要把目前我们所用的编辑器，进行封装开源。如我们所知进行开源的项目封装和我们平时所写的项目和业务还是有所区别的，所以花了一点时间去了解相关写法。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">│  .babelrc</span><br><span class="line">│  .gitignore</span><br><span class="line">│  .npmignore</span><br><span class="line">│  package-lock.json</span><br><span class="line">│  package.json</span><br><span class="line">│  README.md</span><br><span class="line">├─components <span class="comment">// 组件源代码目录</span></span><br><span class="line">│</span><br><span class="line">├─config  <span class="comment">// webpack 配置文件</span></span><br><span class="line">│      webpack.base.js</span><br><span class="line">│      webpack.dev.config.js</span><br><span class="line">│      webpack.prod.config.js</span><br><span class="line">│</span><br><span class="line">├─demo <span class="comment">// 案例demo文件</span></span><br><span class="line">│  └─src</span><br><span class="line">│</span><br><span class="line">└─lib <span class="comment">// 最终打包放到npm的文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h2><p>一般情况下，我们写 React 项目，用 create-react-app 脚手架开发比较方便，但是如果要写一个插件的话，用三方脚手架就显得有点臃肿了，所以我们这里需要自己配置一个开发打包工具。我的package.json文件配置如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;react-ritch-markdown&quot;</span>, <span class="comment">// 项目名</span></span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>, <span class="comment">// 版本</span></span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;一个基于antd的同时支持markdown和ritch的编辑器&quot;</span>, <span class="comment">// 基本介绍</span></span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;lib/index.js&quot;</span>, <span class="comment">// 入口文件</span></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack-dev-server --config config/webpack.dev.config.js&quot;</span>, <span class="comment">// 启动命令</span></span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config config/webpack.prod.config.js&quot;</span>, <span class="comment">// 打包命令</span></span><br><span class="line">    <span class="string">&quot;pub&quot;</span>: <span class="string">&quot;npm run build &amp;&amp; npm publish&quot;</span> <span class="comment">// 发布命令</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [ <span class="comment">// 搜索关键词</span></span><br><span class="line">    <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ritch&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;clairoll&quot;</span>, <span class="comment">// 作者名</span></span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@babel/cli&quot;</span>: <span class="string">&quot;^7.5.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/core&quot;</span>: <span class="string">&quot;^7.5.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span>: <span class="string">&quot;^7.12.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>: <span class="string">&quot;^7.12.10&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/preset-env&quot;</span>: <span class="string">&quot;^7.5.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@babel/preset-react&quot;</span>: <span class="string">&quot;^7.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-loader&quot;</span>: <span class="string">&quot;^8.0.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-plugin-import&quot;</span>: <span class="string">&quot;^1.13.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;clean-webpack-plugin&quot;</span>: <span class="string">&quot;^3.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;less&quot;</span>: <span class="string">&quot;^4.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;less-loader&quot;</span>: <span class="string">&quot;^7.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mini-css-extract-plugin&quot;</span>: <span class="string">&quot;^0.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react&quot;</span>: <span class="string">&quot;^16.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;^16.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style-loader&quot;</span>: <span class="string">&quot;^1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url-loader&quot;</span>: <span class="string">&quot;^4.1.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.39.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^3.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-merge&quot;</span>: <span class="string">&quot;^4.2.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@liradb2000/markdown-it-mermaid&quot;</span>: <span class="string">&quot;^0.4.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;antd&quot;</span>: <span class="string">&quot;^4.9.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;axios&quot;</span>: <span class="string">&quot;^0.21.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;braft-editor&quot;</span>: <span class="string">&quot;^2.3.9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;braft-extensions&quot;</span>: <span class="string">&quot;^0.1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;highlight.js&quot;</span>: <span class="string">&quot;^10.5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;markdown-it&quot;</span>: <span class="string">&quot;^11.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;markdown-it-toc&quot;</span>: <span class="string">&quot;^1.1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-markdown-editor-lite&quot;</span>: <span class="string">&quot;^1.2.2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="webpack配置"><a href="#webpack配置" class="headerlink" title="webpack配置"></a>webpack配置</h2><h3 id="webpack-base-config-js"><a href="#webpack-base-config-js" class="headerlink" title="webpack.base.config.js"></a>webpack.base.config.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Autor: Clairoll</span></span><br><span class="line"><span class="comment"> * @Date: 2020-12-24 14:02:18</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-12-25 15:11:08</span></span><br><span class="line"><span class="comment"> * @Email: 1755033445@qq.com</span></span><br><span class="line"><span class="comment"> * @description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 使用 babel-loader 来编译处理 js 和 jsx 文件</span></span><br><span class="line">                test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">                use: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123; <span class="attr">loader</span>: <span class="string">&quot;style-loader&quot;</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">loader</span>: <span class="string">&quot;css-loader&quot;</span> &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123; <span class="attr">loader</span>: <span class="string">&quot;style-loader&quot;</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">loader</span>: <span class="string">&quot;css-loader&quot;</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">loader</span>: <span class="string">&quot;less-loader&quot;</span> &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.(woff|svg|eot|ttf)\??.*$/</span>,</span><br><span class="line">                use:&#123;<span class="attr">loader</span>:<span class="string">&#x27;url-loader?nmae=fonts/[name].[md5:hash:hex:7].[ext]&#x27;</span>&#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                  test: <span class="regexp">/\.(png|jpg|gif)$/i</span>,</span><br><span class="line">                  use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                      options: &#123;</span><br><span class="line">                          limit: <span class="literal">false</span>,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">              &#125;,</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">&quot;*&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.tsx&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.jsx&quot;</span>, <span class="string">&quot;.json&quot;</span>]</span><br><span class="line">        <span class="comment">// extensions默认值js,json使用此选项，会覆盖默认数组，这就意味着 webpack 不再尝试使用默认扩展来解析模块。对于使用其扩展导入的模块，例如，import SomeFile from &quot;./somefile.ext&quot;，要想正确的解析，一个包含“*”的字符串必须包含在数组中。</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="webpack-dev-config-js"><a href="#webpack-dev-config-js" class="headerlink" title="webpack.dev.config.js"></a>webpack.dev.config.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Autor: Clairoll</span></span><br><span class="line"><span class="comment"> * @Date: 2020-12-24 14:02:45</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-12-24 15:34:02</span></span><br><span class="line"><span class="comment"> * @Email: 1755033445@qq.com</span></span><br><span class="line"><span class="comment"> * @description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base.js&#x27;</span>); <span class="comment">// 引用公共配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  mode: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">  entry: path.join(__dirname, <span class="string">&quot;../demo/src/app.js&quot;</span>), <span class="comment">// 项目入口，处理资源文件的依赖关系</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.join(__dirname, <span class="string">&quot;../demo/src/&quot;</span>),</span><br><span class="line">    filename: <span class="string">&quot;bundle.js&quot;</span>, <span class="comment">// 使用webpack-dev-sevrer启动开发服务时，并不会实际在`src`目录下生成bundle.js，打包好的文件是在内存中的，但并不影响我们使用。</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: path.join(__dirname, <span class="string">&#x27;../demo/src/&#x27;</span>),</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    port: <span class="number">3001</span>, <span class="comment">// 启动端口为 3001 的服务</span></span><br><span class="line">    open: <span class="literal">true</span> <span class="comment">// 自动打开浏览器</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(devConfig, baseConfig); <span class="comment">// 将baseConfig和devConfig合并为一个配置</span></span><br></pre></td></tr></table></figure>


<h3 id="webpack-prod-config-js"><a href="#webpack-prod-config-js" class="headerlink" title="webpack.prod.config.js"></a>webpack.prod.config.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Autor: Clairoll</span></span><br><span class="line"><span class="comment"> * @Date: 2020-12-24 14:03:10</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-12-24 16:04:34</span></span><br><span class="line"><span class="comment"> * @Email: 1755033445@qq.com</span></span><br><span class="line"><span class="comment"> * @description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base.js&#x27;</span>); <span class="comment">// 引用公共的配置</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>); <span class="comment">// 用于将组件的css打包成单独的文件输出到`lib`目录中</span></span><br><span class="line"><span class="comment">// 引入 注意是使用解构的方式引入的 名字一定要正确</span></span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">    entry: path.join(__dirname, <span class="string">&quot;../components/index.jsx&quot;</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">&quot;../lib/&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">        libraryTarget: <span class="string">&#x27;umd&#x27;</span>, <span class="comment">// 采用通用模块定义</span></span><br><span class="line">        libraryExport: <span class="string">&#x27;default&#x27;</span>, <span class="comment">// 兼容 ES6 的模块系统、CommonJS 和 AMD 模块规范</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">&quot;main.min.css&quot;</span> <span class="comment">// 提取后的css的文件名</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    externals: &#123; <span class="comment">// 定义外部依赖，避免把react和react-dom打包进去</span></span><br><span class="line">        react: &#123;</span><br><span class="line">            root: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">            commonjs2: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">            commonjs: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">            amd: <span class="string">&quot;react&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;react-dom&quot;</span>: &#123;</span><br><span class="line">            root: <span class="string">&quot;ReactDOM&quot;</span>,</span><br><span class="line">            commonjs2: <span class="string">&quot;react-dom&quot;</span>,</span><br><span class="line">            commonjs: <span class="string">&quot;react-dom&quot;</span>,</span><br><span class="line">            amd: <span class="string">&quot;react-dom&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;antd&quot;</span>: &#123;</span><br><span class="line">            root: <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">            commonjs2: <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">            commonjs: <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">            amd: <span class="string">&quot;antd&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(prodConfig, baseConfig); <span class="comment">// 将baseConfig和prodConfig合并为一个配置</span></span><br></pre></td></tr></table></figure>
<p><span style="color:red">注意：</span></p>
<ol>
<li>entry的入口文件位置，由开发环境的src/index.js改成了组件的出口src/components/index.js，表示此处只负责输出组件。</li>
<li>output的libraryTarget需要为commonjs2。</li>
<li>通过nodeExternals()将打包组件内的react等依赖给去除了，减小了包的体积，在引用该包时，只要其环境下有相关包，就可以正常使用。</li>
</ol>
<h2 id="调试验证"><a href="#调试验证" class="headerlink" title="调试验证"></a>调试验证</h2><p>在上传到npm 之前我们需要验证自己的组件在打包过后是否可以使用。</p>
<p>第一步：打包 <code>npm run build </code></p>
<p>第二步： 在组件项目的根目录下运行  <code>npm link</code> 将组件映射到本地库</p>
<p>第三步：进入案例demo文件夹下，运行 <code>npm link 包名</code> 然后修改引入方式</p>
<p>如果项目正常运行则表示成功，反之则存在问题</p>
<h2 id="发布到npm"><a href="#发布到npm" class="headerlink" title="发布到npm"></a>发布到npm</h2><ol>
<li><p>准备npm账号,npm官网地址：<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a></p>
</li>
<li><p>在组件的项目根目录下登录npm</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>按照提示输入username、password、email<br>登录后，可以通过npm whoami来查看登录用户信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>发布组件到npm上</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run pub</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://doc.luatos.wiki/2020/12/29/2142/" data-id="ckkfmdgae0031vkcg4lsif2ek" data-title=" 如何发布一个npm包" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/12/30/2149/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          yield与dva流程控制
        
      </div>
    </a>
  
  
    <a href="/2020/12/28/2140/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">MIT 6.824 Distributed Systems 分布式系统课程系列4 Lab 4: Sharded Key/Value Service(上)</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2032/01/">一月 2032</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2032/01/01/608/">【置顶】合宙模块资料汇总</a>
          </li>
        
          <li>
            <a href="/2022/12/31/638/">Air系列模块常见问题列表</a>
          </li>
        
          <li>
            <a href="/2021/01/27/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/01/27/2420/">ECMAScript(ES6)基本语法介绍（一）</a>
          </li>
        
          <li>
            <a href="/2021/01/26/2417/">Air720S系列_luat二次开发固件（ 底层软件+上层脚本）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 chenxuuu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>