---
title: "合宙Cat1超低功耗方案"
date: 2020-12-17 21:08:51
---

<h2><span style="color:#000000">一、超低功耗是什么</span></h2><p>超低功耗是相对于低功耗而言的。考虑到模块大部分应用场景：系统休眠后，依然需要隔一段时间进行数据收发，来上报设备的状态。所以传统的低功耗数据只具备一定的参考意义，实际业务场景下，并不能达到这个数值。超低功耗是针对【隔段时间收发数据】这一场景的特定优化，来降低产品的整体功耗。</p><p><strong>特别说明：不管是进入低功耗还是超低功耗状态，都不会丢失服务器发来的数据。</strong></p><h2><span style="color:#000000">二、能降低多少功耗</span></h2><p>合宙Cat1 AT标准固件，在实网下测量的功耗数据如下：</p><p></p><table border="1" style="border-collapse: collapse"><colgroup><col width="0"></col><col width="0"></col><col width="0"></col><col width="0"></col><col width="0"></col></<colgroup><tr><td style="text-align:center;" colSpan="2" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">测试项</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">移动BAND40</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">联通BAND1</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">电信BAND1</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">样机数量</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">3PCS</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1#</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1#</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1#</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">信号质量</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT+CESQ</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">67</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">61</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">68</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="3"><span style="font-size:14px"><span style="color:#000000">飞行模式(mA)</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">底电流</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.2</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.2</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.2</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT+CFUN=0</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT+CFUN=4</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.21</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">工作电流(mA)</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">IDLE模式</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">12.37</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">11.98</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">12.72</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">休眠电流(mA)</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT+CSCLK=2</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.96</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1.72</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">2.71</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">TCP心跳包保活(mA)</span></span><br/><span style="font-size:14px"><span style="color:#000000">（默认设置）</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1分钟一次</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">10.17</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">9.32</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">8.29</span></span></td></tr><tr><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">TCP心跳包保活(mA)</span></span><br/><span style="font-size:14px"><span style="color:#000000">（超低功耗AT*RTIME=1）</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">1分钟一次</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">3.95</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">3.76</span></span></td><td style="text-align:center;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">4.41</span></span></td></tr></table><p>从最后两行对比结果看，超低功耗模式下，<strong>心跳包保活场景功耗降低了一半以上。</strong></p><p><strong>注意：实际测量数据会受网络信号、是否已经注册上网、外围是否接了设备因素影响，如果差异比较大建议先断开外围设备，进入飞行模式对比一下数据。</strong></p><h2><span style="color:#000000">三、什么时候用</span></h2><p>超低功耗可用于大多数的数传业务场景。这些场景有一个共同的特点：需要传输数据的时候利用网络进行数据传输，传输完成后，设备进入心跳包保活状态。超低功耗正是针对心跳保活功耗的优化来实现整体功耗的降低。典型产品场景有：云喇叭、监控摄像头、共享设备、远程控制等。</p><h2><span style="color:#000000">四、怎么用</span></h2><p>首先，打开进入低功耗休眠模式，让设备空闲状态下进入低功耗状态；其次，通过AT命令AT*RTIME打开超低功耗模式。下面以AT版本为例，设置步骤如下：</p><p>1，打开低功耗模式：AT+CSCLK=2</p><p>2，关闭网络灯：AT+CNETLIGHT=0</p><p>3，关闭日志： AT^TRACECTRL=0,0和AT^TRACECTRL=1,0</p><p>4，设置串口立即休眠：AT+WAKETIM=1</p><p>5，设置超低功耗：AT*RTIME=2</p><p>步骤1-4参考通用AT指令手册。</p><p>下面单独介绍一下超低功耗AT指令：</p><p>AT*RTIME=&lt;n&gt;</p><p><span style="color:#333333">该命令设置后会被保存到NV中，掉电后存储。</span></p><p><strong><span style="font-size:12px"><span style="color:#444444">语法规则：</span></span></strong></p><p></p><table border="1" style="border-collapse: collapse"><colgroup><col width="0"></col><col width="0"></col><col width="0"></col></<colgroup><tr><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">命令类型</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">语法</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">返回</span></span></td></tr><tr><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">设置命令</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT*RTIME=&lt;wait_time&gt;</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">OK</span></span></td></tr><tr><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">查询命令</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">AT*RTIME？</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">*RTIME: &lt;wait_time&gt; OK</span></span></td></tr></table><p><strong><span style="font-size:12px"><span style="color:#444444">参数定义：</span></span></strong></p><p></p><table border="1" style="border-collapse: collapse"><colgroup><col width="0"></col><col width="0"></col><col width="0"></col><col width="0"></col></<colgroup><tr><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">参数</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">定义</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">取值</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">对取值的说明</span></span></td></tr><tr><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">&lt;wait_time&gt;</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">在数传模式下，等待多长时间进入休眠状态</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">0~20</span></span></td><td style="text-align:left;" colSpan="1" rowSpan="1"><span style="font-size:14px"><span style="color:#000000">单位:秒，0表示关闭。</span></span></td></tr></table><p>信号正常情况下，&lt;n&gt;值越短功耗就越低，建议设置为2。如果实际使用环境信号比较差，数据收发经常出现重传延迟，那这个值就需要改大。</p><p><br/></p><h2><span style="color:#000000">五、哪个版本才支持</span></h2><p>AT版本&gt;=V301716</p><p>Lua版本&gt;=V3024</p><p>CSDK版&gt;= 2020-12-19提交 <a href="https://gitee.com/openLuat/Luat_CSDK_Air724U" target="">https://gitee.com/openLuat/Luat_CSDK_Air724U</a></p><p></p><h2><span style="color:#000000">六、要注意什么</span></h2><p>1，在进行CTA/GCF等测试认证的时候需要关闭该功能。</p><p>2，如果心跳包比较频繁，不如10秒一次，那就不建议开启这个功能，极端情况下可能会导致设备断网。</p><p>3，如果数传是基于UDP这种非可靠传输，打开这个功能后，丢包概率会变大。<br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>