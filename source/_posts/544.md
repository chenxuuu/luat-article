---
title: "不敢私藏：Air202, 按键长按重启和特长按回退为出厂版本，感谢 李炜镪"
date: 2019-01-16 17:23:33
---

<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'Menlo';font-size:9.0pt;"><span style="color:#bf6060;">module</span>(<span style="color:#9966ff;">...</span><span style="color:#cc7832;">, </span><span style="color:#bf6060;">package</span>.<span style="color:#a39d2b;">seeall</span>)<br><br><span style="color:#bf6060;">require </span><span style="color:#6a8759;">'pins'<br></span><span style="color:#cc6acc;font-style:italic;"><br></span><span style="color:#cc7832;font-weight:bold;">local </span><span style="color:#009999;">btnDown </span>= <span style="color:#cc6acc;font-style:italic;">false<br></span><span style="color:#cc7832;font-weight:bold;">local </span><span style="color:#009999;">st </span>= <span style="color:#6897bb;">0<br></span><span style="color:#6897bb;"><br></span><span style="color:#bf6060;">pins</span>.<span style="color:#a39d2b;">setup</span>(<span style="color:#bf6060;">pio</span>.<span style="color:#a39d2b;">P0_2</span><span style="color:#cc7832;">, </span><span style="color:#cc7832;font-weight:bold;">function</span>()<br>    <span style="color:#cc7832;font-weight:bold;">if </span><span style="font-weight:bold;font-style:italic;">btnDown </span><span style="color:#cc7832;font-weight:bold;">then<br></span><span style="color:#cc7832;font-weight:bold;">        local </span><span style="color:#009999;">d </span>= <span style="color:#bf6060;">os</span>.<span style="color:#a39d2b;">time</span>() - <span style="font-weight:bold;font-style:italic;">st<br></span><span style="font-weight:bold;font-style:italic;"><br></span><span style="font-weight:bold;font-style:italic;">        </span><span style="color:#cc7832;font-weight:bold;">if </span><span style="color:#009999;">d </span>> <span style="color:#6897bb;">4 </span><span style="color:#cc7832;font-weight:bold;">then<br></span><span style="color:#cc7832;font-weight:bold;">            </span><span style="color:#bf6060;">log</span>.<span style="color:#a39d2b;">info</span>(<span style="color:#6a8759;">'BUTTON'</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">'RESTORE DEVICE...'</span>)<br>            <span style="color:#bf6060;">assert</span>(<span style="color:#cc6acc;font-style:italic;">false</span>)<br>        <span style="color:#cc7832;font-weight:bold;">elseif </span><span style="color:#009999;">d </span>> <span style="color:#6897bb;">1 </span><span style="color:#cc7832;font-weight:bold;">then<br></span><span style="color:#cc7832;font-weight:bold;">            </span><span style="color:#bf6060;">log</span>.<span style="color:#a39d2b;">INFO</span>(<span style="color:#6a8759;">'BUTTON'</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">'RESTART DEVICE...'</span>)<br>            <span style="color:#bf6060;">sys</span>.<span style="color:#a39d2b;">restart</span>(<span style="color:#6a8759;">'BUTTON'</span>)<br>        <span style="color:#cc7832;font-weight:bold;">end<br></span><span style="color:#cc7832;font-weight:bold;"><br></span><span style="color:#cc7832;font-weight:bold;">        </span><span style="font-weight:bold;font-style:italic;">st </span>= <span style="color:#6897bb;">0<br></span><span style="color:#6897bb;">    </span><span style="color:#cc7832;font-weight:bold;">else<br></span><span style="color:#cc7832;font-weight:bold;">        </span><span style="font-weight:bold;font-style:italic;">st </span>= <span style="color:#bf6060;">os</span>.<span style="color:#a39d2b;">time</span>()<br>    <span style="color:#cc7832;font-weight:bold;">end<br></span><span style="color:#cc7832;font-weight:bold;">    </span><span style="font-weight:bold;font-style:italic;">btnDown </span>= <span style="color:#cc7832;font-weight:bold;">not </span><span style="font-weight:bold;font-style:italic;">btnDown<br></span><span style="color:#cc7832;font-weight:bold;">end</span>)</pre>
